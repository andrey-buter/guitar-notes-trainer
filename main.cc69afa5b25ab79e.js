"use strict";(self.webpackChunkalphatab_app=self.webpackChunkalphatab_app||[]).push([[590],{964:(am,P_,ha)=>{function sd(n,t,e,i,s,r,a){try{var o=n[r](a),l=o.value}catch(c){return void e(c)}o.done?t(l):Promise.resolve(l).then(i,s)}function qi(n){return function(){var t=this,e=arguments;return new Promise(function(i,s){var r=n.apply(t,e);function a(l){sd(r,i,s,a,o,"next",l)}function o(l){sd(r,i,s,a,o,"throw",l)}a(void 0)})}}let Xn=null,rd=1;const no=Symbol("SIGNAL");function Sn(n){const t=Xn;return Xn=n,t}function I_(n){if((!Lc(n)||n.dirty)&&(n.dirty||n.lastCleanEpoch!==rd)){if(!n.producerMustRecompute(n)&&!lm(n))return n.dirty=!1,void(n.lastCleanEpoch=rd);n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=rd}}function lm(n){tl(n);for(let t=0;t<n.producerNode.length;t++){const e=n.producerNode[t],i=n.producerLastReadVersion[t];if(i!==e.version||(I_(e),i!==e.version))return!0}return!1}function ad(n,t){if(function H_(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}(n),tl(n),1===n.liveConsumerNode.length)for(let i=0;i<n.producerNode.length;i++)ad(n.producerNode[i],n.producerIndexOfThis[i]);const e=n.liveConsumerNode.length-1;if(n.liveConsumerNode[t]=n.liveConsumerNode[e],n.liveConsumerIndexOfThis[t]=n.liveConsumerIndexOfThis[e],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,t<n.liveConsumerNode.length){const i=n.liveConsumerIndexOfThis[t],s=n.liveConsumerNode[t];tl(s),s.producerIndexOfThis[i]=t}}function Lc(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function tl(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}let W_=null;function rn(n){return"function"==typeof n}function um(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const hm=um(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,s)=>`${s+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function dm(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class Yi{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const r of e)r.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(rn(i))try{i()}catch(r){t=r instanceof hm?r.errors:[r]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const r of s)try{j_(r)}catch(a){t=t??[],a instanceof hm?t=[...t,...a.errors]:t.push(a)}}if(t)throw new hm(t)}}add(t){var e;if(t&&t!==this)if(this.closed)j_(t);else{if(t instanceof Yi){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&dm(e,t)}remove(t){const{_finalizers:e}=this;e&&dm(e,t),t instanceof Yi&&t._removeParent(this)}}Yi.EMPTY=(()=>{const n=new Yi;return n.closed=!0,n})();const z_=Yi.EMPTY;function $_(n){return n instanceof Yi||n&&"closed"in n&&rn(n.remove)&&rn(n.add)&&rn(n.unsubscribe)}function j_(n){rn(n)?n():n.unsubscribe()}const io={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},od={setTimeout(n,t,...e){const{delegate:i}=od;return i?.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=od;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function q_(n){od.setTimeout(()=>{const{onUnhandledError:t}=io;if(!t)throw n;t(n)})}function fm(){}const ZM=pm("C",void 0,void 0);function pm(n,t,e){return{kind:n,value:t,error:e}}let so=null;function ld(n){if(io.useDeprecatedSynchronousErrorHandling){const t=!so;if(t&&(so={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=so;if(so=null,e)throw i}}else n()}class gm extends Yi{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$_(t)&&t.add(this)):this.destination=aA}static create(t,e,i){return new Rc(t,e,i)}next(t){this.isStopped?ym(function tA(n){return pm("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?ym(function eA(n){return pm("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?ym(ZM,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const iA=Function.prototype.bind;function mm(n,t){return iA.call(n,t)}class sA{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){cd(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){cd(i)}else cd(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){cd(e)}}}class Rc extends gm{constructor(t,e,i){let s;if(super(),rn(t)||!t)s={next:t??void 0,error:e??void 0,complete:i??void 0};else{let r;this&&io.useDeprecatedNextContext?(r=Object.create(t),r.unsubscribe=()=>this.unsubscribe(),s={next:t.next&&mm(t.next,r),error:t.error&&mm(t.error,r),complete:t.complete&&mm(t.complete,r)}):s=t}this.destination=new sA(s)}}function cd(n){io.useDeprecatedSynchronousErrorHandling?function nA(n){io.useDeprecatedSynchronousErrorHandling&&so&&(so.errorThrown=!0,so.error=n)}(n):q_(n)}function ym(n,t){const{onStoppedNotification:e}=io;e&&od.setTimeout(()=>e(n,t))}const aA={closed:!0,next:fm,error:function rA(n){throw n},complete:fm},bm="function"==typeof Symbol&&Symbol.observable||"@@observable";function ro(n){return n}function Y_(n){return 0===n.length?ro:1===n.length?n[0]:function(e){return n.reduce((i,s)=>s(i),e)}}let Un=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,s){const r=function cA(n){return n&&n instanceof gm||function lA(n){return n&&rn(n.next)&&rn(n.error)&&rn(n.complete)}(n)&&$_(n)}(e)?e:new Rc(e,i,s);return ld(()=>{const{operator:a,source:o}=this;r.add(a?a.call(r,o):o?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=X_(i))((s,r)=>{const a=new Rc({next:o=>{try{e(o)}catch(l){r(l),a.unsubscribe()}},error:r,complete:s});this.subscribe(a)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[bm](){return this}pipe(...e){return Y_(e)(this)}toPromise(e){return new(e=X_(e))((i,s)=>{let r;this.subscribe(a=>r=a,a=>s(a),()=>i(r))})}}return n.create=t=>new n(t),n})();function X_(n){var t;return null!==(t=n??io.Promise)&&void 0!==t?t:Promise}const uA=um(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ui=(()=>{class n extends Un{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new J_(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new uA}next(e){ld(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){ld(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){ld(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:s,observers:r}=this;return i||s?z_:(this.currentObservers=null,r.push(e),new Yi(()=>{this.currentObservers=null,dm(r,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:s,isStopped:r}=this;i?e.error(s):r&&e.complete()}asObservable(){const e=new Un;return e.source=this,e}}return n.create=(t,e)=>new J_(t,e),n})();class J_ extends ui{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:z_}}class ss extends ui{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function Q_(n){return rn(n?.lift)}function ai(n){return t=>{if(Q_(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jn(n,t,e,i,s){return new hA(n,t,e,i,s)}class hA extends gm{constructor(t,e,i,s,r,a){super(t),this.onFinalize=r,this.shouldUnsubscribe=a,this._next=e?function(o){try{e(o)}catch(l){t.error(l)}}:super._next,this._error=s?function(o){try{s(o)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(o){t.error(o)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function mt(n,t){return ai((e,i)=>{let s=0;e.subscribe(Jn(i,r=>{i.next(n.call(t,r,s++))}))})}class z extends Error{constructor(t,e){super(function nl(n,t){return`NG0${Math.abs(n)}${t?": "+t:""}`}(t,e)),this.code=t}}function wm(n){return t=>{setTimeout(n,void 0,t)}}const hn=class dA extends ui{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){let s=t,r=e||(()=>null),a=i;if(t&&"object"==typeof t){const l=t;s=l.next?.bind(l),r=l.error?.bind(l),a=l.complete?.bind(l)}this.__isAsync&&(r=wm(r),s&&(s=wm(s)),a&&(a=wm(a)));const o=super.subscribe({next:s,error:r,complete:a});return t instanceof Yi&&t.add(o),o}};var dt=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(dt||{});function Qn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Qn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Sm(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}var hd=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(hd||{}),Ms=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(Ms||{});function Mr(n){return{toString:n}.toString()}const It=globalThis,ir={},vt=[];function At(n){for(let t in n)if(n[t]===At)return t;throw Error("Could not find renamed property on target object.")}function mA(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}const Oc=At({\u0275cmp:At}),_m=At({\u0275dir:At}),vm=At({\u0275pipe:At}),tv=At({\u0275mod:At}),Ar=At({\u0275fac:At}),Vc=At({__NG_ELEMENT_ID__:At}),nv=At({__NG_ENV_ID__:At});var an=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(an||{});function iv(n,t,e){let i=n.length;for(;;){const s=n.indexOf(t,e);if(-1===s)return s;if(0===s||n.charCodeAt(s-1)<=32){const r=t.length;if(s+r===i||n.charCodeAt(s+r)<=32)return s}e=s+1}}function Tm(n,t,e){let i=0;for(;i<e.length;){const s=e[i];if("number"==typeof s){if(0!==s)break;i++;const r=e[i++],a=e[i++],o=e[i++];n.setAttribute(t,a,o,r)}else{const r=s,a=e[++i];rv(r)?n.setProperty(t,r,a):n.setAttribute(t,r,a),i++}}return i}function sv(n){return 3===n||4===n||6===n}function rv(n){return 64===n.charCodeAt(0)}function Hc(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const s=t[i];"number"==typeof s?e=s:0===e||av(n,e,s,null,-1===e||2===e?t[++i]:null)}}return n}function av(n,t,e,i,s){let r=0,a=n.length;if(-1===t)a=-1;else for(;r<n.length;){const o=n[r++];if("number"==typeof o){if(o===t){a=-1;break}if(o>t){a=r-1;break}}}for(;r<n.length;){const o=n[r];if("number"==typeof o)break;if(o===e){if(null===i)return void(null!==s&&(n[r+1]=s));if(i===n[r+1])return void(n[r+2]=s)}r++,null!==i&&r++,null!==s&&r++}-1!==a&&(n.splice(a,0,t),r=a+1),n.splice(r++,0,e),null!==i&&n.splice(r++,0,i),null!==s&&n.splice(r++,0,s)}const ov="ng-template";function yA(n,t,e){let i=0,s=!0;for(;i<n.length;){let r=n[i++];if("string"==typeof r&&s){const a=n[i++];if(e&&"class"===r&&-1!==iv(a.toLowerCase(),t,0))return!0}else{if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}"number"==typeof r&&(s=!1)}}return!1}function lv(n){return 4===n.type&&n.value!==ov}function bA(n,t,e){return t===(4!==n.type||e?n.value:ov)}function wA(n,t,e){let i=4;const s=n.attrs||[],r=function vA(n){for(let t=0;t<n.length;t++)if(sv(n[t]))return t;return n.length}(s);let a=!1;for(let o=0;o<t.length;o++){const l=t[o];if("number"!=typeof l){if(!a)if(4&i){if(i=2|1&i,""!==l&&!bA(n,l,e)||""===l&&1===t.length){if(As(i))return!1;a=!0}}else{const c=8&i?l:t[++o];if(8&i&&null!==n.attrs){if(!yA(n.attrs,c,e)){if(As(i))return!1;a=!0}continue}const h=SA(8&i?"class":l,s,lv(n),e);if(-1===h){if(As(i))return!1;a=!0;continue}if(""!==c){let f;f=h>r?"":s[h+1].toLowerCase();const p=8&i?f:null;if(p&&-1!==iv(p,c,0)||2&i&&c!==f){if(As(i))return!1;a=!0}}}}else{if(!a&&!As(i)&&!As(l))return!1;if(a&&As(l))continue;a=!1,i=l|1&i}}return As(i)||a}function As(n){return 0==(1&n)}function SA(n,t,e,i){if(null===t)return-1;let s=0;if(i||!e){let r=!1;for(;s<t.length;){const a=t[s];if(a===n)return s;if(3===a||6===a)r=!0;else{if(1===a||2===a){let o=t[++s];for(;"string"==typeof o;)o=t[++s];continue}if(4===a)break;if(0===a){s+=4;continue}}s+=r?1:2}return-1}return function TA(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function cv(n,t,e=!1){for(let i=0;i<t.length;i++)if(wA(n,t[i],e))return!0;return!1}function uv(n,t){return n?":not("+t.trim()+")":t}function CA(n){let t=n[0],e=1,i=2,s="",r=!1;for(;e<n.length;){let a=n[e];if("string"==typeof a)if(2&i){const o=n[++e];s+="["+a+(o.length>0?'="'+o+'"':"")+"]"}else 8&i?s+="."+a:4&i&&(s+=" "+a);else""!==s&&!As(a)&&(t+=uv(r,s),s=""),i=a,r=r||!As(i);e++}return""!==s&&(t+=uv(r,s)),t}function Wc(n){return Mr(()=>{const t=dv(n),e={...t,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===hd.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Ms.Emulated,styles:n.styles||vt,_:null,schemas:n.schemas||null,tView:null,id:""};fv(e);const i=n.dependencies;return e.directiveDefs=dd(i,!1),e.pipeDefs=dd(i,!0),e.id=function PA(n){let t=0;const e=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const s of e)t=Math.imul(31,t)+s.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(e),e})}function xA(n){return ut(n)||Kn(n)}function EA(n){return null!==n}function il(n){return Mr(()=>({type:n.type,bootstrap:n.bootstrap||vt,declarations:n.declarations||vt,imports:n.imports||vt,exports:n.exports||vt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function hv(n,t){if(null==n)return ir;const e={};for(const i in n)if(n.hasOwnProperty(i)){const s=n[i];let r,a,o=an.None;Array.isArray(s)?(o=s[0],r=s[1],a=s[2]??r):(r=s,a=s),t?(e[r]=o!==an.None?[i,o]:i,t[r]=a):e[r]=i}return e}function $e(n){return Mr(()=>{const t=dv(n);return fv(t),t})}function Ni(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function ut(n){return n[Oc]||null}function Kn(n){return n[_m]||null}function hi(n){return n[vm]||null}function yi(n,t){const e=n[tv]||null;if(!e&&!0===t)throw new Error(`Type ${Qn(n)} does not have '\u0275mod' property.`);return e}function dv(n){const t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:n.inputs||ir,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||vt,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:hv(n.inputs,t),outputs:hv(n.outputs),debugInfo:null}}function fv(n){n.features?.forEach(t=>t(n))}function dd(n,t){if(!n)return null;const e=t?hi:xA;return()=>("function"==typeof n?n():n).map(i=>e(i)).filter(EA)}const ln=0,ee=1,Ee=2,En=3,Fs=4,bi=5,Ls=6,sl=7,Jt=8,di=9,Fr=10,Ye=11,Uc=12,pv=13,rl=14,dn=15,Gc=16,al=17,Lr=18,zc=19,gv=20,pa=21,fd=22,ao=23,Je=25,km=1,sr=7,ol=9,Bn=10;var Cm=function(n){return n[n.None=0]="None",n[n.HasTransplantedViews=2]="HasTransplantedViews",n}(Cm||{});function wi(n){return Array.isArray(n)&&"object"==typeof n[km]}function Si(n){return Array.isArray(n)&&!0===n[km]}function Dm(n){return 0!=(4&n.flags)}function oo(n){return n.componentOffset>-1}function gd(n){return 1==(1&n.flags)}function Rs(n){return!!n.template}function Nm(n){return 0!=(512&n[Ee])}const wv="svg";let _v=!1;function Ut(n){for(;Array.isArray(n);)n=n[ln];return n}function jc(n,t){return Ut(t[n])}function xi(n,t){return Ut(t[n.index])}function qc(n,t){return n.data[t]}function os(n,t){const e=t[n];return wi(e)?e:e[ln]}function Pm(n){return 128==(128&n[Ee])}function rr(n,t){return null==t?null:n[t]}function vv(n){n[al]=0}function VA(n){1024&n[Ee]||(n[Ee]|=1024,Pm(n)&&Yc(n))}function Im(n){return!!(9216&n[Ee]||n[ao]?.dirty)}function Mm(n){Im(n)?Yc(n):64&n[Ee]&&(function FA(){return _v}()?(n[Ee]|=1024,Yc(n)):n[Fr].changeDetectionScheduler?.notify())}function Yc(n){n[Fr].changeDetectionScheduler?.notify();let t=lo(n);for(;null!==t&&!(8192&t[Ee])&&(t[Ee]|=8192,Pm(t));)t=lo(t)}function lo(n){const t=n[En];return Si(t)?t[En]:t}const Ge={lFrame:Iv(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Cv(){return Ge.bindingsEnabled}function L(){return Ge.lFrame.lView}function ft(){return Ge.lFrame.tView}function Ss(n){return Ge.lFrame.contextLView=n,n[Jt]}function _s(n){return Ge.lFrame.contextLView=null,n}function Ft(){let n=Dv();for(;null!==n&&64===n.type;)n=n.parent;return n}function Dv(){return Ge.lFrame.currentTNode}function ar(n,t){const e=Ge.lFrame;e.currentTNode=n,e.isParent=t}function Fm(){return Ge.lFrame.isParent}function Lm(){Ge.lFrame.isParent=!1}function Ei(){const n=Ge.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Os(){return Ge.lFrame.bindingIndex++}function Or(n){const t=Ge.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function JA(n,t){const e=Ge.lFrame;e.bindingIndex=e.bindingRootIndex=n,Rm(t)}function Rm(n){Ge.lFrame.currentDirectiveIndex=n}function Vm(){return Ge.lFrame.currentQueryIndex}function yd(n){Ge.lFrame.currentQueryIndex=n}function KA(n){const t=n[ee];return 2===t.type?t.declTNode:1===t.type?n[bi]:null}function Bv(n,t,e){if(e&dt.SkipSelf){let s=t,r=n;for(;!(s=s.parent,null!==s||e&dt.Host||(s=KA(r),null===s||(r=r[rl],10&s.type))););if(null===s)return!1;t=s,n=r}const i=Ge.lFrame=Pv();return i.currentTNode=t,i.lView=n,!0}function Hm(n){const t=Pv(),e=n[ee];Ge.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Pv(){const n=Ge.lFrame,t=null===n?null:n.child;return null===t?Iv(n):t}function Iv(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function Mv(){const n=Ge.lFrame;return Ge.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Av=Mv;function Wm(){const n=Mv();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function _i(){return Ge.lFrame.selectedIndex}function co(n){Ge.lFrame.selectedIndex=n}function Qt(){const n=Ge.lFrame;return qc(n.tView,n.selectedIndex)}function uo(){Ge.lFrame.currentNamespace=wv}function Jc(){!function tF(){Ge.lFrame.currentNamespace=null}()}let Lv=!0;function bd(){return Lv}function ga(n){Lv=n}function nF(){return ul(Ft(),L())}function ul(n,t){return new ls(xi(n,t))}let $m,ls=(()=>{class n{constructor(e){this.nativeElement=e}static#e=this.__NG_ELEMENT_ID__=nF}return n})();function Rv(n){return n instanceof ls?n.nativeElement:n}function hl(n,t){n.forEach(e=>Array.isArray(e)?hl(e,t):t(e))}function Ov(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function wd(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function cs(n,t,e){let i=dl(n,t);return i>=0?n[1|i]=e:(i=~i,function Vv(n,t,e,i){let s=n.length;if(s==t)n.push(e,i);else if(1===s)n.push(i,n[0]),n[0]=e;else{for(s--,n.push(n[s-1],n[s]);s>t;)n[s]=n[s-2],s--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function Gm(n,t){const e=dl(n,t);if(e>=0)return n[1|e]}function dl(n,t){return function Hv(n,t,e){let i=0,s=n.length>>e;for(;s!==i;){const r=i+(s-i>>1),a=n[r<<e];if(t===a)return r<<e;a>t?s=r:i=r+1}return~(s<<e)}(n,t,1)}function sF(){return this._results[Symbol.iterator]()}class zm{static#e=Symbol.iterator;get changes(){return this._changes??=new hn}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const e=zm.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=sF)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;const i=function Xi(n){return n.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function iF(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let s=n[i],r=t[i];if(e&&(s=e(s),r=e(r)),r!==s)return!1}return!0}(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function _d(n){return 128==(128&n.flags)}function fe(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ho(n){return{providers:n.providers||[],imports:n.imports||[]}}function Td(n){return Gv(n,Cd)||Gv(n,zv)}function Gv(n,t){return n.hasOwnProperty(t)?n[t]:null}function kd(n){return n&&(n.hasOwnProperty(jm)||n.hasOwnProperty(cF))?n[jm]:null}const Cd=At({\u0275prov:At}),jm=At({\u0275inj:At}),zv=At({ngInjectableDef:At}),cF=At({ngInjectorDef:At});class ce{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=fe({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const qm=new ce("",{providedIn:"root",factory:()=>uF}),uF="ng",$v=new ce(""),fo=new ce("",{providedIn:"platform",factory:()=>"unknown"}),jv=new ce("",{providedIn:"root",factory:()=>function ma(){if(void 0!==$m)return $m;if(typeof document<"u")return document;throw new z(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),fF=At({__forward_ref__:At});function Kt(n){return n.__forward_ref__=Kt,n.toString=function(){return Qn(this())},n}function Ue(n){return Dd(n)?n():n}function Dd(n){return"function"==typeof n&&n.hasOwnProperty(fF)&&n.__forward_ref__===Kt}function Km(n){return n&&!!n.\u0275providers}function Qe(n){return"string"==typeof n?n:null==n?"":String(n)}function Zm(n,t){throw new z(-201,!1)}let ey;function Ji(n){const t=ey;return ey=n,t}function Xv(n,t,e){const i=Td(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&dt.Optional?null:void 0!==t?t:void Zm()}const Kc={},ty="__NG_DI_FLAG__",Nd="ngTempTokenPath",wF=/\n/gm,Jv="__source";let fl;function ya(n){const t=fl;return fl=n,t}function vF(n,t=dt.Default){if(void 0===fl)throw new z(-203,!1);return null===fl?Xv(n,void 0,t):fl.get(n,t&dt.Optional?null:void 0,t)}function Oe(n,t=dt.Default){return(function Yv(){return ey}()||vF)(Ue(n),t)}function Q(n,t=dt.Default){return Oe(n,xd(t))}function xd(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function ny(n){const t=[];for(let e=0;e<n.length;e++){const i=Ue(n[e]);if(Array.isArray(i)){if(0===i.length)throw new z(900,!1);let s,r=dt.Default;for(let a=0;a<i.length;a++){const o=i[a],l=TF(o);"number"==typeof l?-1===l?s=o.token:r|=l:s=o}t.push(Oe(s,r))}else t.push(Oe(i))}return t}function Zc(n,t){return n[ty]=t,n.prototype[ty]=t,n}function TF(n){return n[ty]}let Kv=()=>null;function uy(n,t,e=!1){return Kv(n,t,e)}const bl="__parameters__";function Sl(n,t,e){return Mr(()=>{const i=function py(n){return function(...e){if(n){const i=n(...e);for(const s in i)this[s]=i[s]}}}(t);function s(...r){if(this instanceof s)return i.apply(this,r),this;const a=new s(...r);return o.annotation=a,o;function o(l,c,u){const h=l.hasOwnProperty(bl)?l[bl]:Object.defineProperty(l,bl,{value:[]})[bl];for(;h.length<=u;)h.push(null);return(h[u]=h[u]||[]).push(a),l}}return e&&(s.prototype=Object.create(e.prototype)),s.prototype.ngMetadataName=n,s.annotationCls=s,s})}const gy=Zc(Sl("Optional"),8),my=Zc(Sl("SkipSelf"),4);function po(n,t){return n.hasOwnProperty(Ar)?n[Ar]:null}const go=new ce(""),sT=new ce("",-1),yy=new ce("");class Ad{get(t,e=Kc){if(e===Kc){const i=new Error(`NullInjectorError: No provider for ${Qn(t)}!`);throw i.name="NullInjectorError",i}return e}}function iu(n){return{\u0275providers:n}}function rT(...n){return{\u0275providers:by(0,n),\u0275fromNgModule:!0}}function by(n,...t){const e=[],i=new Set;let s;const r=a=>{e.push(a)};return hl(t,a=>{const o=a;Fd(o,r,[],i)&&(s||=[],s.push(o))}),void 0!==s&&aT(s,r),e}function aT(n,t){for(let e=0;e<n.length;e++){const{ngModule:i,providers:s}=n[e];wy(s,r=>{t(r,i)})}}function Fd(n,t,e,i){if(!(n=Ue(n)))return!1;let s=null,r=kd(n);const a=!r&&ut(n);if(r||a){if(a&&!a.standalone)return!1;s=n}else{const l=n.ngModule;if(r=kd(l),!r)return!1;s=l}const o=i.has(s);if(a){if(o)return!1;if(i.add(s),a.dependencies){const l="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of l)Fd(c,t,e,i)}}else{if(!r)return!1;{if(null!=r.imports&&!o){let c;i.add(s);try{hl(r.imports,u=>{Fd(u,t,e,i)&&(c||=[],c.push(u))})}finally{}void 0!==c&&aT(c,t)}if(!o){const c=po(s)||(()=>new s);t({provide:s,useFactory:c,deps:vt},s),t({provide:yy,useValue:s,multi:!0},s),t({provide:go,useValue:()=>Oe(s),multi:!0},s)}const l=r.providers;if(null!=l&&!o){const c=n;wy(l,u=>{t(u,c)})}}}return s!==n&&void 0!==n.providers}function wy(n,t){for(let e of n)Km(e)&&(e=e.\u0275providers),Array.isArray(e)?wy(e,t):t(e)}const RF=At({provide:String,useValue:At});function Sy(n){return null!==n&&"object"==typeof n&&RF in n}function mo(n){return"function"==typeof n}const _y=new ce(""),Ld={},VF={};let vy;function Rd(){return void 0===vy&&(vy=new Ad),vy}class us{}class _l extends us{get destroyed(){return this._destroyed}constructor(t,e,i,s){super(),this.parent=e,this.source=i,this.scopes=s,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ky(t,a=>this.processProvider(a)),this.records.set(sT,vl(void 0,this)),s.has("environment")&&this.records.set(us,vl(void 0,this));const r=this.records.get(_y);null!=r&&"string"==typeof r.value&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(yy,vt,dt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const e of t)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const e=ya(this),i=Ji(void 0);try{return t()}finally{ya(e),Ji(i)}}get(t,e=Kc,i=dt.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(nv))return t[nv](this);i=xd(i);const r=ya(this),a=Ji(void 0);try{if(!(i&dt.SkipSelf)){let l=this.records.get(t);if(void 0===l){const c=function zF(n){return"function"==typeof n||"object"==typeof n&&n instanceof ce}(t)&&Td(t);l=c&&this.injectableDefInScope(c)?vl(Ty(t),Ld):null,this.records.set(t,l)}if(null!=l)return this.hydrate(t,l)}return(i&dt.Self?Rd():this.parent).get(t,e=i&dt.Optional&&e===Kc?null:e)}catch(o){if("NullInjectorError"===o.name){if((o[Nd]=o[Nd]||[]).unshift(Qn(t)),r)throw o;return function kF(n,t,e,i){const s=n[Nd];throw t[Jv]&&s.unshift(t[Jv]),n.message=function CF(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let s=Qn(t);if(Array.isArray(t))s=t.map(Qn).join(" -> ");else if("object"==typeof t){let r=[];for(let a in t)if(t.hasOwnProperty(a)){let o=t[a];r.push(a+":"+("string"==typeof o?JSON.stringify(o):Qn(o)))}s=`{${r.join(", ")}}`}return`${e}${i?"("+i+")":""}[${s}]: ${n.replace(wF,"\n  ")}`}("\n"+n.message,s,e,i),n.ngTokenPath=s,n[Nd]=null,n}(o,t,"R3InjectorError",this.source)}throw o}finally{Ji(a),ya(r)}}resolveInjectorInitializers(){const t=ya(this),e=Ji(void 0);try{const s=this.get(go,vt,dt.Self);for(const r of s)r()}finally{ya(t),Ji(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(Qn(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new z(205,!1)}processProvider(t){let e=mo(t=Ue(t))?t:Ue(t&&t.provide);const i=function WF(n){return Sy(n)?vl(void 0,n.useValue):vl(cT(n),Ld)}(t);if(!mo(t)&&!0===t.multi){let s=this.records.get(e);s||(s=vl(void 0,Ld,!0),s.factory=()=>ny(s.multi),this.records.set(e,s)),e=t,s.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Ld&&(e.value=VF,e.value=e.factory()),"object"==typeof e.value&&e.value&&function GF(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Ue(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){const e=this._onDestroyHooks.indexOf(t);-1!==e&&this._onDestroyHooks.splice(e,1)}}function Ty(n){const t=Td(n),e=null!==t?t.factory:po(n);if(null!==e)return e;if(n instanceof ce)throw new z(204,!1);if(n instanceof Function)return function HF(n){if(n.length>0)throw new z(204,!1);const e=function lF(n){return n&&(n[Cd]||n[zv])||null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new z(204,!1)}function cT(n,t,e){let i;if(mo(n)){const s=Ue(n);return po(s)||Ty(s)}if(Sy(n))i=()=>Ue(n.useValue);else if(function lT(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...ny(n.deps||[]));else if(function oT(n){return!(!n||!n.useExisting)}(n))i=()=>Oe(Ue(n.useExisting));else{const s=Ue(n&&(n.useClass||n.provide));if(!function UF(n){return!!n.deps}(n))return po(s)||Ty(s);i=()=>new s(...ny(n.deps))}return i}function vl(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function ky(n,t){for(const e of n)Array.isArray(e)?ky(e,t):e&&Km(e)?ky(e.\u0275providers,t):t(e)}function yo(n,t){n instanceof _l&&n.assertNotDestroyed();const i=ya(n),s=Ji(void 0);try{return t()}finally{ya(i),Ji(s)}}class eL{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function hT(n,t,e,i){null!==t?t.applyValueToInputSignal(t,i):n[e]=i}function vs(){return dT}function dT(n){return n.type.prototype.ngOnChanges&&(n.setInput=nL),tL}function tL(){const n=pT(this),t=n?.current;if(t){const e=n.previous;if(e===ir)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function nL(n,t,e,i,s){const r=this.declaredInputs[i],a=pT(n)||function iL(n,t){return n[fT]=t}(n,{previous:ir,current:null}),o=a.current||(a.current={}),l=a.previous,c=l[r];o[r]=new eL(c&&c.currentValue,e,l===ir),hT(n,t,s,e)}vs.ngInherit=!0;const fT="__ngSimpleChanges__";function pT(n){return n[fT]||null}const or=function(n,t,e){};function Hd(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const r=n.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:o,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=r;a&&(n.contentHooks??=[]).push(-e,a),o&&((n.contentHooks??=[]).push(e,o),(n.contentCheckHooks??=[]).push(e,o)),l&&(n.viewHooks??=[]).push(-e,l),c&&((n.viewHooks??=[]).push(e,c),(n.viewCheckHooks??=[]).push(e,c)),null!=u&&(n.destroyHooks??=[]).push(e,u)}}function Wd(n,t,e){gT(n,t,3,e)}function Ud(n,t,e,i){(3&n[Ee])===e&&gT(n,t,e,i)}function Ny(n,t){let e=n[Ee];(3&e)===t&&(e&=16383,e+=1,n[Ee]=e)}function gT(n,t,e,i){const r=i??-1,a=t.length-1;let o=0;for(let l=void 0!==i?65535&n[al]:0;l<a;l++)if("number"==typeof t[l+1]){if(o=t[l],null!=i&&o>=i)break}else t[l]<0&&(n[al]+=65536),(o<r||-1==r)&&(aL(n,e,t,l),n[al]=(4294901760&n[al])+l+2),l++}function mT(n,t){or(4,n,t);const e=Sn(null);try{t.call(n)}finally{Sn(e),or(5,n,t)}}function aL(n,t,e,i){const s=e[i]<0,r=e[i+1],o=n[s?-e[i]:e[i]];s?n[Ee]>>14<n[al]>>16&&(3&n[Ee])===t&&(n[Ee]+=16384,mT(o,r)):mT(o,r)}const kl=-1;class ru{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function Ey(n){return n!==kl}function au(n){return 32767&n}function ou(n,t){let e=function hL(n){return n>>16}(n),i=t;for(;e>0;)i=i[rl],e--;return i}let By=!0;function Gd(n){const t=By;return By=n,t}const yT=255,bT=5;let dL=0;const lr={};function zd(n,t){const e=wT(n,t);if(-1!==e)return e;const i=t[ee];i.firstCreatePass&&(n.injectorIndex=t.length,Py(i.data,n),Py(t,null),Py(i.blueprint,null));const s=$d(n,t),r=n.injectorIndex;if(Ey(s)){const a=au(s),o=ou(s,t),l=o[ee].data;for(let c=0;c<8;c++)t[r+c]=o[a+c]|l[a+c]}return t[r+8]=s,r}function Py(n,t){n.push(0,0,0,0,0,0,0,0,t)}function wT(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function $d(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,s=t;for(;null!==s;){if(i=DT(s),null===i)return kl;if(e++,s=s[rl],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return kl}function Iy(n,t,e){!function fL(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Vc)&&(i=e[Vc]),null==i&&(i=e[Vc]=dL++);const s=i&yT;t.data[n+(s>>bT)]|=1<<s}(n,t,e)}function ST(n,t,e){if(e&dt.Optional||void 0!==n)return n;Zm()}function _T(n,t,e,i){if(e&dt.Optional&&void 0===i&&(i=null),!(e&(dt.Self|dt.Host))){const s=n[di],r=Ji(void 0);try{return s?s.get(t,i,e&dt.Optional):Xv(t,i,e&dt.Optional)}finally{Ji(r)}}return ST(i,0,e)}function vT(n,t,e,i=dt.Default,s){if(null!==n){if(2048&t[Ee]&&!(i&dt.Self)){const a=function bL(n,t,e,i,s){let r=n,a=t;for(;null!==r&&null!==a&&2048&a[Ee]&&!(512&a[Ee]);){const o=TT(r,a,e,i|dt.Self,lr);if(o!==lr)return o;let l=r.parent;if(!l){const c=a[gv];if(c){const u=c.get(e,lr,i);if(u!==lr)return u}l=DT(a),a=a[rl]}r=l}return s}(n,t,e,i,lr);if(a!==lr)return a}const r=TT(n,t,e,i,lr);if(r!==lr)return r}return _T(t,e,i,s)}function TT(n,t,e,i,s){const r=function mL(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Vc)?n[Vc]:void 0;return"number"==typeof t?t>=0?t&yT:yL:t}(e);if("function"==typeof r){if(!Bv(t,n,i))return i&dt.Host?ST(s,0,i):_T(t,e,i,s);try{let a;if(a=r(i),null!=a||i&dt.Optional)return a;Zm()}finally{Av()}}else if("number"==typeof r){let a=null,o=wT(n,t),l=kl,c=i&dt.Host?t[dn][bi]:null;for((-1===o||i&dt.SkipSelf)&&(l=-1===o?$d(n,t):t[o+8],l!==kl&&CT(i,!1)?(a=t[ee],o=au(l),t=ou(l,t)):o=-1);-1!==o;){const u=t[ee];if(kT(r,o,u.data)){const h=gL(o,t,e,a,i,c);if(h!==lr)return h}l=t[o+8],l!==kl&&CT(i,t[ee].data[o+8]===c)&&kT(r,o,t)?(a=u,o=au(l),t=ou(l,t)):o=-1}}return s}function gL(n,t,e,i,s,r){const a=t[ee],o=a.data[n+8],u=jd(o,a,e,null==i?oo(o)&&By:i!=a&&0!=(3&o.type),s&dt.Host&&r===o);return null!==u?bo(t,a,u,o):lr}function jd(n,t,e,i,s){const r=n.providerIndexes,a=t.data,o=1048575&r,l=n.directiveStart,u=r>>20,f=s?o+u:n.directiveEnd;for(let p=i?o:o+u;p<f;p++){const g=a[p];if(p<l&&e===g||p>=l&&g.type===e)return p}if(s){const p=a[l];if(p&&Rs(p)&&p.type===e)return l}return null}function bo(n,t,e,i){let s=n[e];const r=t.data;if(function oL(n){return n instanceof ru}(s)){const a=s;a.resolving&&function mF(n,t){throw t&&t.join(" > "),new z(-200,n)}(function Dt(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Qe(n)}(r[e]));const o=Gd(a.canSeeViewProviders);a.resolving=!0;const c=a.injectImpl?Ji(a.injectImpl):null;Bv(n,i,dt.Default);try{s=n[e]=a.factory(void 0,r,n,i),t.firstCreatePass&&e>=i.directiveStart&&function rL(n,t,e){const{ngOnChanges:i,ngOnInit:s,ngDoCheck:r}=t.type.prototype;if(i){const a=dT(t);(e.preOrderHooks??=[]).push(n,a),(e.preOrderCheckHooks??=[]).push(n,a)}s&&(e.preOrderHooks??=[]).push(0-n,s),r&&((e.preOrderHooks??=[]).push(n,r),(e.preOrderCheckHooks??=[]).push(n,r))}(e,r[e],t)}finally{null!==c&&Ji(c),Gd(o),a.resolving=!1,Av()}}return s}function kT(n,t,e){return!!(e[t+(n>>bT)]&1<<n)}function CT(n,t){return!(n&dt.Self||n&dt.Host&&t)}class ei{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return vT(this._tNode,this._lView,t,xd(i),e)}}function yL(){return new ei(Ft(),L())}function Pn(n){return Mr(()=>{const t=n.prototype.constructor,e=t[Ar]||My(t),i=Object.prototype;let s=Object.getPrototypeOf(n.prototype).constructor;for(;s&&s!==i;){const r=s[Ar]||My(s);if(r&&r!==e)return r;s=Object.getPrototypeOf(s)}return r=>new r})}function My(n){return Dd(n)?()=>{const t=My(Ue(n));return t&&t()}:po(n)}function DT(n){const t=n[ee],e=t.type;return 2===e?t.declTNode:1===e?n[bi]:null}function PT(n,t=null,e=null,i){const s=IT(n,t,e,i);return s.resolveInjectorInitializers(),s}function IT(n,t=null,e=null,i,s=new Set){const r=[e||vt,rT(n)];return i=i||("object"==typeof n?void 0:Qn(n)),new _l(r,t||Rd(),i||null,s)}let Qi=(()=>{class n{static#e=this.THROW_IF_NOT_FOUND=Kc;static#t=this.NULL=new Ad;static create(e,i){if(Array.isArray(e))return PT({name:""},i,e,"");{const s=e.name??"";return PT({name:s},e.parent,e.providers,s)}}static#n=this.\u0275prov=fe({token:n,providedIn:"any",factory:()=>Oe(sT)});static#i=this.__NG_ELEMENT_ID__=-1}return n})();function Fy(n){return n.ngOriginalError}class Vr{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Fy(t);for(;e&&Fy(e);)e=Fy(e);return e||null}}const AT=new ce("",{providedIn:"root",factory:()=>Q(Vr).handleError.bind(void 0)}),LT=new ce("",{providedIn:"root",factory:()=>!1});class HT{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const JL=/^>|^->|<!--|-->|--!>|<!-$/g,QL=/(<|>)/g,KL="\u200b$1\u200b";const Uy=new Map;let iR=0;const zy="__ngContext__";function vi(n,t){wi(t)?(n[zy]=t[zc],function rR(n){Uy.set(n[zc],n)}(t)):n[zy]=t}function hs(n){return n instanceof Function?n():n}var Sa=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Sa||{});let Yy;function Xy(n,t){return Yy(n,t)}function Bl(n,t,e,i,s){if(null!=i){let r,a=!1;Si(i)?r=i:wi(i)&&(a=!0,i=i[ln]);const o=Ut(i);0===n&&null!==e?null==s?pk(t,e,o):wo(t,e,o,s||null,!0):1===n&&null!==e?wo(t,e,o,s||null,!0):2===n?function lf(n,t,e){const i=rf(n,t);i&&function NR(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,o,a):3===n&&t.destroyNode(o),null!=r&&function BR(n,t,e,i,s){const r=e[sr];r!==Ut(e)&&Bl(t,n,i,r,s);for(let o=Bn;o<e.length;o++){const l=e[o];cf(l[ee],l,n,t,i,r)}}(t,n,r,e,s)}}function Jy(n,t){return n.createComment(function JT(n){return n.replace(JL,t=>t.replace(QL,KL))}(t))}function nf(n,t,e){return n.createElement(t,e)}function hk(n,t){cf(n,t,t[Ye],2,null,null)}function dk(n,t){const e=n[ol],i=e.indexOf(t);e.splice(i,1)}function du(n,t){if(n.length<=Bn)return;const e=Bn+t,i=n[e];if(i){const s=i[Gc];null!==s&&s!==n&&dk(s,i),t>0&&(n[e-1][Fs]=i[Fs]);const r=wd(n,Bn+t);!function SR(n,t){hk(n,t),t[ln]=null,t[bi]=null}(i[ee],i);const a=r[Lr];null!==a&&a.detachView(r[ee]),i[En]=null,i[Fs]=null,i[Ee]&=-129}return i}function sf(n,t){if(!(256&t[Ee])){const e=t[Ye];e.destroyNode&&cf(n,t,e,3,null,null),function vR(n){let t=n[Uc];if(!t)return Qy(n[ee],n);for(;t;){let e=null;if(wi(t))e=t[Uc];else{const i=t[Bn];i&&(e=i)}if(!e){for(;t&&!t[Fs]&&t!==n;)wi(t)&&Qy(t[ee],t),t=t[En];null===t&&(t=n),wi(t)&&Qy(t[ee],t),e=t&&t[Fs]}t=e}}(t)}}function Qy(n,t){if(!(256&t[Ee])){t[Ee]&=-129,t[Ee]|=256,t[ao]&&function O_(n){if(tl(n),Lc(n))for(let t=0;t<n.producerNode.length;t++)ad(n.producerNode[t],n.producerIndexOfThis[t]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}(t[ao]),function DR(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const s=t[e[i]];if(!(s instanceof ru)){const r=e[i+1];if(Array.isArray(r))for(let a=0;a<r.length;a+=2){const o=s[r[a]],l=r[a+1];or(4,o,l);try{l.call(o)}finally{or(5,o,l)}}else{or(4,s,r);try{r.call(s)}finally{or(5,s,r)}}}}}(n,t),function CR(n,t){const e=n.cleanup,i=t[sl];if(null!==e)for(let r=0;r<e.length-1;r+=2)if("string"==typeof e[r]){const a=e[r+3];a>=0?i[a]():i[-a].unsubscribe(),r+=2}else e[r].call(i[e[r+1]]);null!==i&&(t[sl]=null);const s=t[pa];if(null!==s){t[pa]=null;for(let r=0;r<s.length;r++)(0,s[r])()}}(n,t),1===t[ee].type&&t[Ye].destroy();const e=t[Gc];if(null!==e&&Si(t[En])){e!==t[En]&&dk(e,t);const i=t[Lr];null!==i&&i.detachView(n)}!function aR(n){Uy.delete(n[zc])}(t)}}function Ky(n,t,e){return function fk(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[ln];{const{componentOffset:s}=i;if(s>-1){const{encapsulation:r}=n.data[i.directiveStart+s];if(r===Ms.None||r===Ms.Emulated)return null}return xi(i,e)}}(n,t.parent,e)}function wo(n,t,e,i,s){n.insertBefore(t,e,i,s)}function pk(n,t,e){n.appendChild(t,e)}function gk(n,t,e,i,s){null!==i?wo(n,t,e,i,s):pk(n,t,e)}function rf(n,t){return n.parentNode(t)}let Zy,bk=function yk(n,t,e){return 40&n.type?xi(n,e):null};function af(n,t,e,i){const s=Ky(n,i,t),r=t[Ye],o=function mk(n,t,e){return bk(n,t,e)}(i.parent||t[bi],i,t);if(null!=s)if(Array.isArray(e))for(let l=0;l<e.length;l++)gk(r,s,e[l],o,!1);else gk(r,s,e,o,!1);void 0!==Zy&&Zy(r,i,t,e,s)}function fu(n,t){if(null!==t){const e=t.type;if(3&e)return xi(t,n);if(4&e)return eb(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return fu(n,i);{const s=n[t.index];return Si(s)?eb(-1,s):Ut(s)}}if(32&e)return Xy(t,n)()||Ut(n[t.index]);{const i=Sk(n,t);return null!==i?Array.isArray(i)?i[0]:fu(lo(n[dn]),i):fu(n,t.next)}}return null}function Sk(n,t){return null!==t?n[dn][bi].projection[t.projection]:null}function eb(n,t){const e=Bn+n+1;if(e<t.length){const i=t[e],s=i[ee].firstChild;if(null!==s)return fu(i,s)}return t[sr]}function tb(n,t,e,i,s,r,a){for(;null!=e;){const o=i[e.index],l=e.type;if(a&&0===t&&(o&&vi(Ut(o),i),e.flags|=2),32!=(32&e.flags))if(8&l)tb(n,t,e.child,i,s,r,!1),Bl(t,n,s,o,r);else if(32&l){const c=Xy(e,i);let u;for(;u=c();)Bl(t,n,s,u,r);Bl(t,n,s,o,r)}else 16&l?vk(n,t,i,e,s,r):Bl(t,n,s,o,r);e=a?e.projectionNext:e.next}}function cf(n,t,e,i,s,r){tb(e,i,n.firstChild,t,s,r,!1)}function vk(n,t,e,i,s,r){const a=e[dn],l=a[bi].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Bl(t,n,s,l[c],r);else{let c=l;const u=a[En];_d(i)&&(c.flags|=128),tb(n,t,c,u,s,r,!0)}}function Tk(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function kk(n,t,e){const{mergedAttrs:i,classes:s,styles:r}=e;null!==i&&Tm(n,t,i),null!==s&&Tk(n,t,s),null!==r&&function IR(n,t,e){n.setAttribute(t,"style",e)}(n,t,r)}const et={};function O(n=1){Ck(ft(),L(),_i()+n,!1)}function Ck(n,t,e,i){if(!i)if(3==(3&t[Ee])){const r=n.preOrderCheckHooks;null!==r&&Wd(t,r,e)}else{const r=n.preOrderHooks;null!==r&&Ud(t,r,0,e)}co(e)}function j(n,t=dt.Default){const e=L();return null===e?Oe(n,t):vT(Ft(),e,Ue(n),t)}function Dk(n,t,e,i,s,r){const a=Sn(null);try{let o=null;s&an.SignalBased&&(o=t[i][no]),null!==o&&void 0!==o.transformFn&&(r=o.transformFn(r)),s&an.HasDecoratorInputTransform&&(r=n.inputTransforms[i].call(t,r)),null!==n.setInput?n.setInput(t,o,r,e,i):hT(t,o,i,r)}finally{Sn(a)}}function uf(n,t,e,i,s,r,a,o,l,c,u){const h=t.blueprint.slice();return h[ln]=s,h[Ee]=204|i,(null!==c||n&&2048&n[Ee])&&(h[Ee]|=2048),vv(h),h[En]=h[rl]=n,h[Jt]=e,h[Fr]=a||n&&n[Fr],h[Ye]=o||n&&n[Ye],h[di]=l||n&&n[di]||null,h[bi]=r,h[zc]=function sR(){return iR++}(),h[Ls]=u,h[gv]=c,h[dn]=2==t.type?n[dn]:h,h}function Pl(n,t,e,i,s){let r=n.data[t];if(null===r)r=function nb(n,t,e,i,s){const r=Dv(),a=Fm(),l=n.data[t]=function WR(n,t,e,i,s,r){let a=t?t.injectorIndex:-1,o=0;return function cl(){return null!==Ge.skipHydrationRootTNode}()&&(o|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:a,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:o,providerIndexes:0,value:s,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?r:r&&r.parent,e,t,i,s);return null===n.firstChild&&(n.firstChild=l),null!==r&&(a?null==r.child&&null!==l.parent&&(r.child=l):null===r.next&&(r.next=l,l.prev=r)),l}(n,t,e,i,s),function XA(){return Ge.lFrame.inI18n}()&&(r.flags|=32);else if(64&r.type){r.type=e,r.value=i,r.attrs=s;const a=function Xc(){const n=Ge.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();r.injectorIndex=null===a?-1:a.injectorIndex}return ar(r,!0),r}function pu(n,t,e,i){if(0===e)return-1;const s=t.length;for(let r=0;r<e;r++)t.push(i),n.blueprint.push(i),n.data.push(null);return s}function Nk(n,t,e,i,s){const r=_i(),a=2&i;try{co(-1),a&&t.length>Je&&Ck(n,t,Je,!1),or(a?2:0,s),e(i,s)}finally{co(r),or(a?3:1,s)}}function ib(n,t,e){if(Dm(t)){const i=Sn(null);try{const r=t.directiveEnd;for(let a=t.directiveStart;a<r;a++){const o=n.data[a];o.contentQueries&&o.contentQueries(1,e[a],a)}}finally{Sn(i)}}}function sb(n,t,e){Cv()&&(function YR(n,t,e,i){const s=e.directiveStart,r=e.directiveEnd;oo(e)&&function tO(n,t,e){const i=xi(t,n),s=xk(e);let a=16;e.signals?a=4096:e.onPush&&(a=64);const o=hf(n,uf(n,s,null,a,i,t,null,n[Fr].rendererFactory.createRenderer(i,e),null,null,null));n[t.index]=o}(t,e,n.data[s+e.componentOffset]),n.firstCreatePass||zd(e,t),vi(i,t);const a=e.initialInputs;for(let o=s;o<r;o++){const l=n.data[o],c=bo(t,n,o,e);vi(c,t),null!==a&&nO(0,o-s,c,l,0,a),Rs(l)&&(os(e.index,t)[Jt]=bo(t,n,o,e))}}(n,t,e,xi(e,t)),64==(64&e.flags)&&Mk(n,t,e))}function rb(n,t,e=xi){const i=t.localNames;if(null!==i){let s=t.index+1;for(let r=0;r<i.length;r+=2){const a=i[r+1],o=-1===a?e(t,n):n[a];n[s++]=o}}}function xk(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=ab(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function ab(n,t,e,i,s,r,a,o,l,c,u){const h=Je+i,f=h+s,p=function FR(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:et);return e}(h,f),g="function"==typeof c?c():c;return p[ee]={type:n,blueprint:p,template:e,queries:null,viewQuery:o,declTNode:t,data:p.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof r?r():r,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:l,consts:g,incompleteFirstPass:!1,ssrId:u}}let Ek=()=>null;function Bk(n,t,e,i,s){for(let r in t){if(!t.hasOwnProperty(r))continue;const a=t[r];if(void 0===a)continue;i??={};let o,l=an.None;Array.isArray(a)?(o=a[0],l=a[1]):o=a;let c=r;if(null!==s){if(!s.hasOwnProperty(r))continue;c=s[r]}0===n?Pk(i,e,c,o,l):Pk(i,e,c,o)}return i}function Pk(n,t,e,i,s){let r;n.hasOwnProperty(e)?(r=n[e]).push(t,i):r=n[e]=[t,i],void 0!==s&&r.push(s)}function Zi(n,t,e,i,s,r,a,o){const l=xi(t,e);let u,c=t.inputs;!o&&null!=c&&(u=c[i])?(hb(n,e,u,i,s),oo(t)&&function zR(n,t){const e=os(t,n);16&e[Ee]||(e[Ee]|=64)}(e,t.index)):3&t.type&&(i=function GR(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),s=null!=a?a(s,t.value||"",i):s,r.setProperty(l,i,s))}function ob(n,t,e,i){if(Cv()){const s=null===i?null:{"":-1},r=function JR(n,t){const e=n.directiveRegistry;let i=null,s=null;if(e)for(let r=0;r<e.length;r++){const a=e[r];if(cv(t,a.selectors,!1))if(i||(i=[]),Rs(a))if(null!==a.findHostDirectiveDefs){const o=[];s=s||new Map,a.findHostDirectiveDefs(a,o,s),i.unshift(...o,a),lb(n,t,o.length)}else i.unshift(a),lb(n,t,0);else s=s||new Map,a.findHostDirectiveDefs?.(a,i,s),i.push(a)}return null===i?null:[i,s]}(n,e);let a,o;null===r?a=o=null:[a,o]=r,null!==a&&Ik(n,t,e,a,s,o),s&&function QR(n,t,e){if(t){const i=n.localNames=[];for(let s=0;s<t.length;s+=2){const r=e[t[s+1]];if(null==r)throw new z(-301,!1);i.push(t[s],r)}}}(e,i,s)}e.mergedAttrs=Hc(e.mergedAttrs,e.attrs)}function Ik(n,t,e,i,s,r){for(let c=0;c<i.length;c++)Iy(zd(e,t),n,i[c].type);!function ZR(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}(e,n.data.length,i.length);for(let c=0;c<i.length;c++){const u=i[c];u.providersResolver&&u.providersResolver(u)}let a=!1,o=!1,l=pu(n,t,i.length,null);for(let c=0;c<i.length;c++){const u=i[c];e.mergedAttrs=Hc(e.mergedAttrs,u.hostAttrs),eO(n,e,t,l,u),KR(l,u,s),null!==u.contentQueries&&(e.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(e.flags|=64);const h=u.type.prototype;!a&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),a=!0),!o&&(h.ngOnChanges||h.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),o=!0),l++}!function UR(n,t,e){const s=t.directiveEnd,r=n.data,a=t.attrs,o=[];let l=null,c=null;for(let u=t.directiveStart;u<s;u++){const h=r[u],f=e?e.get(h):null,g=f?f.outputs:null;l=Bk(0,h.inputs,u,l,f?f.inputs:null),c=Bk(1,h.outputs,u,c,g);const m=null===l||null===a||lv(t)?null:iO(l,u,a);o.push(m)}null!==l&&(l.hasOwnProperty("class")&&(t.flags|=8),l.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=o,t.inputs=l,t.outputs=c}(n,e,r)}function Mk(n,t,e){const i=e.directiveStart,s=e.directiveEnd,r=e.index,a=function QA(){return Ge.lFrame.currentDirectiveIndex}();try{co(r);for(let o=i;o<s;o++){const l=n.data[o],c=t[o];Rm(o),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&XR(l,c)}}finally{co(-1),Rm(a)}}function XR(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function lb(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function KR(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Rs(t)&&(e[""]=n)}}function eO(n,t,e,i,s){n.data[i]=s;const r=s.factory||(s.factory=po(s.type)),a=new ru(r,Rs(s),j);n.blueprint[i]=a,e[i]=a,function jR(n,t,e,i,s){const r=s.hostBindings;if(r){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const o=~t.index;(function qR(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(a)!=o&&a.push(o),a.push(e,i,r)}}(n,t,i,pu(n,e,s.hostVars,et),s)}function cr(n,t,e,i,s,r){const a=xi(n,t);!function cb(n,t,e,i,s,r,a){if(null==r)n.removeAttribute(t,s,e);else{const o=null==a?Qe(r):a(r,i||"",s);n.setAttribute(t,s,o,e)}}(t[Ye],a,r,n.value,e,i,s)}function nO(n,t,e,i,s,r){const a=r[t];if(null!==a)for(let o=0;o<a.length;)Dk(i,e,a[o++],a[o++],a[o++],a[o++])}function iO(n,t,e){let i=null,s=0;for(;s<e.length;){const r=e[s];if(0!==r)if(5!==r){if("number"==typeof r)break;if(n.hasOwnProperty(r)){null===i&&(i=[]);const a=n[r];for(let o=0;o<a.length;o+=3)if(a[o]===t){i.push(r,a[o+1],a[o+2],e[s+1]);break}}s+=2}else s+=2;else s+=4}return i}function Ak(n,t,e,i){return[n,!0,0,t,null,i,null,e,null,null]}function Fk(n,t){const e=n.contentQueries;if(null!==e){const i=Sn(null);try{for(let s=0;s<e.length;s+=2){const a=e[s+1];if(-1!==a){const o=n.data[a];yd(e[s]),o.contentQueries(2,t[a],a)}}}finally{Sn(i)}}}function hf(n,t){return n[Uc]?n[pv][Fs]=t:n[Uc]=t,n[pv]=t,t}function ub(n,t,e){yd(0);const i=Sn(null);try{t(n,e)}finally{Sn(i)}}function Lk(n){return n[sl]||(n[sl]=[])}function Rk(n){return n.cleanup||(n.cleanup=[])}function df(n,t){const e=n[di],i=e?e.get(Vr,null):null;i&&i.handleError(t)}function hb(n,t,e,i,s){for(let r=0;r<e.length;){const a=e[r++],o=e[r++],l=e[r++];Dk(n.data[a],t[a],i,o,l,s)}}function Wr(n,t,e){const i=jc(t,n);!function uk(n,t,e){n.setValue(t,e)}(n[Ye],i,e)}function sO(n,t){const e=os(t,n),i=e[ee];!function rO(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}(i,e);const s=e[ln];null!==s&&null===e[Ls]&&(e[Ls]=uy(s,e[di])),db(i,e,e[Jt])}function db(n,t,e){Hm(t);try{const i=n.viewQuery;null!==i&&ub(1,i,e);const s=n.template;null!==s&&Nk(n,t,s,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[Lr]?.finishViewCreation(n),n.staticContentQueries&&Fk(n,t),n.staticViewQueries&&ub(2,n.viewQuery,e);const r=n.components;null!==r&&function aO(n,t){for(let e=0;e<t.length;e++)sO(n,t[e])}(t,r)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[Ee]&=-5,Wm()}}function Il(n,t){return!t||null===t.firstChild||_d(n)}function mu(n,t,e,i=!0){const s=t[ee];if(function TR(n,t,e,i){const s=Bn+i,r=e.length;i>0&&(e[s-1][Fs]=t),i<r-Bn?(t[Fs]=e[s],Ov(e,Bn+i,t)):(e.push(t),t[Fs]=null),t[En]=e;const a=t[Gc];null!==a&&e!==a&&function kR(n,t){const e=n[ol];t[dn]!==t[En][En][dn]&&(n[Ee]|=Cm.HasTransplantedViews),null===e?n[ol]=[t]:e.push(t)}(a,t);const o=t[Lr];null!==o&&o.insertView(n),Mm(t),t[Ee]|=128}(s,t,n,e),i){const a=eb(e,n),o=t[Ye],l=rf(o,n[sr]);null!==l&&function _R(n,t,e,i,s,r){i[ln]=s,i[bi]=t,cf(n,i,e,1,s,r)}(s,n[bi],o,t,l,a)}const r=t[Ls];null!==r&&null!==r.firstChild&&(r.firstChild=null)}function yu(n,t,e,i,s=!1){for(;null!==e;){const r=t[e.index];null!==r&&i.push(Ut(r)),Si(r)&&Hk(r,i);const a=e.type;if(8&a)yu(n,t,e.child,i);else if(32&a){const o=Xy(e,t);let l;for(;l=o();)i.push(l)}else if(16&a){const o=Sk(t,e);if(Array.isArray(o))i.push(...o);else{const l=lo(t[dn]);yu(l[ee],l,o,i,!0)}}e=s?e.projectionNext:e.next}return i}function Hk(n,t){for(let e=Bn;e<n.length;e++){const i=n[e],s=i[ee].firstChild;null!==s&&yu(i[ee],i,s,t)}n[sr]!==n[ln]&&t.push(n[sr])}let Wk=[];const uO={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{Yc(n.lView)},consumerOnSignalRead(){this.lView[ao]=this}};function Uk(n){return zk(n[Uc])}function Gk(n){return zk(n[Fs])}function zk(n){for(;null!==n&&!Si(n);)n=n[Fs];return n}function ff(n,t=!0,e=0){const i=n[Fr],s=i.rendererFactory;s.begin?.();try{!function fO(n,t){pb(n,t);let e=0;for(;Im(n);){if(100===e)throw new z(103,!1);e++,pb(n,1)}}(n,e)}catch(a){throw t&&df(n,a),a}finally{s.end?.(),i.inlineEffectRunner?.flush()}}function pO(n,t,e,i){const s=t[Ee];if(256==(256&s))return;t[Fr].inlineEffectRunner?.flush(),Hm(t);let a=null,o=null;(function gO(n){return 2!==n.type})(n)&&(o=function oO(n){return n[ao]??function lO(n){const t=Wk.pop()??Object.create(uO);return t.lView=n,t}(n)}(t),a=function L_(n){return n&&(n.nextProducerIndex=0),Sn(n)}(o));try{vv(t),function xv(n){return Ge.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&Nk(n,t,e,2,i);const l=3==(3&s);if(l){const h=n.preOrderCheckHooks;null!==h&&Wd(t,h,null)}else{const h=n.preOrderHooks;null!==h&&Ud(t,h,0,null),Ny(t,0)}if(function mO(n){for(let t=Uk(n);null!==t;t=Gk(t)){if(!(t[Ee]&Cm.HasTransplantedViews))continue;const e=t[ol];for(let i=0;i<e.length;i++){VA(e[i])}}}(t),jk(t,0),null!==n.contentQueries&&Fk(n,t),l){const h=n.contentCheckHooks;null!==h&&Wd(t,h)}else{const h=n.contentHooks;null!==h&&Ud(t,h,1),Ny(t,1)}!function AR(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const s=e[i];if(s<0)co(~s);else{const r=s,a=e[++i],o=e[++i];JA(a,r),o(2,t[r])}}}finally{co(-1)}}(n,t);const c=n.components;null!==c&&Yk(t,c,0);const u=n.viewQuery;if(null!==u&&ub(2,u,i),l){const h=n.viewCheckHooks;null!==h&&Wd(t,h)}else{const h=n.viewHooks;null!==h&&Ud(t,h,2),Ny(t,2)}if(!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[fd]){for(const h of t[fd])h();t[fd]=null}t[Ee]&=-73}catch(l){throw Yc(t),l}finally{null!==o&&(function R_(n,t){if(Sn(t),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(Lc(n))for(let e=n.nextProducerIndex;e<n.producerNode.length;e++)ad(n.producerNode[e],n.producerIndexOfThis[e]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}(o,a),function cO(n){n.lView[ao]!==n&&(n.lView=null,Wk.push(n))}(o)),Wm()}}function jk(n,t){for(let e=Uk(n);null!==e;e=Gk(e))for(let i=Bn;i<e.length;i++)qk(e[i],t)}function yO(n,t,e){qk(os(t,n),e)}function qk(n,t){Pm(n)&&pb(n,t)}function pb(n,t){const i=n[ee],s=n[Ee],r=n[ao];let a=!!(0===t&&16&s);if(a||=!!(64&s&&0===t),a||=!!(1024&s),a||=!(!r?.dirty||!lm(r)),r&&(r.dirty=!1),n[Ee]&=-9217,a)pO(i,n,i.template,n[Jt]);else if(8192&s){jk(n,1);const o=i.components;null!==o&&Yk(n,o,1)}}function Yk(n,t,e){for(let i=0;i<t.length;i++)yO(n,t[i],e)}function bu(n){for(n[Fr].changeDetectionScheduler?.notify();n;){n[Ee]|=64;const t=lo(n);if(Nm(n)&&!t)return n;n=t}return null}class wu{get rootNodes(){const t=this._lView,e=t[ee];return yu(e,t,e.firstChild,[])}constructor(t,e,i=!0){this._lView=t,this._cdRefInjectingView=e,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Jt]}set context(t){this._lView[Jt]=t}get destroyed(){return 256==(256&this._lView[Ee])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[En];if(Si(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(du(t,i),wd(e,i))}this._attachedToViewContainer=!1}sf(this._lView[ee],this._lView)}onDestroy(t){!function md(n,t){if(256==(256&n[Ee]))throw new z(911,!1);null===n[pa]&&(n[pa]=[]),n[pa].push(t)}(this._lView,t)}markForCheck(){bu(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ee]&=-129}reattach(){Mm(this._lView),this._lView[Ee]|=128}detectChanges(){this._lView[Ee]|=1024,ff(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new z(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,hk(this._lView[ee],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new z(902,!1);this._appRef=t,Mm(this._lView)}}let Ur=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=SO}return n})();const bO=Ur,wO=class extends bO{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,e){return this.createEmbeddedViewImpl(t,e)}createEmbeddedViewImpl(t,e,i){const s=function gu(n,t,e,i){const s=t.tView,o=uf(n,s,e,4096&n[Ee]?4096:16,null,t,null,null,null,i?.injector??null,i?.dehydratedView??null);o[Gc]=n[t.index];const c=n[Lr];return null!==c&&(o[Lr]=c.createEmbeddedView(s)),db(s,o,e),o}(this._declarationLView,this._declarationTContainer,t,{injector:e,dehydratedView:i});return new wu(s)}};function SO(){return pf(Ft(),L())}function pf(n,t){return 4&n.type?new wO(t,n,ul(n,t)):null}class tC{}class UO{}class nC{}class zO{resolveComponentFactory(t){throw function GO(n){const t=Error(`No component factory found for ${Qn(n)}.`);return t.ngComponent=n,t}(t)}}let wf=(()=>{class n{static#e=this.NULL=new zO}return n})();class sC{}let Gr=(()=>{class n{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function $O(){const n=L(),e=os(Ft().index,n);return(wi(e)?e:n)[Ye]}()}return n})(),jO=(()=>{class n{static#e=this.\u0275prov=fe({token:n,providedIn:"root",factory:()=>null})}return n})();const Sb={};const aC=new Set;function oC(n){return function rC(n){return"function"==typeof n&&void 0!==n[no]}(n)&&"function"==typeof n.set}function Sf(n){return!!function _b(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}class cC{constructor(){}supports(t){return Sf(t)}create(t){return new KO(t)}}const QO=(n,t)=>t;class KO{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||QO}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,s=0,r=null;for(;e||i;){const a=!i||e&&e.currentIndex<hC(i,s,r)?e:i,o=hC(a,s,r),l=a.currentIndex;if(a===i)s--,i=i._nextRemoved;else if(e=e._next,null==a.previousIndex)s++;else{r||(r=[]);const c=o-s,u=l-s;if(c!=u){for(let f=0;f<c;f++){const p=f<r.length?r[f]:r[f]=0,g=p+f;u<=g&&g<c&&(r[f]=p+1)}r[a.previousIndex]=u-c}}o!==l&&t(a,o,l)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Sf(t))throw new z(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let s,r,a,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let o=0;o<this.length;o++)r=t[o],a=this._trackByFn(o,r),null!==e&&Object.is(e.trackById,a)?(i&&(e=this._verifyReinsertion(e,r,a,o)),Object.is(e.item,r)||this._addIdentityChange(e,r)):(e=this._mismatch(e,r,a,o),i=!0),e=e._next}else s=0,function JO(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Symbol.iterator]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,o=>{a=this._trackByFn(s,o),null!==e&&Object.is(e.trackById,a)?(i&&(e=this._verifyReinsertion(e,o,a,s)),Object.is(e.item,o)||this._addIdentityChange(e,o)):(e=this._mismatch(e,o,a,s),i=!0),e=e._next,s++}),this.length=s;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,s){let r;return null===t?r=this._itTail:(r=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,r,s)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,s))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,r,s)):t=this._addAfter(new ZO(e,i),r,s),t}_verifyReinsertion(t,e,i,s){let r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==r?t=this._reinsertAfter(r,t._prev,s):t.currentIndex!=s&&(t.currentIndex=s,this._addToMoves(t,s)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const s=t._prevRemoved,r=t._nextRemoved;return null===s?this._removalsHead=r:s._nextRemoved=r,null===r?this._removalsTail=s:r._prevRemoved=s,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const s=null===e?this._itHead:e._next;return t._next=s,t._prev=e,null===s?this._itTail=t:s._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new uC),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new uC),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class ZO{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class e2{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class uC{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new e2,this.map.set(e,i)),i.add(t)}get(t,e){const s=this.map.get(t);return s?s.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hC(n,t,e){const i=n.previousIndex;if(null===i)return i;let s=0;return e&&i<e.length&&(s=e[i]),i+t+s}function fC(){return new vb([new cC])}let vb=(()=>{class n{static#e=this.\u0275prov=fe({token:n,providedIn:"root",factory:fC});constructor(e){this.factories=e}static create(e,i){if(null!=i){const s=i.factories.slice();e=e.concat(s)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||fC()),deps:[[n,new my,new gy]]}}find(e){const i=this.factories.find(s=>s.supports(e));if(null!=i)return i;throw new z(901,!1)}}return n})(),Al=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=s2}return n})();function s2(n){return function r2(n,t,e){if(oo(n)&&!e){const i=os(n.index,t);return new wu(i,i)}return 47&n.type?new wu(t[dn],t):null}(Ft(),L(),16==(16&n))}function gC(...n){}class Lt{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new hn(!1),this.onMicrotaskEmpty=new hn(!1),this.onStable=new hn(!1),this.onError=new hn(!1),typeof Zone>"u")throw new z(908,!1);Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!i&&e,s.shouldCoalesceRunChangeDetection=i,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function g2(){const n="function"==typeof It.requestAnimationFrame;let t=It[n?"requestAnimationFrame":"setTimeout"],e=It[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&e){const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i);const s=e[Zone.__symbol__("OriginalDelegate")];s&&(e=s)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function b2(n){const t=()=>{!function y2(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(It,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,kb(n),n.isCheckStableRunning=!0,Tb(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),kb(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,s,r,a,o)=>{if(function w2(n){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0].data?.__ignore_ng_zone__}(o))return e.invokeTask(s,r,a,o);try{return mC(n),e.invokeTask(s,r,a,o)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===r.type||n.shouldCoalesceRunChangeDetection)&&t(),yC(n)}},onInvoke:(e,i,s,r,a,o,l)=>{try{return mC(n),e.invoke(s,r,a,o,l)}finally{n.shouldCoalesceRunChangeDetection&&t(),yC(n)}},onHasTask:(e,i,s,r)=>{e.hasTask(s,r),i===s&&("microTask"==r.change?(n._hasPendingMicrotasks=r.microTask,kb(n),Tb(n)):"macroTask"==r.change&&(n.hasPendingMacrotasks=r.macroTask))},onHandleError:(e,i,s,r)=>(e.handleError(s,r),n.runOutsideAngular(()=>n.onError.emit(r)),!1)})}(s)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Lt.isInAngularZone())throw new z(909,!1)}static assertNotInAngularZone(){if(Lt.isInAngularZone())throw new z(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,s){const r=this._inner,a=r.scheduleEventTask("NgZoneEvent: "+s,t,m2,gC,gC);try{return r.runTask(a,e,i)}finally{r.cancelTask(a)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const m2={};function Tb(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function kb(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function mC(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function yC(n){n._nesting--,Tb(n)}let ku=(()=>{class n{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const e=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const i of e)i()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=fe({token:n,providedIn:"root",factory:()=>new n})}return n})();function kf(n,t,e){let i=e?n.styles:null,s=e?n.classes:null,r=0;if(null!==t)for(let a=0;a<t.length;a++){const o=t[a];"number"==typeof o?r=o:1==r?s=Sm(s,o):2==r&&(i=Sm(i,o+": "+t[++a]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=s:n.classesWithoutHost=s}class kC extends wf{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=ut(t);return new Nu(e,this.ngModule)}}function CC(n){const t=[];for(const e in n){if(!n.hasOwnProperty(e))continue;const i=n[e];void 0!==i&&t.push({propName:Array.isArray(i)?i[0]:i,templateName:e})}return t}class D2{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){i=xd(i);const s=this.injector.get(t,Sb,i);return s!==Sb||e===Sb?s:this.parentInjector.get(t,e,i)}}class Nu extends nC{get inputs(){const t=this.componentDef,e=t.inputTransforms,i=CC(t.inputs);if(null!==e)for(const s of i)e.hasOwnProperty(s.propName)&&(s.transform=e[s.propName]);return i}get outputs(){return CC(this.componentDef.outputs)}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function DA(n){return n.map(CA).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}create(t,e,i,s){let r=(s=s||this.ngModule)instanceof us?s:s?.injector;r&&null!==this.componentDef.getStandaloneInjector&&(r=this.componentDef.getStandaloneInjector(r)||r);const a=r?new D2(t,r):t,o=a.get(sC,null);if(null===o)throw new z(407,!1);const h={rendererFactory:o,sanitizer:a.get(jO,null),inlineEffectRunner:null,afterRenderEventManager:a.get(ku,null),changeDetectionScheduler:a.get(tC,null)},f=o.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",g=i?function LR(n,t,e,i){const r=i.get(LT,!1)||e===Ms.ShadowDom,a=n.selectRootElement(t,r);return function RR(n){Ek(n)}(a),a}(f,i,this.componentDef.encapsulation,a):nf(f,p,function C2(n){const t=n.toLowerCase();return"svg"===t?wv:"math"===t?"math":null}(p));let m=512;this.componentDef.signals?m|=4096:this.componentDef.onPush||(m|=16);let y=null;null!==g&&(y=uy(g,a,!0));const b=ab(0,null,null,1,0,null,null,null,null,null,null),_=uf(null,b,null,m,null,null,h,f,a,null,y);let v,k;Hm(_);try{const F=this.componentDef;let D,C=null;F.findHostDirectiveDefs?(D=[],C=new Map,F.findHostDirectiveDefs(F,D,C),D.push(F)):D=[F];const oe=function x2(n,t){const e=n[ee],i=Je;return n[i]=t,Pl(e,i,2,"#host",null)}(_,g),at=function E2(n,t,e,i,s,r,a){const o=s[ee];!function B2(n,t,e,i){for(const s of n)t.mergedAttrs=Hc(t.mergedAttrs,s.hostAttrs);null!==t.mergedAttrs&&(kf(t,t.mergedAttrs,!0),null!==e&&kk(i,e,t))}(i,n,t,a);let l=null;null!==t&&(l=uy(t,s[di]));const c=r.rendererFactory.createRenderer(t,e);let u=16;e.signals?u=4096:e.onPush&&(u=64);const h=uf(s,xk(e),null,u,s[n.index],n,r,c,null,null,l);return o.firstCreatePass&&lb(o,n,i.length-1),hf(s,h),s[n.index]=h}(oe,g,F,D,_,h,f);k=qc(b,Je),g&&function I2(n,t,e,i){if(i)Tm(n,e,["ng-version","17.2.3"]);else{const{attrs:s,classes:r}=function NA(n){const t=[],e=[];let i=1,s=2;for(;i<n.length;){let r=n[i];if("string"==typeof r)2===s?""!==r&&t.push(r,n[++i]):8===s&&e.push(r);else{if(!As(s))break;s=r}i++}return{attrs:t,classes:e}}(t.selectors[0]);s&&Tm(n,e,s),r&&r.length>0&&Tk(n,e,r.join(" "))}}(f,F,g,i),void 0!==e&&function M2(n,t,e){const i=n.projection=[];for(let s=0;s<t.length;s++){const r=e[s];i.push(null!=r?Array.from(r):null)}}(k,this.ngContentSelectors,e),v=function P2(n,t,e,i,s,r){const a=Ft(),o=s[ee],l=xi(a,s);Ik(o,s,a,e,null,i);for(let u=0;u<e.length;u++)vi(bo(s,o,a.directiveStart+u,a),s);Mk(o,s,a),l&&vi(l,s);const c=bo(s,o,a.directiveStart+a.componentOffset,a);if(n[Jt]=s[Jt]=c,null!==r)for(const u of r)u(c,t);return ib(o,a,s),c}(at,F,D,C,_,[A2]),db(b,_,null)}finally{Wm()}return new N2(this.componentType,v,ul(k,_),_,k)}}class N2 extends UO{constructor(t,e,i,s,r){super(),this.location=i,this._rootLView=s,this._tNode=r,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new wu(s,void 0,!1),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let s;if(null!==i&&(s=i[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;const r=this._rootLView;hb(r[ee],r,s,t,e),this.previousInputValues.set(t,e),bu(os(this._tNode.index,r))}}get injector(){return new ei(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function A2(){const n=Ft();Hd(L()[ee],n)}let Vs=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=F2}return n})();function F2(){return xC(Ft(),L())}const L2=Vs,DC=class extends L2{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return ul(this._hostTNode,this._hostLView)}get injector(){return new ei(this._hostTNode,this._hostLView)}get parentInjector(){const t=$d(this._hostTNode,this._hostLView);if(Ey(t)){const e=ou(t,this._hostLView),i=au(t);return new ei(e[ee].data[i+8],e)}return new ei(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=NC(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-Bn}createEmbeddedView(t,e,i){let s,r;"number"==typeof i?s=i:null!=i&&(s=i.index,r=i.injector);const o=t.createEmbeddedViewImpl(e||{},r,null);return this.insertImpl(o,s,Il(this._hostTNode,null)),o}createComponent(t,e,i,s,r){const a=t&&!function su(n){return"function"==typeof n}(t);let o;if(a)o=e;else{const g=e||{};o=g.index,i=g.injector,s=g.projectableNodes,r=g.environmentInjector||g.ngModuleRef}const l=a?t:new Nu(ut(t)),c=i||this.parentInjector;if(!r&&null==l.ngModule){const m=(a?c:this.parentInjector).get(us,null);m&&(r=m)}ut(l.componentType??{});const p=l.create(c,s,null,r);return this.insertImpl(p.hostView,o,Il(this._hostTNode,null)),p}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,i){const s=t._lView;if(function OA(n){return Si(n[En])}(s)){const o=this.indexOf(t);if(-1!==o)this.detach(o);else{const l=s[En],c=new DC(l,l[bi],l[En]);c.detach(c.indexOf(t))}}const r=this._adjustIndex(e),a=this._lContainer;return mu(a,s,r,i),t.attachToViewContainerRef(),Ov(xb(a),r,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=NC(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=du(this._lContainer,e);i&&(wd(xb(this._lContainer),e),sf(i[ee],i))}detach(t){const e=this._adjustIndex(t,-1),i=du(this._lContainer,e);return i&&null!=wd(xb(this._lContainer),e)?new wu(i):null}_adjustIndex(t,e=0){return t??this.length+e}};function NC(n){return n[8]}function xb(n){return n[8]||(n[8]=[])}function xC(n,t){let e;const i=t[n.index];return Si(i)?e=i:(e=Ak(i,t,null,n),t[n.index]=e,hf(t,e)),EC(e,t,n,i),new DC(e,n,t)}let EC=function PC(n,t,e,i){if(n[sr])return;let s;s=8&e.type?Ut(i):function R2(n,t){const e=n[Ye],i=e.createComment(""),s=xi(t,n);return wo(e,rf(e,s),i,function xR(n,t){return n.nextSibling(t)}(e,s),!1),i}(t,e),n[sr]=s},Eb=()=>!1;class Bb{constructor(t){this.queryList=t,this.matches=null}clone(){return new Bb(this.queryList)}setDirty(){this.queryList.setDirty()}}class Pb{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,s=[];for(let r=0;r<i;r++){const a=e.getByIndex(r);s.push(this.queries[a.indexInDeclarationView].clone())}return new Pb(s)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==Lb(t,e).matches&&this.queries[e].setDirty()}}class IC{constructor(t,e,i=null){this.flags=e,this.read=i,this.predicate="string"==typeof t?function $2(n){return n.split(",").map(t=>t.trim())}(t):t}}class Ib{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const s=null!==e?e.length:0,r=this.getByIndex(i).embeddedTView(t,s);r&&(r.indexInDeclarationView=i,null!==e?e.push(r):e=[r])}return null!==e?new Ib(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Mb{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new Mb(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let s=0;s<i.length;s++){const r=i[s];this.matchTNodeWithReadOption(t,e,W2(e,r)),this.matchTNodeWithReadOption(t,e,jd(e,t,r,!1,!1))}else i===Ur?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,jd(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const s=this.metadata.read;if(null!==s)if(s===ls||s===Vs||s===Ur&&4&e.type)this.addMatch(e.index,-2);else{const r=jd(e,t,s,!1,!1);null!==r&&this.addMatch(e.index,r)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function W2(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function G2(n,t,e,i){return-1===e?function U2(n,t){return 11&n.type?ul(n,t):4&n.type?pf(n,t):null}(t,n):-2===e?function z2(n,t,e){return e===ls?ul(t,n):e===Ur?pf(t,n):e===Vs?xC(t,n):void 0}(n,t,i):bo(n,n[ee],e,t)}function MC(n,t,e,i){const s=t[Lr].queries[i];if(null===s.matches){const r=n.data,a=e.matches,o=[];for(let l=0;null!==a&&l<a.length;l+=2){const c=a[l];o.push(c<0?null:G2(t,r[c],a[l+1],e.metadata.read))}s.matches=o}return s.matches}function Ab(n,t,e,i){const s=n.queries.getByIndex(e),r=s.matches;if(null!==r){const a=MC(n,t,s,e);for(let o=0;o<r.length;o+=2){const l=r[o];if(l>0)i.push(a[o/2]);else{const c=r[o+1],u=t[-l];for(let h=Bn;h<u.length;h++){const f=u[h];f[Gc]===f[En]&&Ab(f[ee],f,c,i)}if(null!==u[ol]){const h=u[ol];for(let f=0;f<h.length;f++){const p=h[f];Ab(p[ee],p,c,i)}}}}}return i}function FC(n,t,e){const i=ft();return i.firstCreatePass&&(function RC(n,t,e){null===n.queries&&(n.queries=new Ib),n.queries.track(new Mb(t,e))}(i,new IC(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),function AC(n,t,e){const i=new zm(4==(4&e));return function HR(n,t,e,i){const s=Lk(t);s.push(e),n.firstCreatePass&&Rk(n).push(i,s.length-1)}(n,t,i,i.destroy),(t[Lr]??=new Pb).queries.push(new Bb(i))-1}(i,L(),t)}function Lb(n,t){return n.queries.getByIndex(t)}function OC(n,t){const e=n[ee],i=Lb(e,t);return i.crossesNgTemplate?Ab(e,n,t,[]):MC(e,n,i,t)}function Rt(n){let t=function XC(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let s;if(Rs(n))s=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new z(903,!1);s=t.\u0275dir}if(s){if(e){i.push(s);const a=n;a.inputs=Df(n.inputs),a.inputTransforms=Df(n.inputTransforms),a.declaredInputs=Df(n.declaredInputs),a.outputs=Df(n.outputs);const o=s.hostBindings;o&&aV(n,o);const l=s.viewQuery,c=s.contentQueries;if(l&&sV(n,l),c&&rV(n,c),nV(n,s),mA(n.outputs,s.outputs),Rs(s)&&s.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(s.data.animation)}}const r=s.features;if(r)for(let a=0;a<r.length;a++){const o=r[a];o&&o.ngInherit&&o(n),o===Rt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function iV(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const s=n[i];s.hostVars=t+=s.hostVars,s.hostAttrs=Hc(s.hostAttrs,e=Hc(e,s.hostAttrs))}}(i)}function nV(n,t){for(const e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;const i=t.inputs[e];if(void 0!==i&&(n.inputs[e]=i,n.declaredInputs[e]=t.declaredInputs[e],null!==t.inputTransforms)){const s=Array.isArray(i)?i[0]:i;if(!t.inputTransforms.hasOwnProperty(s))continue;n.inputTransforms??={},n.inputTransforms[s]=t.inputTransforms[s]}}}function Df(n){return n===ir?{}:n===vt?[]:n}function sV(n,t){const e=n.viewQuery;n.viewQuery=e?(i,s)=>{t(i,s),e(i,s)}:t}function rV(n,t){const e=n.contentQueries;n.contentQueries=e?(i,s,r)=>{t(i,s,r),e(i,s,r)}:t}function aV(n,t){const e=n.hostBindings;n.hostBindings=e?(i,s)=>{t(i,s),e(i,s)}:t}class _o{}class eD{}class Ob extends _o{constructor(t,e,i){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new kC(this);const s=yi(t);this._bootstrapComponents=hs(s.bootstrap),this._r3Injector=IT(t,e,[{provide:_o,useValue:this},{provide:wf,useValue:this.componentFactoryResolver},...i],Qn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Vb extends eD{constructor(t){super(),this.moduleType=t}create(t){return new Ob(this.moduleType,t,[])}}class tD extends _o{constructor(t){super(),this.componentFactoryResolver=new kC(this),this.instance=null;const e=new _l([...t.providers,{provide:_o,useValue:this},{provide:wf,useValue:this.componentFactoryResolver}],t.parent||Rd(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Hb(n,t,e=null){return new tD({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}let Ll=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ss(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function hr(n,t,e){return n[t]=e}function In(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Mn(n,t,e,i,s,r,a,o){const l=L(),c=ft(),u=n+Je,h=c.firstCreatePass?function mV(n,t,e,i,s,r,a,o,l){const c=t.consts,u=Pl(t,n,4,a||null,rr(c,o));ob(t,e,u,rr(c,l)),Hd(t,u);const h=u.tView=ab(2,u,i,s,r,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return null!==t.queries&&(t.queries.template(t,u),h.queries=t.queries.embeddedTView(u)),u}(u,c,l,t,e,i,s,r,a):c.data[u];ar(h,!1);const f=nD(c,l,h,n);bd()&&af(c,l,f,h),vi(f,l);const p=Ak(f,l,f,h);return l[u]=p,hf(l,p),function BC(n,t,e){return Eb(n,t,e)}(p,h,l),gd(h)&&sb(c,l,h),null!=a&&rb(l,h,o),Mn}let nD=function iD(n,t,e,i){return ga(!0),t[Ye].createComment("")};function Hs(n,t,e,i){const s=L();return In(s,Os(),t)&&(ft(),cr(Qt(),s,n,t,e,i)),Hs}function zl(n,t,e,i){return In(n,Os(),e)?t+Qe(e)+i:et}function $l(n,t,e,i,s,r){const o=function vo(n,t,e,i){const s=In(n,t,e);return In(n,t+1,i)||s}(n,function Rr(){return Ge.lFrame.bindingIndex}(),e,s);return Or(2),o?t+Qe(e)+i+Qe(s)+r:et}function Af(n,t){return n<<17|t<<2}function ka(n){return n>>17&32767}function Jb(n){return 2|n}function ko(n){return(131068&n)>>2}function Qb(n,t){return-131069&n|t<<2}function Kb(n){return 1|n}function AD(n,t,e,i){const s=n[e+1],r=null===t;let a=i?ka(s):ko(s),o=!1;for(;0!==a&&(!1===o||r);){const c=n[a+1];e3(n[a],t)&&(o=!0,n[a+1]=i?Kb(c):Jb(c)),a=i?ka(c):ko(c)}o&&(n[e+1]=i?Jb(s):Kb(s))}function e3(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&dl(n,t)>=0}function pt(n,t,e){const i=L();return In(i,Os(),t)&&Zi(ft(),Qt(),i,n,t,i[Ye],e,!1),pt}function Zb(n,t,e,i,s){const a=s?"class":"style";hb(n,e,t.inputs[a],a,i)}function Ff(n,t,e){return Ws(n,t,e,!1),Ff}function oi(n,t){return Ws(n,t,null,!0),oi}function Ws(n,t,e,i){const s=L(),r=ft(),a=Or(2);r.firstUpdatePass&&function UD(n,t,e,i){const s=n.data;if(null===s[e+1]){const r=s[_i()],a=function WD(n,t){return t>=n.expandoStartIndex}(n,e);(function jD(n,t){return 0!=(n.flags&(t?8:16))})(r,i)&&null===t&&!a&&(t=!1),t=function c3(n,t,e,i){const s=function Om(n){const t=Ge.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}(n);let r=i?t.residualClasses:t.residualStyles;if(null===s)0===(i?t.classBindings:t.styleBindings)&&(e=Mu(e=ew(null,n,t,e,i),t.attrs,i),r=null);else{const a=t.directiveStylingLast;if(-1===a||n[a]!==s)if(e=ew(s,n,t,e,i),null===r){let l=function u3(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==ko(i))return n[ka(i)]}(n,t,i);void 0!==l&&Array.isArray(l)&&(l=ew(null,n,t,l[1],i),l=Mu(l,t.attrs,i),function h3(n,t,e,i){n[ka(e?t.classBindings:t.styleBindings)]=i}(n,t,i,l))}else r=function d3(n,t,e){let i;const s=t.directiveEnd;for(let r=1+t.directiveStylingLast;r<s;r++)i=Mu(i,n[r].hostAttrs,e);return Mu(i,t.attrs,e)}(n,t,i)}return void 0!==r&&(i?t.residualClasses=r:t.residualStyles=r),e}(s,r,t,i),function KV(n,t,e,i,s,r){let a=r?t.classBindings:t.styleBindings,o=ka(a),l=ko(a);n[i]=e;let u,c=!1;if(Array.isArray(e)?(u=e[1],(null===u||dl(e,u)>0)&&(c=!0)):u=e,s)if(0!==l){const f=ka(n[o+1]);n[i+1]=Af(f,o),0!==f&&(n[f+1]=Qb(n[f+1],i)),n[o+1]=function JV(n,t){return 131071&n|t<<17}(n[o+1],i)}else n[i+1]=Af(o,0),0!==o&&(n[o+1]=Qb(n[o+1],i)),o=i;else n[i+1]=Af(l,0),0===o?o=i:n[l+1]=Qb(n[l+1],i),l=i;c&&(n[i+1]=Jb(n[i+1])),AD(n,u,i,!0),AD(n,u,i,!1),function ZV(n,t,e,i,s){const r=s?n.residualClasses:n.residualStyles;null!=r&&"string"==typeof t&&dl(r,t)>=0&&(e[i+1]=Kb(e[i+1]))}(t,u,n,i,r),a=Af(o,l),r?t.classBindings=a:t.styleBindings=a}(s,r,t,e,a,i)}}(r,n,a,i),t!==et&&In(s,a,t)&&function zD(n,t,e,i,s,r,a,o){if(!(3&t.type))return;const l=n.data,c=l[o+1],u=function QV(n){return 1==(1&n)}(c)?$D(l,t,e,s,ko(c),a):void 0;Lf(u)||(Lf(r)||function XV(n){return 2==(2&n)}(c)&&(r=$D(l,null,e,s,o,a)),function PR(n,t,e,i,s){if(t)s?n.addClass(e,i):n.removeClass(e,i);else{let r=-1===i.indexOf("-")?void 0:Sa.DashCase;null==s?n.removeStyle(e,i,r):("string"==typeof s&&s.endsWith("!important")&&(s=s.slice(0,-10),r|=Sa.Important),n.setStyle(e,i,s,r))}}(i,a,jc(_i(),e),s,r))}(r,r.data[_i()],s,s[Ye],n,s[a+1]=function m3(n,t){return null==n||""===n||("string"==typeof t?n+=t:"object"==typeof n&&(n=Qn(function ba(n){return n instanceof HT?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(t,e),i,a)}function ew(n,t,e,i,s){let r=null;const a=e.directiveEnd;let o=e.directiveStylingLast;for(-1===o?o=e.directiveStart:o++;o<a&&(r=t[o],i=Mu(i,r.hostAttrs,s),r!==n);)o++;return null!==n&&(e.directiveStylingLast=o),i}function Mu(n,t,e){const i=e?1:2;let s=-1;if(null!==t)for(let r=0;r<t.length;r++){const a=t[r];"number"==typeof a?s=a:s===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),cs(n,a,!!e||t[++r]))}return void 0===n?null:n}function $D(n,t,e,i,s,r){const a=null===t;let o;for(;s>0;){const l=n[s],c=Array.isArray(l),u=c?l[1]:l,h=null===u;let f=e[s+1];f===et&&(f=h?vt:void 0);let p=h?Gm(f,i):u===i?f:void 0;if(c&&!Lf(p)&&(p=Gm(l,i)),Lf(p)&&(o=p,a))return o;const g=n[s+1];s=a?ka(g):ko(g)}if(null!==t){let l=r?t.residualClasses:t.residualStyles;null!=l&&(o=Gm(l,i))}return o}function Lf(n){return void 0!==n}function G(n,t,e,i){const s=L(),r=ft(),a=Je+n,o=s[Ye],l=r.firstCreatePass?function V3(n,t,e,i,s,r){const a=t.consts,l=Pl(t,n,2,i,rr(a,s));return ob(t,e,l,rr(a,r)),null!==l.attrs&&kf(l,l.attrs,!1),null!==l.mergedAttrs&&kf(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(a,r,s,t,e,i):r.data[a],c=JD(r,s,l,o,t,n);s[a]=c;const u=gd(l);return ar(l,!0),kk(o,c,l),32!=(32&l.flags)&&bd()&&af(r,s,c,l),0===function HA(){return Ge.lFrame.elementDepthCount}()&&vi(c,s),function WA(){Ge.lFrame.elementDepthCount++}(),u&&(sb(r,s,l),ib(r,l,s)),null!==i&&rb(s,l),G}function $(){let n=Ft();Fm()?Lm():(n=n.parent,ar(n,!1));const t=n;(function GA(n){return Ge.skipHydrationRootTNode===n})(t)&&function qA(){Ge.skipHydrationRootTNode=null}(),function UA(){Ge.lFrame.elementDepthCount--}();const e=ft();return e.firstCreatePass&&(Hd(e,n),Dm(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function cL(n){return 0!=(8&n.flags)}(t)&&Zb(e,t,L(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function uL(n){return 0!=(16&n.flags)}(t)&&Zb(e,t,L(),t.stylesWithoutHost,!1),$}function Ln(n,t,e,i){return G(n,t,e,i),$(),Ln}let JD=(n,t,e,i,s,r)=>(ga(!0),nf(i,s,function Fv(){return Ge.lFrame.currentNamespace}()));function Ca(n,t,e){const i=L(),s=ft(),r=n+Je,a=s.firstCreatePass?function U3(n,t,e,i,s){const r=t.consts,a=rr(r,i),o=Pl(t,n,8,"ng-container",a);return null!==a&&kf(o,a,!0),ob(t,e,o,rr(r,s)),null!==t.queries&&t.queries.elementStart(t,o),o}(r,s,i,t,e):s.data[r];ar(a,!0);const o=KD(s,i,a,n);return i[r]=o,bd()&&af(s,i,o,a),vi(o,i),gd(a)&&(sb(s,i,a),ib(s,a,i)),null!=e&&rb(i,a),Ca}function Da(){let n=Ft();const t=ft();return Fm()?Lm():(n=n.parent,ar(n,!1)),t.firstCreatePass&&(Hd(t,n),Dm(n)&&t.queries.elementEnd(n)),Da}let KD=(n,t,e,i)=>(ga(!0),Jy(t[Ye],""));function zr(){return L()}const ec="en-US";let iN=ec;function tt(n,t,e,i){const s=L(),r=ft(),a=Ft();return ow(r,s,s[Ye],a,n,t,i),tt}function ow(n,t,e,i,s,r,a){const o=gd(i),c=n.firstCreatePass&&Rk(n),u=t[Jt],h=Lk(t);let f=!0;if(3&i.type||a){const m=xi(i,t),y=a?a(m):m,b=h.length,_=a?k=>a(Ut(k[i.index])):i.index;let v=null;if(!a&&o&&(v=function WH(n,t,e,i){const s=n.cleanup;if(null!=s)for(let r=0;r<s.length-1;r+=2){const a=s[r];if(a===e&&s[r+1]===i){const o=t[sl],l=s[r+2];return o.length>l?o[l]:null}"string"==typeof a&&(r+=2)}return null}(n,t,s,i.index)),null!==v)(v.__ngLastListenerFn__||v).__ngNextListenerFn__=r,v.__ngLastListenerFn__=r,f=!1;else{r=BN(i,t,u,r,!1);const k=e.listen(y,s,r);h.push(r,k),c&&c.push(s,_,b,b+1)}}else r=BN(i,t,u,r,!1);const p=i.outputs;let g;if(f&&null!==p&&(g=p[s])){const m=g.length;if(m)for(let y=0;y<m;y+=2){const F=t[g[y]][g[y+1]].subscribe(r),D=h.length;h.push(r,F),c&&c.push(s,i.index,D,"function"==typeof F?D+1:-(D+1))}}}function EN(n,t,e,i){try{return or(6,t,e),!1!==e(i)}catch(s){return df(n,s),!1}finally{or(7,t,e)}}function BN(n,t,e,i,s){return function r(a){if(a===Function)return i;bu(n.componentOffset>-1?os(n.index,t):t);let l=EN(t,e,i,a),c=r.__ngNextListenerFn__;for(;c;)l=EN(t,e,c,a)&&l,c=c.__ngNextListenerFn__;return s&&!1===l&&a.preventDefault(),l}}function Gt(n=1){return function ZA(n){return(Ge.lFrame.contextLView=function Tv(n,t){for(;n>0;)t=t[rl],n--;return t}(n,Ge.lFrame.contextLView))[Jt]}(n)}function Wf(n,t,e){return lw(n,"",t,"",e),Wf}function lw(n,t,e,i,s){const r=L(),a=zl(r,t,e,i);return a!==et&&Zi(ft(),Qt(),r,n,a,r[Ye],s,!1),lw}function cw(n,t,e){FC(n,t,e)}function Uf(n){const t=L(),e=ft(),i=Vm();yd(i+1);const s=Lb(e,i);if(n.dirty&&function RA(n){return 4==(4&n[Ee])}(t)===(2==(2&s.metadata.flags))){if(null===s.matches)n.reset([]);else{const r=OC(t,i);n.reset(r,Rv),n.notifyOnChanges()}return!0}return!1}function Gf(){return function Fb(n,t){return n[Lr].queries[t].queryList}(L(),Vm())}function ue(n,t=""){const e=L(),i=ft(),s=n+Je,r=i.firstCreatePass?Pl(i,s,1,t,null):i.data[s],a=XN(i,e,r,t,n);e[s]=a,bd()&&af(i,e,a,r),ar(r,!1)}let XN=(n,t,e,i,s)=>(ga(!0),function tf(n,t){return n.createText(t)}(t[Ye],i));function Ke(n){return fn("",n,""),Ke}function fn(n,t,e){const i=L(),s=zl(i,n,t,e);return s!==et&&Wr(i,_i(),s),fn}function tc(n,t,e,i,s){const r=L(),a=$l(r,n,t,e,i,s);return a!==et&&Wr(r,_i(),a),tc}function ts(n,t,e){oC(t)&&(t=t());const i=L();return In(i,Os(),t)&&Zi(ft(),Qt(),i,n,t,i[Ye],e,!1),ts}function fs(n,t){const e=oC(n);return e&&n.set(t),e}function ns(n,t){const e=L(),i=ft(),s=Ft();return ow(i,e,e[Ye],s,n,t),ns}function uw(n,t,e,i,s){if(n=Ue(n),Array.isArray(n))for(let r=0;r<n.length;r++)uw(n[r],t,e,i,s);else{const r=ft(),a=L(),o=Ft();let l=mo(n)?n:Ue(n.provide);const c=cT(n),u=1048575&o.providerIndexes,h=o.directiveStart,f=o.providerIndexes>>20;if(mo(n)||!n.multi){const p=new ru(c,s,j),g=dw(l,t,s?u:u+f,h);-1===g?(Iy(zd(o,a),r,l),hw(r,n,t.length),t.push(l),o.directiveStart++,o.directiveEnd++,s&&(o.providerIndexes+=1048576),e.push(p),a.push(p)):(e[g]=p,a[g]=p)}else{const p=dw(l,t,u+f,h),g=dw(l,t,u,u+f),y=g>=0&&e[g];if(s&&!y||!s&&!(p>=0&&e[p])){Iy(zd(o,a),r,l);const b=function u4(n,t,e,i,s){const r=new ru(n,e,j);return r.multi=[],r.index=t,r.componentProviders=0,ix(r,s,i&&!e),r}(s?c4:l4,e.length,s,i,c);!s&&y&&(e[g].providerFactory=b),hw(r,n,t.length,0),t.push(l),o.directiveStart++,o.directiveEnd++,s&&(o.providerIndexes+=1048576),e.push(b),a.push(b)}else hw(r,n,p>-1?p:g,ix(e[s?g:p],c,!s&&i));!s&&i&&y&&e[g].componentProviders++}}}function hw(n,t,e,i){const s=mo(t),r=function OF(n){return!!n.useClass}(t);if(s||r){const l=(r?Ue(t.useClass):t).prototype.ngOnDestroy;if(l){const c=n.destroyHooks||(n.destroyHooks=[]);if(!s&&t.multi){const u=c.indexOf(e);-1===u?c.push(e,[i,l]):c[u+1].push(i,l)}else c.push(e,l)}}}function ix(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function dw(n,t,e,i){for(let s=e;s<i;s++)if(t[s]===n)return s;return-1}function l4(n,t,e,i){return fw(this.multi,[])}function c4(n,t,e,i){const s=this.multi;let r;if(this.providerFactory){const a=this.providerFactory.componentProviders,o=bo(e,e[ee],this.providerFactory.index,i);r=o.slice(0,a),fw(s,r);for(let l=a;l<o.length;l++)r.push(o[l])}else r=[],fw(s,r);return r}function fw(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function cn(n,t=[]){return e=>{e.providersResolver=(i,s)=>function o4(n,t,e){const i=ft();if(i.firstCreatePass){const s=Rs(n);uw(e,i.data,i.blueprint,s,!0),uw(t,i.data,i.blueprint,s,!1)}}(i,s?s(n):n,t)}}let h4=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const i=by(0,e.type),s=i.length>0?Hb([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,s)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=fe({token:n,providedIn:"environment",factory:()=>new n(Oe(us))})}return n})();function Vu(n){(function ur(n){aC.has(n)||(aC.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))})("NgStandalone"),n.getStandaloneInjector=t=>t.get(h4).getOrCreateStandaloneInjector(n)}function Na(n,t,e){const i=Ei()+n,s=L();return s[i]===et?hr(s,i,e?t.call(e):t()):function Eu(n,t){return n[t]}(s,i)}function dx(n,t,e,i,s,r){const a=t+e;return In(n,a,s)?hr(n,a+1,r?i.call(r,s):i(s)):function Hu(n,t){const e=n[t];return e===et?void 0:e}(n,a+1)}function Me(n,t){const e=ft();let i;const s=n+Je;e.firstCreatePass?(i=function B4(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[s]=i,i.onDestroy&&(e.destroyHooks??=[]).push(s,i.onDestroy)):i=e.data[s];const r=i.factory||(i.factory=po(i.type)),o=Ji(j);try{const l=Gd(!1),c=r();return Gd(l),function YH(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,L(),s,c),c}finally{Ji(o)}}function Ae(n,t,e){const i=n+Je,s=L(),r=function ll(n,t){return n[t]}(s,i);return function Wu(n,t){return n[ee].data[t].pure}(s,i)?dx(s,Ei(),t,r.transform,e,r):r.transform(e)}let Ix=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();const Rx=new ce("");function $u(n){return!!n&&"function"==typeof n.then}function Ox(n){return!!n&&"function"==typeof n.subscribe}const E5=new ce("");let Tw=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i}),this.appInits=Q(E5,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const e=[];for(const s of this.appInits){const r=s();if($u(r))e.push(r);else if(Ox(r)){const a=new Promise((o,l)=>{r.subscribe({complete:o,error:l})});e.push(a)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(s=>{this.reject(s)}),0===e.length&&i(),this.initialized=!0}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const kw=new ce("");let xa=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Q(AT),this.afterRenderEffectManager=Q(ku),this.componentTypes=[],this.components=[],this.isStable=Q(Ll).hasPendingTasks.pipe(mt(e=>!e)),this._injector=Q(us)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const s=e instanceof nC;if(!this._injector.get(Tw).done)throw!s&&function fa(n){const t=ut(n)||Kn(n)||hi(n);return null!==t&&t.standalone}(e),new z(405,!1);let a;a=s?e:this._injector.get(wf).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const o=function B5(n){return n.isBoundToModule}(a)?void 0:this._injector.get(_o),c=a.create(Qi.NULL,[],i||a.selector,o),u=c.location.nativeElement,h=c.injector.get(Rx,null);return h?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),Yf(this.components,c),h?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new z(101,!1);try{this._runningTick=!0,this.detectChangesInAttachedViews()}catch(e){this.internalErrorHandler(e)}finally{this._runningTick=!1}}detectChangesInAttachedViews(){let e=0;const i=this.afterRenderEffectManager;for(;;){if(100===e)throw new z(103,!1);const s=0===e;for(let{_lView:r,notifyErrorHandler:a}of this._views)!s&&!Cw(r)||this.detectChangesInView(r,a,s);if(e++,i.executeInternalCallbacks(),!this._views.some(({_lView:r})=>Cw(r))&&(i.execute(),!this._views.some(({_lView:r})=>Cw(r))))break}}detectChangesInView(e,i,s){let r;s?(r=0,e[Ee]|=1024):r=64&e[Ee]?0:1,ff(e,i,r)}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;Yf(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const i=this._injector.get(kw,[]);[...this._bootstrapListeners,...i].forEach(s=>s(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Yf(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new z(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Yf(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function Cw(n){return Im(n)}class I5{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let M5=(()=>{class n{compileModuleSync(e){return new Vb(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),r=hs(yi(e).declarations).reduce((a,o)=>{const l=ut(o);return l&&a.push(new Nu(l)),a},[]);return new I5(i,r)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),L5=(()=>{class n{constructor(){this.zone=Q(Lt),this.applicationRef=Q(xa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Gx(n){return[{provide:Lt,useFactory:n},{provide:go,multi:!0,useFactory:()=>{const t=Q(L5,{optional:!0});return()=>t.initialize()}},{provide:go,multi:!0,useFactory:()=>{const t=Q(V5);return()=>{t.initialize()}}},{provide:AT,useFactory:R5}]}function R5(){const n=Q(Lt),t=Q(Vr);return e=>n.runOutsideAngular(()=>t.handleError(e))}function O5(n){return iu([[],Gx(()=>new Lt(function zx(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}(n)))])}let V5=(()=>{class n{constructor(){this.subscription=new Yi,this.initialized=!1,this.zone=Q(Lt),this.pendingTasks=Q(Ll)}initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Lt.assertNotInAngularZone(),queueMicrotask(()=>{null!==e&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Lt.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const $r=new ce("",{providedIn:"root",factory:()=>Q($r,dt.Optional|dt.SkipSelf)||function H5(){return typeof $localize<"u"&&$localize.locale||ec}()}),Dw=new ce("");let Ea=null;function u8(n){try{const{rootComponent:t,appProviders:e,platformProviders:i}=n,s=function $5(n=[]){if(Ea)return Ea;const t=function qx(n=[],t){return Qi.create({name:t,providers:[{provide:_y,useValue:"platform"},{provide:Dw,useValue:new Set([()=>Ea=null])},...n]})}(n);return Ea=t,function Vx(){!function YM(n){W_=n}(()=>{throw new z(600,!1)})}(),function Yx(n){n.get($v,null)?.forEach(e=>e())}(t),t}(i),r=[O5(),...e||[]],o=new tD({providers:r,parent:s,debugName:"",runEnvironmentInitializers:!1}).injector,l=o.get(Lt);return l.run(()=>{o.resolveInjectorInitializers();const c=o.get(Vr,null);let u;l.runOutsideAngular(()=>{u=l.onError.subscribe({next:p=>{c.handleError(p)}})});const h=()=>o.destroy(),f=s.get(Dw);return f.add(h),o.onDestroy(()=>{u.unsubscribe(),f.delete(h)}),function Hx(n,t,e){try{const i=e();return $u(i)?i.catch(s=>{throw t.runOutsideAngular(()=>n.handleError(s)),s}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(c,l,()=>{const p=o.get(Tw);return p.runInitializers(),p.donePromise.then(()=>{!function sN(n){"string"==typeof n&&(iN=n.toLowerCase().replace(/_/g,"-"))}(o.get($r,ec)||ec);const m=o.get(xa);return void 0!==t&&m.bootstrap(t),m})})})}catch(t){return Promise.reject(t)}}let w1=null;function Ba(){return w1}class C8{}const Gs=new ce("");let S1=(()=>{class n{historyGo(e){throw new Error("")}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q(D8),providedIn:"platform"})}return n})(),D8=(()=>{class n extends S1{constructor(){super(),this._doc=Q(Gs),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ba().getBaseHref(this._doc)}onPopState(e){const i=Ba().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=Ba().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,s){this._history.pushState(e,i,s)}replaceState(e,i,s){this._history.replaceState(e,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function _1(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function v1(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function No(n){return n&&"?"!==n[0]?"?"+n:n}let ip=(()=>{class n{historyGo(e){throw new Error("")}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q(x8),providedIn:"root"})}return n})();const N8=new ce("");let x8=(()=>{class n extends ip{constructor(e,i){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Q(Gs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return _1(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+No(this._platformLocation.search),s=this._platformLocation.hash;return s&&e?`${i}${s}`:i}pushState(e,i,s,r){const a=this.prepareExternalUrl(s+No(r));this._platformLocation.pushState(e,i,a)}replaceState(e,i,s,r){const a=this.prepareExternalUrl(s+No(r));this._platformLocation.replaceState(e,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(S1),Oe(N8,8))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Yu=(()=>{class n{constructor(e){this._subject=new hn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._basePath=function P8(n){if(new RegExp("^(https?:)?//").test(n)){const[,e]=n.split(/\/\/[^\/]+/);return e}return n}(v1(T1(i))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+No(i))}normalize(e){return n.stripTrailingSlash(function B8(n,t){if(!n||!t.startsWith(n))return t;const e=t.substring(n.length);return""===e||["/",";","?","#"].includes(e[0])?e:t}(this._basePath,T1(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",s=null){this._locationStrategy.pushState(s,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+No(i)),s)}replaceState(e,i="",s=null){this._locationStrategy.replaceState(s,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+No(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(s=>s(e,i))}subscribe(e,i,s){return this._subject.subscribe({next:e,error:i,complete:s})}static#e=this.normalizeQueryParams=No;static#t=this.joinWithSlash=_1;static#n=this.stripTrailingSlash=v1;static#i=this.\u0275fac=function(i){return new(i||n)(Oe(ip))};static#s=this.\u0275prov=fe({token:n,factory:()=>function E8(){return new Yu(Oe(ip))}(),providedIn:"root"})}return n})();function T1(n){return n.replace(/\/index.html$/,"")}function I1(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[s,r]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(s.trim()===t)return decodeURIComponent(r)}return null}class y6{constructor(t,e,i,s){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let F1=(()=>{class n{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,i,s){this._viewContainer=e,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((s,r,a)=>{if(null==s.previousIndex)i.createEmbeddedView(this._template,new y6(s.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)i.remove(null===r?void 0:r);else if(null!==r){const o=i.get(r);i.move(o,a),L1(o,s)}});for(let s=0,r=i.length;s<r;s++){const o=i.get(s).context;o.index=s,o.count=r,o.ngForOf=this._ngForOf}e.forEachIdentityChange(s=>{L1(i.get(s.currentIndex),s)})}static ngTemplateContextGuard(e,i){return!0}static#e=this.\u0275fac=function(i){return new(i||n)(j(Vs),j(Ur),j(vb))};static#t=this.\u0275dir=$e({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return n})();function L1(n,t){n.context.$implicit=t.item}let gp=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new b6,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){R1("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){R1("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}static#e=this.\u0275fac=function(i){return new(i||n)(j(Vs),j(Ur))};static#t=this.\u0275dir=$e({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return n})();class b6{constructor(){this.$implicit=null,this.ngIf=null}}function R1(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Qn(t)}'.`)}let Yw=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=il({type:n});static#n=this.\u0275inj=ho({})}return n})();function W1(n){return"server"===n}class U1{}class _W extends C8{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Jw extends _W{static makeCurrent(){!function k8(n){w1??=n}(new Jw)}onAndCancel(t,e,i){return t.addEventListener(e,i),()=>{t.removeEventListener(e,i)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function vW(){return Ku=Ku||document.querySelector("base"),Ku?Ku.getAttribute("href"):null}();return null==e?null:function TW(n){return new URL(n,document.baseURI).pathname}(e)}resetBaseElement(){Ku=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return I1(document.cookie,t)}}let Ku=null,CW=(()=>{class n{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();const Qw=new ce("");let Q1=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(s=>{s.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,i,s){return this._findPluginFor(i).addEventListener(e,i,s)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(r=>r.supports(e)),!i)throw new z(5101,!1);return this._eventNameToPlugin.set(e,i),i}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Qw),Oe(Lt))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();class K1{constructor(t){this._doc=t}}const Kw="ng-app-id";let Z1=(()=>{class n{constructor(e,i,s,r={}){this.doc=e,this.appId=i,this.nonce=s,this.platformId=r,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=W1(r),this.resetHostNodes()}addStyles(e){for(const i of e)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(e){for(const i of e)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const e=this.styleNodesInDOM;e&&(e.forEach(i=>i.remove()),e.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const i of this.getAllStyles())this.addStyleToHost(e,i)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(const i of this.hostNodes)this.addStyleToHost(i,e)}onStyleRemoved(e){const i=this.styleRef;i.get(e)?.elements?.forEach(s=>s.remove()),i.delete(e)}collectServerRenderedStyles(){const e=this.doc.head?.querySelectorAll(`style[${Kw}="${this.appId}"]`);if(e?.length){const i=new Map;return e.forEach(s=>{null!=s.textContent&&i.set(s.textContent,s)}),i}return null}changeUsageCount(e,i){const s=this.styleRef;if(s.has(e)){const r=s.get(e);return r.usage+=i,r.usage}return s.set(e,{usage:i,elements:[]}),i}getStyleElement(e,i){const s=this.styleNodesInDOM,r=s?.get(i);if(r?.parentNode===e)return s.delete(i),r.removeAttribute(Kw),r;{const a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(Kw,this.appId),e.appendChild(a),a}}addStyleToHost(e,i){const s=this.getStyleElement(e,i),r=this.styleRef,a=r.get(i)?.elements;a?a.push(s):r.set(i,{elements:[s],usage:1})}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Gs),Oe(qm),Oe(jv,8),Oe(fo))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();const Zw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},e0=/%COMP%/g,EW=new ce("",{providedIn:"root",factory:()=>!0});function tE(n,t){return t.map(e=>e.replace(e0,n))}let nE=(()=>{class n{constructor(e,i,s,r,a,o,l,c=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=r,this.doc=a,this.platformId=o,this.ngZone=l,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=W1(o),this.defaultRenderer=new t0(e,a,l,this.platformIsServer)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ms.ShadowDom&&(i={...i,encapsulation:Ms.Emulated});const s=this.getOrCreateRenderer(e,i);return s instanceof sE?s.applyToHost(e):s instanceof n0&&s.applyStyles(),s}getOrCreateRenderer(e,i){const s=this.rendererByCompId;let r=s.get(i.id);if(!r){const a=this.doc,o=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,h=this.platformIsServer;switch(i.encapsulation){case Ms.Emulated:r=new sE(l,c,i,this.appId,u,a,o,h);break;case Ms.ShadowDom:return new MW(l,c,e,i,a,o,this.nonce,h);default:r=new n0(l,c,i,u,a,o,h)}s.set(i.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Q1),Oe(Z1),Oe(qm),Oe(EW),Oe(Gs),Oe(fo),Oe(Lt),Oe(jv))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();class t0{constructor(t,e,i,s){this.eventManager=t,this.doc=e,this.ngZone=i,this.platformIsServer=s,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,e){return e?this.doc.createElementNS(Zw[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(iE(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(iE(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new z(-5104,!1);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,s){if(s){e=s+":"+e;const r=Zw[s];r?t.setAttributeNS(r,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const s=Zw[i];s?t.removeAttributeNS(s,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,s){s&(Sa.DashCase|Sa.Important)?t.style.setProperty(e,i,s&Sa.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Sa.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){null!=t&&(t[e]=i)}setValue(t,e){t.nodeValue=e}listen(t,e,i){if("string"==typeof t&&!(t=Ba().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${e}`);return this.eventManager.addEventListener(t,e,this.decoratePreventDefault(i))}decoratePreventDefault(t){return e=>{if("__ngUnwrap__"===e)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(e)):t(e))&&e.preventDefault()}}}function iE(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class MW extends t0{constructor(t,e,i,s,r,a,o,l){super(t,r,a,l),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=tE(s.id,s.styles);for(const u of c){const h=document.createElement("style");o&&h.setAttribute("nonce",o),h.textContent=u,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class n0 extends t0{constructor(t,e,i,s,r,a,o,l){super(t,r,a,o),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=s,this.styles=l?tE(l,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class sE extends n0{constructor(t,e,i,s,r,a,o,l){const c=s+"-"+i.id;super(t,e,i,r,a,o,l,c),this.contentAttr=function BW(n){return"_ngcontent-%COMP%".replace(e0,n)}(c),this.hostAttr=function PW(n){return"_nghost-%COMP%".replace(e0,n)}(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}const rE=["alt","control","meta","shift"],FW={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},LW={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};function aE(n){return{appProviders:[...zW,...n?.providers??[]],platformProviders:UW}}const UW=[{provide:fo,useValue:"browser"},{provide:$v,useValue:function VW(){Jw.makeCurrent()},multi:!0},{provide:Gs,useFactory:function WW(){return function aF(n){$m=n}(document),document},deps:[]}],zW=[{provide:_y,useValue:"root"},{provide:Vr,useFactory:function HW(){return new Vr},deps:[]},{provide:Qw,useClass:(()=>{class n extends K1{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,s){return e.addEventListener(i,s,!1),()=>this.removeEventListener(e,i,s)}removeEventListener(e,i,s){return e.removeEventListener(i,s)}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Gs))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})(),multi:!0,deps:[Gs,Lt,fo]},{provide:Qw,useClass:(()=>{class n extends K1{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,s){const r=n.parseEventName(i),a=n.eventCallback(r.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ba().onAndCancel(e,r.domEventName,a))}static parseEventName(e){const i=e.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const r=n._normalizeKey(i.pop());let a="",o=i.indexOf("code");if(o>-1&&(i.splice(o,1),a="code."),rE.forEach(c=>{const u=i.indexOf(c);u>-1&&(i.splice(u,1),a+=c+".")}),a+=r,0!=i.length||0===r.length)return null;const l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(e,i){let s=FW[e.key]||e.key,r="";return i.indexOf("code.")>-1&&(s=e.code,r="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),rE.forEach(a=>{a!==s&&(0,LW[a])(e)&&(r+=a+".")}),r+=s,r===i)}static eventCallback(e,i,s){return r=>{n.matchEventFullKeyCode(r,e)&&s.runGuarded(()=>i(r))}}static _normalizeKey(e){return"esc"===e?"escape":e}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Gs))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})(),multi:!0,deps:[Gs]},nE,Z1,Q1,{provide:sC,useExisting:nE},{provide:U1,useClass:CW,deps:[]},[]];let $W=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Gs))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function xo(n){return!!n&&(n instanceof Un||rn(n.lift)&&rn(n.subscribe))}function Pa(n){return this instanceof Pa?(this.v=n,this):new Pa(n)}function fE(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function o0(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(r){e[r]=n[r]&&function(a){return new Promise(function(o,l){!function s(r,a,o,l){Promise.resolve(l).then(function(c){r({value:c,done:o})},a)}(o,l,(a=n[r](a)).done,a.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const pE=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function gE(n){return rn(n?.then)}function mE(n){return rn(n[bm])}function yE(n){return Symbol.asyncIterator&&rn(n?.[Symbol.asyncIterator])}function bE(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const wE=function mU(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function SE(n){return rn(n?.[wE])}function _E(n){return function dE(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=e.apply(n,t||[]),r=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){i[f]&&(s[f]=function(p){return new Promise(function(g,m){r.push([f,p,g,m])>1||o(f,p)})})}function o(f,p){try{!function l(f){f.value instanceof Pa?Promise.resolve(f.value.v).then(c,u):h(r[0][2],f)}(i[f](p))}catch(g){h(r[0][3],g)}}function c(f){o("next",f)}function u(f){o("throw",f)}function h(f,p){f(p),r.shift(),r.length&&o(r[0][0],r[0][1])}}(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:s}=yield Pa(e.read());if(s)return yield Pa(void 0);yield yield Pa(i)}}finally{e.releaseLock()}})}function vE(n){return rn(n?.getReader)}function Ds(n){if(n instanceof Un)return n;if(null!=n){if(mE(n))return function yU(n){return new Un(t=>{const e=n[bm]();if(rn(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(pE(n))return function bU(n){return new Un(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(gE(n))return function wU(n){return new Un(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,q_)})}(n);if(yE(n))return TE(n);if(SE(n))return function SU(n){return new Un(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(vE(n))return function _U(n){return TE(_E(n))}(n)}throw bE(n)}function TE(n){return new Un(t=>{(function vU(n,t){var e,i,s,r;return function uE(n,t,e,i){return new(e||(e=Promise))(function(r,a){function o(u){try{c(i.next(u))}catch(h){a(h)}}function l(u){try{c(i.throw(u))}catch(h){a(h)}}function c(u){u.done?r(u.value):function s(r){return r instanceof e?r:new e(function(a){a(r)})}(u.value).then(o,l)}c((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=fE(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=e.return)&&(yield r.call(e))}finally{if(s)throw s.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function Yr(n,t,e,i=0,s=!1){const r=t.schedule(function(){e(),s?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(r),!s)return r}function kE(n,t=0){return ai((e,i)=>{e.subscribe(Jn(i,s=>Yr(i,n,()=>i.next(s),t),()=>Yr(i,n,()=>i.complete(),t),s=>Yr(i,n,()=>i.error(s),t)))})}function CE(n,t=0){return ai((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function DE(n,t){if(!n)throw new Error("Iterable cannot be null");return new Un(e=>{Yr(e,t,()=>{const i=n[Symbol.asyncIterator]();Yr(e,t,()=>{i.next().then(s=>{s.done?e.complete():e.next(s.value)})},0,!0)})})}function fi(n,t){return t?function xU(n,t){if(null!=n){if(mE(n))return function TU(n,t){return Ds(n).pipe(CE(t),kE(t))}(n,t);if(pE(n))return function CU(n,t){return new Un(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(gE(n))return function kU(n,t){return Ds(n).pipe(CE(t),kE(t))}(n,t);if(yE(n))return DE(n,t);if(SE(n))return function DU(n,t){return new Un(e=>{let i;return Yr(e,t,()=>{i=n[wE](),Yr(e,t,()=>{let s,r;try{({value:s,done:r}=i.next())}catch(a){return void e.error(a)}r?e.complete():e.next(s)},0,!0)}),()=>rn(i?.return)&&i.return()})}(n,t);if(vE(n))return function NU(n,t){return DE(_E(n),t)}(n,t)}throw bE(n)}(n,t):Ds(n)}function l0(n){return n[n.length-1]}function NE(n){return rn(l0(n))?n.pop():void 0}function bp(n){return function EU(n){return n&&rn(n.schedule)}(l0(n))?n.pop():void 0}function ze(...n){return fi(n,bp(n))}const wp=um(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:BU}=Array,{getPrototypeOf:PU,prototype:IU,keys:MU}=Object;function xE(n){if(1===n.length){const t=n[0];if(BU(t))return{args:t,keys:null};if(function AU(n){return n&&"object"==typeof n&&PU(n)===IU}(t)){const e=MU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:FU}=Array;function EE(n){return mt(t=>function LU(n,t){return FU(t)?n(...t):n(t)}(n,t))}function BE(n,t){return n.reduce((e,i,s)=>(e[i]=t[s],e),{})}function PE(...n){const t=bp(n),e=NE(n),{args:i,keys:s}=xE(n);if(0===i.length)return fi([],t);const r=new Un(function RU(n,t,e=ro){return i=>{IE(t,()=>{const{length:s}=n,r=new Array(s);let a=s,o=s;for(let l=0;l<s;l++)IE(t,()=>{const c=fi(n[l],t);let u=!1;c.subscribe(Jn(i,h=>{r[l]=h,u||(u=!0,o--),o||i.next(e(r.slice()))},()=>{--a||i.complete()}))},i)},i)}}(i,t,s?a=>BE(s,a):ro));return e?r.pipe(EE(e)):r}function IE(n,t,e){n?Yr(e,n,t):t()}function Mi(n,t,e=1/0){return rn(t)?Mi((i,s)=>mt((r,a)=>t(i,r,s,a))(Ds(n(i,s))),e):("number"==typeof t&&(e=t),ai((i,s)=>function OU(n,t,e,i,s,r,a,o){const l=[];let c=0,u=0,h=!1;const f=()=>{h&&!l.length&&!c&&t.complete()},p=m=>c<i?g(m):l.push(m),g=m=>{r&&t.next(m),c++;let y=!1;Ds(e(m,u++)).subscribe(Jn(t,b=>{s?.(b),r?p(b):t.next(b)},()=>{y=!0},void 0,()=>{if(y)try{for(c--;l.length&&c<i;){const b=l.shift();a?Yr(t,a,()=>g(b)):g(b)}f()}catch(b){t.error(b)}}))};return n.subscribe(Jn(t,p,()=>{h=!0,f()})),()=>{o?.()}}(i,s,n,e)))}function eh(...n){return function VU(){return function c0(n=1/0){return Mi(ro,n)}(1)}()(fi(n,bp(n)))}function Sp(n){return new Un(t=>{Ds(n()).subscribe(t)})}function _p(n,t){const e=rn(n)?n:()=>n,i=s=>s.error(e());return new Un(t?s=>t.schedule(i,0,s):i)}const Xr=new Un(n=>n.complete());function u0(){return ai((n,t)=>{let e=null;n._refCount++;const i=Jn(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const s=n._connection,r=e;e=null,s&&(!r||s===r)&&s.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class ME extends Un{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Q_(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Yi;const e=this.getSubject();t.add(this.source.subscribe(Jn(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Yi.EMPTY)}return t}refCount(){return u0()(this)}}function Ns(n,t){return ai((e,i)=>{let s=null,r=0,a=!1;const o=()=>a&&!s&&i.complete();e.subscribe(Jn(i,l=>{s?.unsubscribe();let c=0;const u=r++;Ds(n(l,u)).subscribe(s=Jn(i,h=>i.next(t?t(l,h,u,c++):h),()=>{s=null,o()}))},()=>{a=!0,o()}))})}function pr(n){return n<=0?()=>Xr:ai((t,e)=>{let i=0;t.subscribe(Jn(e,s=>{++i<=n&&(e.next(s),n<=i&&e.complete())}))})}function Ia(n,t){return ai((e,i)=>{let s=0;e.subscribe(Jn(i,r=>n.call(t,r,s++)&&i.next(r)))})}function vp(n){return ai((t,e)=>{let i=!1;t.subscribe(Jn(e,s=>{i=!0,e.next(s)},()=>{i||e.next(n),e.complete()}))})}function AE(n=UU){return ai((t,e)=>{let i=!1;t.subscribe(Jn(e,s=>{i=!0,e.next(s)},()=>i?e.complete():e.error(n())))})}function UU(){return new wp}function Eo(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Ia((s,r)=>n(s,r,i)):ro,pr(1),e?vp(t):AE(()=>new wp))}function oc(n,t){return rn(t)?Mi(n,t,1):Mi(n,1)}function Ti(n,t,e){const i=rn(n)||t||e?{next:n,error:t,complete:e}:n;return i?ai((s,r)=>{var a;null===(a=i.subscribe)||void 0===a||a.call(i);let o=!0;s.subscribe(Jn(r,l=>{var c;null===(c=i.next)||void 0===c||c.call(i,l),r.next(l)},()=>{var l;o=!1,null===(l=i.complete)||void 0===l||l.call(i),r.complete()},l=>{var c;o=!1,null===(c=i.error)||void 0===c||c.call(i,l),r.error(l)},()=>{var l,c;o&&(null===(l=i.unsubscribe)||void 0===l||l.call(i)),null===(c=i.finalize)||void 0===c||c.call(i)}))}):ro}function lc(n){return ai((t,e)=>{let r,i=null,s=!1;i=t.subscribe(Jn(e,void 0,void 0,a=>{r=Ds(n(a,lc(n)(t))),i?(i.unsubscribe(),i=null,r.subscribe(e)):s=!0})),s&&(i.unsubscribe(),i=null,r.subscribe(e))})}function h0(n){return n<=0?()=>Xr:ai((t,e)=>{let i=[];t.subscribe(Jn(e,s=>{i.push(s),n<i.length&&i.shift()},()=>{for(const s of i)e.next(s);e.complete()},void 0,()=>{i=null}))})}function Tp(n){return ai((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const lt="primary",th=Symbol("RouteTitle");class YU{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function cc(n){return new YU(n)}function XU(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const s={};for(let r=0;r<i.length;r++){const a=i[r],o=n[r];if(a.startsWith(":"))s[a.substring(1)]=o;else if(a!==o.path)return null}return{consumed:n.slice(0,i.length),posParams:s}}function gr(n,t){const e=n?d0(n):void 0,i=t?d0(t):void 0;if(!e||!i||e.length!=i.length)return!1;let s;for(let r=0;r<e.length;r++)if(s=e[r],!FE(n[s],t[s]))return!1;return!0}function d0(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function FE(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((s,r)=>i[r]===s)}return n===t}function LE(n){return n.length>0?n[n.length-1]:null}function Ma(n){return xo(n)?n:$u(n)?fi(Promise.resolve(n)):ze(n)}const QU={exact:function VE(n,t,e){if(!Bo(n.segments,t.segments)||!kp(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!VE(n.children[i],t.children[i],e))return!1;return!0},subset:HE},RE={exact:function KU(n,t){return gr(n,t)},subset:function ZU(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>FE(n[e],t[e]))},ignored:()=>!0};function OE(n,t,e){return QU[e.paths](n.root,t.root,e.matrixParams)&&RE[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function HE(n,t,e){return WE(n,t,t.segments,e)}function WE(n,t,e,i){if(n.segments.length>e.length){const s=n.segments.slice(0,e.length);return!(!Bo(s,e)||t.hasChildren()||!kp(s,e,i))}if(n.segments.length===e.length){if(!Bo(n.segments,e)||!kp(n.segments,e,i))return!1;for(const s in t.children)if(!n.children[s]||!HE(n.children[s],t.children[s],i))return!1;return!0}{const s=e.slice(0,n.segments.length),r=e.slice(n.segments.length);return!!(Bo(n.segments,s)&&kp(n.segments,s,i)&&n.children[lt])&&WE(n.children[lt],t,r,i)}}function kp(n,t,e){return t.every((i,s)=>RE[e](n[s].parameters,i.parameters))}class uc{constructor(t=new zt([],{}),e={},i=null){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=cc(this.queryParams),this._queryParamMap}toString(){return nG.serialize(this)}}class zt{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Cp(this)}}class nh{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=cc(this.parameters),this._parameterMap}toString(){return zE(this)}}function Bo(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let hc=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>new f0,providedIn:"root"})}return n})();class f0{parse(t){const e=new fG(t);return new uc(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${ih(t.root,!0)}`,i=function rG(n){const t=Object.entries(n).map(([e,i])=>Array.isArray(i)?i.map(s=>`${Dp(e)}=${Dp(s)}`).join("&"):`${Dp(e)}=${Dp(i)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function iG(n){return encodeURI(n)}(t.fragment)}`:""}`}}const nG=new f0;function Cp(n){return n.segments.map(t=>zE(t)).join("/")}function ih(n,t){if(!n.hasChildren())return Cp(n);if(t){const e=n.children[lt]?ih(n.children[lt],!1):"",i=[];return Object.entries(n.children).forEach(([s,r])=>{s!==lt&&i.push(`${s}:${ih(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function tG(n,t){let e=[];return Object.entries(n.children).forEach(([i,s])=>{i===lt&&(e=e.concat(t(s,i)))}),Object.entries(n.children).forEach(([i,s])=>{i!==lt&&(e=e.concat(t(s,i)))}),e}(n,(i,s)=>s===lt?[ih(n.children[lt],!1)]:[`${s}:${ih(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[lt]?`${Cp(n)}/${e[0]}`:`${Cp(n)}/(${e.join("//")})`}}function UE(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Dp(n){return UE(n).replace(/%3B/gi,";")}function p0(n){return UE(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Np(n){return decodeURIComponent(n)}function GE(n){return Np(n.replace(/\+/g,"%20"))}function zE(n){return`${p0(n.path)}${function sG(n){return Object.entries(n).map(([t,e])=>`;${p0(t)}=${p0(e)}`).join("")}(n.parameters)}`}const aG=/^[^\/()?;#]+/;function g0(n){const t=n.match(aG);return t?t[0]:""}const oG=/^[^\/()?;=#]+/,cG=/^[^=?&#]+/,hG=/^[^&#]+/;class fG{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new zt([],{}):new zt([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[lt]=new zt(t,e)),i}parseSegment(){const t=g0(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new z(4009,!1);return this.capture(t),new nh(Np(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=function lG(n){const t=n.match(oG);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const s=g0(this.remaining);s&&(i=s,this.capture(i))}t[Np(e)]=Np(i)}parseQueryParam(t){const e=function uG(n){const t=n.match(cG);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const a=function dG(n){const t=n.match(hG);return t?t[0]:""}(this.remaining);a&&(i=a,this.capture(i))}const s=GE(e),r=GE(i);if(t.hasOwnProperty(s)){let a=t[s];Array.isArray(a)||(a=[a],t[s]=a),a.push(r)}else t[s]=r}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=g0(this.remaining),s=this.remaining[i.length];if("/"!==s&&")"!==s&&";"!==s)throw new z(4010,!1);let r;i.indexOf(":")>-1?(r=i.slice(0,i.indexOf(":")),this.capture(r),this.capture(":")):t&&(r=lt);const a=this.parseChildren();e[r]=1===Object.keys(a).length?a[lt]:new zt([],a),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new z(4011,!1)}}function $E(n){return n.segments.length>0?new zt([],{[lt]:n}):n}function jE(n){const t={};for(const[i,s]of Object.entries(n.children)){const r=jE(s);if(i===lt&&0===r.segments.length&&r.hasChildren())for(const[a,o]of Object.entries(r.children))t[a]=o;else(r.segments.length>0||r.hasChildren())&&(t[i]=r)}return function pG(n){if(1===n.numberOfChildren&&n.children[lt]){const t=n.children[lt];return new zt(n.segments.concat(t.segments),t.children)}return n}(new zt(n.segments,t))}function dc(n){return n instanceof uc}function qE(n){let t;const s=$E(function e(r){const a={};for(const l of r.children){const c=e(l);a[l.outlet]=c}const o=new zt(r.url,a);return r===n&&(t=o),o}(n.root));return t??s}function YE(n,t,e,i){let s=n;for(;s.parent;)s=s.parent;if(0===t.length)return m0(s,s,s,e,i);const r=function mG(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new JE(!0,0,n);let t=0,e=!1;const i=n.reduce((s,r,a)=>{if("object"==typeof r&&null!=r){if(r.outlets){const o={};return Object.entries(r.outlets).forEach(([l,c])=>{o[l]="string"==typeof c?c.split("/"):c}),[...s,{outlets:o}]}if(r.segmentPath)return[...s,r.segmentPath]}return"string"!=typeof r?[...s,r]:0===a?(r.split("/").forEach((o,l)=>{0==l&&"."===o||(0==l&&""===o?e=!0:".."===o?t++:""!=o&&s.push(o))}),s):[...s,r]},[]);return new JE(e,t,i)}(t);if(r.toRoot())return m0(s,s,new zt([],{}),e,i);const a=function yG(n,t,e){if(n.isAbsolute)return new Ep(t,!0,0);if(!e)return new Ep(t,!1,NaN);if(null===e.parent)return new Ep(e,!0,0);const i=xp(n.commands[0])?0:1;return function bG(n,t,e){let i=n,s=t,r=e;for(;r>s;){if(r-=s,i=i.parent,!i)throw new z(4005,!1);s=i.segments.length}return new Ep(i,!1,s-r)}(e,e.segments.length-1+i,n.numberOfDoubleDots)}(r,s,n),o=a.processChildren?rh(a.segmentGroup,a.index,r.commands):QE(a.segmentGroup,a.index,r.commands);return m0(s,a.segmentGroup,o,e,i)}function xp(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function sh(n){return"object"==typeof n&&null!=n&&n.outlets}function m0(n,t,e,i,s){let a,r={};i&&Object.entries(i).forEach(([l,c])=>{r[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`}),a=n===t?e:XE(n,t,e);const o=$E(jE(a));return new uc(o,r,s)}function XE(n,t,e){const i={};return Object.entries(n.children).forEach(([s,r])=>{i[s]=r===t?e:XE(r,t,e)}),new zt(n.segments,i)}class JE{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&xp(i[0]))throw new z(4003,!1);const s=i.find(sh);if(s&&s!==LE(i))throw new z(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ep{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function QE(n,t,e){if(n??=new zt([],{}),0===n.segments.length&&n.hasChildren())return rh(n,t,e);const i=function SG(n,t,e){let i=0,s=t;const r={match:!1,pathIndex:0,commandIndex:0};for(;s<n.segments.length;){if(i>=e.length)return r;const a=n.segments[s],o=e[i];if(sh(o))break;const l=`${o}`,c=i<e.length-1?e[i+1]:null;if(s>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!ZE(l,c,a))return r;i+=2}else{if(!ZE(l,{},a))return r;i++}s++}return{match:!0,pathIndex:s,commandIndex:i}}(n,t,e),s=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const r=new zt(n.segments.slice(0,i.pathIndex),{});return r.children[lt]=new zt(n.segments.slice(i.pathIndex),n.children),rh(r,0,s)}return i.match&&0===s.length?new zt(n.segments,{}):i.match&&!n.hasChildren()?y0(n,t,e):i.match?rh(n,0,s):y0(n,t,e)}function rh(n,t,e){if(0===e.length)return new zt(n.segments,{});{const i=function wG(n){return sh(n[0])?n[0].outlets:{[lt]:n}}(e),s={};if(Object.keys(i).some(r=>r!==lt)&&n.children[lt]&&1===n.numberOfChildren&&0===n.children[lt].segments.length){const r=rh(n.children[lt],t,e);return new zt(n.segments,r.children)}return Object.entries(i).forEach(([r,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(s[r]=QE(n.children[r],t,a))}),Object.entries(n.children).forEach(([r,a])=>{void 0===i[r]&&(s[r]=a)}),new zt(n.segments,s)}}function y0(n,t,e){const i=n.segments.slice(0,t);let s=0;for(;s<e.length;){const r=e[s];if(sh(r)){const l=_G(r.outlets);return new zt(i,l)}if(0===s&&xp(e[0])){i.push(new nh(n.segments[t].path,KE(e[0]))),s++;continue}const a=sh(r)?r.outlets[lt]:`${r}`,o=s<e.length-1?e[s+1]:null;a&&o&&xp(o)?(i.push(new nh(a,KE(o))),s+=2):(i.push(new nh(a,{})),s++)}return new zt(i,{})}function _G(n){const t={};return Object.entries(n).forEach(([e,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[e]=y0(new zt([],{}),0,i))}),t}function KE(n){const t={};return Object.entries(n).forEach(([e,i])=>t[e]=`${i}`),t}function ZE(n,t,e){return n==e.path&&gr(t,e.parameters)}const ah="imperative";var yt=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(yt||{});class mr{constructor(t,e){this.id=t,this.url=e}}class b0 extends mr{constructor(t,e,i="imperative",s=null){super(t,e),this.type=yt.NavigationStart,this.navigationTrigger=i,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Po extends mr{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=yt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var xs=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(xs||{}),w0=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(w0||{});class fc extends mr{constructor(t,e,i,s){super(t,e),this.reason=i,this.code=s,this.type=yt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class oh extends mr{constructor(t,e,i,s){super(t,e),this.reason=i,this.code=s,this.type=yt.NavigationSkipped}}class Bp extends mr{constructor(t,e,i,s){super(t,e),this.error=i,this.target=s,this.type=yt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class eB extends mr{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s,this.type=yt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vG extends mr{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s,this.type=yt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class TG extends mr{constructor(t,e,i,s,r){super(t,e),this.urlAfterRedirects=i,this.state=s,this.shouldActivate=r,this.type=yt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class kG extends mr{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s,this.type=yt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class CG extends mr{constructor(t,e,i,s){super(t,e),this.urlAfterRedirects=i,this.state=s,this.type=yt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class DG{constructor(t){this.route=t,this.type=yt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class NG{constructor(t){this.route=t,this.type=yt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class xG{constructor(t){this.snapshot=t,this.type=yt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class EG{constructor(t){this.snapshot=t,this.type=yt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class BG{constructor(t){this.snapshot=t,this.type=yt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class PG{constructor(t){this.snapshot=t,this.type=yt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class S0{}class _0{constructor(t){this.url=t}}class IG{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new lh,this.attachRef=null}}let lh=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const s=this.getOrCreateContext(e);s.outlet=i,this.contexts.set(e,s)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new IG,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class tB{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=v0(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=v0(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=T0(t,this._root);return e.length<2?[]:e[e.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return T0(t,this._root).map(e=>e.value)}}function v0(n,t){if(n===t.value)return t;for(const e of t.children){const i=v0(n,e);if(i)return i}return null}function T0(n,t){if(n===t.value)return[t];for(const e of t.children){const i=T0(n,e);if(i.length)return i.unshift(t),i}return[]}class js{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function pc(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class nB extends tB{constructor(t,e){super(t),this.snapshot=e,D0(this,t)}toString(){return this.snapshot.toString()}}function iB(n){const t=function MG(n){const r=new C0([],{},{},"",{},lt,n,null,{});return new sB("",new js(r,[]))}(n),e=new ss([new nh("",{})]),i=new ss({}),s=new ss({}),r=new ss({}),a=new ss(""),o=new gc(e,i,r,a,s,lt,n,t.root);return o.snapshot=t.root,new nB(new js(o,[]),t)}class gc{constructor(t,e,i,s,r,a,o,l){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=s,this.dataSubject=r,this.outlet=a,this.component=o,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(mt(c=>c[th]))??ze(void 0),this.url=t,this.params=e,this.queryParams=i,this.fragment=s,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(mt(t=>cc(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(mt(t=>cc(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function k0(n,t,e="emptyOnly"){let i;const{routeConfig:s}=n;return i=null===t||"always"!==e&&""!==s?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...n.params},data:{...n.data},resolve:{...n.data,...n._resolvedData??{}}}:{params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.data,...s?.data,...n._resolvedData}},s&&aB(s)&&(i.resolve[th]=s.title),i}class C0{get title(){return this.data?.[th]}constructor(t,e,i,s,r,a,o,l,c){this.url=t,this.params=e,this.queryParams=i,this.fragment=s,this.data=r,this.outlet=a,this.component=o,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=cc(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=cc(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class sB extends tB{constructor(t,e){super(e),this.url=t,D0(this,e)}toString(){return rB(this._root)}}function D0(n,t){t.value._routerState=n,t.children.forEach(e=>D0(n,e))}function rB(n){const t=n.children.length>0?` { ${n.children.map(rB).join(", ")} } `:"";return`${n.value}${t}`}function N0(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,gr(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),gr(t.params,e.params)||n.paramsSubject.next(e.params),function JU(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!gr(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.urlSubject.next(e.url),gr(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function x0(n,t){const e=gr(n.params,t.params)&&function eG(n,t){return Bo(n,t)&&n.every((e,i)=>gr(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||x0(n.parent,t.parent))}function aB(n){return"string"==typeof n.title||null===n.title}let E0=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=lt,this.activateEvents=new hn,this.deactivateEvents=new hn,this.attachEvents=new hn,this.detachEvents=new hn,this.parentContexts=Q(lh),this.location=Q(Vs),this.changeDetector=Q(Al),this.environmentInjector=Q(us),this.inputBinder=Q(Pp,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){const{firstChange:i,previousValue:s}=e.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new z(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new z(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new z(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new z(4013,!1);this._activatedRoute=e;const s=this.location,a=e.snapshot.component,o=this.parentContexts.getOrCreateContext(this.name).children,l=new AG(e,o,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275dir=$e({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[vs]})}return n})();class AG{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===gc?this.route:t===lh?this.childContexts:this.parent.get(t,e)}}const Pp=new ce("");function ch(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const s=function LG(n,t,e){return t.children.map(i=>{for(const s of e.children)if(n.shouldReuseRoute(i.value,s.value.snapshot))return ch(n,i,s);return ch(n,i)})}(n,t,e);return new js(i,s)}{if(n.shouldAttach(t.value)){const r=n.retrieve(t.value);if(null!==r){const a=r.route;return a.value._futureSnapshot=t.value,a.children=t.children.map(o=>ch(n,o)),a}}const i=function RG(n){return new gc(new ss(n.url),new ss(n.params),new ss(n.queryParams),new ss(n.fragment),new ss(n.data),n.outlet,n.component,n)}(t.value),s=t.children.map(r=>ch(n,r));return new js(i,s)}}const lB="ngNavigationCancelingError";function cB(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=dc(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,s=uB(!1,xs.Redirect);return s.url=e,s.navigationBehaviorOptions=i,s}function uB(n,t){const e=new Error(`NavigationCancelingError: ${n||""}`);return e[lB]=!0,e.cancellationCode=t,e}function hB(n){return!!n&&n[lB]}let dB=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=Wc({type:n,selectors:[["ng-component"]],standalone:!0,features:[Vu],decls:1,vars:0,template:function(i,s){1&i&&Ln(0,"router-outlet")},dependencies:[E0],encapsulation:2})}return n})();function B0(n){const t=n.children&&n.children.map(B0),e=t?{...n,children:t}:{...n};return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==lt&&(e.component=dB),e}function yr(n){return n.outlet||lt}function uh(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class $G{constructor(t,e,i,s,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=s,this.inputBindingEnabled=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),N0(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const s=pc(e);t.children.forEach(r=>{const a=r.value.outlet;this.deactivateRoutes(r,s[a],i),delete s[a]}),Object.values(s).forEach(r=>{this.deactivateRouteAndItsChildren(r,i)})}deactivateRoutes(t,e,i){const s=t.value,r=e?e.value:null;if(s===r)if(s.component){const a=i.getContext(s.outlet);a&&this.deactivateChildRoutes(t,e,a.children)}else this.deactivateChildRoutes(t,e,i);else r&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),s=i&&t.value.component?i.children:e,r=pc(t);for(const a of Object.values(r))this.deactivateRouteAndItsChildren(a,s);if(i&&i.outlet){const a=i.outlet.detach(),o=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:a,route:t,contexts:o})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),s=i&&t.value.component?i.children:e,r=pc(t);for(const a of Object.values(r))this.deactivateRouteAndItsChildren(a,s);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,e,i){const s=pc(e);t.children.forEach(r=>{this.activateRoutes(r,s[r.value.outlet],i),this.forwardEvent(new PG(r.value.snapshot))}),t.children.length&&this.forwardEvent(new EG(t.value.snapshot))}activateRoutes(t,e,i){const s=t.value,r=e?e.value:null;if(N0(s),s===r)if(s.component){const a=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,a.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const a=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const o=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),a.children.onOutletReAttached(o.contexts),a.attachRef=o.componentRef,a.route=o.route.value,a.outlet&&a.outlet.attach(o.componentRef,o.route.value),N0(o.route.value),this.activateChildRoutes(t,null,a.children)}else{const o=uh(s.snapshot);a.attachRef=null,a.route=s,a.injector=o,a.outlet&&a.outlet.activateWith(s,a.injector),this.activateChildRoutes(t,null,a.children)}}else this.activateChildRoutes(t,null,i)}}class fB{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Ip{constructor(t,e){this.component=t,this.route=e}}function jG(n,t,e){const i=n._root;return hh(i,t?t._root:null,e,[i.value])}function mc(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function oF(n){return null!==Td(n)}(n)?t.get(n):n:i}function hh(n,t,e,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const r=pc(t);return n.children.forEach(a=>{(function YG(n,t,e,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const r=n.value,a=t?t.value:null,o=e?e.getContext(n.value.outlet):null;if(a&&r.routeConfig===a.routeConfig){const l=function XG(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Bo(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Bo(n.url,t.url)||!gr(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!x0(n,t)||!gr(n.queryParams,t.queryParams);default:return!x0(n,t)}}(a,r,r.routeConfig.runGuardsAndResolvers);l?s.canActivateChecks.push(new fB(i)):(r.data=a.data,r._resolvedData=a._resolvedData),hh(n,t,r.component?o?o.children:null:e,i,s),l&&o&&o.outlet&&o.outlet.isActivated&&s.canDeactivateChecks.push(new Ip(o.outlet.component,a))}else a&&dh(t,o,s),s.canActivateChecks.push(new fB(i)),hh(n,null,r.component?o?o.children:null:e,i,s)})(a,r[a.value.outlet],e,i.concat([a.value]),s),delete r[a.value.outlet]}),Object.entries(r).forEach(([a,o])=>dh(o,e.getContext(a),s)),s}function dh(n,t,e){const i=pc(n),s=n.value;Object.entries(i).forEach(([r,a])=>{dh(a,s.component?t?t.children.getContext(r):null:t,e)}),e.canDeactivateChecks.push(new Ip(s.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,s))}function fh(n){return"function"==typeof n}function pB(n){return n instanceof wp||"EmptyError"===n?.name}const Mp=Symbol("INITIAL_VALUE");function yc(){return Ns(n=>PE(n.map(t=>t.pipe(pr(1),function WU(...n){const t=bp(n);return ai((e,i)=>{(t?eh(n,e,t):eh(n,e)).subscribe(i)})}(Mp)))).pipe(mt(t=>{for(const e of t)if(!0!==e){if(e===Mp)return Mp;if(!1===e||e instanceof uc)return e}return!0}),Ia(t=>t!==Mp),pr(1)))}function gB(n){return function oA(...n){return Y_(n)}(Ti(t=>{if(dc(t))throw cB(0,t)}),mt(t=>!0===t))}class P0{constructor(t){this.segmentGroup=t||null}}class I0 extends Error{constructor(t){super(),this.urlTree=t}}function bc(n){return _p(new P0(n))}class p7{constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let i=[],s=e.root;for(;;){if(i=i.concat(s.segments),0===s.numberOfChildren)return ze(i);if(s.numberOfChildren>1||!s.children[lt])return _p(new z(4e3,!1));s=s.children[lt]}}applyRedirectCommands(t,e,i){const s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i);if(e.startsWith("/"))throw new I0(s);return s}applyRedirectCreateUrlTree(t,e,i,s){const r=this.createSegmentGroup(t,e.root,i,s);return new uc(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return Object.entries(t).forEach(([s,r])=>{if("string"==typeof r&&r.startsWith(":")){const o=r.substring(1);i[s]=e[o]}else i[s]=r}),i}createSegmentGroup(t,e,i,s){const r=this.createSegments(t,e.segments,i,s);let a={};return Object.entries(e.children).forEach(([o,l])=>{a[o]=this.createSegmentGroup(t,l,i,s)}),new zt(r,a)}createSegments(t,e,i,s){return e.map(r=>r.path.startsWith(":")?this.findPosParam(t,r,s):this.findOrReturn(r,i))}findPosParam(t,e,i){const s=i[e.path.substring(1)];if(!s)throw new z(4001,!1);return s}findOrReturn(t,e){let i=0;for(const s of e){if(s.path===t.path)return e.splice(i),s;i++}return t}}const M0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function g7(n,t,e,i,s){const r=A0(n,t,e);return r.matched?(i=function VG(n,t){return n.providers&&!n._injector&&(n._injector=Hb(n.providers,t,`Route: ${n.path}`)),n._injector??t}(t,i),function h7(n,t,e,i){const s=t.canMatch;return s&&0!==s.length?ze(s.map(a=>{const o=mc(a,n);return Ma(function t7(n){return n&&fh(n.canMatch)}(o)?o.canMatch(t,e):yo(n,()=>o(t,e)))})).pipe(yc(),gB()):ze(!0)}(i,t,e).pipe(mt(a=>!0===a?r:{...M0}))):ze(r)}function A0(n,t,e){if("**"===t.path)return function m7(n){return{matched:!0,parameters:n.length>0?LE(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}(e);if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?{...M0}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||XU)(e,n,t);if(!s)return{...M0};const r={};Object.entries(s.posParams??{}).forEach(([o,l])=>{r[o]=l.path});const a=s.consumed.length>0?{...r,...s.consumed[s.consumed.length-1].parameters}:r;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:a,positionalParamSegments:s.posParams??{}}}function mB(n,t,e,i){return e.length>0&&function w7(n,t,e){return e.some(i=>Ap(n,t,i)&&yr(i)!==lt)}(n,e,i)?{segmentGroup:new zt(t,b7(i,new zt(e,n.children))),slicedSegments:[]}:0===e.length&&function S7(n,t,e){return e.some(i=>Ap(n,t,i))}(n,e,i)?{segmentGroup:new zt(n.segments,y7(n,e,i,n.children)),slicedSegments:e}:{segmentGroup:new zt(n.segments,n.children),slicedSegments:e}}function y7(n,t,e,i){const s={};for(const r of e)if(Ap(n,t,r)&&!i[yr(r)]){const a=new zt([],{});s[yr(r)]=a}return{...i,...s}}function b7(n,t){const e={};e[lt]=t;for(const i of n)if(""===i.path&&yr(i)!==lt){const s=new zt([],{});e[yr(i)]=s}return e}function Ap(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}class T7{}class D7{constructor(t,e,i,s,r,a,o){this.injector=t,this.configLoader=e,this.rootComponentType=i,this.config=s,this.urlTree=r,this.paramsInheritanceStrategy=a,this.urlSerializer=o,this.applyRedirects=new p7(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new z(4002,`'${t.segmentGroup}'`)}recognize(){const t=mB(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(mt(e=>{const i=new C0([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},lt,this.rootComponentType,null,{}),s=new js(i,e),r=new sB("",s),a=function gG(n,t,e=null,i=null){return YE(qE(n),t,e,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(a),this.inheritParamsAndData(r._root,null),{state:r,tree:a}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,lt).pipe(lc(i=>{if(i instanceof I0)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof P0?this.noMatchError(i):i}))}inheritParamsAndData(t,e){const i=t.value,s=k0(i,e,this.paramsInheritanceStrategy);i.params=Object.freeze(s.params),i.data=Object.freeze(s.data),t.children.forEach(r=>this.inheritParamsAndData(r,i))}processSegmentGroup(t,e,i,s){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,s,!0).pipe(mt(r=>r instanceof js?[r]:[]))}processChildren(t,e,i){const s=[];for(const r of Object.keys(i.children))"primary"===r?s.unshift(r):s.push(r);return fi(s).pipe(oc(r=>{const a=i.children[r],o=function GG(n,t){const e=n.filter(i=>yr(i)===t);return e.push(...n.filter(i=>yr(i)!==t)),e}(e,r);return this.processSegmentGroup(t,o,a,r)}),function zU(n,t){return ai(function GU(n,t,e,i,s){return(r,a)=>{let o=e,l=t,c=0;r.subscribe(Jn(a,u=>{const h=c++;l=o?n(l,u,h):(o=!0,u),i&&a.next(l)},s&&(()=>{o&&a.next(l),a.complete()})))}}(n,t,arguments.length>=2,!0))}((r,a)=>(r.push(...a),r)),vp(null),function $U(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Ia((s,r)=>n(s,r,i)):ro,h0(1),e?vp(t):AE(()=>new wp))}(),Mi(r=>{if(null===r)return bc(i);const a=yB(r);return function N7(n){n.sort((t,e)=>t.value.outlet===lt?-1:e.value.outlet===lt?1:t.value.outlet.localeCompare(e.value.outlet))}(a),ze(a)}))}processSegment(t,e,i,s,r,a){return fi(e).pipe(oc(o=>this.processSegmentAgainstRoute(o._injector??t,e,o,i,s,r,a).pipe(lc(l=>{if(l instanceof P0)return ze(null);throw l}))),Eo(o=>!!o),lc(o=>{if(pB(o))return function v7(n,t,e){return 0===t.length&&!n.children[e]}(i,s,r)?ze(new T7):bc(i);throw o}))}processSegmentAgainstRoute(t,e,i,s,r,a,o){return function _7(n,t,e,i){return!!(yr(n)===i||i!==lt&&Ap(t,e,n))&&A0(t,n,e).matched}(i,s,r,a)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,s,i,r,a):this.allowRedirects&&o?this.expandSegmentAgainstRouteUsingRedirect(t,s,e,i,r,a):bc(s):bc(s)}expandSegmentAgainstRouteUsingRedirect(t,e,i,s,r,a){const{matched:o,consumedSegments:l,positionalParamSegments:c,remainingSegments:u}=A0(e,s,r);if(!o)return bc(e);s.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const h=this.applyRedirects.applyRedirectCommands(l,s.redirectTo,c);return this.applyRedirects.lineralizeSegments(s,h).pipe(Mi(f=>this.processSegment(t,i,e,f.concat(u),a,!1)))}matchSegmentAgainstRoute(t,e,i,s,r){const a=g7(e,i,s,t);return"**"===i.path&&(e.children={}),a.pipe(Ns(o=>o.matched?this.getChildConfig(t=i._injector??t,i,s).pipe(Ns(({routes:l})=>{const c=i._loadedInjector??t,{consumedSegments:u,remainingSegments:h,parameters:f}=o,p=new C0(u,f,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function E7(n){return n.data||{}}(i),yr(i),i.component??i._loadedComponent??null,i,function B7(n){return n.resolve||{}}(i)),{segmentGroup:g,slicedSegments:m}=mB(e,u,h,l);if(0===m.length&&g.hasChildren())return this.processChildren(c,l,g).pipe(mt(b=>null===b?null:new js(p,b)));if(0===l.length&&0===m.length)return ze(new js(p,[]));const y=yr(i)===r;return this.processSegment(c,l,g,m,y?lt:r,!0).pipe(mt(b=>new js(p,b instanceof js?[b]:[])))})):bc(e)))}getChildConfig(t,e,i){return e.children?ze({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?ze({routes:e._loadedRoutes,injector:e._loadedInjector}):function u7(n,t,e,i){const s=t.canLoad;return void 0===s||0===s.length?ze(!0):ze(s.map(a=>{const o=mc(a,n);return Ma(function QG(n){return n&&fh(n.canLoad)}(o)?o.canLoad(t,e):yo(n,()=>o(t,e)))})).pipe(yc(),gB())}(t,e,i).pipe(Mi(s=>s?this.configLoader.loadChildren(t,e).pipe(Ti(r=>{e._loadedRoutes=r.routes,e._loadedInjector=r.injector})):function f7(n){return _p(uB(!1,xs.GuardRejected))}())):ze({routes:[],injector:t})}}function x7(n){const t=n.value.routeConfig;return t&&""===t.path}function yB(n){const t=[],e=new Set;for(const i of n){if(!x7(i)){t.push(i);continue}const s=t.find(r=>i.value.routeConfig===r.value.routeConfig);void 0!==s?(s.children.push(...i.children),e.add(s)):t.push(i)}for(const i of e){const s=yB(i.children);t.push(new js(i.value,s))}return t.filter(i=>!e.has(i))}function bB(n){const t=n.children.map(e=>bB(e)).flat();return[n,...t]}function F0(n){return Ns(t=>{const e=n(t);return e?fi(e).pipe(mt(()=>t)):ze(t)})}let wB=(()=>{class n{buildTitle(e){let i,s=e.root;for(;void 0!==s;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(r=>r.outlet===lt);return i}getResolvedTitleForRoute(e){return e.data[th]}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q(L7),providedIn:"root"})}return n})(),L7=(()=>{class n extends wB{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}static#e=this.\u0275fac=function(i){return new(i||n)(Oe($W))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const ph=new ce("",{providedIn:"root",factory:()=>({})}),Fp=new ce("");let SB=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Q(M5)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ze(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Ma(e.loadComponent()).pipe(mt(_B),Ti(r=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=r}),Tp(()=>{this.componentLoaders.delete(e)})),s=new ME(i,()=>new ui).pipe(u0());return this.componentLoaders.set(e,s),s}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ze({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const r=function R7(n,t,e,i){return Ma(n.loadChildren()).pipe(mt(_B),Mi(s=>s instanceof eD||Array.isArray(s)?ze(s):fi(t.compileModuleAsync(s))),mt(s=>{i&&i(n);let r,a,o=!1;return Array.isArray(s)?(a=s,!0):(r=s.create(e).injector,a=r.get(Fp,[],{optional:!0,self:!0}).flat()),{routes:a.map(B0),injector:r}}))}(i,this.compiler,e,this.onLoadEndListener).pipe(Tp(()=>{this.childrenLoaders.delete(i)})),a=new ME(r,()=>new ui).pipe(u0());return this.childrenLoaders.set(i,a),a}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _B(n){return function O7(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let L0=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q(V7),providedIn:"root"})}return n})(),V7=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const vB=new ce("");let Lp=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ui,this.transitionAbortSubject=new ui,this.configLoader=Q(SB),this.environmentInjector=Q(us),this.urlSerializer=Q(hc),this.rootContexts=Q(lh),this.location=Q(Yu),this.inputBindingEnabled=null!==Q(Pp,{optional:!0}),this.titleStrategy=Q(wB),this.options=Q(ph,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Q(L0),this.createViewTransition=Q(vB,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ze(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=s=>this.events.next(new NG(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new DG(s))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:i})}setupNavigations(e,i,s){return this.transitions=new ss({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ah,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ia(r=>0!==r.id),mt(r=>({...r,extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),Ns(r=>{this.currentTransition=r;let a=!1,o=!1;return ze(r).pipe(Ti(l=>{this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ns(l=>{const c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!c&&"reload"!==(l.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const h="";return this.events.next(new oh(l.id,this.urlSerializer.serialize(l.rawUrl),h,w0.IgnoredSameUrlNavigation)),l.resolve(null),Xr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ze(l).pipe(Ns(h=>{const f=this.transitions?.getValue();return this.events.next(new b0(h.id,this.urlSerializer.serialize(h.extractedUrl),h.source,h.restoredState)),f!==this.transitions?.getValue()?Xr:Promise.resolve(h)}),function P7(n,t,e,i,s,r){return Mi(a=>function k7(n,t,e,i,s,r,a="emptyOnly"){return new D7(n,t,e,i,s,a,r).recognize()}(n,t,e,i,a.extractedUrl,s,r).pipe(mt(({state:o,tree:l})=>({...a,targetSnapshot:o,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Ti(h=>{r.targetSnapshot=h.targetSnapshot,r.urlAfterRedirects=h.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:h.urlAfterRedirects};const f=new eB(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){const{id:h,extractedUrl:f,source:p,restoredState:g,extras:m}=l,y=new b0(h,this.urlSerializer.serialize(f),p,g);this.events.next(y);const b=iB(this.rootComponentType).snapshot;return this.currentTransition=r={...l,targetSnapshot:b,urlAfterRedirects:f,extras:{...m,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=f,ze(r)}{const h="";return this.events.next(new oh(l.id,this.urlSerializer.serialize(l.extractedUrl),h,w0.IgnoredByUrlHandlingStrategy)),l.resolve(null),Xr}}),Ti(l=>{const c=new vG(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),mt(l=>(this.currentTransition=r={...l,guards:jG(l.targetSnapshot,l.currentSnapshot,this.rootContexts)},r)),function n7(n,t){return Mi(e=>{const{targetSnapshot:i,currentSnapshot:s,guards:{canActivateChecks:r,canDeactivateChecks:a}}=e;return 0===a.length&&0===r.length?ze({...e,guardsResult:!0}):function i7(n,t,e,i){return fi(n).pipe(Mi(s=>function c7(n,t,e,i,s){const r=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return r&&0!==r.length?ze(r.map(o=>{const l=uh(t)??s,c=mc(o,l);return Ma(function e7(n){return n&&fh(n.canDeactivate)}(c)?c.canDeactivate(n,t,e,i):yo(l,()=>c(n,t,e,i))).pipe(Eo())})).pipe(yc()):ze(!0)}(s.component,s.route,e,t,i)),Eo(s=>!0!==s,!0))}(a,i,s,n).pipe(Mi(o=>o&&function JG(n){return"boolean"==typeof n}(o)?function s7(n,t,e,i){return fi(t).pipe(oc(s=>eh(function a7(n,t){return null!==n&&t&&t(new xG(n)),ze(!0)}(s.route.parent,i),function r7(n,t){return null!==n&&t&&t(new BG(n)),ze(!0)}(s.route,i),function l7(n,t,e){const i=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(a=>function qG(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(a)).filter(a=>null!==a).map(a=>Sp(()=>ze(a.guards.map(l=>{const c=uh(a.node)??e,u=mc(l,c);return Ma(function ZG(n){return n&&fh(n.canActivateChild)}(u)?u.canActivateChild(i,n):yo(c,()=>u(i,n))).pipe(Eo())})).pipe(yc())));return ze(r).pipe(yc())}(n,s.path,e),function o7(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return ze(!0);const s=i.map(r=>Sp(()=>{const a=uh(t)??e,o=mc(r,a);return Ma(function KG(n){return n&&fh(n.canActivate)}(o)?o.canActivate(t,n):yo(a,()=>o(t,n))).pipe(Eo())}));return ze(s).pipe(yc())}(n,s.route,e))),Eo(s=>!0!==s,!0))}(i,r,n,t):ze(o)),mt(o=>({...e,guardsResult:o})))})}(this.environmentInjector,l=>this.events.next(l)),Ti(l=>{if(r.guardsResult=l.guardsResult,dc(l.guardsResult))throw cB(0,l.guardsResult);const c=new TG(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),Ia(l=>!!l.guardsResult||(this.cancelNavigationTransition(l,"",xs.GuardRejected),!1)),F0(l=>{if(l.guards.canActivateChecks.length)return ze(l).pipe(Ti(c=>{const u=new kG(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),Ns(c=>{let u=!1;return ze(c).pipe(function I7(n,t){return Mi(e=>{const{targetSnapshot:i,guards:{canActivateChecks:s}}=e;if(!s.length)return ze(e);const r=new Set(s.map(l=>l.route)),a=new Set;for(const l of r)if(!a.has(l))for(const c of bB(l))a.add(c);let o=0;return fi(a).pipe(oc(l=>r.has(l)?function M7(n,t,e,i){const s=n.routeConfig,r=n._resolve;return void 0!==s?.title&&!aB(s)&&(r[th]=s.title),function A7(n,t,e,i){const s=d0(n);if(0===s.length)return ze({});const r={};return fi(s).pipe(Mi(a=>function F7(n,t,e,i){const s=uh(t)??i,r=mc(n,s);return Ma(r.resolve?r.resolve(t,e):yo(s,()=>r(t,e)))}(n[a],t,e,i).pipe(Eo(),Ti(o=>{r[a]=o}))),h0(1),function jU(n){return mt(()=>n)}(r),lc(a=>pB(a)?Xr:_p(a)))}(r,n,t,i).pipe(mt(a=>(n._resolvedData=a,n.data=k0(n,n.parent,e).resolve,null)))}(l,i,n,t):(l.data=k0(l,l.parent,n).resolve,ze(void 0))),Ti(()=>o++),h0(1),Mi(l=>o===a.size?ze(e):Xr))})}(this.paramsInheritanceStrategy,this.environmentInjector),Ti({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",xs.NoDataFromResolver)}}))}),Ti(c=>{const u=new CG(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),F0(l=>{const c=u=>{const h=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&h.push(this.configLoader.loadComponent(u.routeConfig).pipe(Ti(f=>{u.component=f}),mt(()=>{})));for(const f of u.children)h.push(...c(f));return h};return PE(c(l.targetSnapshot.root)).pipe(vp(null),pr(1))}),F0(()=>this.afterPreactivation()),Ns(()=>{const{currentSnapshot:l,targetSnapshot:c}=r,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?fi(u).pipe(mt(()=>r)):ze(r)}),mt(l=>{const c=function FG(n,t,e){const i=ch(n,t._root,e?e._root:void 0);return new nB(i,t)}(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=r={...l,targetRouterState:c},this.currentNavigation.targetRouterState=c,r}),Ti(()=>{this.events.next(new S0)}),((n,t,e,i)=>mt(s=>(new $G(t,s.targetRouterState,s.currentRouterState,e,i).activate(n),s)))(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),pr(1),Ti({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Po(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),function qU(n){return ai((t,e)=>{Ds(n).subscribe(Jn(e,()=>e.complete(),fm)),!e.closed&&t.subscribe(e)})}(this.transitionAbortSubject.pipe(Ti(l=>{throw l}))),Tp(()=>{!a&&!o&&this.cancelNavigationTransition(r,"",xs.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),lc(l=>{if(o=!0,hB(l))this.events.next(new fc(r.id,this.urlSerializer.serialize(r.extractedUrl),l.message,l.cancellationCode)),function OG(n){return hB(n)&&dc(n.url)}(l)?this.events.next(new _0(l.url)):r.resolve(!1);else{this.events.next(new Bp(r.id,this.urlSerializer.serialize(r.extractedUrl),l,r.targetSnapshot??void 0));try{r.resolve(e.errorHandler(l))}catch(c){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(c)}}return Xr}))}))}cancelNavigationTransition(e,i,s){const r=new fc(e.id,this.urlSerializer.serialize(e.extractedUrl),i,s);this.events.next(r),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function U7(n){return n!==ah}let G7=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q($7),providedIn:"root"})}return n})();class z7{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}let $7=(()=>{class n extends z7{static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),kB=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:()=>Q(j7),providedIn:"root"})}return n})(),j7=(()=>{class n extends kB{constructor(){super(...arguments),this.location=Q(Yu),this.urlSerializer=Q(hc),this.options=Q(ph,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Q(L0),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new uc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=iB(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{"popstate"===i.type&&e(i.url,i.state)})}handleRouterEvent(e,i){if(e instanceof b0)this.stateMemento=this.createStateMemento();else if(e instanceof oh)this.rawUrlTree=i.initialUrl;else if(e instanceof eB){if("eager"===this.urlUpdateStrategy&&!i.extras.skipLocationChange){const s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else e instanceof S0?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,"deferred"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):e instanceof fc&&(e.code===xs.GuardRejected||e.code===xs.NoDataFromResolver)?this.restoreHistory(i):e instanceof Bp?this.restoreHistory(i,!0):e instanceof Po&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,i){const s=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){const a={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(s,"",a)}else{const r={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(s,"",r)}}restoreHistory(e,i=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-this.browserPageId;0!==r?this.location.historyGo(r):this.currentUrlTree===e.finalUrl&&0===r&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var gh=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(gh||{});function q7(n){throw n}const Y7={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},X7={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Jr=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Q(Ix),this.stateManager=Q(kB),this.options=Q(ph,{optional:!0})||{},this.pendingTasks=Q(Ll),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Q(Lp),this.urlSerializer=Q(hc),this.location=Q(Yu),this.urlHandlingStrategy=Q(L0),this._events=new ui,this.errorHandler=this.options.errorHandler||q7,this.navigated=!1,this.routeReuseStrategy=Q(G7),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Q(Fp,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Q(Pp,{optional:!0}),this.eventsSubscription=new Yi,this.isNgZoneEnabled=Q(Lt)instanceof Lt&&Lt.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(i=>{try{const s=this.navigationTransitions.currentTransition,r=this.navigationTransitions.currentNavigation;if(null!==s&&null!==r)if(this.stateManager.handleRouterEvent(i,r),i instanceof fc&&i.code!==xs.Redirect&&i.code!==xs.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Po)this.navigated=!0;else if(i instanceof _0){const a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),o={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||U7(s.source)};this.scheduleNavigation(a,ah,null,o,{resolve:s.resolve,reject:s.reject,promise:s.promise})}(function Q7(n){return!(n instanceof S0||n instanceof _0)})(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),ah,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",i)},0)})}navigateToSyncWithBrowser(e,i,s){const r={replaceUrl:!0},a=s?.navigationId?s:null;if(s){const l={...s};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(r.state=l)}const o=this.parseUrl(e);this.scheduleNavigation(o,i,a,r)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(B0),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){const{relativeTo:s,queryParams:r,fragment:a,queryParamsHandling:o,preserveFragment:l}=i,c=l?this.currentUrlTree.fragment:a;let h,u=null;switch(o){case"merge":u={...this.currentUrlTree.queryParams,...r};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=r||null}null!==u&&(u=this.removeEmptyProps(u));try{h=qE(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||!e[0].startsWith("/"))&&(e=[]),h=this.currentUrlTree.root}return YE(h,e,u,c??null)}navigateByUrl(e,i={skipLocationChange:!1}){const s=dc(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(r,ah,null,i)}navigate(e,i={skipLocationChange:!1}){return function J7(n){for(let t=0;t<n.length;t++)if(null==n[t])throw new z(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,i){let s;if(s=!0===i?{...Y7}:!1===i?{...X7}:i,dc(e))return OE(this.currentUrlTree,e,s);const r=this.parseUrl(e);return OE(this.currentUrlTree,r,s)}removeEmptyProps(e){return Object.entries(e).reduce((i,[s,r])=>(null!=r&&(i[s]=r),i),{})}scheduleNavigation(e,i,s,r,a){if(this.disposed)return Promise.resolve(!1);let o,l,c;a?(o=a.resolve,l=a.reject,c=a.promise):c=new Promise((h,f)=>{o=h,l=f});const u=this.pendingTasks.add();return function CB(n,t){n.events.pipe(Ia(e=>e instanceof Po||e instanceof fc||e instanceof Bp||e instanceof oh),mt(e=>e instanceof Po||e instanceof oh?gh.COMPLETE:e instanceof fc&&(e.code===xs.Redirect||e.code===xs.SupersededByNewNavigation)?gh.REDIRECTING:gh.FAILED),Ia(e=>e!==gh.REDIRECTING),pr(1)).subscribe(()=>{t()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:r,resolve:o,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(h=>Promise.reject(h))}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const O0=new ce("");function NB(n){return n.routerState.root}function xB(){const n=Q(Qi);return t=>{const e=n.get(xa);if(t!==e.components[0])return;const i=n.get(Jr),s=n.get(EB);1===n.get(V0)&&i.initialNavigation(),n.get(BB,null,dt.Optional)?.setUpPreloading(),n.get(O0,null,dt.Optional)?.init(),i.resetRootComponentType(e.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}const EB=new ce("",{factory:()=>new ui}),V0=new ce("",{providedIn:"root",factory:()=>1}),BB=new ce("");class Rp{}class Op{}class Es{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const s=e.slice(0,i),r=s.toLowerCase(),a=e.slice(i+1).trim();this.maybeSetNormalizedName(s,r),this.headers.has(r)?this.headers.get(r).push(a):this.headers.set(r,[a])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,i)=>{this.setHeaderEntries(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Es?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Es;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Es?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const s=("a"===t.op?this.headers.get(e):void 0)||[];s.push(...i),this.headers.set(e,s);break;case"d":const r=t.value;if(r){let a=this.headers.get(e);if(!a)return;a=a.filter(o=>-1===r.indexOf(o)),0===a.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}else this.headers.delete(e),this.normalizedNames.delete(e)}}setHeaderEntries(t,e){const i=(Array.isArray(e)?e:[e]).map(r=>r.toString()),s=t.toLowerCase();this.headers.set(s,i),this.maybeSetNormalizedName(t,s)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class az{encodeKey(t){return IB(t)}encodeValue(t){return IB(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const lz=/%(\d[a-f0-9])/gi,cz={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function IB(n){return encodeURIComponent(n).replace(lz,(t,e)=>cz[e]??t)}function Vp(n){return`${n}`}class Aa{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new az,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function oz(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(s=>{const r=s.indexOf("="),[a,o]=-1==r?[t.decodeKey(s),""]:[t.decodeKey(s.slice(0,r)),t.decodeValue(s.slice(r+1))],l=e.get(a)||[];l.push(o),e.set(a,l)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],s=Array.isArray(i)?i.map(Vp):[Vp(i)];this.map.set(e,s)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const s=t[i];Array.isArray(s)?s.forEach(r=>{e.push({param:i,value:r,op:"a"})}):e.push({param:i,value:s,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Aa({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Vp(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const s=i.indexOf(Vp(t.value));-1!==s&&i.splice(s,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class uz{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function MB(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function AB(n){return typeof Blob<"u"&&n instanceof Blob}function FB(n){return typeof FormData<"u"&&n instanceof FormData}class mh{constructor(t,e,i,s){let r;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function hz(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==i?i:null,r=s):r=i,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Es,this.context??=new uz,this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=e;else{const o=e.indexOf("?");this.urlWithParams=e+(-1===o?"?":o<e.length-1?"&":"")+a}}else this.params=new Aa,this.urlWithParams=e}serializeBody(){return null===this.body?null:MB(this.body)||AB(this.body)||FB(this.body)||function dz(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Aa?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||FB(this.body)?null:AB(this.body)?this.body.type||null:MB(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Aa?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const e=t.method||this.method,i=t.url||this.url,s=t.responseType||this.responseType,r=void 0!==t.body?t.body:this.body,a=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,o=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let l=t.headers||this.headers,c=t.params||this.params;const u=t.context??this.context;return void 0!==t.setHeaders&&(l=Object.keys(t.setHeaders).reduce((h,f)=>h.set(f,t.setHeaders[f]),l)),t.setParams&&(c=Object.keys(t.setParams).reduce((h,f)=>h.set(f,t.setParams[f]),c)),new mh(e,i,r,{params:c,headers:l,context:u,reportProgress:o,responseType:s,withCredentials:a})}}var Fa=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Fa||{});class H0{constructor(t,e=yh.Ok,i="OK"){this.headers=t.headers||new Es,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Hp extends H0{constructor(t={}){super(t),this.type=Fa.ResponseHeader}clone(t={}){return new Hp({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Io extends H0{constructor(t={}){super(t),this.type=Fa.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Io({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class wc extends H0{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}var yh=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(yh||{});function W0(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}let LB=(()=>{class n{constructor(e){this.handler=e}request(e,i,s={}){let r;if(e instanceof mh)r=e;else{let l,c;l=s.headers instanceof Es?s.headers:new Es(s.headers),s.params&&(c=s.params instanceof Aa?s.params:new Aa({fromObject:s.params})),r=new mh(e,i,void 0!==s.body?s.body:null,{headers:l,context:s.context,params:c,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}const a=ze(r).pipe(oc(l=>this.handler.handle(l)));if(e instanceof mh||"events"===s.observe)return a;const o=a.pipe(Ia(l=>l instanceof Io));switch(s.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return o.pipe(mt(l=>{if(null!==l.body&&!(l.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return l.body}));case"blob":return o.pipe(mt(l=>{if(null!==l.body&&!(l.body instanceof Blob))throw new Error("Response is not a Blob.");return l.body}));case"text":return o.pipe(mt(l=>{if(null!==l.body&&"string"!=typeof l.body)throw new Error("Response is not a string.");return l.body}));default:return o.pipe(mt(l=>l.body))}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Aa).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,s={}){return this.request("PATCH",e,W0(s,i))}post(e,i,s={}){return this.request("POST",e,W0(s,i))}put(e,i,s={}){return this.request("PUT",e,W0(s,i))}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Rp))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();function OB(n,t){return t(n)}const bh=new ce(""),VB=new ce(""),HB=new ce("");let WB=(()=>{class n extends Rp{constructor(e,i){super(),this.backend=e,this.injector=i,this.chain=null,this.pendingTasks=Q(Ll);const s=Q(HB,{optional:!0});this.backend=s??e}handle(e){if(null===this.chain){const s=Array.from(new Set([...this.injector.get(bh),...this.injector.get(VB,[])]));this.chain=s.reduceRight((r,a)=>function bz(n,t,e){return(i,s)=>yo(e,()=>t(i,r=>n(r,s)))}(r,a,this.injector),OB)}const i=this.pendingTasks.add();return this.chain(e,s=>this.backend.handle(s)).pipe(Tp(()=>this.pendingTasks.remove(i)))}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Op),Oe(us))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();const Cz=/^\)\]\}',?\n/;let GB=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new z(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?fi(i.\u0275loadImpl()):ze(null)).pipe(Ns(()=>new Un(r=>{const a=i.build();if(a.open(e.method,e.urlWithParams),e.withCredentials&&(a.withCredentials=!0),e.headers.forEach((m,y)=>a.setRequestHeader(m,y.join(","))),e.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const m=e.detectContentTypeHeader();null!==m&&a.setRequestHeader("Content-Type",m)}if(e.responseType){const m=e.responseType.toLowerCase();a.responseType="json"!==m?m:"text"}const o=e.serializeBody();let l=null;const c=()=>{if(null!==l)return l;const m=a.statusText||"OK",y=new Es(a.getAllResponseHeaders()),b=function Dz(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(a)||e.url;return l=new Hp({headers:y,status:a.status,statusText:m,url:b}),l},u=()=>{let{headers:m,status:y,statusText:b,url:_}=c(),v=null;y!==yh.NoContent&&(v=typeof a.response>"u"?a.responseText:a.response),0===y&&(y=v?yh.Ok:0);let k=y>=200&&y<300;if("json"===e.responseType&&"string"==typeof v){const F=v;v=v.replace(Cz,"");try{v=""!==v?JSON.parse(v):null}catch(D){v=F,k&&(k=!1,v={error:D,text:v})}}k?(r.next(new Io({body:v,headers:m,status:y,statusText:b,url:_||void 0})),r.complete()):r.error(new wc({error:v,headers:m,status:y,statusText:b,url:_||void 0}))},h=m=>{const{url:y}=c(),b=new wc({error:m,status:a.status||0,statusText:a.statusText||"Unknown Error",url:y||void 0});r.error(b)};let f=!1;const p=m=>{f||(r.next(c()),f=!0);let y={type:Fa.DownloadProgress,loaded:m.loaded};m.lengthComputable&&(y.total=m.total),"text"===e.responseType&&a.responseText&&(y.partialText=a.responseText),r.next(y)},g=m=>{let y={type:Fa.UploadProgress,loaded:m.loaded};m.lengthComputable&&(y.total=m.total),r.next(y)};return a.addEventListener("load",u),a.addEventListener("error",h),a.addEventListener("timeout",h),a.addEventListener("abort",h),e.reportProgress&&(a.addEventListener("progress",p),null!==o&&a.upload&&a.upload.addEventListener("progress",g)),a.send(o),r.next({type:Fa.Sent}),()=>{a.removeEventListener("error",h),a.removeEventListener("abort",h),a.removeEventListener("load",u),a.removeEventListener("timeout",h),e.reportProgress&&(a.removeEventListener("progress",p),null!==o&&a.upload&&a.upload.removeEventListener("progress",g)),a.readyState!==a.DONE&&a.abort()}})))}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(U1))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();const z0=new ce(""),zB=new ce("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),$B=new ce("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class jB{}let Ez=(()=>{class n{constructor(e,i,s){this.doc=e,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=I1(e,this.cookieName),this.lastCookieString=e),this.lastToken}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(Gs),Oe(fo),Oe(zB))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();function Bz(n,t){const e=n.url.toLowerCase();if(!Q(z0)||"GET"===n.method||"HEAD"===n.method||e.startsWith("http://")||e.startsWith("https://"))return t(n);const i=Q(jB).getToken(),s=Q($B);return null!=i&&!n.headers.has(s)&&(n=n.clone({headers:n.headers.set(s,i)})),t(n)}function eP(...n){const t=NE(n),{args:e,keys:i}=xE(n),s=new Un(r=>{const{length:a}=e;if(!a)return void r.complete();const o=new Array(a);let l=a,c=a;for(let u=0;u<a;u++){let h=!1;Ds(e[u]).subscribe(Jn(r,f=>{h||(h=!0,c--),o[u]=f},()=>l--,void 0,()=>{(!l||!h)&&(c||r.next(i?BE(i,o):o),r.complete())}))}});return t?s.pipe(EE(t)):s}const tP={now:()=>(tP.delegate||Date).now(),delegate:void 0};class Rz extends ui{constructor(t=1/0,e=1/0,i=tP){super(),this._bufferSize=t,this._windowTime=e,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,e)}next(t){const{isStopped:e,_buffer:i,_infiniteTimeWindow:s,_timestampProvider:r,_windowTime:a}=this;e||(i.push(t),!s&&i.push(r.now()+a)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:s}=this,r=s.slice();for(let a=0;a<r.length&&!t.closed;a+=i?1:2)t.next(r[a]);return this._checkFinalizedStatuses(t),e}_trimBuffer(){const{_bufferSize:t,_timestampProvider:e,_buffer:i,_infiniteTimeWindow:s}=this,r=(s?1:2)*t;if(t<1/0&&r<i.length&&i.splice(0,i.length-r),!s){const a=e.now();let o=0;for(let l=1;l<i.length&&i[l]<=a;l+=2)o=l;o&&i.splice(0,o+1)}}}function $0(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new Rc({next:()=>{i.unsubscribe(),n()}});return Ds(t(...e)).subscribe(i)}function nP(n,t,e){let i,s=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:t=1/0,refCount:s=!1,scheduler:e}=n):i=n??1/0,function Oz(n={}){const{connector:t=(()=>new ui),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:s=!0}=n;return r=>{let a,o,l,c=0,u=!1,h=!1;const f=()=>{o?.unsubscribe(),o=void 0},p=()=>{f(),a=l=void 0,u=h=!1},g=()=>{const m=a;p(),m?.unsubscribe()};return ai((m,y)=>{c++,!h&&!u&&f();const b=l=l??t();y.add(()=>{c--,0===c&&!h&&!u&&(o=$0(g,s))}),b.subscribe(y),!a&&c>0&&(a=new Rc({next:_=>b.next(_),error:_=>{h=!0,f(),o=$0(p,e,_),b.error(_)},complete:()=>{u=!0,f(),o=$0(p,i),b.complete()}}),Ds(m).subscribe(a))})(r)}}({connector:()=>new Rz(i,t,e),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}class j0{}let iP=(()=>{class n{handle(e){return e.key}static \u0275fac=function(i){return new(i||n)};static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();class Up{}let sP=(()=>{class n extends Up{compile(e,i){return e}compileTranslations(e,i){return e}static \u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();class wh{}let rP=(()=>{class n extends wh{getTranslation(e){return ze({})}static \u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();function Gp(n,t){if(n===t)return!0;if(null===n||null===t)return!1;if(n!=n&&t!=t)return!0;const e=typeof n;let s;if(e==typeof t&&"object"==e)if(Array.isArray(n)){if(!Array.isArray(t))return!1;if((s=n.length)==t.length){for(let r=0;r<s;r++)if(!Gp(n[r],t[r]))return!1;return!0}}else{if(Array.isArray(t))return!1;if(wr(n)&&wr(t)){const r=Object.create(null);for(const a in n){if(!Gp(n[a],t[a]))return!1;r[a]=!0}for(const a in t)if(!(a in r)&&typeof t[a]<"u")return!1;return!0}}return!1}function Ra(n){return typeof n<"u"&&null!==n}function aP(n){return void 0!==n}function wr(n){return Sh(n)&&!Ao(n)&&null!==n}function Sh(n){return"object"==typeof n&&null!==n}function Ao(n){return Array.isArray(n)}function zp(n){return"string"==typeof n}function $p(n){if(Ao(n))return n.map(t=>$p(t));if(wr(n)){const t={};return Object.keys(n).forEach(e=>{t[e]=$p(n[e])}),t}return n}function q0(n,t){if(!Sh(n))return $p(t);const e=$p(n);return Sh(e)&&Sh(t)&&Object.keys(t).forEach(i=>{wr(t[i])?i in n?e[i]=q0(n[i],t[i]):Object.assign(e,{[i]:t[i]}):Object.assign(e,{[i]:t[i]})}),e}function oP(n,t){const e=t.split(".");t="";do{t+=e.shift();const i=!e.length;if(Ra(n)){if(wr(n)&&aP(n[t])&&(wr(n[t])||Ao(n[t])||i)){n=n[t],t="";continue}if(Ao(n)){const s=parseInt(t,10);if(aP(n[s])&&(wr(n[s])||Ao(n[s])||i)){n=n[s],t="";continue}}}i?n=void 0:t+="."}while(e.length);return n}class jp{}let lP=(()=>{class n extends jp{templateMatcher=/{{\s?([^{}\s]*)\s?}}/g;interpolate(e,i){return zp(e)?this.interpolateString(e,i):function Vz(n){return"function"==typeof n}(e)?this.interpolateFunction(e,i):void 0}interpolateFunction(e,i){return e(i)}interpolateString(e,i){return i?e.replace(this.templateMatcher,(s,r)=>{const a=this.getInterpolationReplacement(i,r);return void 0!==a?a:s}):e}getInterpolationReplacement(e,i){return this.formatValue(oP(e,i))}formatValue(e){return zp(e)?e:"number"==typeof e||"boolean"==typeof e?e.toString():null===e?"null":Ao(e)?e.join(", "):Sh(e)?"function"==typeof e.toString&&e.toString!==Object.prototype.toString?e.toString():JSON.stringify(e):void 0}static \u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})(),Y0=(()=>{class n{_onTranslationChange=new ui;_onLangChange=new ui;_onFallbackLangChange=new ui;fallbackLang=null;currentLang;translations={};languages=[];getTranslations(e){return this.translations[e]}setTranslations(e,i,s){this.translations[e]=s&&this.hasTranslationFor(e)?q0(this.translations[e],i):i,this.addLanguages([e]),this._onTranslationChange.next({lang:e,translations:this.getTranslations(e)})}getLanguages(){return this.languages}getCurrentLang(){return this.currentLang}getFallbackLang(){return this.fallbackLang}setFallbackLang(e,i=!0){this.fallbackLang=e,i&&this._onFallbackLangChange.next({lang:e,translations:this.translations[e]})}setCurrentLang(e,i=!0){this.currentLang=e,i&&this._onLangChange.next({lang:e,translations:this.translations[e]})}get onTranslationChange(){return this._onTranslationChange.asObservable()}get onLangChange(){return this._onLangChange.asObservable()}get onFallbackLangChange(){return this._onFallbackLangChange.asObservable()}addLanguages(e){this.languages=Array.from(new Set([...this.languages,...e]))}hasTranslationFor(e){return typeof this.translations[e]<"u"}deleteTranslations(e){delete this.translations[e]}getTranslation(e){let i=this.getValue(this.currentLang,e);return void 0===i&&null!=this.fallbackLang&&this.fallbackLang!==this.currentLang&&(i=this.getValue(this.fallbackLang,e)),i}getValue(e,i){return oP(this.getTranslations(e),i)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();const X0=new ce("TRANSLATE_CONFIG"),_h=n=>xo(n)?n:ze(n);let vh=(()=>{class n{loadingTranslations;pending=!1;_translationRequests={};lastUseLanguage=null;currentLoader=Q(wh);compiler=Q(Up);parser=Q(jp);missingTranslationHandler=Q(j0);store=Q(Y0);extend=!1;get onTranslationChange(){return this.store.onTranslationChange}get onLangChange(){return this.store.onLangChange}get onFallbackLangChange(){return this.store.onFallbackLangChange}get onDefaultLangChange(){return this.store.onFallbackLangChange}constructor(){const e={extend:!1,fallbackLang:null,...Q(X0,{optional:!0})};e.lang&&this.use(e.lang),e.fallbackLang&&this.setFallbackLang(e.fallbackLang),e.extend&&(this.extend=!0)}setFallbackLang(e){this.getFallbackLang()||this.store.setFallbackLang(e,!1);const i=this.loadOrExtendLanguage(e);return xo(i)?(i.pipe(pr(1)).subscribe({next:()=>{this.store.setFallbackLang(e)},error:()=>{}}),i):(this.store.setFallbackLang(e),ze(this.store.getTranslations(e)))}use(e){this.lastUseLanguage=e,this.getCurrentLang()||this.store.setCurrentLang(e,!1);const i=this.loadOrExtendLanguage(e);return xo(i)?(i.pipe(pr(1)).subscribe({next:()=>{this.changeLang(e)},error:()=>{}}),i):(this.changeLang(e),ze(this.store.getTranslations(e)))}loadOrExtendLanguage(e){if(!this.store.hasTranslationFor(e)||this.extend)return this._translationRequests[e]=this._translationRequests[e]||this.loadAndCompileTranslations(e),this._translationRequests[e]}changeLang(e){e===this.lastUseLanguage&&this.store.setCurrentLang(e)}getCurrentLang(){return this.store.getCurrentLang()}loadAndCompileTranslations(e){this.pending=!0;const i=this.currentLoader.getTranslation(e).pipe(nP(1),pr(1));return this.loadingTranslations=i.pipe(mt(s=>this.compiler.compileTranslations(s,e)),nP(1),pr(1)),this.loadingTranslations.subscribe({next:s=>{this.store.setTranslations(e,s,this.extend),this.pending=!1},error:s=>{this.pending=!1}}),i}setTranslation(e,i,s=!1){const r=this.compiler.compileTranslations(i,e);this.store.setTranslations(e,r,s||this.extend)}getLangs(){return this.store.getLanguages()}addLangs(e){this.store.addLanguages(e)}getParsedResultForKey(e,i){const s=this.getTextToInterpolate(e);if(Ra(s))return this.runInterpolation(s,i);const r=this.missingTranslationHandler.handle({key:e,translateService:this,...void 0!==i&&{interpolateParams:i}});return void 0!==r?r:e}getFallbackLang(){return this.store.getFallbackLang()}getTextToInterpolate(e){return this.store.getTranslation(e)}runInterpolation(e,i){if(Ra(e))return Ao(e)?this.runInterpolationOnArray(e,i):wr(e)?this.runInterpolationOnDict(e,i):this.parser.interpolate(e,i)}runInterpolationOnArray(e,i){return e.map(s=>this.runInterpolation(s,i))}runInterpolationOnDict(e,i){const s={};for(const r in e){const a=this.runInterpolation(e[r],i);void 0!==a&&(s[r]=a)}return s}getParsedResult(e,i){return e instanceof Array?this.getParsedResultForArray(e,i):this.getParsedResultForKey(e,i)}getParsedResultForArray(e,i){const s={};let r=!1;for(const o of e)s[o]=this.getParsedResultForKey(o,i),r=r||xo(s[o]);return r?eP(e.map(o=>_h(s[o]))).pipe(mt(o=>{const l={};return o.forEach((c,u)=>{l[e[u]]=c}),l})):s}get(e,i){if(!Ra(e)||!e.length)throw new Error('Parameter "key" is required and cannot be empty');return this.pending?this.loadingTranslations.pipe(oc(()=>_h(this.getParsedResult(e,i)))):_h(this.getParsedResult(e,i))}getStreamOnTranslationChange(e,i){if(!Ra(e)||!e.length)throw new Error('Parameter "key" is required and cannot be empty');return eh(Sp(()=>this.get(e,i)),this.onTranslationChange.pipe(Ns(()=>{const s=this.getParsedResult(e,i);return _h(s)})))}stream(e,i){if(!Ra(e)||!e.length)throw new Error('Parameter "key" required');return eh(Sp(()=>this.get(e,i)),this.onLangChange.pipe(Ns(()=>{const s=this.getParsedResult(e,i);return _h(s)})))}instant(e,i){if(!Ra(e)||0===e.length)throw new Error('Parameter "key" is required and cannot be empty');const s=this.getParsedResult(e,i);return xo(s)?Array.isArray(e)?e.reduce((r,a)=>(r[a]=a,r),{}):e:s}set(e,i,s=this.getCurrentLang()){this.store.setTranslations(s,function Hz(n,t,e){return q0(n,function Wz(n,t){return n.split(".").reduceRight((e,i)=>({[i]:e}),t)}(t,e))}(this.store.getTranslations(s),e,zp(i)?this.compiler.compile(i,s):this.compiler.compileTranslations(i,s)),!1)}reloadLang(e){return this.resetLang(e),this.loadAndCompileTranslations(e)}resetLang(e){delete this._translationRequests[e],this.store.deleteTranslations(e)}static getBrowserLang(){if(typeof window>"u"||!window.navigator)return;const e=this.getBrowserCultureLang();return e?e.split(/[-_]/)[0]:void 0}static getBrowserCultureLang(){if(!(typeof window>"u"||typeof window.navigator>"u"))return window.navigator.languages?window.navigator.languages[0]:window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage}getBrowserLang(){return n.getBrowserLang()}getBrowserCultureLang(){return n.getBrowserCultureLang()}get defaultLang(){return this.getFallbackLang()}get currentLang(){return this.store.getCurrentLang()}get langs(){return this.store.getLanguages()}setDefaultLang(e){return this.setFallbackLang(e)}getDefaultLang(){return this.getFallbackLang()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})(),J0=(()=>{class n{translate=Q(vh);_ref=Q(Al);value="";lastKey=null;lastParams=[];onTranslationChange;onLangChange;onFallbackLangChange;updateValue(e,i,s){const r=a=>{this.value=void 0!==a?a:e,this.lastKey=e,this._ref.markForCheck()};if(s){const a=this.translate.getParsedResult(e,i);xo(a)?a.subscribe(r):r(a)}this.translate.get(e,i).subscribe(r)}transform(e,...i){if(!e||!e.length)return e;if(Gp(e,this.lastKey)&&Gp(i,this.lastParams))return this.value;let s;if(Ra(i[0])&&i.length)if(zp(i[0])&&i[0].length){const r=i[0].replace(/(')?([a-zA-Z0-9_]+)(')?(\s)?:/g,'"$2":').replace(/:(\s)?(')(.*?)(')/g,':"$3"');try{s=JSON.parse(r)}catch(a){throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${i[0]}`)}}else wr(i[0])&&(s=i[0]);return this.lastKey=e,this.lastParams=i,this.updateValue(e,s),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(r=>{(this.lastKey&&r.lang===this.translate.getCurrentLang()||r.lang===this.translate.getFallbackLang())&&(this.lastKey=null,this.updateValue(e,s,r.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(r=>{this.lastKey&&(this.lastKey=null,this.updateValue(e,s,r.translations))})),this.onFallbackLangChange||(this.onFallbackLangChange=this.translate.onFallbackLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(e,s))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onFallbackLangChange<"u"&&(this.onFallbackLangChange.unsubscribe(),this.onFallbackLangChange=void 0)}ngOnDestroy(){this._dispose()}static \u0275fac=function(i){return new(i||n)};static \u0275pipe=Ni({name:"translate",type:n,pure:!1,standalone:!0});static \u0275prov=fe({token:n,factory:n.\u0275fac})}return n})();function cP(n){return{provide:wh,useClass:n}}function uP(n){return{provide:Up,useClass:n}}function hP(n){return{provide:jp,useClass:n}}function dP(n){return{provide:j0,useClass:n}}function qp(n={},t){const e=[];return n.loader&&e.push(n.loader),n.compiler&&e.push(n.compiler),n.parser&&e.push(n.parser),n.missingTranslationHandler&&e.push(n.missingTranslationHandler),t&&e.push(Y0),(n.useDefaultLang||n.defaultLanguage)&&(console.warn("The `useDefaultLang` and `defaultLanguage` options are deprecated. Please use `fallbackLang` instead."),!0===n.useDefaultLang&&n.defaultLanguage&&(n.fallbackLang=n.defaultLanguage)),e.push({provide:X0,useValue:{fallbackLang:n.fallbackLang??null,lang:n.lang,extend:n.extend??!1}}),e.push({provide:vh,useClass:vh,deps:[Y0,wh,Up,jp,j0,X0]}),e}let Yp=(()=>{class n{static forRoot(e={}){return{ngModule:n,providers:[...qp({compiler:uP(sP),parser:hP(lP),loader:cP(rP),missingTranslationHandler:dP(iP),...e},!0)]}}static forChild(e={}){return{ngModule:n,providers:[...qp(e,e.isolate??!1)]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=il({type:n});static \u0275inj=ho({})}return n})();class Gz{constructor(t){this.http=t}getTranslation(t){return this.http.get(`./assets/i18n/${t}.json`)}}const $z={providers:[function nz(n,...t){return iu([{provide:Fp,multi:!0,useValue:n},[],{provide:gc,useFactory:NB,deps:[Jr]},{provide:kw,multi:!0,useFactory:xB},t.map(e=>e.\u0275providers)])}([]),function Pz(...n){const t=[LB,GB,WB,{provide:Rp,useExisting:WB},{provide:Op,useExisting:GB},{provide:bh,useValue:Bz,multi:!0},{provide:z0,useValue:!0},{provide:jB,useClass:Ez}];for(const e of n)t.push(...e.\u0275providers);return iu(t)}(),rT(Yp.forRoot({defaultLanguage:"en",loader:{provide:wh,useFactory:function zz(n){return new Gz(n)},deps:[LB]}}))]};let fP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static#e=this.\u0275fac=function(i){return new(i||n)(j(Gr),j(ls))};static#t=this.\u0275dir=$e({type:n})}return n})(),Fo=(()=>{class n extends fP{static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275dir=$e({type:n,features:[Rt]})}return n})();const Sr=new ce(""),jz={provide:Sr,useExisting:Kt(()=>Xp),multi:!0};let Xp=(()=>{class n extends Fo{writeValue(e){this.setProperty("checked",e)}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275dir=$e({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,s){1&i&&tt("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[cn([jz]),Rt]})}return n})();const qz={provide:Sr,useExisting:Kt(()=>Jp),multi:!0},Xz=new ce("");let Jp=(()=>{class n extends fP{constructor(e,i,s){super(e,i),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Yz(){const n=Ba()?Ba().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static#e=this.\u0275fac=function(i){return new(i||n)(j(Gr),j(ls),j(Xz,8))};static#t=this.\u0275dir=$e({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){1&i&&tt("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[cn([qz]),Rt]})}return n})();const ki=new ce(""),Va=new ce("");function TP(n){return null!=n}function kP(n){return $u(n)?fi(n):n}function CP(n){let t={};return n.forEach(e=>{t=null!=e?{...t,...e}:t}),0===Object.keys(t).length?null:t}function DP(n,t){return t.map(e=>e(n))}function NP(n){return n.map(t=>function Qz(n){return!n.validate}(t)?t:e=>t.validate(e))}function Q0(n){return null!=n?function xP(n){if(!n)return null;const t=n.filter(TP);return 0==t.length?null:function(e){return CP(DP(e,t))}}(NP(n)):null}function K0(n){return null!=n?function EP(n){if(!n)return null;const t=n.filter(TP);return 0==t.length?null:function(e){return eP(DP(e,t).map(kP)).pipe(mt(CP))}}(NP(n)):null}function BP(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function Z0(n){return n?Array.isArray(n)?n:[n]:[]}function Kp(n,t){return Array.isArray(n)?n.includes(t):n===t}function MP(n,t){const e=Z0(t);return Z0(n).forEach(s=>{Kp(e,s)||e.push(s)}),e}function AP(n,t){return Z0(t).filter(e=>!Kp(n,e))}class FP{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Q0(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=K0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Ai extends FP{get formDirective(){return null}get path(){return null}}class Ha extends FP{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class LP{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let eS=(()=>{class n extends LP{constructor(e){super(e)}static#e=this.\u0275fac=function(i){return new(i||n)(j(Ha,2))};static#t=this.\u0275dir=$e({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){2&i&&oi("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Rt]})}return n})();const Th="VALID",eg="INVALID",Sc="PENDING",kh="DISABLED";function tg(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class rS{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Th}get invalid(){return this.status===eg}get pending(){return this.status==Sc}get disabled(){return this.status===kh}get enabled(){return this.status!==kh}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(MP(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(MP(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(AP(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(AP(t,this._rawAsyncValidators))}hasValidator(t){return Kp(this._rawValidators,t)}hasAsyncValidator(t){return Kp(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Sc,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=kh,this.errors=null,this._forEachChild(i=>{i.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:e}),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Th,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:e}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Th||this.status===Sc)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?kh:Th}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Sc,this._hasOwnPendingAsyncValidator=!0;const e=kP(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,s)=>i&&i._find(s),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new hn,this.statusChanges=new hn}_calculateStatus(){return this._allControlsDisabled()?kh:this.errors?eg:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Sc)?Sc:this._anyControlsHaveStatus(eg)?eg:Th}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){tg(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function n$(n){return Array.isArray(n)?Q0(n):n||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function i$(n){return Array.isArray(n)?K0(n):n||null}(this._rawAsyncValidators)}}const _c=new ce("CallSetDisabledState",{providedIn:"root",factory:()=>ng}),ng="always";function Ch(n,t,e=ng){(function oS(n,t){const e=function PP(n){return n._rawValidators}(n);null!==t.validator?n.setValidators(BP(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=function IP(n){return n._rawAsyncValidators}(n);null!==t.asyncValidator?n.setAsyncValidators(BP(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const s=()=>n.updateValueAndValidity();rg(t._rawValidators,s),rg(t._rawAsyncValidators,s)})(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||"always"===e)&&t.valueAccessor.setDisabledState?.(n.disabled),function a$(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&HP(n,t)})}(n,t),function l$(n,t){const e=(i,s)=>{t.valueAccessor.writeValue(i),s&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function o$(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&HP(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function r$(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function rg(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function HP(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function GP(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function zP(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}Promise.resolve();const $P=class extends rS{constructor(t=null,e,i){super(function iS(n){return(tg(n)?n.validators:n)||null}(e),function sS(n,t){return(tg(t)?t.asyncValidators:n)||null}(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),tg(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=zP(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){GP(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){GP(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){zP(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},m$={provide:Ha,useExisting:Kt(()=>og)},YP=Promise.resolve();let og=(()=>{class n extends Ha{constructor(e,i,s,r,a,o){super(),this._changeDetectorRef=a,this.callSetDisabledState=o,this.control=new $P,this._registered=!1,this.name="",this.update=new hn,this._parent=e,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=function uS(n,t){if(!t)return null;let e,i,s;return Array.isArray(t),t.forEach(r=>{r.constructor===Jp?e=r:function h$(n){return Object.getPrototypeOf(n.constructor)===Fo}(r)?i=r:s=r}),s||i||e||null}(0,r)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),function cS(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ch(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){YP.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,s=0!==i&&function rc(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}(i);YP.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function ig(n,t){return[...t.path,n]}(e,this._parent):[e]}static#e=this.\u0275fac=function(i){return new(i||n)(j(Ai,9),j(ki,10),j(Va,10),j(Sr,10),j(Al,8),j(_c,8))};static#t=this.\u0275dir=$e({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[an.None,"disabled","isDisabled"],model:[an.None,"ngModel","model"],options:[an.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[cn([m$]),Rt,vs]})}return n})();const w$={provide:Sr,useExisting:Kt(()=>dS),multi:!0};let S$=(()=>{class n{constructor(){this._accessors=[]}add(e,i){this._accessors.push([e,i])}remove(e){for(let i=this._accessors.length-1;i>=0;--i)if(this._accessors[i][1]===e)return void this._accessors.splice(i,1)}select(e){this._accessors.forEach(i=>{this._isSameGroup(i,e)&&i[1]!==e&&i[1].fireUncheck(e.value)})}_isSameGroup(e,i){return!!e[0].control&&e[0]._parent===i._control._parent&&e[1].name===i.name}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dS=(()=>{class n extends Fo{constructor(e,i,s,r){super(e,i),this._registry=s,this._injector=r,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=Q(_c,{optional:!0})??ng}ngOnInit(){this._control=this._injector.get(Ha),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}static#e=this.\u0275fac=function(i){return new(i||n)(j(Gr),j(ls),j(S$),j(Qi))};static#t=this.\u0275dir=$e({type:n,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(i,s){1&i&&tt("change",function(){return s.onChange()})("blur",function(){return s.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[cn([w$]),Rt]})}return n})();const _$={provide:Sr,useExisting:Kt(()=>fS),multi:!0};let fS=(()=>{class n extends Fo{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=i=>{e(""==i?null:parseFloat(i))}}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275dir=$e({type:n,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(i,s){1&i&&tt("change",function(a){return s.onChange(a.target.value)})("input",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},features:[cn([_$]),Rt]})}return n})();const N$={provide:Sr,useExisting:Kt(()=>lg),multi:!0};function eI(n,t){return null==n?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let lg=(()=>{class n extends Fo{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const s=eI(this._getOptionId(e),e);this.setProperty("value",s)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){const i=function x$(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275dir=$e({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){1&i&&tt("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([N$]),Rt]})}return n})(),tI=(()=>{class n{constructor(e,i,s){this._element=e,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(eI(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(i){return new(i||n)(j(ls),j(Gr),j(lg,9))};static#t=this.\u0275dir=$e({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return n})();const E$={provide:Sr,useExisting:Kt(()=>yS),multi:!0};function nI(n,t){return null==n?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let yS=(()=>{class n extends Fo{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let i;if(this.value=e,Array.isArray(e)){const s=e.map(r=>this._getOptionId(r));i=(r,a)=>{r._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,r)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{const s=[],r=i.selectedOptions;if(void 0!==r){const a=r;for(let o=0;o<a.length;o++){const c=this._getOptionValue(a[o].value);s.push(c)}}else{const a=i.options;for(let o=0;o<a.length;o++){const l=a[o];if(l.selected){const c=this._getOptionValue(l.value);s.push(c)}}}this.value=s,e(s)}}_registerOption(e){const i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){const i=function B$(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static#e=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Pn(n)))(s||n)}})();static#t=this.\u0275dir=$e({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){1&i&&tt("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([E$]),Rt]})}return n})(),iI=(()=>{class n{constructor(e,i,s){this._element=e,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(nI(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(nI(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(i){return new(i||n)(j(ls),j(Gr),j(yS,9))};static#t=this.\u0275dir=$e({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return n})(),V$=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=il({type:n});static#n=this.\u0275inj=ho({})}return n})(),fI=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:_c,useValue:e.callSetDisabledState??ng}]}}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=il({type:n});static#n=this.\u0275inj=ho({imports:[V$]})}return n})();var Wa=function(n){return n[n.Page=0]="Page",n[n.Horizontal=1]="Horizontal",n}(Wa||{}),_r=function(n){return n[n.Default=0]="Default",n[n.ScoreTab=1]="ScoreTab",n[n.Score=2]="Score",n[n.Tab=3]="Tab",n[n.TabMixed=4]="TabMixed",n}(_r||{});class qs{static getValue(t){return qs._values||(qs._values=new Map),t=t.toLowerCase().replaceAll(" ",""),qs._values.has(t)?qs._values.get(t):0}static isPiano(t){return t<=7||t>=16&&t<=23}static isGuitar(t){return t>=24&&t<=39||105===t||43===t}}qs._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);var Ys=function(n){return n[n.NoBrackets=0]="NoBrackets",n[n.GroupStaves=1]="GroupStaves",n[n.GroupSimilarInstruments=2]="GroupSimilarInstruments",n}(Ys||{}),Et=function(n){return n[n.Hidden=0]="Hidden",n[n.FirstSystem=1]="FirstSystem",n[n.AllSystems=2]="AllSystems",n}(Et||{}),zn=function(n){return n[n.FullName=0]="FullName",n[n.ShortName=1]="ShortName",n}(zn||{}),$n=function(n){return n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n}($n||{});class pI{constructor(){this.hideDynamics=!1,this.bracketExtendMode=Ys.GroupStaves,this.useSystemSignSeparator=!1,this.globalDisplayTuning=!0,this.perTrackDisplayTuning=null,this.globalDisplayChordDiagramsOnTop=!0,this.perTrackChordDiagramsOnTop=null,this.singleTrackTrackNamePolicy=Et.FirstSystem,this.multiTrackTrackNamePolicy=Et.FirstSystem,this.firstSystemTrackNameMode=zn.ShortName,this.otherSystemsTrackNameMode=zn.ShortName,this.firstSystemTrackNameOrientation=$n.Vertical,this.otherSystemsTrackNameOrientation=$n.Vertical,this.multiTrackMultiBarRest=!1,this.perTrackMultiBarRest=null}}class wS{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const t=this.opening;return t?[t]:[]}get isOpened(){return!0===this.opening?.isRepeatStart}addMasterBar(t){null===this.opening&&(this.opening=t),this.masterBars.push(t),t.repeatGroup=this,t.isRepeatEnd&&(this.closings.push(t),this.isClosed=!0)}}class Ro{constructor(){this.colors=new Map}}var Be=function(n){return n[n.Neutral=0]="Neutral",n[n.C3=1]="C3",n[n.C4=2]="C4",n[n.F4=3]="F4",n[n.G2=4]="G2",n}(Be||{}),we=function(n){return n[n._15ma=0]="_15ma",n[n._8va=1]="_8va",n[n.Regular=2]="Regular",n[n._8vb=3]="_8vb",n[n._15mb=4]="_15mb",n}(we||{}),$t=function(n){return n[n.None=0]="None",n[n.Simple=1]="Simple",n[n.FirstOfDouble=2]="FirstOfDouble",n[n.SecondOfDouble=3]="SecondOfDouble",n}($t||{}),De=function(n){return n[n.Cb=-7]="Cb",n[n.Gb=-6]="Gb",n[n.Db=-5]="Db",n[n.Ab=-4]="Ab",n[n.Eb=-3]="Eb",n[n.Bb=-2]="Bb",n[n.F=-1]="F",n[n.C=0]="C",n[n.G=1]="G",n[n.D=2]="D",n[n.A=3]="A",n[n.E=4]="E",n[n.B=5]="B",n[n.FSharp=6]="FSharp",n[n.CSharp=7]="CSharp",n}(De||{}),li=function(n){return n[n.Major=0]="Major",n[n.Minor=1]="Minor",n}(li||{}),jt=function(n){return n[n.Down=0]="Down",n[n.Hold=1]="Hold",n[n.Up=2]="Up",n}(jt||{});class Ua{constructor(){this.ratioPosition=0,this.pedalType=jt.Down,this.nextPedalMarker=null,this.previousPedalMarker=null}}var Le=function(n){return n[n.StandardNotationRepeats=0]="StandardNotationRepeats",n[n.GuitarTabsRepeats=1]="GuitarTabsRepeats",n[n.SlashRepeats=2]="SlashRepeats",n[n.NumberedRepeats=3]="NumberedRepeats",n[n.StandardNotationBarNumber=4]="StandardNotationBarNumber",n[n.GuitarTabsBarNumber=5]="GuitarTabsBarNumber",n[n.SlashBarNumber=6]="SlashBarNumber",n[n.NumberedBarNumber=7]="NumberedBarNumber",n[n.StandardNotationBarLines=8]="StandardNotationBarLines",n[n.GuitarTabsBarLines=9]="GuitarTabsBarLines",n[n.SlashBarLines=10]="SlashBarLines",n[n.NumberedBarLines=11]="NumberedBarLines",n[n.StandardNotationClef=12]="StandardNotationClef",n[n.GuitarTabsClef=13]="GuitarTabsClef",n[n.StandardNotationKeySignature=14]="StandardNotationKeySignature",n[n.NumberedKeySignature=15]="NumberedKeySignature",n[n.StandardNotationTimeSignature=16]="StandardNotationTimeSignature",n[n.GuitarTabsTimeSignature=17]="GuitarTabsTimeSignature",n[n.SlashTimeSignature=18]="SlashTimeSignature",n[n.NumberedTimeSignature=19]="NumberedTimeSignature",n[n.StandardNotationStaffLine=20]="StandardNotationStaffLine",n[n.GuitarTabsStaffLine=21]="GuitarTabsStaffLine",n[n.SlashStaffLine=22]="SlashStaffLine",n[n.NumberedStaffLine=23]="NumberedStaffLine",n}(Le||{});class gI extends Ro{}var pe=function(n){return n[n.Automatic=0]="Automatic",n[n.Dashed=1]="Dashed",n[n.Dotted=2]="Dotted",n[n.Heavy=3]="Heavy",n[n.HeavyHeavy=4]="HeavyHeavy",n[n.HeavyLight=5]="HeavyLight",n[n.LightHeavy=6]="LightHeavy",n[n.LightLight=7]="LightLight",n[n.None=8]="None",n[n.Regular=9]="Regular",n[n.Short=10]="Short",n[n.Tick=11]="Tick",n}(pe||{});let vr=(()=>{class n{constructor(){this.id=n._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=Be.G2,this.clefOttava=we.Regular,this.voices=[],this.simileMark=$t.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1,this.sustainPedals=[],this._isEmpty=!0,this._isRestOnly=!0,this.barLineLeft=pe.Automatic,this.barLineRight=pe.Automatic,this.keySignature=De.C,this.keySignatureType=li.Major}static resetIds(){n._globalBarId=0}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){return this._isEmpty}get isRestOnly(){return this._isRestOnly}getActualBarLineLeft(e){return n.actualBarLine(this,!1,e)}getActualBarLineRight(){return n.actualBarLine(this,!0,!1)}static automaticToActualType(e,i,s){let r;return r=i?e.isRepeatEnd?pe.LightHeavy:e.nextMasterBar?e.isFreeTime?pe.Dashed:e.isDoubleBar?pe.LightLight:pe.Regular:pe.LightHeavy:e.isRepeatStart?pe.HeavyLight:s?pe.Regular:pe.None,r}static actualBarLine(e,i,s){const a=i?e.barLineRight:e.barLineLeft;let o;return o=a===pe.Automatic?n.automaticToActualType(e.masterBar,i,s):a,o}addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,i=null){this.isMultiVoice=!1,this._isEmpty=!0,this._isRestOnly=!0;for(let r=0,a=this.voices.length;r<a;r++){const o=this.voices[r];o.finish(e,i),r>0&&!o.isEmpty&&(this.isMultiVoice=!0),o.isEmpty||(this._isEmpty=!1),o.isRestOnly||(this._isRestOnly=!1)}const s=this.sustainPedals;if(s.length>0){let r=null;this.sustainPedals=[],this.previousBar&&this.previousBar.sustainPedals.length>0&&(r=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1]);const a=null!==r&&r.pedalType!==jt.Up;for(const o of s){if(r&&r.pedalType!==jt.Up){if(r.bar===this&&o.ratioPosition<=r.ratioPosition)continue;r.nextPedalMarker=o,o.previousPedalMarker=r}a&&o.pedalType===jt.Down&&(o.pedalType=jt.Hold),o.bar=this,this.sustainPedals.push(o),r=o}}else if(this.previousBar&&this.previousBar.sustainPedals.length>0){const r=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1];if(r.pedalType!==jt.Up){const a=new Ua;a.ratioPosition=0,a.bar=this,a.pedalType=jt.Hold,this.sustainPedals.push(a),r.nextPedalMarker=a,a.previousPedalMarker=r}}}calculateDuration(){let e=0;for(const i of this.voices){const s=i.calculateDuration();s>e&&(e=s)}return e}}return n._globalBarId=0,n})();var ie=function(n){return n[n.PPP=0]="PPP",n[n.PP=1]="PP",n[n.P=2]="P",n[n.MP=3]="MP",n[n.MF=4]="MF",n[n.F=5]="F",n[n.FF=6]="FF",n[n.FFF=7]="FFF",n[n.PPPP=8]="PPPP",n[n.PPPPP=9]="PPPPP",n[n.PPPPPP=10]="PPPPPP",n[n.FFFF=11]="FFFF",n[n.FFFFF=12]="FFFFF",n[n.FFFFFF=13]="FFFFFF",n[n.SF=14]="SF",n[n.SFP=15]="SFP",n[n.SFPP=16]="SFPP",n[n.FP=17]="FP",n[n.RF=18]="RF",n[n.RFZ=19]="RFZ",n[n.SFZ=20]="SFZ",n[n.SFFZ=21]="SFFZ",n[n.FZ=22]="FZ",n[n.N=23]="N",n[n.PF=24]="PF",n[n.SFZP=25]="SFZP",n}(ie||{});let P=(()=>{class n{static ticksToMillis(e,i){return e*(6e4/(i*n.QuarterTime))|0}static millisToTicks(e,i){return e/(6e4/(i*n.QuarterTime))|0}static toTicks(e){return n.valueToTicks(e)}static valueToTicks(e){let i=e;return i<0&&(i=1/-i),n.QuarterTime*(4/i)|0}static applyDot(e,i){return i?e+3*(e/4|0):e+(e/2|0)}static applyTuplet(e,i,s){return e*s/i|0}static removeTuplet(e,i,s){return e*i/s|0}static dynamicToVelocity(e,i=0){let s=1;switch(e){case ie.PPP:s=n.MinVelocity+0*n.VelocityIncrement;break;case ie.PP:s=n.MinVelocity+1*n.VelocityIncrement;break;case ie.P:s=n.MinVelocity+2*n.VelocityIncrement;break;case ie.MP:s=n.MinVelocity+3*n.VelocityIncrement;break;case ie.MF:s=n.MinVelocity+4*n.VelocityIncrement;break;case ie.F:s=n.MinVelocity+5*n.VelocityIncrement;break;case ie.FF:s=n.MinVelocity+6*n.VelocityIncrement;break;case ie.FFF:s=n.MinVelocity+7*n.VelocityIncrement;break;case ie.PPPP:s=10;break;case ie.PPPPP:s=5;break;case ie.PPPPPP:s=3;break;case ie.FFFF:s=n.MinVelocity+8*n.VelocityIncrement;break;case ie.FFFFF:s=n.MinVelocity+9*n.VelocityIncrement;break;case ie.FFFFFF:s=n.MinVelocity+10*n.VelocityIncrement;break;case ie.SF:case ie.SFP:case ie.SFZP:case ie.SFPP:case ie.SFZ:case ie.FZ:s=n.MinVelocity+6*n.VelocityIncrement;break;case ie.FP:case ie.RF:case ie.RFZ:case ie.SFFZ:s=n.MinVelocity+5*n.VelocityIncrement;break;case ie.N:s=1;break;case ie.PF:s=n.MinVelocity+(4.5*n.VelocityIncrement|0)}return s+=i*n.VelocityIncrement,Math.min(Math.max(s,1),127)}}return n.QuarterTime=960,n.MinVelocity=15,n.VelocityIncrement=16,n})();var Bt=function(n){return n[n.Tempo=0]="Tempo",n[n.Volume=1]="Volume",n[n.Instrument=2]="Instrument",n[n.Balance=3]="Balance",n}(Bt||{});class Xt{constructor(){this.isLinear=!1,this.type=Bt.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(t,e,i,s){(s<1||s>5)&&(s=2);const r=new Float32Array([1,.5,1,1.5,2,3]),a=new Xt;return a.type=Bt.Tempo,a.isLinear=t,a.ratioPosition=e,a.value=i*r[s],a}static buildInstrumentAutomation(t,e,i){const s=new Xt;return s.type=Bt.Instrument,s.isLinear=t,s.ratioPosition=e,s.value=i,s}}let V=(()=>{class n{constructor(e=0,i=0){this.offset=e,this.value=i}}return n.MaxPosition=60,n.MaxValue=12,n})();var ct=function(n){return n[n.Default=0]="Default",n[n.Gradual=1]="Gradual",n[n.Fast=2]="Fast",n}(ct||{}),J=function(n){return n[n.None=0]="None",n[n.Custom=1]="Custom",n[n.Bend=2]="Bend",n[n.Release=3]="Release",n[n.BendRelease=4]="BendRelease",n[n.Hold=5]="Hold",n[n.Prebend=6]="Prebend",n[n.PrebendBend=7]="PrebendBend",n[n.PrebendRelease=8]="PrebendRelease",n}(J||{}),Y=function(n){return n[n.None=0]="None",n[n.BrushUp=1]="BrushUp",n[n.BrushDown=2]="BrushDown",n[n.ArpeggioUp=3]="ArpeggioUp",n[n.ArpeggioDown=4]="ArpeggioDown",n}(Y||{}),ii=function(n){return n[n.None=0]="None",n[n.Crescendo=1]="Crescendo",n[n.Decrescendo=2]="Decrescendo",n}(ii||{}),w=function(n){return n[n.QuadrupleWhole=-4]="QuadrupleWhole",n[n.DoubleWhole=-2]="DoubleWhole",n[n.Whole=1]="Whole",n[n.Half=2]="Half",n[n.Quarter=4]="Quarter",n[n.Eighth=8]="Eighth",n[n.Sixteenth=16]="Sixteenth",n[n.ThirtySecond=32]="ThirtySecond",n[n.SixtyFourth=64]="SixtyFourth",n[n.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",n[n.TwoHundredFiftySixth=256]="TwoHundredFiftySixth",n}(w||{}),re=function(n){return n[n.None=0]="None",n[n.OnBeat=1]="OnBeat",n[n.BeforeBeat=2]="BeforeBeat",n[n.BendGrace=3]="BendGrace",n}(re||{}),Ot=function(n){return n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Heavy=2]="Heavy",n[n.Tenuto=3]="Tenuto",n}(Ot||{}),se=function(n){return n[n.Unknown=-2]="Unknown",n[n.NoOrDead=-1]="NoOrDead",n[n.Thumb=0]="Thumb",n[n.IndexFinger=1]="IndexFinger",n[n.MiddleFinger=2]="MiddleFinger",n[n.AnnularFinger=3]="AnnularFinger",n[n.LittleFinger=4]="LittleFinger",n}(se||{}),ae=function(n){return n[n.None=0]="None",n[n.Natural=1]="Natural",n[n.Artificial=2]="Artificial",n[n.Pinch=3]="Pinch",n[n.Tap=4]="Tap",n[n.Semi=5]="Semi",n[n.Feedback=6]="Feedback",n}(ae||{}),ke=function(n){return n[n.Default=0]="Default",n[n.ForceNone=1]="ForceNone",n[n.ForceNatural=2]="ForceNatural",n[n.ForceSharp=3]="ForceSharp",n[n.ForceDoubleSharp=4]="ForceDoubleSharp",n[n.ForceFlat=5]="ForceFlat",n[n.ForceDoubleFlat=6]="ForceDoubleFlat",n}(ke||{}),pn=function(n){return n[n.None=0]="None",n[n.IntoFromBelow=1]="IntoFromBelow",n[n.IntoFromAbove=2]="IntoFromAbove",n}(pn||{}),Se=function(n){return n[n.None=0]="None",n[n.Shift=1]="Shift",n[n.Legato=2]="Legato",n[n.OutUp=3]="OutUp",n[n.OutDown=4]="OutDown",n[n.PickSlideDown=5]="PickSlideDown",n[n.PickSlideUp=6]="PickSlideUp",n}(Se||{}),Ie=function(n){return n[n.None=0]="None",n[n.Slight=1]="Slight",n[n.Wide=2]="Wide",n}(Ie||{}),Xs=function(n){return n[n.Hidden=0]="Hidden",n[n.ShowWithBeams=1]="ShowWithBeams",n[n.ShowWithBars=2]="ShowWithBars",n[n.Automatic=3]="Automatic",n}(Xs||{}),Tr=function(n){return n[n.ScoreDefault=0]="ScoreDefault",n[n.ScoreForcePiano=1]="ScoreForcePiano",n[n.SingleNoteEffectBand=2]="SingleNoteEffectBand",n[n.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano",n}(Tr||{}),_n=function(n){return n[n.GuitarPro=0]="GuitarPro",n[n.SongBook=1]="SongBook",n}(_n||{}),Te=function(n){return n[n.ScoreTitle=0]="ScoreTitle",n[n.ScoreSubTitle=1]="ScoreSubTitle",n[n.ScoreArtist=2]="ScoreArtist",n[n.ScoreAlbum=3]="ScoreAlbum",n[n.ScoreWords=4]="ScoreWords",n[n.ScoreMusic=5]="ScoreMusic",n[n.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",n[n.ScoreCopyright=7]="ScoreCopyright",n[n.GuitarTuning=8]="GuitarTuning",n[n.TrackNames=9]="TrackNames",n[n.ChordDiagrams=10]="ChordDiagrams",n[n.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",n[n.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",n[n.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",n[n.EffectAlternateEndings=14]="EffectAlternateEndings",n[n.EffectCapo=15]="EffectCapo",n[n.EffectChordNames=16]="EffectChordNames",n[n.EffectCrescendo=17]="EffectCrescendo",n[n.EffectDynamics=18]="EffectDynamics",n[n.EffectFadeIn=19]="EffectFadeIn",n[n.EffectFermata=20]="EffectFermata",n[n.EffectFingering=21]="EffectFingering",n[n.EffectHarmonics=22]="EffectHarmonics",n[n.EffectLetRing=23]="EffectLetRing",n[n.EffectLyrics=24]="EffectLyrics",n[n.EffectMarker=25]="EffectMarker",n[n.EffectOttavia=26]="EffectOttavia",n[n.EffectPalmMute=27]="EffectPalmMute",n[n.EffectPickSlide=28]="EffectPickSlide",n[n.EffectPickStroke=29]="EffectPickStroke",n[n.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",n[n.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",n[n.EffectTap=32]="EffectTap",n[n.EffectTempo=33]="EffectTempo",n[n.EffectText=34]="EffectText",n[n.EffectTrill=35]="EffectTrill",n[n.EffectTripletFeel=36]="EffectTripletFeel",n[n.EffectWhammyBar=37]="EffectWhammyBar",n[n.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",n[n.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",n[n.EffectLeftHandTap=40]="EffectLeftHandTap",n[n.EffectFreeTime=41]="EffectFreeTime",n[n.EffectSustainPedal=42]="EffectSustainPedal",n[n.EffectGolpe=43]="EffectGolpe",n[n.EffectWahPedal=44]="EffectWahPedal",n[n.EffectBeatBarre=45]="EffectBeatBarre",n[n.EffectNoteOrnament=46]="EffectNoteOrnament",n[n.EffectRasgueado=47]="EffectRasgueado",n[n.EffectDirections=48]="EffectDirections",n[n.EffectBeatTimer=49]="EffectBeatTimer",n}(Te||{});class Nh{constructor(){this.notationMode=_n.GuitarPro,this.fingeringMode=Tr.ScoreDefault,this.elements=new Map,this.rhythmMode=Xs.Automatic,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(t){return this.elements.has(t)?this.elements.get(t):!Nh.defaultElements.has(t)||Nh.defaultElements.get(t)}}Nh.defaultElements=new Map([[Te.ZerosOnDiveWhammys,!1]]);class cg{constructor(t){this._value=void 0,this._factory=t}get value(){return void 0===this._value&&(this._value=this._factory()),this._value}}var kr=function(n){return n[n.None=0]="None",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n}(kr||{});class Oo{static format(t,e){return`[AlphaTab][${t}] ${e}`}debug(t,e,...i){console.debug(Oo.format(t,e),...i)}warning(t,e,...i){console.warn(Oo.format(t,e),...i)}info(t,e,...i){console.info(Oo.format(t,e),...i)}error(t,e,...i){console.error(Oo.format(t,e),...i)}}Oo.logLevel=kr.Info;class x{static shouldLog(t){return x.logLevel!==kr.None&&t>=x.logLevel}static debug(t,e,...i){x.shouldLog(kr.Debug)&&x.log.debug(t,e,...i)}static warning(t,e,...i){x.shouldLog(kr.Warning)&&x.log.warning(t,e,...i)}static info(t,e,...i){x.shouldLog(kr.Info)&&x.log.info(t,e,...i)}static error(t,e,...i){x.shouldLog(kr.Error)&&x.log.error(t,e,...i)}}x.logLevel=kr.Info,x.log=new Oo;var _e=function(n){return n[n.NoTripletFeel=0]="NoTripletFeel",n[n.Triplet16th=1]="Triplet16th",n[n.Triplet8th=2]="Triplet8th",n[n.Dotted16th=3]="Dotted16th",n[n.Dotted8th=4]="Dotted8th",n[n.Scottish16th=5]="Scottish16th",n[n.Scottish8th=6]="Scottish8th",n}(_e||{});let Cr=(()=>{class n{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.isFreeTime=!1,this.tripletFeel=_e.NoTripletFeel,this.section=null,this.tempoAutomations=[],this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1,this.directions=null}get keySignature(){return this.score.tracks[0].staves[0].bars[this.index].keySignature}set keySignature(e){this.score.tracks[0].staves[0].bars[this.index].keySignature=e}get keySignatureType(){return this.score.tracks[0].staves[0].bars[this.index].keySignatureType}set keySignatureType(e){this.score.tracks[0].staves[0].bars[this.index].keySignatureType=e}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}calculateDuration(e=!0){if(this.isAnacrusis&&e){let i=0;for(const s of this.score.tracks)for(const r of s.staves){const a=this.index<r.bars.length?r.bars[this.index].calculateDuration():0;a>i&&(i=a)}return i}return this.timeSignatureNumerator*P.valueToTicks(this.timeSignatureDenominator)}addFermata(e,i){let s=this.fermata;null===s&&(s=new Map,this.fermata=s),s.set(e,i)}addDirection(e){null==this.directions&&(this.directions=new Set),this.directions.add(e)}getFermata(e){const i=this.fermata;return null===i?null:i.has(e.playbackStart)?i.get(e.playbackStart):null}}return n.MaxAlternateEndings=8,n})();class he{}he.DefaultChannelCount=17,he.MetronomeChannel=he.DefaultChannelCount-1,he.MetronomeKey=33,he.AudioChannels=2,he.MinVolume=0,he.MinProgram=0,he.MaxProgram=127,he.MinPlaybackSpeed=.125,he.MaxPlaybackSpeed=8,he.PercussionChannel=9,he.PercussionBank=128,he.MaxPitchWheel=16384,he.MaxPitchWheel20=4294967296,he.DefaultPitchWheel=he.MaxPitchWheel/2,he.MicroBufferCount=32,he.MicroBufferSize=64;class ug{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(t){t.graceIndex=this.beats.length,t.graceGroup=this,this.beats.push(t)}finish(){this.beats.length>0&&(this.id=`${this.beats[0].absoluteDisplayStart}_${this.beats[0].voice.index}`)}}var xh=function(n){return n[n.Glyphs=0]="Glyphs",n}(xh||{});class mI extends Ro{}let Fi=class B_{constructor(){this._isEmpty=!0,this._isRestOnly=!0,this.id=B_._globalVoiceId++,this.index=0,this.beats=[]}static resetIds(){B_._globalVoiceId=0}get isEmpty(){return this._isEmpty}forceNonEmpty(){this._isEmpty=!1}get isRestOnly(){return this._isRestOnly}insertBeat(t,e){e.nextBeat=t.nextBeat,e.nextBeat&&(e.nextBeat.previousBeat=e),e.previousBeat=t,e.voice=this,t.nextBeat=e,this.beats.splice(t.index+1,0,e)}addBeat(t){t.voice=this,t.index=this.beats.length,this.beats.push(t),t.isEmpty||(this._isEmpty=!1),t.isRest||(this._isRestOnly=!1)}chain(t,e=null){if(this.bar){if(t.index<this.beats.length-1)t.nextBeat=this.beats[t.index+1],t.nextBeat.previousBeat=t;else if(t.isLastOfVoice&&t.voice.bar.nextBar){const i=this.bar.nextBar.voices[this.index];i.beats.length>0&&(t.nextBeat=i.beats[0]),t.nextBeat.previousBeat=t}t.chain(e)}}addGraceBeat(t){if(0===this.beats.length)return void this.addBeat(t);const e=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(t),this.addBeat(e),this._isEmpty=!1,this._isRestOnly=!1}getBeatAtPlaybackStart(t){return this._beatLookup.has(t)?this._beatLookup.get(t):null}finish(t,e=null){this._isEmpty=!0,this._isRestOnly=!0,this._beatLookup=new Map;let i=null;for(let a=0;a<this.beats.length;a++){const o=this.beats[a];o.index=a,this.chain(o,e),o.graceType===re.None?(o.graceGroup=i,i&&(i.isComplete=!0),i=null):(i||(i=new ug),i.addBeat(o)),o.isEmpty||(this._isEmpty=!1),o.isRest||(this._isRestOnly=!1)}let s=0,r=0;for(let a=0;a<this.beats.length;a++){const o=this.beats[a];if(o.index=a,o.finish(t,e),o.graceType===re.None){if(o.graceGroup){const l=o.graceGroup.beats[0],c=o.graceGroup.beats[o.graceGroup.beats.length-1];if(l.graceType!==re.BendGrace){const u=c.playbackStart+c.playbackDuration-l.playbackStart;switch(l.graceType){case re.BeforeBeat:l.previousBeat?(l.previousBeat.playbackDuration-=u,r=l.previousBeat.voice===this?l.previousBeat.playbackStart+l.previousBeat.playbackDuration:-u):r=-u;for(const h of o.graceGroup.beats)this._beatLookup.delete(h.playbackStart),h.playbackStart=r,this._beatLookup.set(h.playbackStart,o),r+=h.playbackDuration;break;case re.OnBeat:o.playbackDuration-=u,r=c.voice===this?c.playbackStart+c.playbackDuration:-u}}}o.displayStart=s,o.playbackStart=r,o.fermata?this.bar.masterBar.addFermata(o.playbackStart,o.fermata):o.fermata=this.bar.masterBar.getFermata(o),this._beatLookup.set(o.playbackStart,o)}else o.displayStart=s,o.playbackStart=r;o.finishTuplet(),o.graceGroup&&o.graceGroup.finish(),s+=o.displayDuration,r+=o.playbackDuration}}calculateDuration(){if(this.isEmpty||0===this.beats.length)return 0;const t=this.beats[this.beats.length-1];return t.playbackStart+t.playbackDuration-this.beats[0].playbackStart}};Fi._globalVoiceId=0;class W${constructor(){this.note=null,this.tone=new yI,this.octave=0}get realValue(){return 12*this.octave+this.tone.noteValue}}class yI{constructor(t=0,e=ke.Default){this.noteValue=t,this.accidentalMode=e}}class H{static getIndex(t){return t<0?0:0|Math.log2(t)}static keySignatureIsFlat(t){return t<0}static keySignatureIsNatural(t){return 0===t}static keySignatureIsSharp(t){return t>0}static applyPitchOffsets(t,e){for(let i=0;i<e.tracks.length;i++){if(i<t.notation.displayTranspositionPitches.length)for(const s of e.tracks[i].staves)s.displayTranspositionPitch=-t.notation.displayTranspositionPitches[i];if(i<t.notation.transpositionPitches.length)for(const s of e.tracks[i].staves)s.transpositionPitch=-t.notation.transpositionPitches[i]}}static fingerToString(t,e,i,s){if(t.notation.fingeringMode===Tr.ScoreForcePiano||t.notation.fingeringMode===Tr.SingleNoteEffectBandForcePiano||qs.isPiano(e.voice.bar.staff.track.playbackInfo.program))switch(i){case se.Unknown:case se.NoOrDead:return null;case se.Thumb:return"1";case se.IndexFinger:return"2";case se.MiddleFinger:return"3";case se.AnnularFinger:return"4";case se.LittleFinger:return"5";default:return null}if(s)switch(i){case se.Unknown:return null;case se.NoOrDead:return"0";case se.Thumb:return"t";case se.IndexFinger:return"1";case se.MiddleFinger:return"2";case se.AnnularFinger:return"3";case se.LittleFinger:return"4";default:return null}switch(i){case se.Unknown:case se.NoOrDead:return null;case se.Thumb:return"p";case se.IndexFinger:return"i";case se.MiddleFinger:return"m";case se.AnnularFinger:return"a";case se.LittleFinger:return"c";default:return null}}static isTuning(t){return!!H.parseTuning(t)}static parseTuning(t){let e="",i="";for(let r=0;r<t.length;r++){const a=t.charCodeAt(r);if(a>=48&&a<=57){if(!e)return null;i+=String.fromCharCode(a)}else{if(!H.TuningLetters.has(a))return null;e+=String.fromCharCode(a)}}if(!i||!e)return null;const s=new W$;return s.octave=Number.parseInt(i)+1,s.note=e.toLowerCase(),s.tone=H.getToneForText(s.note),s.tone.noteValue<0&&(s.octave--,s.tone.noteValue+=12),s}static getTuningForText(t){const e=H.parseTuning(t);return e?e.realValue:-1}static getToneForText(t){const e=t.substring(0,1),i=t.substring(1);let s,r;switch(e.toLowerCase()){case"c":default:s=0;break;case"d":s=2;break;case"e":s=4;break;case"f":s=5;break;case"g":s=7;break;case"a":s=9;break;case"b":s=11}switch(r=H.parseAccidentalMode(i),r){case ke.Default:case ke.ForceNone:case ke.ForceNatural:break;case ke.ForceSharp:s++;break;case ke.ForceDoubleSharp:s+=2;break;case ke.ForceFlat:s--;break;case ke.ForceDoubleFlat:s-=2}return new yI(s,r)}static parseAccidentalMode(t){const e=t.toLowerCase();return H.accidentalModeMapping.has(e)?H.accidentalModeMapping.get(e):ke.Default}static newGuid(){return`${Math.floor(65536*(1+Math.random())).toString(16).substring(1)+Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}`}static isAlmostEqualTo(t,e){return Math.abs(t-e)<1e-5}static toHexString(t,e=0){let i="";do{i=String.fromCharCode("0123456789ABCDEF".charCodeAt(15&t))+i,t>>=4}while(t>0);for(;i.length<e;)i=`0${i}`;return i}static getAlternateEndingsList(t){const e=[];for(let i=0;i<Cr.MaxAlternateEndings;i++)t&1<<i&&e.push(i);return e}static deltaFretToHarmonicValue(t){switch(t){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return t;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}static clamp(t,e,i){return t<=e?e:t>=i?i:t}static buildMultiBarRestInfo(t,e,i){if(!t)return null;const s=t[0].score.stylesheet;if(!(t.length>1?s.multiTrackMultiBarRest:!0===s.perTrackMultiBarRest?.has(t[0].index)))return null;const a=new Map,o=t[0].score;let l=e;for(;l<=i;){const c=l;let u=null;for(;l<=i;){const h=o.masterBars[l];if(h.alternateEndings||h.isRepeatStart&&h.index!==c||h.isFreeTime||h.isAnacrusis||null!==h.section||h.index!==c&&h.tempoAutomations.length>0||null!==h.fermata&&h.fermata.size>0||null!==h.directions&&h.directions.size>0||c>e&&h.previousMasterBar&&(h.timeSignatureCommon!==h.previousMasterBar.timeSignatureCommon||h.timeSignatureNumerator!==h.previousMasterBar.timeSignatureNumerator||h.timeSignatureDenominator!==h.previousMasterBar.timeSignatureDenominator||h.tripletFeel!==h.previousMasterBar.tripletFeel))break;let f=!0;for(const p of t){for(const g of p.staves){const m=g.bars[h.index];if(!m.isRestOnly){f=!1;break}if(m.index>0&&(m.keySignature!==m.previousBar.keySignature||m.keySignatureType!==m.previousBar.keySignatureType)){f=!1;break}}if(!f)break}if(!f||(l++,h.index>c&&(null===u?u=[h.index]:u.push(h.index)),h.isRepeatEnd))break}u?a.set(c,u):l++}return a}static computeFirstDisplayedBarIndex(t,e){let i=e.display.startBar;return i--,i=Math.min(t.masterBars.length-1,Math.max(0,i)),i}static computeLastDisplayedBarIndex(t,e,i){let s=e.display.barCount;return s<0&&(s=t.masterBars.length),s=i+s-1,s=Math.min(t.masterBars.length-1,Math.max(0,s)),s}static getOrCreateHeaderFooterStyle(t,e){let s,i=t.style;if(t.style||(i=new Vo,t.style=i),i.headerAndFooter.has(e))s=i.headerAndFooter.get(e);else{if(s=new gs,Vo.defaultHeaderAndFooter.has(e)){const r=Vo.defaultHeaderAndFooter.get(e);s.template=r.template,s.textAlign=r.textAlign}i.headerAndFooter.set(e,s)}return s}static consolidate(t){if(0===t.masterBars.length){const i=new Cr;t.addMasterBar(i);const s=new Xt;s.isLinear=!1,s.type=Bt.Tempo,s.value=t.tempo,i.tempoAutomations.push(s);const r=new vr;t.tracks[0].staves[0].addBar(r);const a=new Fi;r.addVoice(a);const o=new Vn;return o.isEmpty=!0,void a.addBeat(o)}const e=new Set([he.PercussionChannel]);for(const i of t.tracks){if(1===i.staves.length&&i.staves[0].isPercussion)i.playbackInfo.primaryChannel=he.PercussionChannel,i.playbackInfo.secondaryChannel=he.PercussionChannel;else{if(i.playbackInfo.primaryChannel!==he.PercussionChannel)for(;e.has(i.playbackInfo.primaryChannel);)i.playbackInfo.primaryChannel++;if(e.add(i.playbackInfo.primaryChannel),i.playbackInfo.secondaryChannel!==he.PercussionChannel)for(;e.has(i.playbackInfo.secondaryChannel);)i.playbackInfo.secondaryChannel++;e.add(i.playbackInfo.secondaryChannel)}for(const s of i.staves){for(const a of s.bars)for(const o of a.voices)if(o.isEmpty&&0===o.beats.length){const l=new Vn;l.isEmpty=!0,o.addBeat(l)}const r=0===s.bars.length?1:s.bars[0].voices.length;for(;s.bars.length<t.masterBars.length;){const a=new vr;s.addBar(a);const o=a.previousBar;o&&(a.clef=o.clef,a.clefOttava=o.clefOttava,a.keySignature=a.previousBar.keySignature,a.keySignatureType=a.previousBar.keySignatureType);for(let l=0;l<r;l++){const c=new Fi;a.addVoice(c);const u=new Vn;u.isEmpty=!0,c.addBeat(u)}}}}}}H.TuningLetters=new Set([67,68,69,70,71,65,66,99,100,101,102,103,97,98,35]),H.accidentalModeMapping=new Map([["default",ke.Default],["d",ke.Default],["forcenone",ke.ForceNone],["-",ke.ForceNone],["forcenatural",ke.ForceNatural],["n",ke.ForceNatural],["forcesharp",ke.ForceSharp],["#",ke.ForceSharp],["forcedoublesharp",ke.ForceDoubleSharp],["##",ke.ForceDoubleSharp],["x",ke.ForceDoubleSharp],["forceflat",ke.ForceFlat],["b",ke.ForceFlat],["forcedoubleflat",ke.ForceDoubleFlat],["bb",ke.ForceDoubleFlat]]);var vn=function(n){return n[n.None=0]="None",n[n.Up=1]="Up",n[n.Down=2]="Down",n}(vn||{}),d=function(n){return n[n.None=-1]="None",n[n.Space=32]="Space",n[n.Brace=57344]="Brace",n[n.BracketTop=57347]="BracketTop",n[n.BracketBottom=57348]="BracketBottom",n[n.SystemDivider=57351]="SystemDivider",n[n.GClef=57424]="GClef",n[n.CClef=57436]="CClef",n[n.FClef=57442]="FClef",n[n.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",n[n.SixStringTabClef=57453]="SixStringTabClef",n[n.FourStringTabClef=57454]="FourStringTabClef",n[n.TimeSig0=57472]="TimeSig0",n[n.TimeSig1=57473]="TimeSig1",n[n.TimeSig2=57474]="TimeSig2",n[n.TimeSig3=57475]="TimeSig3",n[n.TimeSig4=57476]="TimeSig4",n[n.TimeSig5=57477]="TimeSig5",n[n.TimeSig6=57478]="TimeSig6",n[n.TimeSig7=57479]="TimeSig7",n[n.TimeSig8=57480]="TimeSig8",n[n.TimeSig9=57481]="TimeSig9",n[n.TimeSigCommon=57482]="TimeSigCommon",n[n.TimeSigCutCommon=57483]="TimeSigCutCommon",n[n.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",n[n.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",n[n.NoteheadWhole=57506]="NoteheadWhole",n[n.NoteheadHalf=57507]="NoteheadHalf",n[n.NoteheadBlack=57508]="NoteheadBlack",n[n.NoteheadNull=57509]="NoteheadNull",n[n.NoteheadXOrnate=57514]="NoteheadXOrnate",n[n.NoteheadPlusDoubleWhole=57516]="NoteheadPlusDoubleWhole",n[n.NoteheadPlusWhole=57517]="NoteheadPlusWhole",n[n.NoteheadPlusHalf=57518]="NoteheadPlusHalf",n[n.NoteheadPlusBlack=57519]="NoteheadPlusBlack",n[n.NoteheadSquareWhite=57528]="NoteheadSquareWhite",n[n.NoteheadSquareBlack=57529]="NoteheadSquareBlack",n[n.NoteheadTriangleUpDoubleWhole=57530]="NoteheadTriangleUpDoubleWhole",n[n.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",n[n.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",n[n.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",n[n.NoteheadTriangleRightWhite=57537]="NoteheadTriangleRightWhite",n[n.NoteheadTriangleRightBlack=57538]="NoteheadTriangleRightBlack",n[n.NoteheadTriangleDownDoubleWhole=57548]="NoteheadTriangleDownDoubleWhole",n[n.NoteheadTriangleDownWhole=57540]="NoteheadTriangleDownWhole",n[n.NoteheadTriangleDownHalf=57541]="NoteheadTriangleDownHalf",n[n.NoteheadTriangleDownBlack=57543]="NoteheadTriangleDownBlack",n[n.NoteheadDiamondDoubleWhole=57559]="NoteheadDiamondDoubleWhole",n[n.NoteheadDiamondWhole=57560]="NoteheadDiamondWhole",n[n.NoteheadDiamondHalf=57561]="NoteheadDiamondHalf",n[n.NoteheadDiamondBlack=57563]="NoteheadDiamondBlack",n[n.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",n[n.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",n[n.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",n[n.NoteheadCircleXDoubleWhole=57520]="NoteheadCircleXDoubleWhole",n[n.NoteheadCircleXWhole=57521]="NoteheadCircleXWhole",n[n.NoteheadCircleXHalf=57522]="NoteheadCircleXHalf",n[n.NoteheadCircleX=57523]="NoteheadCircleX",n[n.NoteheadXDoubleWhole=57510]="NoteheadXDoubleWhole",n[n.NoteheadXWhole=57511]="NoteheadXWhole",n[n.NoteheadXHalf=57512]="NoteheadXHalf",n[n.NoteheadXBlack=57513]="NoteheadXBlack",n[n.NoteheadParenthesis=57550]="NoteheadParenthesis",n[n.NoteheadSlashedBlack1=57551]="NoteheadSlashedBlack1",n[n.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",n[n.NoteheadSlashedHalf1=57553]="NoteheadSlashedHalf1",n[n.NoteheadSlashedHalf2=57554]="NoteheadSlashedHalf2",n[n.NoteheadSlashedWhole1=57555]="NoteheadSlashedWhole1",n[n.NoteheadSlashedWhole2=57556]="NoteheadSlashedWhole2",n[n.NoteheadSlashedDoubleWhole1=57557]="NoteheadSlashedDoubleWhole1",n[n.NoteheadSlashedDoubleWhole2=57558]="NoteheadSlashedDoubleWhole2",n[n.NoteheadCircledBlack=57572]="NoteheadCircledBlack",n[n.NoteheadCircledHalf=57573]="NoteheadCircledHalf",n[n.NoteheadCircledWhole=57574]="NoteheadCircledWhole",n[n.NoteheadCircledDoubleWhole=57575]="NoteheadCircledDoubleWhole",n[n.NoteheadCircleSlash=57591]="NoteheadCircleSlash",n[n.NoteheadHeavyX=57592]="NoteheadHeavyX",n[n.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",n[n.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",n[n.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",n[n.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",n[n.NoteheadRoundWhiteWithDot=57621]="NoteheadRoundWhiteWithDot",n[n.NoteheadSquareBlackLarge=57626]="NoteheadSquareBlackLarge",n[n.NoteheadSquareBlackWhite=57627]="NoteheadSquareBlackWhite",n[n.NoteheadClusterDoubleWhole3rd=57640]="NoteheadClusterDoubleWhole3rd",n[n.NoteheadClusterWhole3rd=57641]="NoteheadClusterWhole3rd",n[n.NoteheadClusterHalf3rd=57642]="NoteheadClusterHalf3rd",n[n.NoteheadClusterQuarter3rd=57643]="NoteheadClusterQuarter3rd",n[n.NoteShapeRoundWhite=57776]="NoteShapeRoundWhite",n[n.NoteShapeRoundBlack=57777]="NoteShapeRoundBlack",n[n.NoteShapeSquareWhite=57778]="NoteShapeSquareWhite",n[n.NoteShapeSquareBlack=57779]="NoteShapeSquareBlack",n[n.NoteShapeTriangleRightWhite=57780]="NoteShapeTriangleRightWhite",n[n.NoteShapeTriangleRightBlack=57781]="NoteShapeTriangleRightBlack",n[n.NoteShapeTriangleLeftWhite=57782]="NoteShapeTriangleLeftWhite",n[n.NoteShapeTriangleLeftBlack=57783]="NoteShapeTriangleLeftBlack",n[n.NoteShapeDiamondWhite=57784]="NoteShapeDiamondWhite",n[n.NoteShapeDiamondBlack=57785]="NoteShapeDiamondBlack",n[n.NoteShapeTriangleUpWhite=57786]="NoteShapeTriangleUpWhite",n[n.NoteShapeTriangleUpBlack=57787]="NoteShapeTriangleUpBlack",n[n.NoteShapeMoonWhite=57788]="NoteShapeMoonWhite",n[n.NoteShapeMoonBlack=57789]="NoteShapeMoonBlack",n[n.NoteShapeTriangleRoundWhite=57790]="NoteShapeTriangleRoundWhite",n[n.NoteShapeTriangleRoundBlack=57791]="NoteShapeTriangleRoundBlack",n[n.NoteQuarterUp=57813]="NoteQuarterUp",n[n.NoteEighthUp=57815]="NoteEighthUp",n[n.TextBlackNoteLongStem=57841]="TextBlackNoteLongStem",n[n.TextBlackNoteFrac8thLongStem=57843]="TextBlackNoteFrac8thLongStem",n[n.TextBlackNoteFrac16thLongStem=57845]="TextBlackNoteFrac16thLongStem",n[n.TextBlackNoteFrac32ndLongStem=57846]="TextBlackNoteFrac32ndLongStem",n[n.TextCont8thBeamLongStem=57848]="TextCont8thBeamLongStem",n[n.TextCont16thBeamLongStem=57850]="TextCont16thBeamLongStem",n[n.TextCont32ndBeamLongStem=57851]="TextCont32ndBeamLongStem",n[n.TextAugmentationDot=57852]="TextAugmentationDot",n[n.TextTupletBracketStartLongStem=57857]="TextTupletBracketStartLongStem",n[n.TextTuplet3LongStem=57858]="TextTuplet3LongStem",n[n.TextTupletBracketEndLongStem=57859]="TextTupletBracketEndLongStem",n[n.Tremolo3=57890]="Tremolo3",n[n.Tremolo2=57889]="Tremolo2",n[n.Tremolo1=57888]="Tremolo1",n[n.FlagEighthUp=57920]="FlagEighthUp",n[n.FlagEighthDown=57921]="FlagEighthDown",n[n.FlagSixteenthUp=57922]="FlagSixteenthUp",n[n.FlagSixteenthDown=57923]="FlagSixteenthDown",n[n.FlagThirtySecondUp=57924]="FlagThirtySecondUp",n[n.FlagThirtySecondDown=57925]="FlagThirtySecondDown",n[n.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",n[n.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",n[n.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",n[n.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",n[n.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",n[n.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",n[n.AccidentalFlat=57952]="AccidentalFlat",n[n.AccidentalNatural=57953]="AccidentalNatural",n[n.AccidentalSharp=57954]="AccidentalSharp",n[n.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",n[n.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",n[n.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",n[n.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",n[n.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",n[n.Segno=57415]="Segno",n[n.Coda=57416]="Coda",n[n.ArticAccentAbove=58528]="ArticAccentAbove",n[n.ArticAccentBelow=58529]="ArticAccentBelow",n[n.ArticStaccatoAbove=58530]="ArticStaccatoAbove",n[n.ArticStaccatoBelow=58531]="ArticStaccatoBelow",n[n.ArticTenutoAbove=58532]="ArticTenutoAbove",n[n.ArticTenutoBelow=58533]="ArticTenutoBelow",n[n.ArticMarcatoAbove=58540]="ArticMarcatoAbove",n[n.ArticMarcatoBelow=58541]="ArticMarcatoBelow",n[n.FermataAbove=58560]="FermataAbove",n[n.FermataShortAbove=58564]="FermataShortAbove",n[n.FermataLongAbove=58566]="FermataLongAbove",n[n.RestLonga=58593]="RestLonga",n[n.RestDoubleWhole=58594]="RestDoubleWhole",n[n.RestWhole=58595]="RestWhole",n[n.RestHalf=58596]="RestHalf",n[n.RestQuarter=58597]="RestQuarter",n[n.RestEighth=58598]="RestEighth",n[n.RestSixteenth=58599]="RestSixteenth",n[n.RestThirtySecond=58600]="RestThirtySecond",n[n.RestSixtyFourth=58601]="RestSixtyFourth",n[n.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",n[n.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",n[n.RestHBarLeft=58607]="RestHBarLeft",n[n.RestHBarMiddle=58608]="RestHBarMiddle",n[n.RestHBarRight=58609]="RestHBarRight",n[n.Repeat1Bar=58624]="Repeat1Bar",n[n.Repeat2Bars=58625]="Repeat2Bars",n[n.Ottava=58640]="Ottava",n[n.OttavaAlta=58641]="OttavaAlta",n[n.OttavaBassaVb=58652]="OttavaBassaVb",n[n.Quindicesima=58644]="Quindicesima",n[n.QuindicesimaAlta=58645]="QuindicesimaAlta",n[n.DynamicPPPPPP=58663]="DynamicPPPPPP",n[n.DynamicPPPPP=58664]="DynamicPPPPP",n[n.DynamicPPPP=58665]="DynamicPPPP",n[n.DynamicPPP=58666]="DynamicPPP",n[n.DynamicPP=58667]="DynamicPP",n[n.DynamicPiano=58656]="DynamicPiano",n[n.DynamicMP=58668]="DynamicMP",n[n.DynamicMF=58669]="DynamicMF",n[n.DynamicPF=58670]="DynamicPF",n[n.DynamicForte=58658]="DynamicForte",n[n.DynamicFF=58671]="DynamicFF",n[n.DynamicFFF=58672]="DynamicFFF",n[n.DynamicFFFF=58673]="DynamicFFFF",n[n.DynamicFFFFF=58674]="DynamicFFFFF",n[n.DynamicFFFFFF=58675]="DynamicFFFFFF",n[n.DynamicFortePiano=58676]="DynamicFortePiano",n[n.DynamicNiente=58662]="DynamicNiente",n[n.DynamicSforzando1=58678]="DynamicSforzando1",n[n.DynamicSforzandoPiano=58679]="DynamicSforzandoPiano",n[n.DynamicSforzandoPianissimo=58680]="DynamicSforzandoPianissimo",n[n.DynamicSforzato=58681]="DynamicSforzato",n[n.DynamicSforzatoPiano=58682]="DynamicSforzatoPiano",n[n.DynamicSforzatoFF=58683]="DynamicSforzatoFF",n[n.DynamicRinforzando1=58684]="DynamicRinforzando1",n[n.DynamicRinforzando2=58685]="DynamicRinforzando2",n[n.DynamicForzando=58677]="DynamicForzando",n[n.OrnamentTrill=58726]="OrnamentTrill",n[n.OrnamentTurn=58727]="OrnamentTurn",n[n.OrnamentTurnInverted=58728]="OrnamentTurnInverted",n[n.OrnamentShortTrill=58732]="OrnamentShortTrill",n[n.OrnamentMordent=58733]="OrnamentMordent",n[n.StringsDownBow=58896]="StringsDownBow",n[n.StringsUpBow=58898]="StringsUpBow",n[n.KeyboardPedalPed=58960]="KeyboardPedalPed",n[n.KeyboardPedalUp=58965]="KeyboardPedalUp",n[n.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",n[n.GuitarString0=59443]="GuitarString0",n[n.GuitarString1=59444]="GuitarString1",n[n.GuitarString2=59445]="GuitarString2",n[n.GuitarString3=59446]="GuitarString3",n[n.GuitarString4=59447]="GuitarString4",n[n.GuitarString5=59448]="GuitarString5",n[n.GuitarString6=59449]="GuitarString6",n[n.GuitarString7=59450]="GuitarString7",n[n.GuitarString8=59451]="GuitarString8",n[n.GuitarString9=59452]="GuitarString9",n[n.GuitarOpenPedal=59453]="GuitarOpenPedal",n[n.GuitarClosePedal=59455]="GuitarClosePedal",n[n.GuitarGolpe=59458]="GuitarGolpe",n[n.GuitarFadeIn=59459]="GuitarFadeIn",n[n.GuitarFadeOut=59460]="GuitarFadeOut",n[n.GuitarVolumeSwell=59461]="GuitarVolumeSwell",n[n.FretboardX=59481]="FretboardX",n[n.FretboardO=59482]="FretboardO",n[n.WiggleTrill=60068]="WiggleTrill",n[n.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",n[n.OctaveBaselineM=60565]="OctaveBaselineM",n[n.OctaveBaselineB=60563]="OctaveBaselineB",n}(d||{}),K=function(n){return n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right",n}(K||{}),ge=function(n){return n[n.Top=0]="Top",n[n.Middle=1]="Middle",n[n.Bottom=2]="Bottom",n}(ge||{});class Eh{constructor(t,e){this.width=t,this.height=e}}class q{constructor(t="",e=0,i=0,s=d.None,r=d.None,a=d.None,o=d.None,l=ge.Middle){this.elementType=t,this.outputMidiNumber=i,this.staffLine=e,this.noteHeadDefault=s,this.noteHeadHalf=r!==d.None?r:s,this.noteHeadWhole=a!==d.None?a:s,this.techniqueSymbol=o,this.techniqueSymbolPlacement=l}getSymbol(t){switch(t){case w.Whole:return this.noteHeadWhole;case w.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class nn{static articulationFromElementVariation(t,e){return t<nn.gp6ElementAndVariationToArticulation.length?(e>=nn.gp6ElementAndVariationToArticulation.length&&(e=0),nn.gp6ElementAndVariationToArticulation[t][e]):38}static getArticulation(t){const e=t.percussionArticulation;if(e<0)return null;const i=t.beat.voice.bar.staff.track.percussionArticulations;return e<i.length?i[e]:nn.getArticulationByInputMidiNumber(e)}static getElementAndVariation(t){const e=nn.getArticulation(t);if(!e)return[-1,-1];for(let i=0;i<nn.gp6ElementAndVariationToArticulation.length;i++){const s=nn.gp6ElementAndVariationToArticulation[i];for(let r=0;r<s.length;r++)if(nn.getArticulationByInputMidiNumber(s[r])?.outputMidiNumber===e.outputMidiNumber)return[i,r]}return[-1,-1]}static getArticulationByInputMidiNumber(t){return nn.instrumentArticulations.has(t)?nn.instrumentArticulations.get(t):null}}nn.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]],nn.instrumentArticulations=new Map([[38,new q("snare",3,38,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[37,new q("snare",3,37,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[91,new q("snare",3,38,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite)],[42,new q("hiHat",-1,42,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[92,new q("hiHat",-1,46,d.NoteheadCircleSlash,d.NoteheadCircleSlash,d.NoteheadCircleSlash)],[46,new q("hiHat",-1,46,d.NoteheadCircleX,d.NoteheadCircleX,d.NoteheadCircleX)],[44,new q("hiHat",9,44,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[35,new q("kickDrum",8,35,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[36,new q("kickDrum",7,36,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[50,new q("tom",1,50,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[48,new q("tom",2,48,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[47,new q("tom",4,47,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[45,new q("tom",5,45,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[43,new q("tom",6,43,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[93,new q("ride",0,51,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.PictEdgeOfCymbal,ge.Bottom)],[51,new q("ride",0,51,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[53,new q("ride",0,53,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite)],[94,new q("ride",0,51,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.ArticStaccatoAbove,ge.Top)],[55,new q("splash",-2,55,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[95,new q("splash",-2,55,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.ArticStaccatoAbove,ge.Bottom)],[52,new q("china",-3,52,d.NoteheadHeavyXHat,d.NoteheadHeavyXHat,d.NoteheadHeavyXHat)],[96,new q("china",-3,52,d.NoteheadHeavyXHat,d.NoteheadHeavyXHat,d.NoteheadHeavyXHat)],[49,new q("crash",-2,49,d.NoteheadHeavyX,d.NoteheadHeavyX,d.NoteheadHeavyX)],[97,new q("crash",-2,49,d.NoteheadHeavyX,d.NoteheadHeavyX,d.NoteheadHeavyX,d.ArticStaccatoAbove,ge.Bottom)],[57,new q("crash",-1,57,d.NoteheadHeavyX,d.NoteheadHeavyX,d.NoteheadHeavyX)],[98,new q("crash",-1,57,d.NoteheadHeavyX,d.NoteheadHeavyX,d.NoteheadHeavyX,d.ArticStaccatoAbove,ge.Bottom)],[99,new q("cowbell",1,56,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpHalf,d.NoteheadTriangleUpWhole)],[100,new q("cowbell",1,56,d.NoteheadXBlack,d.NoteheadXHalf,d.NoteheadXWhole)],[56,new q("cowbell",0,56,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpHalf,d.NoteheadTriangleUpWhole)],[101,new q("cowbell",0,56,d.NoteheadXBlack,d.NoteheadXHalf,d.NoteheadXWhole)],[102,new q("cowbell",-1,56,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpHalf,d.NoteheadTriangleUpWhole)],[103,new q("cowbell",-1,56,d.NoteheadXBlack,d.NoteheadXHalf,d.NoteheadXWhole)],[77,new q("woodblock",-9,77,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack)],[76,new q("woodblock",-10,76,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack)],[60,new q("bongo",-4,60,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[104,new q("bongo",-5,60,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.NoteheadParenthesis,ge.Middle)],[105,new q("bongo",-6,60,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[61,new q("bongo",-7,61,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[106,new q("bongo",-8,61,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.NoteheadParenthesis,ge.Middle)],[107,new q("bongo",-16,61,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[66,new q("timbale",10,66,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[65,new q("timbale",9,65,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[68,new q("agogo",12,68,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[67,new q("agogo",11,67,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[64,new q("conga",17,64,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[108,new q("conga",16,64,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[109,new q("conga",15,64,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.NoteheadParenthesis,ge.Middle)],[63,new q("conga",14,63,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[110,new q("conga",13,63,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[62,new q("conga",19,62,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.NoteheadParenthesis,ge.Middle)],[72,new q("whistle",-11,72,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[71,new q("whistle",-17,71,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[73,new q("guiro",38,73,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[74,new q("guiro",37,74,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[86,new q("surdo",36,86,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[87,new q("surdo",35,87,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadParenthesis,ge.Middle)],[54,new q("tambourine",3,54,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack)],[111,new q("tambourine",2,54,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.StringsUpBow,ge.Bottom)],[112,new q("tambourine",1,54,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.NoteheadTriangleUpBlack,d.StringsDownBow,ge.Bottom)],[113,new q("tambourine",-7,54,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[79,new q("cuica",30,79,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[78,new q("cuica",29,78,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[58,new q("vibraslap",28,58,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[81,new q("triangle",27,81,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[80,new q("triangle",26,80,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadParenthesis,ge.Middle)],[114,new q("grancassa",25,43,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[115,new q("piatti",18,49,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[116,new q("piatti",24,49,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[69,new q("cabasa",23,69,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[117,new q("cabasa",22,69,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.StringsUpBow,ge.Bottom)],[85,new q("castanets",21,85,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[75,new q("claves",20,75,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[70,new q("maraca",-12,70,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[118,new q("maraca",-13,70,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.StringsUpBow,ge.Bottom)],[119,new q("maraca",-14,70,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[120,new q("maraca",-15,70,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.StringsUpBow,ge.Bottom)],[82,new q("shaker",-23,54,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[122,new q("shaker",-24,54,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.StringsUpBow,ge.Bottom)],[84,new q("bellTree",-18,53,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[123,new q("bellTree",-19,53,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole,d.StringsUpBow,ge.Bottom)],[83,new q("jingleBell",-20,53,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[124,new q("unpitched",-21,62,d.NoteheadNull,d.NoteheadNull,d.NoteheadNull,d.GuitarGolpe,ge.Top)],[125,new q("unpitched",-22,62,d.NoteheadNull,d.NoteheadNull,d.NoteheadNull,d.GuitarGolpe,ge.Bottom)],[39,new q("handClap",3,39,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[40,new q("snare",3,40,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[31,new q("snare",3,40,d.NoteheadSlashedBlack2,d.NoteheadSlashedBlack2,d.NoteheadSlashedBlack2)],[41,new q("tom",5,41,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole)],[59,new q("ride",2,59,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.PictEdgeOfCymbal,ge.Bottom)],[126,new q("ride",2,59,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[127,new q("ride",2,59,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite,d.NoteheadDiamondWhite)],[29,new q("ride",2,59,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack,d.ArticStaccatoAbove,ge.Top)],[30,new q("crash",-3,49,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[33,new q("snare",3,37,d.NoteheadXBlack,d.NoteheadXBlack,d.NoteheadXBlack)],[34,new q("snare",3,38,d.NoteheadBlack,d.NoteheadBlack,d.NoteheadBlack)]]),nn.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);var Vt=function(n){return n[n.None=0]="None",n[n.InvertedTurn=1]="InvertedTurn",n[n.Turn=2]="Turn",n[n.UpperMordent=3]="UpperMordent",n[n.LowerMordent=4]="LowerMordent",n}(Vt||{});class Ga{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1,this.slideTargetNoteId=-1,this.slideOriginNoteId=-1}}var si=function(n){return n[n.Effects=0]="Effects",n[n.StandardNotationNoteHead=1]="StandardNotationNoteHead",n[n.StandardNotationAccidentals=2]="StandardNotationAccidentals",n[n.StandardNotationEffects=3]="StandardNotationEffects",n[n.GuitarTabFretNumber=4]="GuitarTabFretNumber",n[n.GuitarTabEffects=5]="GuitarTabEffects",n[n.SlashNoteHead=6]="SlashNoteHead",n[n.SlashEffects=7]="SlashEffects",n[n.NumberedNumber=8]="NumberedNumber",n[n.NumberedAccidentals=9]="NumberedAccidentals",n[n.NumberedEffects=10]="NumberedEffects",n}(si||{});class SS extends Ro{}let is=(()=>{class n{constructor(){this.id=n.GlobalNoteId++,this.index=0,this.accentuated=Ot.None,this.bendType=J.None,this.bendStyle=ct.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.showStringNumber=!1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=ae.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=pn.None,this.slideOutType=Se.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=Ie.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=se.Unknown,this.rightHandFinger=se.Unknown,this.trillValue=-1,this.trillSpeed=w.ThirtySecond,this.durationPercent=1,this.accidentalMode=ke.Default,this.dynamics=ie.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.ornament=Vt.None,this._noteIdBag=null}static resetIds(){n.GlobalNoteId=0}get hasBend(){return null!==this.bendPoints&&this.bendType!==J.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?nn.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?nn.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==ae.None}get isTieOrigin(){return null!==this.tieDestination}get isFingering(){return this.leftHandFinger!==se.Unknown||this.rightHandFinger!==se.Unknown}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+n.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,i){return e.tuning.length>0?e.tuning[e.tuning.length-(i-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,i){const s=e?this.beat.voice.bar.staff.transpositionPitch:0;if(i){let r=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===ae.Natural?r=this.harmonicPitch+this.stringTuning-s:r+=this.harmonicPitch),r}return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-s:this.isPiano?12*this.octave+this.tone-s:0}get harmonicPitch(){if(this.harmonicType===ae.None||!this.isStringed)return 0;const e=this.harmonicValue;return H.isAlmostEqualTo(e,2.4)?36:H.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==ae.Natural&&this.harmonicType!==ae.None&&(e-=this.harmonicPitch),this.beat.ottava){case we._15ma:e-=24;break;case we._8va:e-=12;break;case we.Regular:break;case we._8vb:e+=12;break;case we._15mb:e+=24}switch(this.beat.voice.bar.clefOttava){case we._15ma:e-=24;break;case we._8va:e-=12;break;case we.Regular:break;case we._8vb:e+=12;break;case we._15mb:e+=24}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!=0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!=0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!=0:!!this.beat.isContinuedWhammy&&this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!=0}addBendPoint(e){let i=this.bendPoints;null===i&&(i=[],this.bendPoints=i),i.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===J.None&&(this.bendType=J.Custom)}finish(e,i=null){const s=new cg(()=>n.nextNoteOnSameLine(this)),r=e&&e.notation.notationMode===_n.SongBook;if(this.isTieDestination&&(this.chain(i),r&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(this.letRingDestination=s.value&&s.value.isLetRing?s.value:this,r&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(this.palmMuteDestination=s.value&&s.value.isPalmMute?s.value:this),this.isHammerPullOrigin){const c=n.findHammerPullDestination(this);c?(this.hammerPullDestination=c,c.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case Se.Shift:case Se.Legato:this.slideTarget||(this.slideTarget=s.value),this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=Se.None}let a=null;this.isHammerPullOrigin&&this.hammerPullDestination?a=this.hammerPullDestination:this.slideOutType===Se.Legato&&this.slideTarget&&(a=this.slideTarget),a&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===vn.None?(this.effectSlurOrigin.effectSlurDestination=a,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=a,this.effectSlurDestination.effectSlurOrigin=this));const o=this.bendPoints,l=null!=o&&o.length>0;if(l?this.isContinuedBend=this.isTieDestination&&this.tieOrigin.hasBend:this.bendType=J.None,l&&this.bendType===J.Custom)if(4===o.length){const c=o[0],u=o[1],f=o[3];u.value===o[2].value?f.value>c.value?u.value>f.value?this.bendType=J.BendRelease:!this.isContinuedBend&&c.value>0?(this.bendType=J.PrebendBend,o.splice(2,1),o.splice(1,1)):(this.bendType=J.Bend,o.splice(2,1),o.splice(1,1)):f.value<c.value?this.isContinuedBend?(this.bendType=J.Release,o.splice(2,1),o.splice(1,1)):(this.bendType=J.PrebendRelease,o.splice(2,1),o.splice(1,1)):u.value>c.value?this.bendType=J.BendRelease:c.value>0&&!this.isContinuedBend?(this.bendType=J.Prebend,o.splice(2,1),o.splice(1,1)):(this.bendType=J.Hold,o.splice(2,1),o.splice(1,1)):x.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(2===o.length){const c=o[0],u=o[1];this.bendType=u.value>c.value?!this.isContinuedBend&&c.value>0?J.PrebendBend:J.Bend:u.value<c.value?this.isContinuedBend?J.Release:J.PrebendRelease:c.value>0&&!this.isContinuedBend?J.Prebend:J.Hold}this.initialBendValue>0&&(this.accidentalMode=ke.Default)}static nextNoteOnSameLine(e){let i=e.beat.nextBeat;for(;i&&i.voice.bar.index<=e.beat.voice.bar.index+n.MaxOffsetForSameLineSearch;){const s=i.getNoteOnString(e.string);if(s)return s;i=i.nextBeat}return null}static findHammerPullDestination(e){let i=e.beat.nextBeat;for(;i&&i.voice.bar.index<=e.beat.voice.bar.index+n.MaxOffsetForSameLineSearch;){let s=i.getNoteOnString(e.string);if(s)return s;for(let r=e.string;r>0;r--)if(s=i.getNoteOnString(r),s){if(s.isLeftHandTapped)return s;break}for(let r=e.string;r<=e.beat.voice.bar.staff.tuning.length;r++)if(s=i.getNoteOnString(r),s){if(s.isLeftHandTapped)return s;break}i=i.nextBeat}return null}static findTieOrigin(e){let i=e.beat.previousBeat;for(;i&&i.voice.bar.index>=e.beat.voice.bar.index-n.MaxOffsetForSameLineSearch;){if(e.isStringed){const s=i.getNoteOnString(e.string);if(s)return s}else if(-1===e.octave&&-1===e.tone){if(e.index<i.notes.length)return i.notes[e.index]}else{const s=i.getNoteWithRealValue(e.realValue);if(s)return s}i=i.previousBeat}return null}chain(e=null){if(null!==e)if(null!==this._noteIdBag){let i;e.has(n.NoteIdLookupKey)?i=e.get(n.NoteIdLookupKey):(i=new Map,e.set(n.NoteIdLookupKey,i)),(-1!==this._noteIdBag.hammerPullDestinationNoteId||-1!==this._noteIdBag.tieDestinationNoteId||-1!==this._noteIdBag.slurDestinationNoteId||-1!==this._noteIdBag.slideTargetNoteId)&&i.set(this.id,this),-1!==this._noteIdBag.hammerPullOriginNoteId&&(this.hammerPullOrigin=i.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),-1!==this._noteIdBag.tieOriginNoteId&&(this.tieOrigin=i.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),-1!==this._noteIdBag.slurOriginNoteId&&(this.slurOrigin=i.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),-1!==this._noteIdBag.slideOriginNoteId&&(this.slideOrigin=i.get(this._noteIdBag.slideOriginNoteId),this.slideOrigin.slideTarget=this),this._noteIdBag=null}else{if(!this.isTieDestination&&null===this.tieOrigin)return;const i=this.tieOrigin??n.findTieOrigin(this);i?(i.tieDestination=this,this.tieOrigin=i,this.fret=i.fret,this.octave=i.octave,this.tone=i.tone,i.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){null!==this.tieDestination&&e.set("tiedestinationnoteid",this.tieDestination.id),null!==this.tieOrigin&&e.set("tieoriginnoteid",this.tieOrigin.id),null!==this.slurDestination&&e.set("slurdestinationnoteid",this.slurDestination.id),null!==this.slurOrigin&&e.set("sluroriginnoteid",this.slurOrigin.id),null!==this.hammerPullOrigin&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),null!==this.hammerPullDestination&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id),null!==this.slideTarget&&e.set("slidetargetnoteid",this.slideTarget.id),null!==this.slideOrigin&&e.set("slideoriginnoteid",this.slideOrigin.id)}setProperty(e,i){switch(e){case"tiedestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.tieDestinationNoteId=i,!0;case"tieoriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.tieOriginNoteId=i,!0;case"slurdestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.slurDestinationNoteId=i,!0;case"sluroriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.slurOriginNoteId=i,!0;case"hammerpulloriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.hammerPullOriginNoteId=i,!0;case"hammerpulldestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.hammerPullDestinationNoteId=i,!0;case"slidetargetnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.slideTargetNoteId=i,!0;case"slideoriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new Ga),this._noteIdBag.slideOriginNoteId=i,!0}return!1}}return n.GlobalNoteId=0,n.MaxOffsetForSameLineSearch=3,n.NoteIdLookupKey="NoteIdLookup",n})();class On{constructor(t){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=t}check(t){if(0===this.beats.length)return this.beats.push(t),this.totalDuration+=t.playbackDuration,!0;if(t.graceType!==re.None)return!0;if(t.voice!==this.voice||this.isFull||t.tupletNumerator!==this.beats[0].tupletNumerator||t.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(t.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(t),this.totalDuration+=t.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{const e=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(const i of On.AllTicks)if(this.totalDuration===i*e){this.isFull=!0;break}}return!0}}On.HalfTicks=1920,On.QuarterTicks=960,On.EighthTicks=480,On.SixteenthTicks=240,On.ThirtySecondTicks=120,On.SixtyFourthTicks=60,On.OneHundredTwentyEighthTicks=30,On.TwoHundredFiftySixthTicks=15,On.AllTicks=[On.HalfTicks,On.QuarterTicks,On.EighthTicks,On.SixteenthTicks,On.ThirtySecondTicks,On.SixtyFourthTicks,On.OneHundredTwentyEighthTicks,On.TwoHundredFiftySixthTicks];var Re=function(n){return n[n.None=0]="None",n[n.Custom=1]="Custom",n[n.Dive=2]="Dive",n[n.Dip=3]="Dip",n[n.Hold=4]="Hold",n[n.Predive=5]="Predive",n[n.PrediveDive=6]="PrediveDive",n}(Re||{});class bI{static clone(t){const e=new V;return e.offset=t.offset,e.value=t.value,e}}class wI{static clone(t){const e=new is;if(e.index=t.index,e.accentuated=t.accentuated,e.bendType=t.bendType,e.bendStyle=t.bendStyle,e.isContinuedBend=t.isContinuedBend,t.bendPoints){e.bendPoints=[];for(const i of t.bendPoints)e.addBendPoint(bI.clone(i))}return e.fret=t.fret,e.string=t.string,e.showStringNumber=t.showStringNumber,e.octave=t.octave,e.tone=t.tone,e.percussionArticulation=t.percussionArticulation,e.isVisible=t.isVisible,e.isLeftHandTapped=t.isLeftHandTapped,e.isHammerPullOrigin=t.isHammerPullOrigin,e.isSlurDestination=t.isSlurDestination,e.harmonicType=t.harmonicType,e.harmonicValue=t.harmonicValue,e.isGhost=t.isGhost,e.isLetRing=t.isLetRing,e.isPalmMute=t.isPalmMute,e.isDead=t.isDead,e.isStaccato=t.isStaccato,e.slideInType=t.slideInType,e.slideOutType=t.slideOutType,e.vibrato=t.vibrato,e.isTieDestination=t.isTieDestination,e.leftHandFinger=t.leftHandFinger,e.rightHandFinger=t.rightHandFinger,e.trillValue=t.trillValue,e.trillSpeed=t.trillSpeed,e.durationPercent=t.durationPercent,e.accidentalMode=t.accidentalMode,e.dynamics=t.dynamics,e.ornament=t.ornament,e}}class U${static clone(t){const e=new Xt;return e.isLinear=t.isLinear,e.type=t.type,e.value=t.value,e.ratioPosition=t.ratioPosition,e.text=t.text,e}}class _S{static clone(t){const e=new Vn;e.index=t.index,e.notes=[];for(const i of t.notes)e.addNote(wI.clone(i));e.isEmpty=t.isEmpty,e.whammyStyle=t.whammyStyle,e.ottava=t.ottava,e.isLegatoOrigin=t.isLegatoOrigin,e.duration=t.duration,e.isLetRing=t.isLetRing,e.isPalmMute=t.isPalmMute,e.automations=[];for(const i of t.automations)e.automations.push(U$.clone(i));if(e.dots=t.dots,e.fade=t.fade,e.lyrics=t.lyrics?t.lyrics.slice():null,e.pop=t.pop,e.slap=t.slap,e.tap=t.tap,e.text=t.text,e.slashed=t.slashed,e.deadSlapped=t.deadSlapped,e.brushType=t.brushType,e.brushDuration=t.brushDuration,e.tupletDenominator=t.tupletDenominator,e.tupletNumerator=t.tupletNumerator,e.isContinuedWhammy=t.isContinuedWhammy,e.whammyBarType=t.whammyBarType,t.whammyBarPoints){e.whammyBarPoints=[];for(const i of t.whammyBarPoints)e.addWhammyBarPoint(bI.clone(i))}return e.vibrato=t.vibrato,e.chordId=t.chordId,e.graceType=t.graceType,e.pickStroke=t.pickStroke,e.tremoloSpeed=t.tremoloSpeed,e.crescendo=t.crescendo,e.displayStart=t.displayStart,e.playbackStart=t.playbackStart,e.displayDuration=t.displayDuration,e.playbackDuration=t.playbackDuration,e.overrideDisplayDuration=t.overrideDisplayDuration,e.golpe=t.golpe,e.dynamics=t.dynamics,e.invertBeamDirection=t.invertBeamDirection,e.preferredBeamDirection=t.preferredBeamDirection,e.isEffectSlurOrigin=t.isEffectSlurOrigin,e.beamingMode=t.beamingMode,e.wahPedal=t.wahPedal,e.barreFret=t.barreFret,e.barreShape=t.barreShape,e.rasgueado=t.rasgueado,e.showTimer=t.showTimer,e.timer=t.timer,e}}var Ci=function(n){return n[n.None=0]="None",n[n.Thumb=1]="Thumb",n[n.Finger=2]="Finger",n}(Ci||{}),un=function(n){return n[n.None=0]="None",n[n.FadeIn=1]="FadeIn",n[n.FadeOut=2]="FadeOut",n[n.VolumeSwell=3]="VolumeSwell",n}(un||{}),Li=function(n){return n[n.None=0]="None",n[n.Open=1]="Open",n[n.Closed=2]="Closed",n}(Li||{}),Ri=function(n){return n[n.None=0]="None",n[n.Full=1]="Full",n[n.Half=2]="Half",n}(Ri||{}),X=function(n){return n[n.None=0]="None",n[n.Ii=1]="Ii",n[n.Mi=2]="Mi",n[n.MiiTriplet=3]="MiiTriplet",n[n.MiiAnapaest=4]="MiiAnapaest",n[n.PmpTriplet=5]="PmpTriplet",n[n.PmpAnapaest=6]="PmpAnapaest",n[n.PeiTriplet=7]="PeiTriplet",n[n.PeiAnapaest=8]="PeiAnapaest",n[n.PaiTriplet=9]="PaiTriplet",n[n.PaiAnapaest=10]="PaiAnapaest",n[n.AmiTriplet=11]="AmiTriplet",n[n.AmiAnapaest=12]="AmiAnapaest",n[n.Ppp=13]="Ppp",n[n.Amii=14]="Amii",n[n.Amip=15]="Amip",n[n.Eami=16]="Eami",n[n.Eamii=17]="Eamii",n[n.Peami=18]="Peami",n}(X||{}),St=function(n){return n[n.Auto=0]="Auto",n[n.ForceSplitToNext=1]="ForceSplitToNext",n[n.ForceMergeWithNext=2]="ForceMergeWithNext",n[n.ForceSplitOnSecondaryToNext=3]="ForceSplitOnSecondaryToNext",n}(St||{}),ht=function(n){return n[n.Effects=0]="Effects",n[n.StandardNotationStem=1]="StandardNotationStem",n[n.StandardNotationFlags=2]="StandardNotationFlags",n[n.StandardNotationBeams=3]="StandardNotationBeams",n[n.StandardNotationTuplet=4]="StandardNotationTuplet",n[n.StandardNotationEffects=5]="StandardNotationEffects",n[n.StandardNotationRests=6]="StandardNotationRests",n[n.GuitarTabStem=7]="GuitarTabStem",n[n.GuitarTabFlags=8]="GuitarTabFlags",n[n.GuitarTabBeams=9]="GuitarTabBeams",n[n.GuitarTabTuplet=10]="GuitarTabTuplet",n[n.GuitarTabEffects=11]="GuitarTabEffects",n[n.GuitarTabRests=12]="GuitarTabRests",n[n.SlashStem=13]="SlashStem",n[n.SlashFlags=14]="SlashFlags",n[n.SlashBeams=15]="SlashBeams",n[n.SlashTuplet=16]="SlashTuplet",n[n.SlashRests=17]="SlashRests",n[n.SlashEffects=18]="SlashEffects",n[n.NumberedDuration=19]="NumberedDuration",n[n.NumberedEffects=20]="NumberedEffects",n[n.NumberedRests=21]="NumberedRests",n[n.NumberedTuplet=22]="NumberedTuplet",n}(ht||{});class SI extends Ro{}let Vn=(()=>{class n{constructor(){this.id=n._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=ct.Default,this.ottava=we.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=w.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fade=un.None,this.lyrics=null,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.slashed=!1,this.deadSlapped=!1,this.brushType=Y.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=Re.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=Ie.None,this.chordId=null,this.graceType=re.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=vn.None,this.tremoloSpeed=null,this.crescendo=ii.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.golpe=Ci.None,this.dynamics=ie.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=St.Auto,this.wahPedal=Li.None,this.barreFret=-1,this.barreShape=Ri.None,this.rasgueado=X.None,this.showTimer=!1,this.timer=null}static resetIds(){n._globalBeatId=0}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||!this.deadSlapped&&0===this.notes.length}get isFullBarRest(){return this.isRest&&1===this.voice.beats.length&&this.duration===w.Whole}get fadeIn(){return this.fade===un.FadeIn}set fadeIn(e){this.fade=e?un.FadeIn:un.None}get hasRasgueado(){return this.rasgueado!==X.None}get hasTuplet(){return!(-1===this.tupletDenominator&&-1===this.tupletNumerator||1===this.tupletDenominator&&1===this.tupletNumerator)}get hasWhammyBar(){return null!==this.whammyBarPoints&&this.whammyBarType!==Re.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get displayEnd(){return this.displayStart+this.displayDuration}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get isBarre(){return this.barreShape!==Ri.None&&this.barreFret>=0}addWhammyBarPoint(e){let i=this.whammyBarPoints;null===i&&(i=[],this.whammyBarPoints=i),i.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===Re.None&&(this.whammyBarType=Re.Custom)}removeWhammyBarPoint(e){const i=this.whammyBarPoints;if(null===i||e<0||e>=i.length)return;i.splice(e,1);const s=i[e];if(s===this.maxWhammyPoint){this.maxWhammyPoint=null;for(const r of i)(!this.maxWhammyPoint||r.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=r)}if(s===this.minWhammyPoint){this.minWhammyPoint=null;for(const r of i)(!this.minWhammyPoint||r.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=r)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){const i=this.notes.indexOf(e);i>=0&&(this.notes.splice(i,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let i=0,s=this.automations.length;i<s;i++){const r=this.automations[i];if(r.type===e)return r}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}calculateDuration(){if(void 0!==this.overrideDisplayDuration)return this.overrideDisplayDuration;if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=P.toTicks(this.duration);return 2===this.dots?e=P.applyDot(e,!0):1===this.dots&&(e=P.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=P.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){const e=this.calculateDuration();switch(this.playbackDuration=e,this.graceType){case re.BeforeBeat:case re.OnBeat:switch(this.duration){case w.Sixteenth:this.playbackDuration=P.toTicks(w.SixtyFourth);break;case w.ThirtySecond:this.playbackDuration=P.toTicks(w.OneHundredTwentyEighth);break;default:this.playbackDuration=P.toTicks(w.ThirtySecond)}this.displayDuration=0;break;case re.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;const i=this.previousBeat;i&&i.graceType===re.BendGrace&&(this.playbackDuration=i.playbackDuration)}}finishTuplet(){const e=this.previousBeat;let i=e?e.tupletGroup:null;if((this.hasTuplet||this.graceType!==re.None&&i)&&((!e||!i||!i.check(this))&&(i=new On(this.voice),i.check(this)),this.tupletGroup=i),this.index>0){const s=this.voice.bar.masterBar.calculateDuration(),r=[];for(const a of this.automations)0===a.ratioPosition&&(a.ratioPosition=this.playbackStart/s),a.type!==Bt.Volume&&r.push(a);this.automations=r}}finish(e,i=null){switch(null===this.getAutomation(Bt.Instrument)&&0===this.index&&0===this.voice.index&&0===this.voice.bar.index&&0===this.voice.bar.staff.index&&this.automations.push(Xt.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case re.OnBeat:case re.BeforeBeat:const h=this.graceGroup.beats.length;this.duration=1===h?w.Eighth:2===h?w.Sixteenth:w.ThirtySecond}const s=e?e.notation.notationMode:_n.GuitarPro;let r="grad"===this.text||"grad."===this.text;r&&s===_n.SongBook&&(this.text="");let a=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let o=0,l=!1;for(let h=0,f=this.notes.length;h<f;h++){const p=this.notes[h];if(p.dynamics=this.dynamics,p.finish(e,i),p.isLetRing&&(this.isLetRing=!0),p.isPalmMute&&(this.isPalmMute=!0),s===_n.SongBook&&p.hasBend&&this.graceType!==re.BendGrace){if(!p.isTieOrigin)switch(p.bendType){case J.Bend:case J.PrebendRelease:case J.PrebendBend:a=!0}r||p.bendStyle===ct.Gradual?(r=!0,p.bendStyle=ct.Gradual,a=!1):p.bendStyle=ct.Fast}p.isVisible&&(o++,(!this.minNote||p.realValue<this.minNote.realValue)&&(this.minNote=p),(!this.maxNote||p.realValue>this.maxNote.realValue)&&(this.maxNote=p),(!this.minStringNote||p.string<this.minStringNote.string)&&(this.minStringNote=p),(!this.maxStringNote||p.string>this.maxStringNote.string)&&(this.maxStringNote=p),p.hasEffectSlur&&(l=!0))}if(l&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&0===o&&(this.isEmpty=!0),this.isRest||this.isLetRing&&this.isPalmMute)this.isRest&&this.previousBeat&&e&&e.notation.notationMode===_n.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));else{let h=this.previousBeat;for(;h&&h.isRest;)this.isLetRing||(h.isLetRing=!1),this.isPalmMute||(h.isPalmMute=!1),h=h.previousBeat}const c=this.whammyBarPoints,u=null!==c&&c.length>0;if(u?this.isContinuedWhammy=!!this.previousBeat&&this.previousBeat.hasWhammyBar:this.whammyBarType=Re.None,u&&this.whammyBarType===Re.Custom&&(s===_n.SongBook&&(this.whammyStyle=r?ct.Gradual:ct.Fast),4===c.length)){const h=c[0],f=c[1],p=c[2],g=c[3];f.value===p.value&&(h.value<f.value&&f.value<g.value||h.value>f.value&&f.value>g.value?(this.whammyBarType=0===h.value||this.isContinuedWhammy?Re.Dive:Re.PrediveDive,c.splice(2,1),c.splice(1,1)):h.value>f.value&&f.value<g.value||h.value<f.value&&f.value>g.value?(this.whammyBarType=Re.Dip,(f.offset===p.offset||s===_n.SongBook)&&c.splice(2,1)):h.value===f.value&&f.value===g.value&&(this.whammyBarType=0===h.value||this.isContinuedWhammy?Re.Hold:Re.Predive,c.splice(2,1),c.splice(1,1)))}if(this.updateDurations(),a){const h=_S.clone(this);h.id=n._globalBeatId++,h.pickStroke=vn.None;for(let f=0,p=h.notes.length;f<p;f++){const g=h.notes[f],m=this.notes[f];if(g.bendType=J.None,g.maxBendPoint=null,g.bendPoints=null,g.bendStyle=ct.Default,g.id=is.GlobalNoteId++,m.isTieOrigin&&(g.tieDestination=m.tieDestination,m.tieDestination.tieOrigin=g),m.isTieDestination&&(g.tieOrigin=m.tieOrigin?m.tieOrigin:null,m.tieOrigin.tieDestination=g),m.hasBend&&m.isTieOrigin){const y=is.findTieOrigin(m);if(y&&y.hasBend){g.bendType=J.Hold;const b=m.bendPoints[m.bendPoints.length-1];g.addBendPoint(new V(0,b.value)),g.addBendPoint(new V(V.MaxPosition,b.value))}}g.isTieDestination=!0}this.graceType=re.BendGrace,this.graceGroup=new ug,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,h),h.graceGroup=new ug,h.graceGroup.addBeat(this),h.graceGroup.isComplete=!0,h.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const i of this.notes)this.noteValueLookup.set(i.realValue,i),i.chain(e)}}return n._globalBeatId=0,n})();var U=function(n){return n[n.Title=0]="Title",n[n.SubTitle=1]="SubTitle",n[n.Artist=2]="Artist",n[n.Album=3]="Album",n[n.Words=4]="Words",n[n.Music=5]="Music",n[n.WordsAndMusic=6]="WordsAndMusic",n[n.Transcriber=7]="Transcriber",n[n.Copyright=8]="Copyright",n[n.CopyrightSecondLine=9]="CopyrightSecondLine",n[n.ChordDiagramList=10]="ChordDiagramList",n}(U||{});let gs=(()=>{class n{constructor(e="",i=void 0,s=K.Left){this.template=e,this.isVisible=i,this.textAlign=s}buildText(e){let i=!1,s=!1;const r=this.template.replace(n.PlaceholderPattern,(a,o)=>{s=!0;let l="";switch(o){case"TITLE":l=e.title;break;case"SUBTITLE":l=e.subTitle;break;case"ARTIST":l=e.artist;break;case"ALBUM":l=e.album;break;case"WORDS":case"WORDSMUSIC":l=e.words;break;case"MUSIC":l=e.music;break;case"TABBER":l=e.tab;break;case"COPYRIGHT":l=e.copyright;break;default:l=""}return l&&(i=!0),l});return s&&!i?"":r}}return n.PlaceholderPattern=/%([^%]+)%/g,n})();class Vo extends Ro{constructor(){super(...arguments),this.headerAndFooter=new Map}}Vo.defaultHeaderAndFooter=new Map([[U.Title,new gs("%TITLE%",void 0,K.Center)],[U.SubTitle,new gs("%SUBTITLE%",void 0,K.Center)],[U.Artist,new gs("%ARTIST%",void 0,K.Center)],[U.Album,new gs("%ALBUM%",void 0,K.Center)],[U.Words,new gs("Words by %WORDS%",void 0,K.Left)],[U.Music,new gs("Music by %MUSIC%",void 0,K.Right)],[U.WordsAndMusic,new gs("Words & Music by %MUSIC%",void 0,K.Right)],[U.Transcriber,new gs("Tabbed by %TABBER%",!1,K.Right)],[U.Copyright,new gs("%COPYRIGHT%",void 0,K.Center)],[U.CopyrightSecondLine,new gs("All Rights Reserved - International Copyright Secured",!0,K.Center)]]);class Dr{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new pI}static resetIds(){vr.resetIds(),Vn.resetIds(),Fi.resetIds(),is.resetIds()}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const t of this.masterBars)this.addMasterBarToRepeatGroups(t)}addMasterBar(t){t.score=this,t.index=this.masterBars.length,0!==this.masterBars.length&&(t.previousMasterBar=this.masterBars[this.masterBars.length-1],t.previousMasterBar.nextMasterBar=t,t.start=t.previousMasterBar.start+(t.previousMasterBar.isAnacrusis?0:t.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(t),this.masterBars.push(t)}addMasterBarToRepeatGroups(t){t.isRepeatStart?(this._currentRepeatGroup?.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new wS,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new wS,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(t),t.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(t){t.score=this,t.index=this.tracks.length,this.tracks.push(t)}finish(t){const e=new Map;for(let i=0,s=this.tracks.length;i<s;i++)this.tracks[i].finish(t,e)}}class Ho{init(t,e){this.data=t,this.settings=e,Dr.resetIds()}}var it=function(n){return n[n.General=0]="General",n[n.Format=1]="Format",n[n.AlphaTex=2]="AlphaTex",n}(it||{});class nt extends Error{constructor(t,e="",i){super(e??"",{cause:i}),this.type=t,Object.setPrototypeOf(this,nt.prototype)}}class Ht extends nt{constructor(t=null,e){super(it.Format,t??"Unsupported format",e),Object.setPrototypeOf(this,Ht.prototype)}}class Qr{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var pi=function(n){return n[n.IgnoreSpaces=0]="IgnoreSpaces",n[n.Begin=1]="Begin",n[n.Text=2]="Text",n[n.Comment=3]="Comment",n[n.Dash=4]="Dash",n}(pi||{});let vc=(()=>{class n{constructor(){this.startBar=0,this.text=""}finish(e=!1){this.chunks=[],this.parse(this.text,0,this.chunks,e)}parse(e,i,s,r){if(!e)return;let a=pi.Begin,o=pi.Begin,l=!1,c=0;for(;i<e.length;){const u=e.charCodeAt(i);switch(a){case pi.IgnoreSpaces:switch(u){case n.CharCodeLF:case n.CharCodeCR:case n.CharCodeTab:break;case n.CharCodeSpace:if(!l){a=o;continue}break;default:l=!1,a=o;continue}break;case pi.Begin:if(u!==n.CharCodeBrackedOpen){c=i,a=pi.Text;continue}a=pi.Comment;break;case pi.Comment:u===n.CharCodeBrackedClose&&(a=pi.Begin);break;case pi.Text:switch(u){case n.CharCodeDash:a=pi.Dash;break;case n.CharCodeCR:case n.CharCodeLF:case n.CharCodeSpace:const h=e.substr(c,i-c);this.addChunk(h,r),a=pi.IgnoreSpaces,o=pi.Begin}break;case pi.Dash:if(u!==n.CharCodeDash){const h=e.substr(c,i-c);this.addChunk(h,r),l=!0,a=pi.IgnoreSpaces,o=pi.Begin;continue}}i+=1}a===pi.Text&&i!==c&&this.addChunk(e.substr(c,i-c),r)}addChunk(e,i){e=this.prepareChunk(e),(!i||e.length>0&&"-"!==e)&&this.chunks.push(e)}prepareChunk(e){const i=e.split("+").join(" ");let s=i.length;for(;s>0&&"_"===i.charAt(s-1);)s--;return s!==i.length?i.substr(0,s):i}}return n.CharCodeLF=10,n.CharCodeTab=9,n.CharCodeCR=13,n.CharCodeSpace=32,n.CharCodeBrackedClose=93,n.CharCodeBrackedOpen=91,n.CharCodeDash=45,n})();class Tc{constructor(){this.marker="",this.text=""}}class gn extends nt{constructor(t){super(it.Format,t),Object.setPrototypeOf(this,gn.prototype)}}let st=(()=>{class n{constructor(e,i,s,r=255){this.raw=0,this.raw=(255&r)<<24|(255&e)<<16|(255&i)<<8|255&s,this.updateRgba()}updateRgba(){this.rgba=255===this.a?`#${H.toHexString(this.r,2)}${H.toHexString(this.g,2)}${H.toHexString(this.b,2)}`:`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return 255&this.raw}static random(e=100){return new n(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,e)}static fromJson(e){if(e instanceof n)return e;switch(typeof e){case"number":{const i=new n(0,0,0,0);return i.raw=e,i.updateRgba(),i}case"string":{const i=e;if(i.startsWith("#")){if(4===i.length)return new n(17*Number.parseInt(i[1],16),17*Number.parseInt(i[2],16),17*Number.parseInt(i[3],16));if(5===i.length)return new n(17*Number.parseInt(i[1],16),17*Number.parseInt(i[2],16),17*Number.parseInt(i[3],16),17*Number.parseInt(i[4],16));if(7===i.length)return new n(Number.parseInt(i.substring(1,3),16),Number.parseInt(i.substring(3,5),16),Number.parseInt(i.substring(5,7),16));if(9===i.length)return new n(Number.parseInt(i.substring(1,3),16),Number.parseInt(i.substring(3,5),16),Number.parseInt(i.substring(5,7),16),Number.parseInt(i.substring(7,9),16))}else if(i.startsWith("rgba")||i.startsWith("rgb")){const s=i.indexOf("("),r=i.lastIndexOf(")");if(-1===s||-1===r)throw new gn("No values specified for rgb/rgba function");const a=i.substring(s+1,r).split(",");if(3===a.length)return new n(Number.parseInt(a[0]),Number.parseInt(a[1]),Number.parseInt(a[2]));if(4===a.length)return new n(Number.parseInt(a[0]),Number.parseInt(a[1]),Number.parseInt(a[2]),255*Number.parseFloat(a[3]))}return null}}throw new gn("Unsupported format for color")}static toJson(e){return null===e?null:e.raw}}return n.BlackRgb="#000000",n})();class vS{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class I{static getTextForTuning(t,e){const i=I.getTextPartsForTuning(t);return e?i.join(""):i[0]}static getTextPartsForTuning(t,e=-1){return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][t%12],((t/12|0)+e).toString()]}static getDefaultTuningFor(t){return I._defaultTunings.has(t)?I._defaultTunings.get(t):null}static getPresetsFor(t){switch(t){case 7:return I._sevenStrings;case 6:return I._sixStrings;case 5:return I._fiveStrings;case 4:return I._fourStrings}return[]}static initialize(){I._defaultTunings.set(7,new I("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),I._sevenStrings.push(I._defaultTunings.get(7)),I._defaultTunings.set(6,new I("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),I._sixStrings.push(I._defaultTunings.get(6)),I._sixStrings.push(new I("Guitar Tune down \xbd step",[63,58,54,49,44,39],!1)),I._sixStrings.push(new I("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),I._sixStrings.push(new I("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),I._sixStrings.push(new I("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),I._sixStrings.push(new I("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),I._sixStrings.push(new I("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),I._sixStrings.push(new I("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),I._sixStrings.push(new I("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),I._sixStrings.push(new I("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),I._sixStrings.push(new I("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),I._sixStrings.push(new I("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),I._sixStrings.push(new I("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),I._sixStrings.push(new I("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),I._sixStrings.push(new I("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),I._sixStrings.push(new I("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),I._sixStrings.push(new I("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),I._sixStrings.push(new I("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),I._sixStrings.push(new I("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),I._sixStrings.push(new I("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),I._sixStrings.push(new I("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),I._sixStrings.push(new I("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),I._sixStrings.push(new I("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),I._sixStrings.push(new I("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),I._sixStrings.push(new I("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),I._sixStrings.push(new I("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),I._sixStrings.push(new I("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),I._sixStrings.push(new I("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),I._sixStrings.push(new I("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),I._sixStrings.push(new I("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),I._sixStrings.push(new I("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),I._defaultTunings.set(5,new I("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),I._fiveStrings.push(I._defaultTunings.get(5)),I._fiveStrings.push(new I("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),I._fiveStrings.push(new I("Banjo Open D Tuning",[62,57,54,50,69],!1)),I._fiveStrings.push(new I("Banjo Open G Tuning",[62,59,55,50,67],!1)),I._fiveStrings.push(new I("Banjo G Minor Tuning",[62,58,55,50,67],!1)),I._fiveStrings.push(new I("Banjo G Modal Tuning",[62,57,55,50,67],!1)),I._defaultTunings.set(4,new I("Bass Standard Tuning",[43,38,33,28],!0)),I._fourStrings.push(I._defaultTunings.get(4)),I._fourStrings.push(new I("Bass Tune down \xbd step",[42,37,32,27],!1)),I._fourStrings.push(new I("Bass Tune down 1 step",[41,36,31,26],!1)),I._fourStrings.push(new I("Bass Tune down 2 step",[39,34,29,24],!1)),I._fourStrings.push(new I("Bass Dropped D Tuning",[43,38,33,26],!1)),I._fourStrings.push(new I("Ukulele C Tuning",[45,40,36,43],!1)),I._fourStrings.push(new I("Ukulele G Tuning",[52,47,43,38],!1)),I._fourStrings.push(new I("Mandolin Standard Tuning",[64,57,50,43],!1)),I._fourStrings.push(new I("Mandolin or Violin Tuning",[76,69,62,55],!1)),I._fourStrings.push(new I("Viola Tuning",[69,62,55,48],!1)),I._fourStrings.push(new I("Cello Tuning",[57,50,43,36],!1))}static findTuning(t){const e=I.getPresetsFor(t.length);for(let i=0,s=e.length;i<s;i++){const r=e[i];let a=!0;for(let o=0,l=t.length;o<l;o++)if(t[o]!==r.tunings[o]){a=!1;break}if(a)return r}return null}constructor(t="",e=null,i=!1){this.isStandard=i,this.name=t,this.tunings=e??[]}finish(){const t=I.findTuning(this.tunings);t&&(this.name=t.name,this.isStandard=t.isStandard),this.name=this.name.trim()}}I._sevenStrings=[],I._sixStrings=[],I._fiveStrings=[],I._fourStrings=[],I._defaultTunings=new Map,I.defaultAccidentals=["","#","","#","","","#","","#","","#",""],I.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"],I.initialize();let hg=(()=>{class n{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new I("",[],!1),this.showSlash=!1,this.showNumbered=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=n.DefaultStandardNotationLineCount}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(e,i=null){this.stringTuning.finish();for(let s=0,r=this.bars.length;s<r;s++)this.bars[s].finish(e,i)}addChord(e,i){i.staff=this;let s=this.chords;null===s&&(s=new Map,this.chords=s),s.set(e,i)}hasChord(e){return this.chords?.has(e)??!1}getChord(e){return this.chords?.get(e)??null}addBar(e){const i=this.bars;e.staff=this,e.index=i.length,i.length>0&&(e.previousBar=i[i.length-1],e.previousBar.nextBar=e),i.push(e)}}return n.DefaultStandardNotationLineCount=5,n})();var Nr=function(n){return n[n.TrackName=0]="TrackName",n[n.BracesAndBrackets=1]="BracesAndBrackets",n[n.SystemSeparator=2]="SystemSeparator",n[n.StringTuning=3]="StringTuning",n}(Nr||{});class _I extends Ro{}let Wo=(()=>{class n{constructor(){this.index=0,this.staves=[],this.playbackInfo=new vS,this.color=new st(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}addLineBreaks(e){this.lineBreaks||(this.lineBreaks=new Set),this.lineBreaks.add(e)}ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new hg)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,i=null){this.shortName||(this.shortName=this.name,this.shortName.length>n.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,n.ShortNameMaxLength)));for(let s=0,r=this.staves.length;s<r;s++)this.staves[s].finish(e,i)}applyLyrics(e){for(const s of e)s.finish();const i=this.staves[0];for(let s=0;s<e.length;s++){const r=e[s];if(r.startBar>=0&&r.startBar<i.bars.length){let a=i.bars[r.startBar].voices[0].beats[0];for(let o=0;o<r.chunks.length&&a;o++){for(;a&&(a.isEmpty||a.isRest);)a=a.nextBeat;a&&(a.lyrics||(a.lyrics=new Array(e.length),a.lyrics.fill("")),a.lyrics[s]=r.chunks[o],a=a.nextBeat)}}}}}return n.ShortNameMaxLength=10,n})();class ye{static float64ToBytes(t){return ye._dataView.setFloat64(0,t,!0),ye._conversionByteArray}static bytesToInt64LE(t){ye._conversionByteArray.set(t,0);const e=ye._dataView.getBigInt64(0,!0);return e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?Number(e):Number.MAX_SAFE_INTEGER}static bytesToFloat64LE(t){return ye._conversionByteArray.set(t,0),ye._dataView.getFloat64(0,!0)}static bytesToFloat32LE(t){return ye._conversionByteArray.set(t,0),ye._dataView.getFloat32(0,!0)}static float32BEToBytes(t){return ye._dataView.setFloat32(0,t,!1),ye._conversionByteArray.slice(0,4)}static uint16ToInt16(t){return ye._dataView.setUint16(0,t,!0),ye._dataView.getInt16(0,!0)}static int16ToUint32(t){return ye._dataView.setInt16(0,t,!0),ye._dataView.getUint32(0,!0)}static int32ToUint16(t){return ye._dataView.setInt32(0,t,!0),ye._dataView.getUint16(0,!0)}static int32ToInt16(t){return ye._dataView.setInt32(0,t,!0),ye._dataView.getInt16(0,!0)}static int32ToUint32(t){return ye._dataView.setInt32(0,t,!0),ye._dataView.getUint32(0,!0)}static uint8ToInt8(t){return ye._dataView.setUint8(0,t),ye._dataView.getInt8(0)}}ye._conversionBuffer=new ArrayBuffer(8),ye._conversionByteArray=new Uint8Array(ye._conversionBuffer),ye._dataView=new DataView(ye._conversionBuffer);class T{static readInt32BE(t){return t.readByte()<<24|t.readByte()<<16|t.readByte()<<8|t.readByte()}static readFloat32BE(t){const e=new Uint8Array(4);return t.read(e,0,e.length),e.reverse(),ye.bytesToFloat32LE(e)}static readFloat64BE(t){const e=new Uint8Array(8);return t.read(e,0,e.length),e.reverse(),ye.bytesToFloat64LE(e)}static readInt32LE(t){const e=t.readByte(),i=t.readByte(),s=t.readByte();return t.readByte()<<24|s<<16|i<<8|e}static readInt64LE(t){const e=new Uint8Array(8);return t.read(e,0,e.length),ye.bytesToInt64LE(e)}static readUInt32LE(t){const e=t.readByte(),i=t.readByte(),s=t.readByte();return t.readByte()<<24|s<<16|i<<8|e}static decodeUInt32LE(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}static readUInt16LE(t){const e=t.readByte(),i=t.readByte();return ye.int32ToUint16(i<<8|e)}static readInt16LE(t){const e=t.readByte(),i=t.readByte();return ye.int32ToInt16(i<<8|e)}static readUInt32BE(t){const e=t.readByte(),i=t.readByte(),s=t.readByte(),r=t.readByte();return ye.int32ToUint32(e<<24|i<<16|s<<8|r)}static readUInt16BE(t){const e=t.readByte(),i=t.readByte();return ye.int32ToInt16(e<<8|i)}static readInt16BE(t){const e=t.readByte(),i=t.readByte();return ye.int32ToInt16(e<<8|i)}static readByteArray(t,e){const i=new Uint8Array(e);return t.read(i,0,e),i}static read8BitChars(t,e){const i=new Uint8Array(e);return t.read(i,0,i.length),T.toString(i,"utf-8")}static read8BitString(t){let e="",i=t.readByte();for(;0!==i;)e+=String.fromCharCode(i),i=t.readByte();return e}static read8BitStringLength(t,e){let i="",s=-1;for(let a=0;a<e;a++){const o=t.readByte();0===o&&-1===s&&(s=a),i+=String.fromCharCode(o)}const r=i;return s>=0?r.substr(0,s):r}static readSInt8(t){const e=t.readByte();return-256*((255&e)>>7)+(255&e)}static readInt24(t,e){let i=t[e]|t[e+1]<<8|t[e+2]<<16;return 8388608==(8388608&i)&&(i|=255<<24),i}static readInt16(t,e){return ye.int32ToInt16(t[e]|t[e+1]<<8)}static toString(t,e){const i=T.detectEncoding(t);return i&&(e=i),e||(e="utf-8"),new TextDecoder(e).decode(t.buffer)}static detectEncoding(t){return t.length>2&&254===t[0]&&255===t[1]?"utf-16be":t.length>2&&255===t[0]&&254===t[1]?"utf-16le":t.length>4&&0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]?"utf-32be":t.length>4&&255===t[0]&&254===t[1]&&0===t[2]&&0===t[3]?"utf-32le":null}static stringToBytes(t){return(new TextEncoder).encode(t)}static writeInt32BE(t,e){t.writeByte(e>>24&255),t.writeByte(e>>16&255),t.writeByte(e>>8&255),t.writeByte(e>>0&255)}static writeInt32LE(t,e){t.writeByte(e>>0&255),t.writeByte(e>>8&255),t.writeByte(e>>16&255),t.writeByte(e>>24&255)}static writeUInt16LE(t,e){t.writeByte(e>>0&255),t.writeByte(e>>8&255)}static writeInt16LE(t,e){t.writeByte(e>>0&255),t.writeByte(e>>8&255)}static writeInt16BE(t,e){t.writeByte(e>>8&255),t.writeByte(e>>0&255)}static writeFloat32BE(t,e){const i=ye.float32BEToBytes(e);t.write(i,0,i.length)}}class Wt{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return Wt.withCapacity(0)}static withCapacity(t){const e=new Wt;return e._buffer=new Uint8Array(t),e}static fromBuffer(t){const e=new Wt;return e._buffer=t,e.length=t.length,e}static fromString(t){const e=T.stringToBytes(t);return Wt.fromBuffer(e)}reset(){this.position=0}skip(t){this.position+=t}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(t,e,i){let s=this.length-this.position;return s>i&&(s=i),s<=0?0:(t.set(this._buffer.subarray(this.position,this.position+s),e),this.position+=s,s)}writeByte(t){const e=this.position+1;this.ensureCapacity(e),this._buffer[this.position]=255&t,e>this.length&&(this.length=e),this.position=e}write(t,e,i){const s=this.position+i;this.ensureCapacity(s);const r=Math.min(i,t.length-e);this._buffer.set(t.subarray(e,e+r),this.position),s>this.length&&(this.length=s),this.position=s}ensureCapacity(t){if(t>this._buffer.length){let e=t;e<256&&(e=256),e<2*this._buffer.length&&(e=2*this._buffer.length);const i=new Uint8Array(e);this.length>0&&i.set(this._buffer.subarray(0,0+this.length),0),this._buffer=i}}readAll(){return this.toArray()}toArray(){const t=new Uint8Array(this.length);return t.set(this._buffer.subarray(0,0+this.length),0),t}copyTo(t){t.write(this._buffer,0,this.length)}}var A=function(n){return n[n.TargetFine=0]="TargetFine",n[n.TargetSegno=1]="TargetSegno",n[n.TargetSegnoSegno=2]="TargetSegnoSegno",n[n.TargetCoda=3]="TargetCoda",n[n.TargetDoubleCoda=4]="TargetDoubleCoda",n[n.JumpDaCapo=5]="JumpDaCapo",n[n.JumpDaCapoAlCoda=6]="JumpDaCapoAlCoda",n[n.JumpDaCapoAlDoubleCoda=7]="JumpDaCapoAlDoubleCoda",n[n.JumpDaCapoAlFine=8]="JumpDaCapoAlFine",n[n.JumpDalSegno=9]="JumpDalSegno",n[n.JumpDalSegnoAlCoda=10]="JumpDalSegnoAlCoda",n[n.JumpDalSegnoAlDoubleCoda=11]="JumpDalSegnoAlDoubleCoda",n[n.JumpDalSegnoAlFine=12]="JumpDalSegnoAlFine",n[n.JumpDalSegnoSegno=13]="JumpDalSegnoSegno",n[n.JumpDalSegnoSegnoAlCoda=14]="JumpDalSegnoSegnoAlCoda",n[n.JumpDalSegnoSegnoAlDoubleCoda=15]="JumpDalSegnoSegnoAlDoubleCoda",n[n.JumpDalSegnoSegnoAlFine=16]="JumpDalSegnoSegnoAlFine",n[n.JumpDaCoda=17]="JumpDaCoda",n[n.JumpDaDoubleCoda=18]="JumpDaDoubleCoda",n}(A||{}),jn=function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n}(jn||{});class kc{constructor(){this.type=jn.Short,this.length=0}}var B=function(n){return n[n.Up=0]="Up",n[n.Down=1]="Down",n}(B||{}),S=function(n){return n[n.No=0]="No",n[n.Eof=1]="Eof",n[n.Number=2]="Number",n[n.DoubleDot=3]="DoubleDot",n[n.Dot=4]="Dot",n[n.String=5]="String",n[n.Tuning=6]="Tuning",n[n.LParensis=7]="LParensis",n[n.RParensis=8]="RParensis",n[n.LBrace=9]="LBrace",n[n.RBrace=10]="RBrace",n[n.Pipe=11]="Pipe",n[n.MetaCommand=12]="MetaCommand",n[n.Multiply=13]="Multiply",n[n.LowerThan=14]="LowerThan",n}(S||{}),Tn=function(n){return n[n.KnownStaffMeta=0]="KnownStaffMeta",n[n.UnknownStaffMeta=1]="UnknownStaffMeta",n[n.EndOfMetaDetected=2]="EndOfMetaDetected",n}(Tn||{});class Uo extends nt{constructor(t,e,i,s,r,a,o,l=null){super(it.AlphaTex,t),this.position=e,this.line=i,this.col=s,this.nonTerm=r??"",this.expected=a??S.No,this.symbol=o??S.No,this.symbolData=l,Object.setPrototypeOf(this,Uo.prototype)}static symbolError(t,e,i,s,r,a,o=null){let l=`MalFormed AlphaTex: @${t} (line ${e}, col ${i}): Error on block ${s}`;return r!==a?(l+=`, expected a ${S[r]} found a ${S[a]}`,null!==o&&(l+=`: '${o}'`)):l+=`, invalid value: '${o}'`,new Uo(l,t,e,i,s,r,a,o)}static errorMessage(t,e,i,s){return new Uo(t=`MalFormed AlphaTex: @${e} (line ${i}, col ${s}): ${t}`,e,i,s,null,null,null,null)}}var Bh=function(n){return n[n.Auto=0]="Auto",n[n.Explicit=1]="Explicit",n}(Bh||{});let vI=(()=>{class n extends Ho{constructor(){super(...arguments),this._trackChannel=0,this._barIndex=0,this._voiceIndex=0,this._input="",this._ch=n.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=S.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=w.QuadrupleWhole,this._currentDynamics=ie.PPP,this._currentTuplet=0,this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this._sustainPedalToBeat=new Map,this._slurs=new Map,this._articulationValueToIndex=new Map,this._accidentalMode=Bh.Explicit,this.logErrors=!1}get name(){return"AlphaTex"}initFromString(e,i){this.data=Wt.empty(),this._input=e,this.settings=i,Dr.resetIds()}readScore(){try{if(this.data.length>0&&(this._input=T.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this._sustainPedalToBeat=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=w.Quarter,this._currentDynamics=ie.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===S.LowerThan)throw new Ht("Unknown start sign '<' (meant to import as XML?)");if(this._sy!==S.Eof){const e=this.metaData(),i=this.bars();if(!e&&!i)throw new Ht("No alphaTex data found")}H.consolidate(this._score),this._score.finish(this.settings),this._score.rebuildRepeatGroups();for(const[e,i]of this._lyrics)this._score.tracks[e].applyLyrics(i);for(const[e,i]of this._sustainPedalToBeat){const s=i.voice.bar.masterBar.calculateDuration();e.ratioPosition=i.playbackStart/s}return this._score}catch(e){throw e instanceof Uo?new Ht(e.message,e):e}}error(e,i,s=!0){let r,a=!1;s?(r=this._sy,(r===S.String||r===S.Number||r===S.MetaCommand)&&(a=!0)):r=i;const o=Uo.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],e,i,r,a?this._syData:null);throw this.logErrors&&x.error(this.name,o.message),o}errorMessage(e){const i=Uo.errorMessage(e,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&x.error(this.name,i.message),i}createDefaultScore(){this._score=new Dr,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new Wo,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++;const e=this._currentTrack.staves[0];e.displayTranspositionPitch=0,e.stringTuning.tunings=I.getDefaultTuningFor(6).tunings,this._articulationValueToIndex.clear(),this.beginStaff(e),this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=ie.F}parseClefFromString(e){switch(e.toLowerCase()){case"g2":case"treble":default:return Be.G2;case"f4":case"bass":return Be.F4;case"c3":case"tenor":return Be.C3;case"c4":case"alto":return Be.C4;case"n":case"neutral":return Be.Neutral}}parseClefFromInt(e){switch(e){case 43:default:return Be.G2;case 65:return Be.F4;case 48:return Be.C3;case 60:return Be.C4}}parseTripletFeelFromString(e){switch(e.toLowerCase()){case"no":case"none":default:return _e.NoTripletFeel;case"t16":case"triplet-16th":return _e.Triplet16th;case"t8":case"triplet-8th":return _e.Triplet8th;case"d16":case"dotted-16th":return _e.Dotted16th;case"d8":case"dotted-8th":return _e.Dotted8th;case"s16":case"scottish-16th":return _e.Scottish16th;case"s8":case"scottish-8th":return _e.Scottish8th}}parseTripletFeelFromInt(e){switch(e){case 0:default:return _e.NoTripletFeel;case 1:return _e.Triplet16th;case 2:return _e.Triplet8th;case 3:return _e.Dotted16th;case 4:return _e.Dotted8th;case 5:return _e.Scottish16th;case 6:return _e.Scottish8th}}parseKeySignature(e){switch(e.toLowerCase()){case"cb":case"cbmajor":case"abminor":return De.Cb;case"gb":case"gbmajor":case"ebminor":return De.Gb;case"db":case"dbmajor":case"bbminor":return De.Db;case"ab":case"abmajor":case"fminor":return De.Ab;case"eb":case"ebmajor":case"cminor":return De.Eb;case"bb":case"bbmajor":case"gminor":return De.Bb;case"f":case"fmajor":case"dminor":return De.F;case"c":case"cmajor":case"aminor":default:return De.C;case"g":case"gmajor":case"eminor":return De.G;case"d":case"dmajor":case"bminor":return De.D;case"a":case"amajor":case"f#minor":return De.A;case"e":case"emajor":case"c#minor":return De.E;case"b":case"bmajor":case"g#minor":return De.B;case"f#":case"f#major":case"d#minor":return De.FSharp;case"c#":case"c#major":case"a#minor":return De.CSharp}}parseKeySignatureType(e){return e.toLowerCase().endsWith("minor")?li.Minor:li.Major}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),10===this._ch?(this._line++,this._col=0):this._col++):this._ch=n.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=S.No;this._sy===S.No;)if(this._ch===n.Eof)this._sy=S.Eof;else if(n.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(47===this._ch){if(this._ch=this.nextChar(),47===this._ch)for(;13!==this._ch&&10!==this._ch&&this._ch!==n.Eof;)this._ch=this.nextChar();else if(42===this._ch)for(;this._ch!==n.Eof;)if(42===this._ch){if(this._ch=this.nextChar(),47===this._ch){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",S.String,!1);this.saveValidSpot()}else if(34===this._ch||39===this._ch){const e=this._ch;this._ch=this.nextChar();let i="";for(this._sy=S.String;this._ch!==e&&this._ch!==n.Eof;)92===this._ch?(this._ch=this.nextChar(),92===this._ch?i+="\\":this._ch===e?i+=String.fromCharCode(this._ch):82===this._ch||114===this._ch?i+="\r":78===this._ch||110===this._ch?i+="\n":84===this._ch||116===this._ch?i+="\t":this.errorMessage("Unsupported escape sequence")):i+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===n.Eof&&this.errorMessage("String opened but never closed"),this._syData=i,this._ch=this.nextChar()}else if(45===this._ch)this._allowNegatives?this.readNumberOrName():(this._sy=S.String,this._syData=this.readName());else if(46===this._ch)this._sy=S.Dot,this._ch=this.nextChar();else if(58===this._ch)this._sy=S.DoubleDot,this._ch=this.nextChar();else if(40===this._ch)this._sy=S.LParensis,this._ch=this.nextChar();else if(92===this._ch)this._ch=this.nextChar(),this._sy=S.MetaCommand,92===this._ch&&(this._ch=this.nextChar()),this._syData=this.readName();else if(41===this._ch)this._sy=S.RParensis,this._ch=this.nextChar();else if(123===this._ch)this._sy=S.LBrace,this._ch=this.nextChar();else if(125===this._ch)this._sy=S.RBrace,this._ch=this.nextChar();else if(124===this._ch)this._sy=S.Pipe,this._ch=this.nextChar();else if(42===this._ch)this._sy=S.Multiply,this._ch=this.nextChar();else if(60===this._ch)this._sy=S.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this.readNumberOrName();else if(n.isNameLetter(this._ch)){const e=this.readName(),i=this._allowTuning?H.parseTuning(e):null;i?(this._sy=S.Tuning,this._syData=i):(this._sy=S.String,this._syData=e)}else this.error("symbol",S.String,!1);return this._sy}readNumberOrName(){let e="",i=!0;do{e+=String.fromCharCode(this._ch),this.isDigit(this._ch)||(i=!1),this._ch=this.nextChar()}while(this.isDigit(this._ch)||n.isNameLetter(this._ch));i?(this._sy=S.Number,this._syData=this._allowFloat?Number.parseFloat(e):Number.parseInt(e)):(this._sy=S.String,this._syData=e)}static isNameLetter(e){return!n.isTerminal(e)&&(33<=e&&e<=47||58<=e&&e<=126||128<=e)}static isTerminal(e){return 46===e||123===e||125===e||91===e||93===e||40===e||41===e||124===e||39===e||34===e||42===e||92===e}static isWhiteSpace(e){return 9===e||10===e||11===e||13===e||32===e}isDigit(e){return e>=48&&e<=57||this._allowNegatives&&45===e||this._allowFloat&&46===e}readName(){let e="";do{e+=String.fromCharCode(this._ch),this._ch=this.nextChar()}while(n.isNameLetter(this._ch)||this.isDigit(this._ch));return e}metaData(){let e=!1,i=!1,s=!0;for(;this._sy===S.MetaCommand&&s;){const r=this._syData.toLowerCase();switch(r){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":case"instructions":case"notices":case"tab":this._sy=this.newSy(),this._sy!==S.String&&this.error(r,S.String,!0);const a=this._syData;this._sy=this.newSy(),e=!0;let o=U.ChordDiagramList;switch(r){case"title":this._score.title=a,o=U.Title;break;case"subtitle":this._score.subTitle=a,o=U.SubTitle;break;case"artist":this._score.artist=a,o=U.Artist;break;case"album":this._score.album=a,o=U.Album;break;case"words":this._score.words=a,o=U.Words;break;case"music":this._score.music=a,o=U.Music;break;case"copyright":this._score.copyright=a,o=U.Copyright;break;case"instructions":this._score.instructions=a;break;case"notices":this._score.notices=a;break;case"tab":this._score.tab=a,o=U.Transcriber}o!==U.ChordDiagramList&&this.headerFooterStyle(o);break;case"copyright2":this._sy=this.newSy(),this._sy!==S.String&&this.error(r,S.String,!0),this.headerFooterStyle(U.CopyrightSecondLine),e=!0;break;case"wordsandmusic":this._sy=this.newSy(),this._sy!==S.String&&this.error(r,S.String,!0),this.headerFooterStyle(U.WordsAndMusic),e=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===S.Number?this._score.tempo=this._syData:this.error("tempo",S.Number,!0),this._sy=this.newSy(),this._sy===S.String&&(this._score.tempoLabel=this._syData,this._sy=this.newSy()),e=!0;break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===S.Number?(this._score.defaultSystemsLayout=this._syData,this._sy=this.newSy(),e=!0):this.error("default-systems-layout",S.Number,!0);break;case"systemslayout":for(this._sy=this.newSy(),e=!0;this._sy===S.Number;)this._score.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"hidedynamics":this._score.stylesheet.hideDynamics=!0,this._sy=this.newSy(),e=!0;break;case"showdynamics":this._score.stylesheet.hideDynamics=!1,this._sy=this.newSy(),e=!0;break;case"bracketextendmode":this._sy=this.newSy(),this._sy!==S.String&&this.error("bracketExtendMode",S.String,!0),this._score.stylesheet.bracketExtendMode=this.parseBracketExtendMode(this._syData),this._sy=this.newSy(),e=!0;break;case"usesystemsignseparator":this._score.stylesheet.useSystemSignSeparator=!0,this._sy=this.newSy(),e=!0;break;case"multibarrest":this._score.stylesheet.multiTrackMultiBarRest=!0,this._sy=this.newSy(),e=!0;break;case"singletracktracknamepolicy":this._sy=this.newSy(),this._sy!==S.String&&this.error("singleTrackTrackNamePolicy",S.String,!0),this._score.stylesheet.singleTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),e=!0;break;case"multitracktracknamepolicy":this._sy=this.newSy(),this._sy!==S.String&&this.error("multiTrackTrackNamePolicy",S.String,!0),this._score.stylesheet.multiTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),e=!0;break;case"firstsystemtracknamemode":this._sy=this.newSy(),this._sy!==S.String&&this.error("firstSystemTrackNameMode",S.String,!0),this._score.stylesheet.firstSystemTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),e=!0;break;case"othersystemstracknamemode":this._sy=this.newSy(),this._sy!==S.String&&this.error("otherSystemsTrackNameMode",S.String,!0),this._score.stylesheet.otherSystemsTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),e=!0;break;case"firstsystemtracknameorientation":this._sy=this.newSy(),this._sy!==S.String&&this.error("firstSystemTrackNameOrientation",S.String,!0),this._score.stylesheet.firstSystemTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),e=!0;break;case"othersystemstracknameorientation":this._sy=this.newSy(),this._sy!==S.String&&this.error("otherSystemsTrackNameOrientation",S.String,!0),this._score.stylesheet.otherSystemsTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),e=!0;break;default:switch(this.handleStaffMeta()){case Tn.KnownStaffMeta:i=!0;break;case Tn.UnknownStaffMeta:e||i?this.error("metaDataTags",S.String,!1):s=!1;break;case Tn.EndOfMetaDetected:s=!1}}}return e?(this._sy!==S.Dot&&this.error("song",S.Dot,!0),this._sy=this.newSy()):this._sy===S.Dot&&(this._sy=this.newSy(),e=!0),e||i}headerFooterStyle(e){const i=H.getOrCreateHeaderFooterStyle(this._score,e);if(void 0===i.isVisible&&(i.isVisible=!0),this._sy===S.String){const s=this._syData;s?i.template=s:i.isVisible=!1,this._sy=this.newSy()}if(this._sy===S.String){switch(this._syData.toLowerCase()){case"left":i.textAlign=K.Left;break;case"center":i.textAlign=K.Center;break;case"right":i.textAlign=K.Right}this._sy=this.newSy()}}parseTrackNamePolicy(e){switch(e.toLowerCase()){case"hidden":return Et.Hidden;case"allsystems":return Et.AllSystems;default:return Et.FirstSystem}}parseTrackNameMode(e){return"fullname"===e.toLowerCase()?zn.FullName:zn.ShortName}parseTrackNameOrientation(e){return"horizontal"===e.toLowerCase()?$n.Horizontal:$n.Vertical}handleStaffMeta(){switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===S.Number?this._currentStaff.capo=this._syData:this.error("capo",S.Number,!0),this._sy=this.newSy(),Tn.KnownStaffMeta;case"tuning":this._sy=this.newSy();const e=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case S.String:const o=this._syData.toLowerCase();"piano"===o||"none"===o||"voice"===o?this.makeCurrentStaffPitched():this.error("tuning",S.Tuning,!0),this._sy=this.newSy();break;case S.Tuning:const l=[];do{l.push(this._syData.realValue),this._sy=this.newSy()}while(this._sy===S.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",S.Tuning,!0)}return this._sy===S.String&&"hide"===this._syData.toLowerCase()&&(this._score.stylesheet.perTrackDisplayTuning||(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(this._currentTrack.index,!1),this._sy=this.newSy()),e!==this._currentStaff.tuning.length&&(this._currentStaff.chords?.size??0)>0&&this.errorMessage("Tuning must be defined before any chord"),Tn.KnownStaffMeta;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===S.Number){const o=this._syData;o>=0&&o<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",S.Number,!1)}else if(this._sy===S.String){const o=this._syData.toLowerCase();if("percussion"===o){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=he.PercussionChannel,this._currentTrack.playbackInfo.secondaryChannel=he.PercussionChannel}else this._currentTrack.playbackInfo.program=qs.getValue(o)}else this.error("instrument",S.Number,!0);return this._sy=this.newSy(),Tn.KnownStaffMeta;case"lyrics":this._sy=this.newSy();const i=new vc;return i.startBar=0,i.text="",this._sy===S.Number&&(i.startBar=this._syData,this._sy=this.newSy()),this._sy===S.String?(i.text=this._syData,this._sy=this.newSy()):this.error("lyrics",S.String,!0),this._lyrics.get(this._currentTrack.index).push(i),Tn.KnownStaffMeta;case"chord":this._sy=this.newSy();const s=new Qr;this.chordProperties(s),this._sy===S.String?(s.name=this._syData,this._sy=this.newSy()):this.error("chord-name",S.String,!0);for(let o=0;o<this._currentStaff.tuning.length;o++)this._sy===S.Number?s.strings.push(this._syData):this._sy===S.String&&"x"===this._syData.toLowerCase()&&s.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,s.name),s),Tn.KnownStaffMeta;case"articulation":this._sy=this.newSy();let r="";if(this._sy===S.String?(r=this._syData,this._sy=this.newSy()):this.error("articulation-name",S.String,!0),"defaults"===r){for(const[o,l]of nn.instrumentArticulationNames)this._percussionArticulationNames.set(o.toLowerCase(),l),this._percussionArticulationNames.set(n.toArticulationId(o),l);return Tn.KnownStaffMeta}let a=0;return this._sy===S.Number?(a=this._syData,this._sy=this.newSy()):this.error("articulation-number",S.Number,!0),nn.instrumentArticulations.has(a)||this.errorMessage(`Unknown articulation ${a}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(r.toLowerCase(),a),Tn.KnownStaffMeta;case"accidentals":return this.handleAccidentalMode(),Tn.KnownStaffMeta;case"displaytranspose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===S.Number?(this._currentStaff.displayTranspositionPitch=-1*this._syData,this._staffHasExplicitDisplayTransposition=!0):this.error("displaytranspose",S.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),Tn.KnownStaffMeta;case"transpose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===S.Number?this._currentStaff.transpositionPitch=-1*this._syData:this.error("transpose",S.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),Tn.KnownStaffMeta;case"track":case"staff":return Tn.EndOfMetaDetected;case"voice":return this._sy=this.newSy(),this.handleNewVoice()?Tn.EndOfMetaDetected:Tn.KnownStaffMeta;default:return Tn.UnknownStaffMeta}}handleAccidentalMode(){switch(this._sy=this.newSy(),this._sy!==S.String&&this.error("accidental-mode",S.String,!0),this._syData){case"auto":this._accidentalMode=Bh.Auto;break;case"explicit":this._accidentalMode=Bh.Explicit}this._sy=this.newSy()}makeCurrentStaffPitched(){this._currentStaff.stringTuning.tunings=[],this._staffHasExplicitDisplayTransposition||(this._currentStaff.displayTranspositionPitch=0)}static toArticulationId(e){return e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1}chordProperties(e){if(this._sy===S.LBrace){for(this._sy=this.newSy();this._sy===S.String;)switch(this._syData.toLowerCase()){case"firstfret":this._sy=this.newSy(),this._sy===S.Number?e.firstFret=this._syData:this.error("chord-firstfret",S.Number,!0),this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case S.String:e.showDiagram="false"!==this._syData.toLowerCase();break;case S.Number:e.showDiagram=0!==this._syData;break;default:this.error("chord-showdiagram",S.String,!0)}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case S.String:e.showDiagram="false"!==this._syData.toLowerCase();break;case S.Number:e.showFingering=0!==this._syData;break;default:this.error("chord-showfingering",S.String,!0)}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case S.String:e.showName="false"!==this._syData.toLowerCase();break;case S.Number:e.showName=0!==this._syData;break;default:this.error("chord-showname",S.String,!0)}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===S.Number;)e.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",S.String,!1)}this._sy!==S.RBrace&&this.error("chord-properties",S.RBrace,!0),this._sy=this.newSy()}}bars(){const e=this.bar();for(;this._sy!==S.Eof;)if(this._sy===S.Pipe)this._sy=this.newSy(),this.bar();else{if(this._sy!==S.MetaCommand)break;this.bar()}return e}trackStaffMeta(){if(this._sy!==S.MetaCommand)return!1;if("track"===this._syData.toLowerCase()&&(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===S.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===S.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy()),this.trackProperties()),this._sy===S.MetaCommand&&"staff"===this._syData.toLowerCase()){if(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){const e=this._currentStaff.isPercussion;this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1),this.beginStaff(this._currentTrack.staves[this._currentTrack.staves.length-1]),e&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=ie.F}this.staffProperties()}return this._sy===S.MetaCommand&&"voice"===this._syData.toLowerCase()&&(this._sy=this.newSy(),this.handleNewVoice()),!0}handleNewVoice(){if(0===this._voiceIndex&&(0===this._currentStaff.bars.length||1===this._currentStaff.bars.length&&this._currentStaff.bars[0].isEmpty))return!1;for(const e of this._currentStaff.bars){const i=new Fi;e.addVoice(i)}return this._voiceIndex++,this._barIndex=0,!0}beginStaff(e){this._currentStaff=e,this._slurs.clear(),this._barIndex=0,this._voiceIndex=0}trackProperties(){if(this._sy===S.LBrace){for(this._sy=this.newSy();this._sy===S.String;)switch(this._syData.toLowerCase()){case"color":this._sy=this.newSy(),this._sy!==S.String&&this.error("track-color",S.String,!0),this._currentTrack.color=st.fromJson(this._syData),this._sy=this.newSy();break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===S.Number?(this._currentTrack.defaultSystemsLayout=this._syData,this._sy=this.newSy()):this.error("default-systems-layout",S.Number,!0);break;case"systemslayout":for(this._sy=this.newSy();this._sy===S.Number;)this._currentTrack.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"volume":this._sy=this.newSy(),this._sy!==S.Number&&this.error("track-volume",S.Number,!0),this._currentTrack.playbackInfo.volume=H.clamp(this._syData,0,16),this._sy=this.newSy();break;case"balance":this._sy=this.newSy(),this._sy!==S.Number&&this.error("track-balance",S.Number,!0),this._currentTrack.playbackInfo.balance=H.clamp(this._syData,0,16),this._sy=this.newSy();break;case"mute":this._sy=this.newSy(),this._currentTrack.playbackInfo.isMute=!0;break;case"solo":this._sy=this.newSy(),this._currentTrack.playbackInfo.isSolo=!0;break;case"multibarrest":this._sy=this.newSy(),this._score.stylesheet.perTrackMultiBarRest||(this._score.stylesheet.perTrackMultiBarRest=new Set),this._score.stylesheet.perTrackMultiBarRest.add(this._currentTrack.index);break;default:this.error("track-properties",S.String,!1)}this._sy!==S.RBrace&&this.error("track-properties",S.RBrace,!0),this._sy=this.newSy()}}staffProperties(){if(this._sy!==S.LBrace)return;this._sy=this.newSy();let e=!1,i=!1,s=!1,r=!1;for(;this._sy===S.String;)switch(this._syData.toLowerCase()){case"score":e=!0,this._sy=this.newSy(),this._sy===S.Number&&(this._currentStaff.standardNotationLineCount=this._syData,this._sy=this.newSy());break;case"tabs":i=!0,this._sy=this.newSy();break;case"slash":s=!0,this._sy=this.newSy();break;case"numbered":r=!0,this._sy=this.newSy();break;default:this.error("staff-properties",S.String,!1)}(e||i||s||r)&&(this._currentStaff.showStandardNotation=e,this._currentStaff.showTablature=i,this._currentStaff.showSlash=s,this._currentStaff.showNumbered=r),this._sy!==S.RBrace&&this.error("staff-properties",S.RBrace,!0),this._sy=this.newSy()}bar(){const e=this.trackStaffMeta(),i=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){const c=new Cr;this._score.addMasterBar(c),c.index>0&&(c.timeSignatureDenominator=c.previousMasterBar.timeSignatureDenominator,c.timeSignatureNumerator=c.previousMasterBar.timeSignatureNumerator,c.tripletFeel=c.previousMasterBar.tripletFeel)}const s=this.barMeta(i),r=this._currentTrack.playbackInfo.program;!this._staffTuningApplied&&!this._staffHasExplicitTuning&&(this._currentStaff.stringTuning.tunings=[],15===r||r>=24&&r<=31?this._currentStaff.stringTuning.tunings=I.getDefaultTuningFor(6).tunings:r>=32&&r<=39?this._currentStaff.stringTuning.tunings=[43,38,33,28]:40===r||44===r||45===r||48===r||49===r||50===r||51===r?this._currentStaff.stringTuning.tunings=[52,57,50,43]:41===r?this._currentStaff.stringTuning.tunings=[57,50,43,36]:42===r?this._currentStaff.stringTuning.tunings=[45,38,31,24]:43===r?this._currentStaff.stringTuning.tunings=[43,38,33,28]:105===r?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:106===r?this._currentStaff.stringTuning.tunings=[57,52,45]:107===r?this._currentStaff.stringTuning.tunings=[52,45,38,31]:110===r&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0),this._staffHasExplicitDisplayTransposition||(this._currentStaff.displayTranspositionPitch=r>=24&&r<=31||r>=32&&r<=39||43===r?-12:0);let a=!1;const o=i.voices[this._voiceIndex];if(this._sy!==S.MetaCommand||"track"!==this._syData.toLowerCase()&&"staff"!==this._syData.toLowerCase())for(;this._sy!==S.Pipe&&this._sy!==S.Eof&&this.beat(o);)a=!0;if(0===o.beats.length){const c=new Vn;c.isEmpty=!0,o.addBeat(c)}return e||s||a}newBar(e){if(this._barIndex<e.bars.length){const r=e.bars[this._barIndex];return this._barIndex++,r}const i=0===e.bars.length?1:e.bars[0].voices.length,s=new vr;e.addBar(s),s.previousBar&&(s.clef=s.previousBar.clef,s.clefOttava=s.previousBar.clefOttava,s.keySignature=s.previousBar.keySignature,s.keySignatureType=s.previousBar.keySignatureType),this._barIndex++;for(let r=0;r<i;r++){const a=new Fi;s.addVoice(a)}return s}beat(e){this.beatDuration();const i=new Vn;if(e.addBeat(i),this._allowTuning=!this._currentStaff.isPercussion,this._sy===S.LParensis){for(this._sy=this.newSy(),this.note(i);this._sy!==S.RParensis&&this._sy!==S.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,this.note(i)););this._sy!==S.RParensis&&this.error("note-list",S.RParensis,!0),this._sy=this.newSy()}else if(this._sy===S.String&&"r"===this._syData.toLowerCase())this._sy=this.newSy();else if(!this.note(i))return e.beats.splice(e.beats.length-1,1),!1;this._sy===S.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==S.Number&&this.error("duration",S.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),i.duration=this._currentDuration,i.dynamics=this._currentDynamics,1!==this._currentTuplet&&!i.hasTuplet&&n.applyTuplet(i,this._currentTuplet);let s=1;this._sy===S.Multiply&&(this._sy=this.newSy(),this._sy!==S.Number?this.error("multiplier",S.Number,!0):s=this._syData,this._sy=this.newSy()),this.beatEffects(i);for(let r=0;r<s-1;r++)e.addBeat(_S.clone(i));return!0}beatDuration(){if(this._sy===S.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==S.Number&&this.error("duration",S.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===S.LBrace)){for(this._sy=this.newSy();this._sy===S.String;)"tu"===this._syData.toLowerCase()?(this._sy=this.newSy(),this._sy!==S.Number&&this.error("duration-tuplet",S.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy()):this.error("beat-duration",S.String,!1);this._sy!==S.RBrace&&this.error("beat-duration",S.RBrace,!0),this._sy=this.newSy()}}beatEffects(e){if(this._sy===S.LBrace){for(this._sy=this.newSy();this._sy===S.String;)this.applyBeatEffect(e)||this.error("beat-effects",S.String,!1);this._sy!==S.RBrace&&this.error("beat-effects",S.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(e){const i=this._syData.toLowerCase();if("f"===i)e.fade=un.FadeIn;else if("fo"===i)e.fade=un.FadeOut;else if("vs"===i)e.fade=un.VolumeSwell;else if("v"===i)e.vibrato=Ie.Slight;else if("vw"===i)e.vibrato=Ie.Wide;else if("s"===i)e.slap=!0;else if("p"===i)e.pop=!0;else if("tt"===i)e.tap=!0;else if("txt"===i){if(this._sy=this.newSy(),this._sy!==S.String)return this.error("beat-text",S.String,!0),!1;e.text=this._syData}else if("dd"===i)e.dots=2;else if("d"===i)e.dots=1;else if("su"===i)e.pickStroke=vn.Up;else if("sd"===i)e.pickStroke=vn.Down;else{if("tu"===i){if(this._sy=this.newSy(),this._sy!==S.Number)return this.error("tuplet",S.Number,!0),!1;const s=this._syData;if(this._sy=this.newSy(),this._sy===S.Number){const r=this._syData;this._sy=this.newSy(),e.tupletNumerator=s,e.tupletDenominator=r}else n.applyTuplet(e,s);return!0}if("tb"===i||"tbe"===i){this._sy=this.newSy();const s="tbe"===i;for(this._sy===S.String&&(e.whammyBarType=this.parseWhammyType(this._syData),this._sy=this.newSy()),this._sy===S.String&&(e.whammyStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==S.LParensis&&this.error("tremolobar-effect",S.LParensis,!0),this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy();this._sy!==S.RParensis&&this._sy!==S.Eof;){let r=0,a=0;s?(this._sy!==S.Number&&this.error("tremolobar-effect",S.Number,!0),r=this._syData,this._sy=this.newSy(),this._sy!==S.Number&&this.error("tremolobar-effect",S.Number,!0),a=this._syData):(this._sy!==S.Number&&this.error("tremolobar-effect",S.Number,!0),r=0,a=this._syData),e.addWhammyBarPoint(new V(r,a)),this._sy=this.newSy()}if(null!=e.whammyBarPoints){for(;e.whammyBarPoints.length>60;)e.removeWhammyBarPoint(e.whammyBarPoints.length-1);if(s)e.whammyBarPoints.sort((r,a)=>r.offset-a.offset);else{const r=e.whammyBarPoints.length,a=60/r|0;let o=0;for(;o<r;)e.whammyBarPoints[o].offset=Math.min(60,o*a),o++}}this._allowNegatives=!1,this._allowFloat=!1,this._sy!==S.RParensis&&this.error("tremolobar-effect",S.RParensis,!0)}else{if("bu"===i||"bd"===i||"au"===i||"ad"===i){switch(i){case"bu":e.brushType=Y.BrushUp;break;case"bd":e.brushType=Y.BrushDown;break;case"au":e.brushType=Y.ArpeggioUp;break;case"ad":e.brushType=Y.ArpeggioDown}return this._sy=this.newSy(),this._sy===S.Number?(e.brushDuration=this._syData,this._sy=this.newSy(),!0):(e.updateDurations(),"bu"===i||"bd"===i?e.brushDuration=e.playbackDuration/4/e.notes.length:("au"===i||"ad"===i)&&(e.brushDuration=e.playbackDuration/e.notes.length),!0)}if("ch"===i){this._sy=this.newSy();const s=this._syData,r=this.getChordId(this._currentStaff,s);if(!this._currentStaff.hasChord(r)){const a=new Qr;a.showDiagram=!1,a.name=s,this._currentStaff.addChord(r,a)}e.chordId=r}else{if("gr"===i)return this._sy=this.newSy(),"ob"===this._syData.toLowerCase()?(e.graceType=re.OnBeat,this._sy=this.newSy()):"b"===this._syData.toLowerCase()?(e.graceType=re.BendGrace,this._sy=this.newSy()):e.graceType=re.BeforeBeat,!0;if("dy"===i){this._sy=this.newSy();const s=this._syData.toUpperCase();switch(s){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":e.dynamics=ie[s]}this._currentDynamics=e.dynamics}else if("cre"===i)e.crescendo=ii.Crescendo;else if("dec"===i)e.crescendo=ii.Decrescendo;else{if("tempo"===i){const s=this.readTempoAutomation();return e.automations.push(s),e.voice.bar.masterBar.tempoAutomations.push(s),!0}if("tp"===i){if(this._sy=this.newSy(),e.tremoloSpeed=w.Eighth,this._sy===S.Number){switch(this._syData){case 8:default:e.tremoloSpeed=w.Eighth;break;case 16:e.tremoloSpeed=w.Sixteenth;break;case 32:e.tremoloSpeed=w.ThirtySecond}this._sy=this.newSy()}return!0}if("spd"===i){const s=new Ua;return s.pedalType=jt.Down,s.ratioPosition=e.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(s,e),e.voice.bar.sustainPedals.push(s),this._sy=this.newSy(),!0}if("spu"===i){const s=new Ua;return s.pedalType=jt.Up,s.ratioPosition=e.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(s,e),e.voice.bar.sustainPedals.push(s),this._sy=this.newSy(),!0}if("spe"===i){const s=new Ua;return s.pedalType=jt.Up,s.ratioPosition=1,e.voice.bar.sustainPedals.push(s),this._sy=this.newSy(),!0}if("slashed"===i)return e.slashed=!0,this._sy=this.newSy(),!0;if("ds"===i)return e.deadSlapped=!0,this._sy=this.newSy(),!0;if("glpf"===i)return this._sy=this.newSy(),e.golpe=Ci.Finger,!0;if("glpt"===i)return this._sy=this.newSy(),e.golpe=Ci.Thumb,!0;if("waho"===i)return this._sy=this.newSy(),e.wahPedal=Li.Open,!0;if("wahc"===i)return this._sy=this.newSy(),e.wahPedal=Li.Closed,!0;if("barre"===i){if(this._sy=this.newSy(),this._sy!==S.Number&&this.error("beat-barre",S.Number,!0),e.barreFret=this._syData,e.barreShape=Ri.Full,this._sy=this.newSy(),this._sy===S.String)switch(this._syData.toLowerCase()){case"full":e.barreShape=Ri.Full,this._sy=this.newSy();break;case"half":e.barreShape=Ri.Half,this._sy=this.newSy()}return!0}if("rasg"===i){switch(this._sy=this.newSy(),this._sy!==S.String&&this.error("rasgueado",S.String,!0),this._syData.toLowerCase()){case"ii":e.rasgueado=X.Ii;break;case"mi":e.rasgueado=X.Mi;break;case"miitriplet":e.rasgueado=X.MiiTriplet;break;case"miianapaest":e.rasgueado=X.MiiAnapaest;break;case"pmptriplet":e.rasgueado=X.PmpTriplet;break;case"pmpanapaest":e.rasgueado=X.PmpAnapaest;break;case"peitriplet":e.rasgueado=X.PeiTriplet;break;case"peianapaest":e.rasgueado=X.PeiAnapaest;break;case"paitriplet":e.rasgueado=X.PaiTriplet;break;case"paianapaest":e.rasgueado=X.PaiAnapaest;break;case"amitriplet":e.rasgueado=X.AmiTriplet;break;case"amianapaest":e.rasgueado=X.AmiAnapaest;break;case"ppp":e.rasgueado=X.Ppp;break;case"amii":e.rasgueado=X.Amii;break;case"amip":e.rasgueado=X.Amip;break;case"eami":e.rasgueado=X.Eami;break;case"eamii":e.rasgueado=X.Eamii;break;case"peami":e.rasgueado=X.Peami}return this._sy=this.newSy(),!0}if("ot"===i)this._sy=this.newSy(),this._sy!==S.String&&this.error("beat-ottava",S.String,!0),e.ottava=this.parseClefOttavaFromString(this._syData);else if("legatoorigin"===i)e.isLegatoOrigin=!0;else{if("instrument"!==i){if("fermata"===i){this._sy=this.newSy(),this._sy!==S.String&&this.error("fermata",S.Number,!0);const s=new kc;return s.type=this.parseFermataFromString(this._syData),this._allowFloat=!0,this._sy=this.newSy(),this._sy===S.Number&&(s.length=this._syData,this._sy=this.newSy()),this._allowFloat=!1,e.fermata=s,!0}if("beam"===i){switch(this._sy=this.newSy(),this._sy!==S.String&&this.error("beam",S.Number,!0),this._syData.toLowerCase()){case"invert":e.invertBeamDirection=!0;break;case"up":e.preferredBeamDirection=B.Up;break;case"down":e.preferredBeamDirection=B.Down;break;case"auto":e.beamingMode=St.Auto;break;case"split":e.beamingMode=St.ForceSplitToNext;break;case"merge":e.beamingMode=St.ForceMergeWithNext;break;case"splitsecondary":e.beamingMode=St.ForceSplitOnSecondaryToNext}return this._sy=this.newSy(),!0}return"timer"===i&&(e.showTimer=!0,this._sy=this.newSy(),!0)}{this._sy=this.newSy();let s=0;this._sy===S.Number?s=this._syData:this._sy===S.String?s=qs.getValue(this._syData):this.error("instrument-change",S.Number,!0);const r=new Xt;r.isLinear=!1,r.type=Bt.Instrument,r.value=s,e.automations.push(r)}}}}}}return this._sy=this.newSy(),!0}parseBracketExtendMode(e){switch(e.toLowerCase()){case"nobrackets":return Ys.NoBrackets;case"groupstaves":default:return Ys.GroupStaves;case"groupsimilarinstruments":return Ys.GroupSimilarInstruments}}parseFermataFromString(e){switch(e.toLowerCase()){case"short":return jn.Short;case"medium":default:return jn.Medium;case"long":return jn.Long}}parseClefOttavaFromString(e){switch(e.toLowerCase()){case"15ma":return we._15ma;case"8va":return we._8va;case"regular":default:return we.Regular;case"8vb":return we._8vb;case"15mb":return we._15mb}}getChordId(e,i){return i.toLowerCase()+e.index+e.track.index}static applyTuplet(e,i){switch(i){case 3:e.tupletNumerator=3,e.tupletDenominator=2;break;case 5:e.tupletNumerator=5,e.tupletDenominator=4;break;case 6:e.tupletNumerator=6,e.tupletDenominator=4;break;case 7:e.tupletNumerator=7,e.tupletDenominator=4;break;case 9:e.tupletNumerator=9,e.tupletDenominator=8;break;case 10:e.tupletNumerator=10,e.tupletDenominator=8;break;case 11:e.tupletNumerator=11,e.tupletDenominator=8;break;case 12:e.tupletNumerator=12,e.tupletDenominator=8;break;default:e.tupletNumerator=1,e.tupletDenominator=1}}isNoteText(e){return"x"===e||"-"===e||"r"===e}note(e){let i=!1,s=!1,r=-1,a=-1,o=-1,l=ke.Default;switch(this._sy){case S.Number:r=this._syData,this._currentStaff.isPercussion&&!nn.instrumentArticulations.has(r)&&this.errorMessage(`Unknown percussion articulation ${r}`);break;case S.String:if(this._currentStaff.isPercussion){const p=this._syData.toLowerCase();this._percussionArticulationNames.has(p)?r=this._percussionArticulationNames.get(p):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else i="x"===this._syData,s="-"===this._syData,s||i?r=0:this.error("note-fret",S.Number,!0);break;case S.Tuning:0===e.index&&0===e.voice.index&&0===e.voice.bar.index&&this.makeCurrentStaffPitched();const f=this._syData;a=f.octave,o=f.tone.noteValue,this._accidentalMode===Bh.Explicit&&(l=f.tone.accidentalMode);break;default:return!1}this._sy=this.newSy();const c=-1===a&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion;let u=-1;c&&(this._sy!==S.Dot&&this.error("note",S.Dot,!0),this._sy=this.newSy(),this._sy!==S.Number&&this.error("note-string",S.Number,!0),u=this._syData,(u<1||u>this._currentStaff.tuning.length)&&this.error("note-string",S.Number,!1),this._sy=this.newSy());const h=new is;if(c)h.string=this._currentStaff.tuning.length-(u-1),h.isDead=i,h.isTieDestination=s,s||(h.fret=r);else if(this._currentStaff.isPercussion){const f=r;let p=0;if(this._articulationValueToIndex.has(f))p=this._articulationValueToIndex.get(f);else{p=this._currentTrack.percussionArticulations.length;const g=nn.getArticulationByInputMidiNumber(f);null===g&&this.errorMessage(`Unknown articulation value ${f}`),this._currentTrack.percussionArticulations.push(g),this._articulationValueToIndex.set(f,p)}h.percussionArticulation=p}else h.octave=a,h.tone=o,h.accidentalMode=l,h.isTieDestination=s;return e.addNote(h),this.noteEffects(h),!0}noteEffects(e){if(this._sy===S.LBrace){for(this._sy=this.newSy();this._sy===S.String;){const i=this._syData.toLowerCase();if("b"===i||"be"===i){this._sy=this.newSy();const s="be"===i;for(this._sy===S.String&&(e.bendType=this.parseBendType(this._syData),this._sy=this.newSy()),this._sy===S.String&&(e.bendStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==S.LParensis&&this.error("bend-effect",S.LParensis,!0),this._sy=this.newSy();this._sy!==S.RParensis&&this._sy!==S.Eof;){let a=0,o=0;s?(this._sy!==S.Number&&this.error("bend-effect-value",S.Number,!0),a=this._syData,this._sy=this.newSy(),this._sy!==S.Number&&this.error("bend-effect-value",S.Number,!0),o=this._syData):(this._sy!==S.Number&&this.error("bend-effect-value",S.Number,!0),o=this._syData),e.addBendPoint(new V(a,o)),this._sy=this.newSy()}const r=e.bendPoints;if(null!=r){for(;r.length>60;)r.splice(r.length-1,1);if(s)r.sort((a,o)=>a.offset-o.offset);else{const a=r.length,o=60/(a-1)|0;let l=0;for(;l<a;)r[l].offset=Math.min(60,l*o),l++}}this._sy!==S.RParensis&&this.error("bend-effect",S.RParensis,!0),this._sy=this.newSy()}else if("nh"===i)e.harmonicType=ae.Natural,e.harmonicValue=H.deltaFretToHarmonicValue(e.fret),this._sy=this.newSy();else if("ah"===i)e.harmonicType=ae.Artificial,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if("th"===i)e.harmonicType=ae.Tap,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if("ph"===i)e.harmonicType=ae.Pinch,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if("sh"===i)e.harmonicType=ae.Semi,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if("fh"===i)e.harmonicType=ae.Feedback,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if("tr"===i){this._sy=this.newSy(),this._sy!==S.Number&&this.error("trill-effect",S.Number,!0);const s=this._syData;this._sy=this.newSy();let r=w.Sixteenth;if(this._sy===S.Number){switch(this._syData){case 16:default:r=w.Sixteenth;break;case 32:r=w.ThirtySecond;break;case 64:r=w.SixtyFourth}this._sy=this.newSy()}e.trillValue=s+e.stringTuning,e.trillSpeed=r}else if("v"===i)this._sy=this.newSy(),e.vibrato=Ie.Slight;else if("sl"===i)this._sy=this.newSy(),e.slideOutType=Se.Legato;else if("ss"===i)this._sy=this.newSy(),e.slideOutType=Se.Shift;else if("sib"===i)this._sy=this.newSy(),e.slideInType=pn.IntoFromBelow;else if("sia"===i)this._sy=this.newSy(),e.slideInType=pn.IntoFromAbove;else if("sou"===i)this._sy=this.newSy(),e.slideOutType=Se.OutUp;else if("sod"===i)this._sy=this.newSy(),e.slideOutType=Se.OutDown;else if("psd"===i)this._sy=this.newSy(),e.slideOutType=Se.PickSlideDown;else if("psu"===i)this._sy=this.newSy(),e.slideOutType=Se.PickSlideUp;else if("h"===i)this._sy=this.newSy(),e.isHammerPullOrigin=!0;else if("lht"===i)this._sy=this.newSy(),e.isLeftHandTapped=!0;else if("g"===i)this._sy=this.newSy(),e.isGhost=!0;else if("ac"===i)this._sy=this.newSy(),e.accentuated=Ot.Normal;else if("hac"===i)this._sy=this.newSy(),e.accentuated=Ot.Heavy;else if("ten"===i)this._sy=this.newSy(),e.accentuated=Ot.Tenuto;else if("pm"===i)this._sy=this.newSy(),e.isPalmMute=!0;else if("st"===i)this._sy=this.newSy(),e.isStaccato=!0;else if("lr"===i)this._sy=this.newSy(),e.isLetRing=!0;else if("x"===i)this._sy=this.newSy(),e.fret=0,e.isDead=!0;else if("-"===i||"t"===i)this._sy=this.newSy(),e.isTieDestination=!0;else if("lf"===i){this._sy=this.newSy();let s=se.Thumb;this._sy===S.Number&&(s=this.toFinger(this._syData),this._sy=this.newSy()),e.leftHandFinger=s}else if("rf"===i){this._sy=this.newSy();let s=se.Thumb;this._sy===S.Number&&(s=this.toFinger(this._syData),this._sy=this.newSy()),e.rightHandFinger=s}else if("acc"===i)this._sy=this.newSy(),this._sy!==S.String&&this.error("note-accidental",S.String,!0),e.accidentalMode=H.parseAccidentalMode(this._syData),this._sy=this.newSy();else if("turn"===i)this._sy=this.newSy(),e.ornament=Vt.Turn;else if("iturn"===i)this._sy=this.newSy(),e.ornament=Vt.InvertedTurn;else if("umordent"===i)this._sy=this.newSy(),e.ornament=Vt.UpperMordent;else if("lmordent"===i)this._sy=this.newSy(),e.ornament=Vt.LowerMordent;else if("string"===i)this._sy=this.newSy(),e.showStringNumber=!0;else if("hide"===i)this._sy=this.newSy(),e.isVisible=!1;else if("slur"===i){this._sy=this.newSy(),this._sy!==S.String&&this.error("slur",S.String,!0);const s=this._syData;if(this._slurs.has(s)){const r=this._slurs.get(s);r.slurDestination=e,e.slurOrigin=r,e.isSlurDestination=!0}else this._slurs.set(s,e);this._sy=this.newSy()}else this.applyBeatEffect(e.beat)||this.error(i,S.String,!1)}this._sy!==S.RBrace&&this.error("note-effect",S.RBrace,!1),this._sy=this.newSy()}}harmonicValue(e){return this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy(),this._sy===S.Number&&(e=this._syData,this._sy=this.newSy()),this._allowNegatives=!1,this._allowFloat=!1,e}toFinger(e){switch(e){case 1:return se.Thumb;case 2:return se.IndexFinger;case 3:return se.MiddleFinger;case 4:return se.AnnularFinger;case 5:return se.LittleFinger}return se.Thumb}parseDuration(e){switch(e){case-4:return w.QuadrupleWhole;case-2:return w.DoubleWhole;case 1:return w.Whole;case 2:return w.Half;case 4:return w.Quarter;case 8:return w.Eighth;case 16:return w.Sixteenth;case 32:return w.ThirtySecond;case 64:return w.SixtyFourth;case 128:return w.OneHundredTwentyEighth;case 256:return w.TwoHundredFiftySixth;default:return w.Quarter}}parseBendStyle(e){switch(e.toLowerCase()){case"gradual":return ct.Gradual;case"fast":return ct.Fast;default:return ct.Default}}parseBendType(e){switch(e.toLowerCase()){case"none":return J.None;case"custom":default:return J.Custom;case"bend":return J.Bend;case"release":return J.Release;case"bendrelease":return J.BendRelease;case"hold":return J.Hold;case"prebend":return J.Prebend;case"prebendbend":return J.PrebendBend;case"prebendrelease":return J.PrebendRelease}}barMeta(e){let i=!1;const s=e.masterBar;let r=!1;for(;!r&&this._sy===S.MetaCommand;){i=!0;const a=this._syData.toLowerCase();if("ts"===a)this._sy=this.newSy(),this._sy===S.String?"common"===this._syData.toLowerCase()?(s.timeSignatureCommon=!0,s.timeSignatureNumerator=4,s.timeSignatureDenominator=4,this._sy=this.newSy()):this.error("timesignature-numerator",S.String,!0):(this._sy!==S.Number&&this.error("timesignature-numerator",S.Number,!0),s.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==S.Number&&this.error("timesignature-denominator",S.Number,!0),s.timeSignatureDenominator=this._syData,this._sy=this.newSy());else if("ft"===a)s.isFreeTime=!0,this._sy=this.newSy();else if("ro"===a)s.isRepeatStart=!0,this._sy=this.newSy();else if("rc"===a)this._sy=this.newSy(),this._sy!==S.Number&&this.error("repeatclose",S.Number,!0),this._syData>2048&&this.error("repeatclose",S.Number,!1),s.repeatCount=this._syData,this._sy=this.newSy();else if("ae"===a)if(this._sy=this.newSy(),this._sy===S.LParensis){for(this._sy=this.newSy(),this._sy!==S.Number&&this.error("alternateending",S.Number,!0),this.applyAlternateEnding(s);this._sy===S.Number;)this.applyAlternateEnding(s);this._sy!==S.RParensis&&this.error("alternateending-list",S.RParensis,!0),this._sy=this.newSy()}else this._sy!==S.Number&&this.error("alternateending",S.Number,!0),this.applyAlternateEnding(s);else if("ks"===a)this._sy=this.newSy(),this._sy!==S.String&&this.error("keysignature",S.String,!0),e.keySignature=this.parseKeySignature(this._syData),e.keySignatureType=this.parseKeySignatureType(this._syData),this._sy=this.newSy();else if("clef"===a){switch(this._sy=this.newSy(),this._sy){case S.String:e.clef=this.parseClefFromString(this._syData);break;case S.Number:e.clef=this.parseClefFromInt(this._syData);break;case S.Tuning:e.clef=this.parseClefFromInt(this._syData.realValue);break;default:this.error("clef",S.String,!0)}this._sy=this.newSy()}else if("tempo"===a){const o=this.readTempoAutomation();s.tempoAutomations.push(o)}else if("section"===a){this._sy=this.newSy(),this._sy!==S.String&&this.error("section",S.String,!0);let o=this._syData;this._sy=this.newSy();let l="";this._sy===S.String&&!this.isNoteText(this._syData.toLowerCase())&&(l=o,o=this._syData,this._sy=this.newSy());const c=new Tc;c.marker=l,c.text=o,s.section=c}else if("tf"===a){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case S.String:s.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case S.Number:s.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",S.String,!0)}this._sy=this.newSy()}else if("ac"===a)s.isAnacrusis=!0,this._sy=this.newSy();else if("db"===a)s.isDoubleBar=!0,e.barLineRight=pe.LightLight,this._sy=this.newSy();else if("barlineleft"===a)this._sy=this.newSy(),this._sy!==S.String&&this.error("barlineleft",S.String,!0),e.barLineLeft=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if("barlineright"===a)this._sy=this.newSy(),this._sy!==S.String&&this.error("barlineright",S.String,!0),e.barLineRight=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if("accidentals"===a)this.handleAccidentalMode();else if("jump"===a)this.handleDirections(s);else if("ottava"===a)this._sy=this.newSy(),this._sy!==S.String&&this.error("ottava",S.String,!0),e.clefOttava=this.parseClefOttavaFromString(this._syData),this._sy=this.newSy();else if("simile"===a)this._sy=this.newSy(),this._sy!==S.String&&this.error("simile",S.String,!0),e.simileMark=this.parseSimileMarkFromString(this._syData),this._sy=this.newSy();else if("scale"===a)this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==S.Number&&this.error("scale",S.Number,!0),s.displayScale=this._syData,e.displayScale=this._syData,this._sy=this.newSy();else if("width"===a)this._sy=this.newSy(),this._sy!==S.Number&&this.error("width",S.Number,!0),s.displayWidth=this._syData,e.displayWidth=this._syData,this._sy=this.newSy();else if(0===e.index)switch(this.handleStaffMeta()){case Tn.KnownStaffMeta:break;case Tn.UnknownStaffMeta:this.error("measure-effects",S.String,!1);break;case Tn.EndOfMetaDetected:r=!0}else this.handleStaffMeta()===Tn.EndOfMetaDetected?r=!0:this.error("measure-effects",S.String,!1)}if(0===s.index&&0===s.tempoAutomations.length){const a=new Xt;a.isLinear=!1,a.type=Bt.Tempo,a.value=this._score.tempo,a.text=this._score.tempoLabel,s.tempoAutomations.push(a)}return i}parseBarLineStyle(e){switch(e.toLowerCase()){case"automatic":return pe.Automatic;case"dashed":return pe.Dashed;case"dotted":return pe.Dotted;case"heavy":return pe.Heavy;case"heavyheavy":return pe.HeavyHeavy;case"heavylight":return pe.HeavyLight;case"lightheavy":return pe.LightHeavy;case"lightlight":return pe.LightLight;case"none":return pe.None;case"regular":return pe.Regular;case"short":return pe.Short;case"tick":return pe.Tick}return pe.Automatic}parseSimileMarkFromString(e){switch(e.toLowerCase()){case"none":default:return $t.None;case"simple":return $t.Simple;case"firstofdouble":return $t.FirstOfDouble;case"secondofdouble":return $t.SecondOfDouble}}handleDirections(e){switch(this._sy=this.newSy(),this._sy!==S.String&&this.error("direction",S.String,!0),this._syData.toLowerCase()){case"fine":e.addDirection(A.TargetFine);break;case"segno":e.addDirection(A.TargetSegno);break;case"segnosegno":e.addDirection(A.TargetSegnoSegno);break;case"coda":e.addDirection(A.TargetCoda);break;case"doublecoda":e.addDirection(A.TargetDoubleCoda);break;case"dacapo":e.addDirection(A.JumpDaCapo);break;case"dacapoalcoda":e.addDirection(A.JumpDaCapoAlCoda);break;case"dacapoaldoublecoda":e.addDirection(A.JumpDaCapoAlDoubleCoda);break;case"dacapoalfine":e.addDirection(A.JumpDaCapoAlFine);break;case"dalsegno":e.addDirection(A.JumpDalSegno);break;case"dalsegnoalcoda":e.addDirection(A.JumpDalSegnoAlCoda);break;case"dalsegnoaldoublecoda":e.addDirection(A.JumpDalSegnoAlDoubleCoda);break;case"dalsegnoalfine":e.addDirection(A.JumpDalSegnoAlFine);break;case"dalsegnosegno":e.addDirection(A.JumpDalSegnoSegno);break;case"dalsegnosegnoalcoda":e.addDirection(A.JumpDalSegnoSegnoAlCoda);break;case"dalsegnosegnoaldoublecoda":e.addDirection(A.JumpDalSegnoSegnoAlDoubleCoda);break;case"dalsegnosegnoalfine":e.addDirection(A.JumpDalSegnoSegnoAlFine);break;case"dacoda":e.addDirection(A.JumpDaCoda);break;case"dadoublecoda":e.addDirection(A.JumpDaDoubleCoda);break;default:return void this.errorMessage(`Unexpected direction value: '${this._syData}'`)}this._sy=this.newSy()}readTempoAutomation(){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==S.Number&&this.error("tempo",S.Number,!0);const e=new Xt;return e.isLinear=!1,e.type=Bt.Tempo,e.value=this._syData,this._sy=this.newSy(),this._sy===S.String&&(e.text=this._syData,this._sy=this.newSy()),e}applyAlternateEnding(e){const i=this._syData;i<1&&this.error("alternateending",S.Number,!0),e.alternateEndings|=1<<i-1,this._sy=this.newSy()}parseWhammyType(e){switch(e.toLowerCase()){case"none":return Re.None;case"custom":default:return Re.Custom;case"dive":return Re.Dive;case"dip":return Re.Dip;case"hold":return Re.Hold;case"predive":return Re.Predive;case"predivedive":return Re.PrediveDive}}}return n.Eof=0,n})(),G$=(()=>{class n extends Ho{constructor(){super(...arguments),this._versionNumber=0,this._globalTripletFeel=_e.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._doubleBars=new Set,this._keySignatures=new Map,this._beatTextChunksByTrack=new Map,this._directionLookup=new Map}get name(){return"Guitar Pro 3-5"}readScore(){if(this._directionLookup.clear(),this.readVersion(),this._score=new Dr,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Ve.gpReadBool(this.data)?_e.Triplet8th:_e.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=T.readInt32LE(this.data),this._versionNumber>=510&&Ve.gpReadBool(this.data),T.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.readDirection(A.TargetCoda),this.readDirection(A.TargetDoubleCoda),this.readDirection(A.TargetSegno),this.readDirection(A.TargetSegnoSegno),this.readDirection(A.TargetFine),this.readDirection(A.JumpDaCapo),this.readDirection(A.JumpDaCapoAlCoda),this.readDirection(A.JumpDaCapoAlDoubleCoda),this.readDirection(A.JumpDaCapoAlFine),this.readDirection(A.JumpDalSegno),this.readDirection(A.JumpDalSegnoAlCoda),this.readDirection(A.JumpDalSegnoAlDoubleCoda),this.readDirection(A.JumpDalSegnoAlFine),this.readDirection(A.JumpDalSegnoSegno),this.readDirection(A.JumpDalSegnoSegnoAlCoda),this.readDirection(A.JumpDalSegnoSegnoAlDoubleCoda),this.readDirection(A.JumpDalSegnoSegnoAlFine),this.readDirection(A.JumpDaCoda),this.readDirection(A.JumpDaDoubleCoda),this.data.skip(4)),this._barCount=T.readInt32LE(this.data),this._trackCount=T.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const e=Xt.buildTempoAutomation(!1,0,this._score.tempo,2);e.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(e)}return H.consolidate(this._score),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readDirection(e){let s,i=T.readInt16LE(this.data);-1!==i&&(i--,this._directionLookup.has(i)?s=this._directionLookup.get(i):(s=[],this._directionLookup.set(i,s)),s.push(e))}readVersion(){let e=Ve.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(n.VersionString))throw new Ht("Unsupported format");e=e.substr(n.VersionString.length+1);const i=e.indexOf(".");this._versionNumber=100*Number.parseInt(e.substr(0,i))+Number.parseInt(e.substr(i+1)),x.debug(this.name,`Guitar Pro version ${e} detected`)}readScoreInformation(){this._score.title=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding);const e=T.readInt32LE(this.data);let i="";for(let s=0;s<e;s++)s>0&&(i+="\r\n"),i+=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding)?.toString();this._score.notices=i}readLyrics(){this._lyrics=[],this._lyricsTrack=T.readInt32LE(this.data)-1;for(let e=0;e<5;e++){const i=new vc;i.startBar=T.readInt32LE(this.data)-1,i.text=Ve.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(i)}}readPageSetup(){this.data.skip(28);const e=T.readInt16LE(this.data);H.getOrCreateHeaderFooterStyle(this._score,U.Title).isVisible=0!=(1&e),H.getOrCreateHeaderFooterStyle(this._score,U.Title).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.SubTitle).isVisible=0!=(2&e),H.getOrCreateHeaderFooterStyle(this._score,U.SubTitle).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.Artist).isVisible=0!=(4&e),H.getOrCreateHeaderFooterStyle(this._score,U.Artist).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.Album).isVisible=0!=(8&e),H.getOrCreateHeaderFooterStyle(this._score,U.Album).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.Words).isVisible=0!=(16&e),H.getOrCreateHeaderFooterStyle(this._score,U.Words).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.Music).isVisible=0!=(32&e),H.getOrCreateHeaderFooterStyle(this._score,U.Music).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.WordsAndMusic).isVisible=0!=(64&e),H.getOrCreateHeaderFooterStyle(this._score,U.WordsAndMusic).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.Copyright).isVisible=0!=(128&e),H.getOrCreateHeaderFooterStyle(this._score,U.Copyright).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),H.getOrCreateHeaderFooterStyle(this._score,U.CopyrightSecondLine).isVisible=0!=(128&e),H.getOrCreateHeaderFooterStyle(this._score,U.CopyrightSecondLine).template=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];let e=0;for(let i=0;i<64;i++){const s=new vS;s.primaryChannel=e++,s.secondaryChannel=e++,s.program=T.readInt32LE(this.data),s.volume=this.data.readByte(),s.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(s)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);const i=new Cr,s=this.data.readByte();if(1&s?i.timeSignatureNumerator=this.data.readByte():e&&(i.timeSignatureNumerator=e.timeSignatureNumerator),2&s?i.timeSignatureDenominator=this.data.readByte():e&&(i.timeSignatureDenominator=e.timeSignatureDenominator),i.isRepeatStart=0!=(4&s),8&s&&(i.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),16&s&&this._versionNumber<500){let o=e,l=0;for(;o&&!(o.isRepeatEnd&&o!==e||o.isRepeatStart);)l|=o.alternateEndings,o=o.previousMasterBar;let c=0;const u=this.data.readByte();for(let h=0;h<8;h++){const f=1<<h;u>h&&!(l&f)&&(c|=f)}i.alternateEndings=c}if(32&s){const o=new Tc;o.text=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),o.marker="",Ve.gpReadColor(this.data,!1),i.section=o}if(64&s&&this._keySignatures.set(this._score.masterBars.length,[T.readSInt8(this.data),this.data.readByte()]),this._versionNumber>=500&&3&s&&this.data.skip(4),this._versionNumber>=500&&(i.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:i.tripletFeel=_e.Triplet8th;break;case 2:i.tripletFeel=_e.Triplet16th}this.data.readByte()}else i.tripletFeel=this._globalTripletFeel;const r=0!=(128&s);i.isDoubleBar=r;const a=this._score.masterBars.length;if(this._directionLookup.has(a))for(const o of this._directionLookup.get(a))i.addDirection(o);this._score.addMasterBar(i),r&&this._doubleBars.add(i.index)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){const e=new Wo;e.ensureStaveCount(1),this._score.addTrack(e);const i=e.staves[0],s=this.data.readByte();e.name=Ve.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),1&s&&(i.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=0!=(8&s)),null===this._score.stylesheet.perTrackDisplayTuning&&(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(e.index,0!=(128&s));const r=T.readInt32LE(this.data),a=[];for(let u=0;u<7;u++){const h=T.readInt32LE(this.data);r>u&&a.push(h)}i.stringTuning.tunings=a;const o=T.readInt32LE(this.data),l=T.readInt32LE(this.data)-1,c=T.readInt32LE(this.data)-1;if(this.data.skip(4),l>=0&&l<this._playbackInfos.length){const u=this._playbackInfos[l];u.port=o,u.isSolo=0!=(16&s),u.isMute=0!=(32&s),u.secondaryChannel=c,qs.isGuitar(u.program)&&(i.displayTranspositionPitch=-12),e.playbackInfo=u}if(i.capo=T.readInt32LE(this.data),e.color=Ve.gpReadColor(this.data,!1),this._versionNumber>=500){const u=this.data.readByte();i.showTablature=0!=(1&u),i.showStandardNotation=0!=(2&u);const h=0!=(100&u);null===this._score.stylesheet.perTrackChordDiagramsOnTop&&(this._score.stylesheet.perTrackChordDiagramsOnTop=new Map),this._score.stylesheet.perTrackChordDiagramsOnTop.set(e.index,h),this.data.readByte(),this.data.skip(43)}this._versionNumber>=510&&(this.data.skip(4),Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let e=0;e<this._barCount;e++)for(let i=0;i<this._trackCount;i++)this.readBar(this._score.tracks[i])}readBar(e){const i=new vr,s=e.staves[0];if(s.isPercussion&&(i.clef=Be.Neutral),s.addBar(i),this._keySignatures.has(i.index)){const a=this._keySignatures.get(i.index);i.keySignature=a[0],i.keySignatureType=a[1]}else i.index>0&&(i.keySignature=i.previousBar.keySignature,i.keySignatureType=i.previousBar.keySignatureType);this._doubleBars.has(i.index)&&(i.barLineRight=pe.LightLight);let r=1;this._versionNumber>=500&&(this.data.readByte(),r=2);for(let a=0;a<r;a++)this.readVoice(e,i)}readVoice(e,i){const s=T.readInt32LE(this.data);if(0===s)return;const r=new Fi;i.addVoice(r);for(let a=0;a<s;a++)this.readBeat(e,i,r)}readBeat(e,i,s){const r=new Vn,a=this.data.readByte();if(1&a&&(r.dots=1),64&a){const h=this.data.readByte();r.isEmpty=0==(2&h)}switch(s.addBeat(r),T.readSInt8(this.data)){case-2:r.duration=w.Whole;break;case-1:r.duration=w.Half;break;case 0:r.duration=w.Quarter;break;case 1:r.duration=w.Eighth;break;case 2:r.duration=w.Sixteenth;break;case 3:r.duration=w.ThirtySecond;break;case 4:r.duration=w.SixtyFourth;break;default:r.duration=w.Quarter}if(32&a)switch(r.tupletNumerator=T.readInt32LE(this.data),r.tupletNumerator){case 1:r.tupletDenominator=1;break;case 3:r.tupletDenominator=2;break;case 5:case 6:case 7:r.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:r.tupletDenominator=8;break;case 2:case 4:case 8:break;default:r.tupletNumerator=1,r.tupletDenominator=1}2&a&&this.readChord(r);const l=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if(4&a){const h=Ve.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(l){const f=new vc;f.text=h.trim(),f.finish(!0);const p=[];for(let g=f.chunks.length-1;g>=0;g--)p.push(f.chunks[g]);this._beatTextChunksByTrack.set(e.index,p)}else r.text=h}let c=ae.None;8&a&&(c=this.readBeatEffects(r)),16&a&&this.readMixTableChange(r);const u=this.data.readByte();for(let h=6;h>=0;h--)if(u&1<<h&&6-h<i.staff.tuning.length){const f=this.readNote(e,i,s,r,6-h);c!==ae.None&&(f.harmonicType=c,f.harmonicType===ae.Natural&&(f.harmonicValue=H.deltaFretToHarmonicValue(f.fret)))}if(this._versionNumber>=500){const h=T.readInt16LE(this.data);if(1&h&&r.index>0&&(s.beats[r.index-1].beamingMode=St.ForceSplitToNext),2&h&&(r.preferredBeamDirection=B.Down),4&h&&r.index>0&&(s.beats[r.index-1].beamingMode=St.ForceMergeWithNext),8&h&&(r.preferredBeamDirection=B.Up),16&h&&(r.ottava=we._8va),32&h&&(r.ottava=we._8vb),64&h&&(r.ottava=we._15ma),256&h&&(r.ottava=we._15mb),2048&h){const f=0!==this.data.readByte();r.index>0&&f&&(s.beats[r.index-1].beamingMode=St.ForceSplitOnSecondaryToNext)}}l&&!r.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(r.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){const i=new Qr,s=H.newGuid();if(this._versionNumber>=500){this.data.skip(17),i.name=Ve.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),i.firstFret=T.readInt32LE(this.data);for(let o=0;o<7;o++){const l=T.readInt32LE(this.data);o<e.voice.bar.staff.tuning.length&&i.strings.push(l)}const r=this.data.readByte(),a=new Uint8Array(5);this.data.read(a,0,a.length);for(let o=0;o<r;o++)i.barreFrets.push(a[o]);this.data.skip(26)}else if(0!==this.data.readByte())if(this._versionNumber>=400){this.data.skip(16),i.name=Ve.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),i.firstFret=T.readInt32LE(this.data);for(let o=0;o<7;o++){const l=T.readInt32LE(this.data);o<e.voice.bar.staff.tuning.length&&i.strings.push(l)}const r=this.data.readByte(),a=new Uint8Array(5);this.data.read(a,0,a.length);for(let o=0;o<r;o++)i.barreFrets.push(a[o]);this.data.skip(26)}else{this.data.skip(25),i.name=Ve.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),i.firstFret=T.readInt32LE(this.data);for(let r=0;r<6;r++){const a=T.readInt32LE(this.data);r<e.voice.bar.staff.tuning.length&&i.strings.push(a)}this.data.skip(36)}else{const r=this._versionNumber>=406?7:6;if(i.name=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),i.firstFret=T.readInt32LE(this.data),i.firstFret>0)for(let a=0;a<r;a++){const o=T.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&i.strings.push(o)}}i.name&&(e.chordId=s,e.voice.bar.staff.addChord(e.chordId,i))}readBeatEffects(e){const i=this.data.readByte();let s=0;if(this._versionNumber>=400&&(s=this.data.readByte()),16&i&&(e.fade=un.FadeIn),(this._versionNumber<400&&1&i||2&i)&&(e.vibrato=Ie.Slight),1&s&&(e.rasgueado=X.Ii),32&i&&this._versionNumber>=400)switch(T.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0}else if(32&i){switch(T.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0}this.data.skip(4)}if(4&s&&this.readTremoloBarEffect(e),64&i){let r=0,a=0;this._versionNumber<500?(a=this.data.readByte(),r=this.data.readByte()):(r=this.data.readByte(),a=this.data.readByte()),r>0?(e.brushType=Y.BrushUp,e.brushDuration=n.toStrokeValue(r)):a>0&&(e.brushType=Y.BrushDown,e.brushDuration=n.toStrokeValue(a))}if(2&s)switch(T.readSInt8(this.data)){case 0:e.pickStroke=vn.None;break;case 1:e.pickStroke=vn.Up;break;case 2:e.pickStroke=vn.Down}if(this._versionNumber<400){if(4&i)return ae.Natural;if(8&i)return ae.Artificial}return ae.None}readTremoloBarEffect(e){this.data.readByte(),T.readInt32LE(this.data);const i=T.readInt32LE(this.data);if(i>0)for(let s=0;s<i;s++){const r=new V(0,0);r.offset=T.readInt32LE(this.data),r.value=T.readInt32LE(this.data)/n.BendStep|0,Ve.gpReadBool(this.data),e.addWhammyBarPoint(r)}}static toStrokeValue(e){switch(e){case 1:case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(e){const i=new z$;i.instrument=T.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),i.volume=T.readSInt8(this.data),i.balance=T.readSInt8(this.data);const s=T.readSInt8(this.data),r=T.readSInt8(this.data),a=T.readSInt8(this.data),o=T.readSInt8(this.data);if(this._versionNumber>=500&&(i.tempoName=Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding)),i.tempo=T.readInt32LE(this.data),i.volume>=0&&this.data.readByte(),i.balance>=0&&this.data.readByte(),s>=0&&this.data.readByte(),r>=0&&this.data.readByte(),a>=0&&this.data.readByte(),o>=0&&this.data.readByte(),i.tempo>=0&&(i.duration=T.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500){const l=T.readSInt8(this.data);l>=100?e.wahPedal=Li.Closed:l>=0&&(e.wahPedal=Li.Open)}if(this._versionNumber>=510&&(Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ve.gpReadStringIntByte(this.data,this.settings.importer.encoding)),i.volume>=0){const l=new Xt;l.isLinear=!0,l.type=Bt.Volume,l.value=i.volume,e.automations.push(l)}if(i.balance>=0){const l=new Xt;l.isLinear=!0,l.type=Bt.Balance,l.value=i.balance,e.automations.push(l)}if(i.instrument>=0){const l=new Xt;l.isLinear=!0,l.type=Bt.Instrument,l.value=i.instrument,e.automations.push(l)}if(i.tempo>=0){const l=new Xt;l.isLinear=!0,l.type=Bt.Tempo,l.value=i.tempo,e.automations.push(l),e.voice.bar.masterBar.tempoAutomations.push(l)}}readNote(e,i,s,r,a){const o=new is;o.string=i.staff.tuning.length-a;const l=this.data.readByte();if(2&l?o.accentuated=Ot.Heavy:64&l&&(o.accentuated=Ot.Normal),o.isGhost=0!=(4&l),32&l){const u=this.data.readByte();3===u?o.isDead=!0:2===u&&(o.isTieDestination=!0)}if(1&l&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),16&l){const u=T.readSInt8(this.data);o.dynamics=this.toDynamicValue(u),r.dynamics=o.dynamics}32&l&&(o.fret=T.readSInt8(this.data)),128&l&&(o.leftHandFinger=T.readSInt8(this.data),o.rightHandFinger=T.readSInt8(this.data));let c=!1;if(this._versionNumber>=500&&(1&l&&(o.durationPercent=T.readFloat64BE(this.data)),c=0!=(2&this.data.readByte())),r.addNote(o),8&l&&this.readNoteEffects(e,s,r,o),i.staff.isPercussion&&(o.percussionArticulation=o.fret,o.string=-1,o.fret=-1),c){const u=I.defaultAccidentals[o.realValueWithoutHarmonic%12];"#"===u?o.accidentalMode=ke.ForceFlat:"b"===u&&(o.accidentalMode=ke.ForceSharp)}return o}toDynamicValue(e){switch(e){case 1:return ie.PPP;case 2:return ie.PP;case 3:return ie.P;case 4:return ie.MP;case 5:return ie.MF;case 6:default:return ie.F;case 7:return ie.FF;case 8:return ie.FFF}}readNoteEffects(e,i,s,r){const a=this.data.readByte();let o=0;this._versionNumber>=400&&(o=this.data.readByte()),1&a&&this.readBend(r),16&a&&this.readGrace(i,r),4&o&&this.readTremoloPicking(s),8&o?this.readSlide(r):this._versionNumber<400&&4&a&&(r.slideOutType=Se.Shift),16&o&&this.readArtificialHarmonic(r),32&o&&this.readTrill(r),r.isLetRing=0!=(8&a),r.isHammerPullOrigin=0!=(2&a),64&o&&(r.vibrato=Ie.Slight),r.isPalmMute=0!=(2&o),r.isStaccato=0!=(1&o)}readBend(e){this.data.readByte(),T.readInt32LE(this.data);const i=T.readInt32LE(this.data);if(i>0)for(let s=0;s<i;s++){const r=new V(0,0);r.offset=T.readInt32LE(this.data),r.value=T.readInt32LE(this.data)/n.BendStep|0,Ve.gpReadBool(this.data),e.addBendPoint(r)}}readGrace(e,i){const s=new Vn,r=new is;switch(r.string=i.string,r.fret=T.readSInt8(this.data),s.duration=w.ThirtySecond,s.dynamics=this.toDynamicValue(T.readSInt8(this.data)),T.readSInt8(this.data)){case 0:case 2:break;case 1:r.slideOutType=Se.Legato,r.slideTarget=i;break;case 3:r.isHammerPullOrigin=!0}if(r.dynamics=s.dynamics,this.data.skip(1),this._versionNumber<500)s.graceType=re.BeforeBeat;else{const o=this.data.readByte();r.isDead=0!=(1&o),s.graceType=2&o?re.OnBeat:re.BeforeBeat}e.addGraceBeat(s),s.addNote(r)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=w.Eighth;break;case 2:e.tremoloSpeed=w.Sixteenth;break;case 3:e.tremoloSpeed=w.ThirtySecond}}readSlide(e){if(this._versionNumber>=500){const i=T.readSInt8(this.data);1&i?e.slideOutType=Se.Shift:2&i?e.slideOutType=Se.Legato:4&i?e.slideOutType=Se.OutDown:8&i&&(e.slideOutType=Se.OutUp),16&i?e.slideInType=pn.IntoFromBelow:32&i&&(e.slideInType=pn.IntoFromAbove)}else switch(T.readSInt8(this.data)){case 1:e.slideOutType=Se.Shift;break;case 2:e.slideOutType=Se.Legato;break;case 3:e.slideOutType=Se.OutDown;break;case 4:e.slideOutType=Se.OutUp;break;case-1:e.slideInType=pn.IntoFromBelow;break;case-2:e.slideInType=pn.IntoFromAbove}}readArtificialHarmonic(e){const i=this.data.readByte();if(this._versionNumber>=500)switch(i){case 1:e.harmonicType=ae.Natural,e.harmonicValue=H.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=ae.Artificial;break;case 3:e.harmonicType=ae.Tap,e.harmonicValue=H.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=ae.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=ae.Semi,e.harmonicValue=12}else if(this._versionNumber>=400)switch(i){case 1:e.harmonicType=ae.Natural;break;case 3:e.harmonicType=ae.Tap;break;case 4:e.harmonicType=ae.Pinch;break;case 5:e.harmonicType=ae.Semi;break;case 15:case 17:case 22:e.harmonicType=ae.Artificial}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=w.Sixteenth;break;case 2:e.trillSpeed=w.ThirtySecond;break;case 3:e.trillSpeed=w.SixtyFourth}}}return n.VersionString="FICHIER GUITAR PRO ",n.BendStep=25,n})();class Ve{static gpReadColor(t,e=!1){const i=t.readByte(),s=t.readByte(),r=t.readByte();let a=255;return e?a=t.readByte():t.skip(1),new st(i,s,r,a)}static gpReadBool(t){return 0!==t.readByte()}static gpReadStringIntUnused(t,e){return t.skip(4),Ve.gpReadString(t,t.readByte(),e)}static gpReadStringInt(t,e){return Ve.gpReadString(t,T.readInt32LE(t),e)}static gpReadStringIntByte(t,e){const i=T.readInt32LE(t)-1;return t.readByte(),Ve.gpReadString(t,i,e)}static gpReadString(t,e,i){const s=new Uint8Array(e);return t.read(s,0,s.length),T.toString(s,i)}static gpWriteString(t,e){const i=T.stringToBytes(e);t.writeByte(e.length),t.write(i,0,i.length)}static gpReadStringByteLength(t,e,i){const s=t.readByte(),r=Ve.gpReadString(t,s,i);return s<e&&t.skip(e-s),r}}class z${constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class kn{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}scaleWith(t){this.x*=t,this.y*=t,this.w*=t,this.h*=t}}var Ze=function(n){return n[n.Boolean=0]="Boolean",n[n.Integer=1]="Integer",n[n.Float=2]="Float",n[n.String=3]="String",n[n.Point=4]="Point",n[n.Size=5]="Size",n[n.Rectangle=6]="Rectangle",n[n.Color=7]="Color",n}(Ze||{});class Oi{constructor(t){this._types=new Map,this.raw=new Map,t&&this.read(t)}read(t){const e=Wt.fromBuffer(t),i=T.readInt32BE(e);for(let s=0;s<i;s++){const r=Ve.gpReadString(e,e.readByte(),"utf-8"),a=e.readByte();switch(this._types.set(r,a),a){case Ze.Boolean:const o=1===e.readByte();this.addValue(r,o);break;case Ze.Integer:const l=T.readInt32BE(e);this.addValue(r,l);break;case Ze.Float:const c=T.readFloat32BE(e);this.addValue(r,c);break;case Ze.String:const u=Ve.gpReadString(e,T.readInt16BE(e),"utf-8");this.addValue(r,u);break;case Ze.Point:const h=T.readInt32BE(e),f=T.readInt32BE(e);this.addValue(r,new V(h,f));break;case Ze.Size:const p=T.readInt32BE(e),g=T.readInt32BE(e);this.addValue(r,new V(p,g));break;case Ze.Rectangle:const m=new kn;m.x=T.readInt32BE(e),m.y=T.readInt32BE(e),m.w=T.readInt32BE(e),m.h=T.readInt32BE(e),this.addValue(r,m);break;case Ze.Color:const y=Ve.gpReadColor(e,!0);this.addValue(r,y)}}}apply(t){for(const[e,i]of this.raw)switch(e){case"StandardNotation/hideDynamics":t.stylesheet.hideDynamics=i;break;case"System/bracketExtendMode":t.stylesheet.bracketExtendMode=i;break;case"Global/useSystemSignSeparator":t.stylesheet.useSystemSignSeparator=i;break;case"Global/DisplayTuning":t.stylesheet.globalDisplayTuning=i;break;case"Global/DrawChords":t.stylesheet.globalDisplayChordDiagramsOnTop=i;break;case"System/showTrackNameSingle":i||(t.stylesheet.singleTrackTrackNamePolicy=Et.Hidden);break;case"System/showTrackNameMulti":i||(t.stylesheet.multiTrackTrackNamePolicy=Et.Hidden);break;case"System/trackNameModeSingle":if(t.stylesheet.singleTrackTrackNamePolicy!==Et.Hidden)switch(i){case 0:case 1:t.stylesheet.singleTrackTrackNamePolicy=Et.FirstSystem;break;case 2:t.stylesheet.singleTrackTrackNamePolicy=Et.AllSystems}break;case"System/trackNameModeMulti":if(t.stylesheet.multiTrackTrackNamePolicy!==Et.Hidden)switch(i){case 0:case 1:t.stylesheet.multiTrackTrackNamePolicy=Et.FirstSystem;break;case 2:t.stylesheet.multiTrackTrackNamePolicy=Et.AllSystems}break;case"System/shortTrackNameOnFirstSystem":t.stylesheet.firstSystemTrackNameMode=i?zn.ShortName:zn.FullName;break;case"System/shortTrackNameOnOtherSystems":t.stylesheet.otherSystemsTrackNameMode=i?zn.ShortName:zn.FullName;break;case"System/horizontalTrackNameOnFirstSystem":t.stylesheet.firstSystemTrackNameOrientation=i?$n.Horizontal:$n.Vertical;break;case"System/horizontalTrackNameOnOtherSystems":t.stylesheet.otherSystemsTrackNameOrientation=i?$n.Horizontal:$n.Vertical;break;case"Header/Title":H.getOrCreateHeaderFooterStyle(t,U.Title).template=i;break;case"Header/TitleAlignment":H.getOrCreateHeaderFooterStyle(t,U.Title).textAlign=this.toTextAlign(i);break;case"Header/drawTitle":H.getOrCreateHeaderFooterStyle(t,U.Title).isVisible=i;break;case"Header/Subtitle":H.getOrCreateHeaderFooterStyle(t,U.SubTitle).template=i;break;case"Header/SubtitleAlignment":H.getOrCreateHeaderFooterStyle(t,U.SubTitle).textAlign=this.toTextAlign(i);break;case"Header/drawSubtitle":H.getOrCreateHeaderFooterStyle(t,U.SubTitle).isVisible=i;break;case"Header/Artist":H.getOrCreateHeaderFooterStyle(t,U.Artist).template=i;break;case"Header/ArtistAlignment":H.getOrCreateHeaderFooterStyle(t,U.Artist).textAlign=this.toTextAlign(i);break;case"Header/drawArtist":H.getOrCreateHeaderFooterStyle(t,U.Artist).isVisible=i;break;case"Header/Album":H.getOrCreateHeaderFooterStyle(t,U.Album).template=i;break;case"Header/AlbumAlignment":H.getOrCreateHeaderFooterStyle(t,U.Album).textAlign=this.toTextAlign(i);break;case"Header/drawAlbum":H.getOrCreateHeaderFooterStyle(t,U.Album).isVisible=i;break;case"Header/Words":H.getOrCreateHeaderFooterStyle(t,U.Words).template=i;break;case"Header/WordsAlignment":H.getOrCreateHeaderFooterStyle(t,U.Words).textAlign=this.toTextAlign(i);break;case"Header/drawWords":H.getOrCreateHeaderFooterStyle(t,U.Words).isVisible=i;break;case"Header/Music":H.getOrCreateHeaderFooterStyle(t,U.Music).template=i;break;case"Header/MusicAlignment":H.getOrCreateHeaderFooterStyle(t,U.Music).textAlign=this.toTextAlign(i);break;case"Header/drawMusic":H.getOrCreateHeaderFooterStyle(t,U.Music).isVisible=i;break;case"Header/WordsAndMusic":H.getOrCreateHeaderFooterStyle(t,U.WordsAndMusic).template=i;break;case"Header/WordsAndMusicAlignment":H.getOrCreateHeaderFooterStyle(t,U.WordsAndMusic).textAlign=this.toTextAlign(i);break;case"Header/drawWordsAndMusic":H.getOrCreateHeaderFooterStyle(t,U.WordsAndMusic).isVisible=i;break;case"Header/Tabber":H.getOrCreateHeaderFooterStyle(t,U.Transcriber).template=i;break;case"Header/TabberAlignment":H.getOrCreateHeaderFooterStyle(t,U.Transcriber).textAlign=this.toTextAlign(i);break;case"Header/drawTabber":H.getOrCreateHeaderFooterStyle(t,U.Transcriber).isVisible=i;break;case"Footer/Copyright":H.getOrCreateHeaderFooterStyle(t,U.Copyright).template=i;break;case"Footer/CopyrightAlignment":H.getOrCreateHeaderFooterStyle(t,U.Copyright).textAlign=this.toTextAlign(i);break;case"Footer/drawCopyright":H.getOrCreateHeaderFooterStyle(t,U.Copyright).isVisible=i;break;case"Footer/Copyright2":H.getOrCreateHeaderFooterStyle(t,U.CopyrightSecondLine).template=i;break;case"Footer/Copyright2Alignment":H.getOrCreateHeaderFooterStyle(t,U.CopyrightSecondLine).textAlign=this.toTextAlign(i);break;case"Footer/drawCopyright2":H.getOrCreateHeaderFooterStyle(t,U.CopyrightSecondLine).isVisible=i}}toTextAlign(t){switch(t){case 0:return K.Left;case 1:return K.Center;case 2:return K.Right}return K.Left}addValue(t,e,i){this.raw.set(t,e),void 0!==i&&this._types.set(t,i)}writeTo(t){T.writeInt32BE(t,this.raw.size);for(const[e,i]of this.raw){const s=this.getDataType(e,i);switch(Ve.gpWriteString(t,e),t.writeByte(s),s){case Ze.Boolean:t.writeByte(i?1:0);break;case Ze.Integer:T.writeInt32BE(t,i);break;case Ze.Float:T.writeFloat32BE(t,i);break;case Ze.String:const r=T.stringToBytes(i);T.writeInt16BE(t,r.length),t.write(r,0,r.length);break;case Ze.Point:case Ze.Size:T.writeInt32BE(t,i.offset),T.writeInt32BE(t,i.value);break;case Ze.Rectangle:T.writeInt32BE(t,i.x),T.writeInt32BE(t,i.y),T.writeInt32BE(t,i.w),T.writeInt32BE(t,i.h);break;case Ze.Color:t.writeByte(i.r),t.writeByte(i.g),t.writeByte(i.b),t.writeByte(i.a)}}}getDataType(t,e){if(this._types.has(t))return this._types.get(t);const i=typeof e;switch(typeof e){case"string":return Ze.String;case"number":return e===(0|e)?Ze.Integer:Ze.Float;case"object":if(e instanceof V)return Ze.Point;if(e instanceof kn)return Ze.Rectangle;if(e instanceof st)return Ze.Color}throw new nt(it.General,`Unknown value type in BinaryStylesheet: ${i}`)}static writeForScore(t){const e=new Oi;switch(e.addValue("StandardNotation/hideDynamics",t.stylesheet.hideDynamics,Ze.Boolean),e.addValue("System/bracketExtendMode",t.stylesheet.bracketExtendMode,Ze.Integer),e.addValue("Global/useSystemSignSeparator",t.stylesheet.useSystemSignSeparator,Ze.Boolean),e.addValue("Global/DisplayTuning",t.stylesheet.globalDisplayTuning,Ze.Boolean),e.addValue("Global/DrawChords",t.stylesheet.globalDisplayChordDiagramsOnTop,Ze.Boolean),t.stylesheet.singleTrackTrackNamePolicy){case Et.Hidden:e.addValue("System/showTrackNameSingle",!1,Ze.Boolean);break;case Et.FirstSystem:e.addValue("System/trackNameModeSingle",0,Ze.Integer);break;case Et.AllSystems:e.addValue("System/trackNameModeSingle",2,Ze.Integer)}switch(t.stylesheet.multiTrackTrackNamePolicy){case Et.Hidden:e.addValue("System/trackNameModeMulti",!1,Ze.Boolean);break;case Et.FirstSystem:e.addValue("System/trackNameModeMulti",0,Ze.Integer);break;case Et.AllSystems:e.addValue("System/trackNameModeMulti",2,Ze.Integer)}switch(t.stylesheet.firstSystemTrackNameMode){case zn.FullName:e.addValue("System/shortTrackNameOnFirstSystem",!1,Ze.Boolean);break;case zn.ShortName:e.addValue("System/shortTrackNameOnFirstSystem",!0,Ze.Boolean)}switch(t.stylesheet.otherSystemsTrackNameMode){case zn.FullName:e.addValue("System/shortTrackNameOnOtherSystems",!1,Ze.Boolean);break;case zn.ShortName:e.addValue("System/shortTrackNameOnOtherSystems",!0,Ze.Boolean)}switch(t.stylesheet.firstSystemTrackNameOrientation){case $n.Horizontal:e.addValue("System/horizontalTrackNameOnFirstSystem",!0,Ze.Boolean);break;case $n.Vertical:e.addValue("System/horizontalTrackNameOnFirstSystem",!1,Ze.Boolean)}switch(t.stylesheet.otherSystemsTrackNameOrientation){case $n.Horizontal:e.addValue("System/horizontalTrackNameOnOtherSystems",!0,Ze.Boolean);break;case $n.Vertical:e.addValue("System/horizontalTrackNameOnOtherSystems",!1,Ze.Boolean)}const i=t.style;if(i)for(const[r,a]of i.headerAndFooter)switch(r){case U.Title:Oi.addHeaderAndFooter(e,a,"Header/","Title");break;case U.SubTitle:Oi.addHeaderAndFooter(e,a,"Header/","Subtitle");break;case U.Artist:Oi.addHeaderAndFooter(e,a,"Header/","Artist");break;case U.Album:Oi.addHeaderAndFooter(e,a,"Header/","Album");break;case U.Words:Oi.addHeaderAndFooter(e,a,"Header/","Words");break;case U.Music:Oi.addHeaderAndFooter(e,a,"Header/","Music");break;case U.WordsAndMusic:Oi.addHeaderAndFooter(e,a,"Header/","WordsAndMusic");break;case U.Transcriber:Oi.addHeaderAndFooter(e,a,"Header/","Tabber");break;case U.Copyright:Oi.addHeaderAndFooter(e,a,"Footer/","Copyright");break;case U.CopyrightSecondLine:Oi.addHeaderAndFooter(e,a,"Footer/","Copyright2")}const s=Wt.withCapacity(128);return e.writeTo(s),s.toArray()}static addHeaderAndFooter(t,e,i,s){void 0!==e.template&&t.addValue(`${i}${s}`,e.template,Ze.String),t.addValue(`${i}${s}Alignment`,e.textAlign,Ze.Integer),void 0!==e.isVisible&&t.addValue(`${i}draw${s}`,e.isVisible,Ze.Boolean)}}var qt=function(n){return n[n.None=0]="None",n[n.Element=1]="Element",n[n.Text=2]="Text",n[n.CDATA=3]="CDATA",n[n.Document=4]="Document",n[n.DocumentType=5]="DocumentType",n}(qt||{});class Bs{constructor(){this.nodeType=qt.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}*childElements(){for(const t of this.childNodes)t.nodeType===qt.Element&&(yield t)}addChild(t){this.childNodes.push(t),this.firstChild=t,(t.nodeType===qt.Element||t.nodeType===qt.CDATA)&&(this.firstElement=t)}getAttribute(t,e=""){return this.attributes.has(t)?this.attributes.get(t):e}getElementsByTagName(t,e=!1){const i=[];return this.searchElementsByTagName(this.childNodes,i,t,e),i}searchElementsByTagName(t,e,i,s=!1){for(const r of t)r&&r.nodeType===qt.Element&&r.localName===i&&e.push(r),s&&this.searchElementsByTagName(r.childNodes,e,i,!0)}findChildElement(t){for(const e of this.childNodes)if(e&&e.nodeType===qt.Element&&e.localName===t)return e;return null}addElement(t){const e=new Bs;return e.nodeType=qt.Element,e.localName=t,this.addChild(e),e}get innerText(){if(this.nodeType===qt.Element||this.nodeType===qt.Document){if(this.firstElement&&this.firstElement.nodeType===qt.CDATA)return this.firstElement.innerText;let t="";for(const i of this.childNodes)t+=i.innerText?.toString();return t.trim()}return this.value??""}set innerText(t){const e=new Bs;e.nodeType=qt.Text,e.value=t,this.childNodes=[e]}setCData(t){const e=new Bs;e.nodeType=qt.CDATA,e.value=t,this.childNodes=[e]}}class Vi extends nt{constructor(t,e,i){super(it.Format,t),this.pos=0,this.xml=e,this.pos=i,Object.setPrototypeOf(this,Vi.prototype)}}var be=function(n){return n[n.IgnoreSpaces=0]="IgnoreSpaces",n[n.Begin=1]="Begin",n[n.BeginNode=2]="BeginNode",n[n.TagName=3]="TagName",n[n.Body=4]="Body",n[n.AttribName=5]="AttribName",n[n.Equals=6]="Equals",n[n.AttvalBegin=7]="AttvalBegin",n[n.AttribVal=8]="AttribVal",n[n.Childs=9]="Childs",n[n.Close=10]="Close",n[n.WaitEnd=11]="WaitEnd",n[n.WaitEndRet=12]="WaitEndRet",n[n.Pcdata=13]="Pcdata",n[n.Header=14]="Header",n[n.Comment=15]="Comment",n[n.Doctype=16]="Doctype",n[n.Cdata=17]="Cdata",n[n.Escape=18]="Escape",n}(be||{});class te{static parse(t,e,i){let s=t.charCodeAt(e),r=be.Begin,a=be.Begin,o=0,l="",c=be.Begin,u=null,h=null,f=0,p=0;for(;e<t.length;){switch(s=t.charCodeAt(e),r){case be.IgnoreSpaces:switch(s){case te.CharCodeLF:case te.CharCodeCR:case te.CharCodeTab:case te.CharCodeSpace:break;default:r=a;continue}break;case be.Begin:if(s!==te.CharCodeLowerThan){o=e,r=be.Pcdata;continue}r=be.IgnoreSpaces,a=be.BeginNode;break;case be.Pcdata:if(s===te.CharCodeLowerThan){l+=t.substr(o,e-o);const g=new Bs;g.nodeType=qt.Text,g.value=l,l="",i.addChild(g),r=be.IgnoreSpaces,a=be.BeginNode}else s===te.CharCodeAmp&&(l+=t.substr(o,e-o),r=be.Escape,c=be.Pcdata,o=e+1);break;case be.Cdata:if(s===te.CharCodeBrackedClose&&t.charCodeAt(e+1)===te.CharCodeBrackedClose&&t.charCodeAt(e+2)===te.CharCodeGreaterThan){const g=new Bs;g.nodeType=qt.CDATA,g.value=t.substr(o,e-o),i.addChild(g),e+=2,r=be.Begin}break;case be.BeginNode:switch(s){case te.CharCodeExclamation:if(t.charCodeAt(e+1)===te.CharCodeBrackedOpen){if("CDATA["!==t.substr(e+=2,6).toUpperCase())throw new Vi("Expected <![CDATA[",t,e);r=be.Cdata,o=(e+=5)+1}else if(t.charCodeAt(e+1)===te.CharCodeUpperD||t.charCodeAt(e+1)===te.CharCodeLowerD){if("OCTYPE"!==t.substr(e+2,6).toUpperCase())throw new Vi("Expected <!DOCTYPE",t,e);r=be.Doctype,o=(e+=8)+1}else{if(t.charCodeAt(e+1)!==te.CharCodeMinus||t.charCodeAt(e+2)!==te.CharCodeMinus)throw new Vi("Expected \x3c!--",t,e);r=be.Comment,o=(e+=2)+1}break;case te.CharCodeQuestion:r=be.Header,o=e;break;case te.CharCodeSlash:if(!i)throw new Vi("Expected node name",t,e);o=e+1,r=be.IgnoreSpaces,a=be.Close;break;default:r=be.TagName,o=e;continue}break;case be.TagName:if(!te.isValidChar(s)){if(e===o)throw new Vi("Expected node name",t,e);u=new Bs,u.nodeType=qt.Element,u.localName=t.substr(o,e-o),i.addChild(u),r=be.IgnoreSpaces,a=be.Body;continue}break;case be.Body:switch(s){case te.CharCodeSlash:r=be.WaitEnd;break;case te.CharCodeGreaterThan:r=be.Childs;break;default:r=be.AttribName,o=e;continue}break;case be.AttribName:if(!te.isValidChar(s)){if(o===e)throw new Vi("Expected attribute name",t,e);if(h=t.substr(o,e-o),u.attributes.has(h))throw new Vi(`Duplicate attribute [${h}]`,t,e);r=be.IgnoreSpaces,a=be.Equals;continue}break;case be.Equals:if(s!==te.CharCodeEquals)throw new Vi("Expected =",t,e);r=be.IgnoreSpaces,a=be.AttvalBegin;break;case be.AttvalBegin:switch(s){case te.CharCodeDoubleQuote:case te.CharCodeSingleQuote:l="",r=be.AttribVal,o=e+1,p=s}break;case be.AttribVal:if(s===te.CharCodeAmp)l+=t.substr(o,e-o),r=be.Escape,c=be.AttribVal,o=e+1;else if(s===p){l+=t.substr(o,e-o);const g=l;l="",u.attributes.set(h,g),r=be.IgnoreSpaces,a=be.Body}break;case be.Childs:o=e=te.parse(t,e,u),r=be.Begin;break;case be.WaitEnd:if(s!==te.CharCodeGreaterThan)throw new Vi("Expected >",t,e);r=be.Begin;break;case be.WaitEndRet:if(s===te.CharCodeGreaterThan)return e;throw new Vi("Expected >",t,e);case be.Close:if(!te.isValidChar(s)){if(o===e)throw new Vi("Expected node name",t,e);if(t.substr(o,e-o)!==i.localName)throw new Vi(`Expected </${i.localName}>`,t,e);r=be.IgnoreSpaces,a=be.WaitEndRet;continue}break;case be.Comment:s===te.CharCodeMinus&&t.charCodeAt(e+1)===te.CharCodeMinus&&t.charCodeAt(e+2)===te.CharCodeGreaterThan&&(e+=2,r=be.Begin);break;case be.Doctype:if(s===te.CharCodeBrackedOpen)f++;else if(s===te.CharCodeBrackedClose)f--;else if(s===te.CharCodeGreaterThan&&0===f){const g=new Bs;g.nodeType=qt.DocumentType,g.value=t.substr(o,e-o),i.addChild(g),r=be.Begin}break;case be.Header:s===te.CharCodeQuestion&&t.charCodeAt(e+1)===te.CharCodeGreaterThan&&(e++,r=be.Begin);break;case be.Escape:if(s===te.CharCodeSemi){const g=t.substr(o,e-o);if(g.charCodeAt(0)===te.CharCodeSharp){const m=g.charCodeAt(1)===te.CharCodeLowerX?Number.parseInt(`0${g.substr(1,g.length-1)}`):Number.parseInt(g.substr(1,g.length-1));l+=String.fromCharCode(m)}else te.Escapes.has(g)?l+=te.Escapes.get(g):l+=`&${g};`?.toString();o=e+1,r=c}else!te.isValidChar(s)&&s!==te.CharCodeSharp&&(l+="&",l+=t.substr(o,e-o),o=1+--e,r=c)}e++}if(r===be.Begin&&(o=e,r=be.Pcdata),r===be.Pcdata){if(e!==o){l+=t.substr(o,e-o);const g=new Bs;g.nodeType=qt.Text,g.value=l,i.addChild(g)}return e}if(r===be.Escape&&c===be.Pcdata){l+="&",l+=t.substr(o,e-o);const g=new Bs;return g.nodeType=qt.Text,g.value=l,i.addChild(g),e}throw new Vi("Unexpected end",t,e)}static isValidChar(t){return t>=te.CharCodeLowerA&&t<=te.CharCodeLowerZ||t>=te.CharCodeUpperA&&t<=te.CharCodeUpperZ||t>=te.CharCode0&&t<=te.CharCode9||t===te.CharCodeColon||t===te.CharCodeDot||t===te.CharCodeUnderscore||t===te.CharCodeMinus}}te.CharCodeLF=10,te.CharCodeTab=9,te.CharCodeCR=13,te.CharCodeSpace=32,te.CharCodeLowerThan=60,te.CharCodeAmp=38,te.CharCodeBrackedClose=93,te.CharCodeBrackedOpen=91,te.CharCodeGreaterThan=62,te.CharCodeExclamation=33,te.CharCodeUpperD=68,te.CharCodeLowerD=100,te.CharCodeMinus=45,te.CharCodeQuestion=63,te.CharCodeSlash=47,te.CharCodeEquals=61,te.CharCodeDoubleQuote=34,te.CharCodeSingleQuote=39,te.CharCodeSharp=35,te.CharCodeLowerX=120,te.CharCodeLowerA=97,te.CharCodeLowerZ=122,te.CharCodeUpperA=65,te.CharCodeUpperZ=90,te.CharCode0=48,te.CharCode9=57,te.CharCodeColon=58,te.CharCodeDot=46,te.CharCodeUnderscore=95,te.CharCodeSemi=59,te.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class TS{static write(t,e,i){const s=new TS(e,i);return s.writeNode(t),s.toString()}constructor(t,e){this._result=[],this._indention=t,this._xmlHeader=e,this._currentIndention="",this._isStartOfLine=!0}writeNode(t){switch(t.nodeType){case qt.None:break;case qt.Element:this._result.length>0&&this.writeLine(),this.write(`<${t.localName}`);for(const[e,i]of t.attributes)this.write(` ${e}="`),this.writeAttributeValue(i),this.write('"');if(0===t.childNodes.length)this.write("/>");else{if(this.write(">"),1!==t.childNodes.length||t.firstElement){this.indent();for(const e of t.childNodes)e.nodeType===qt.Element&&this.writeNode(e);this.unindend(),this.writeLine()}else this.writeNode(t.childNodes[0]);this.write(`</${t.localName}>`)}break;case qt.Text:t.value&&this.write(t.value);break;case qt.CDATA:null!==t.value&&this.write(`<![CDATA[${t.value}]]>`);break;case qt.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const e of t.childNodes)this.writeNode(e);break;case qt.DocumentType:this.write(`<!DOCTYPE ${t.value}>`)}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(t){for(let e=0;e<t.length;e++){const i=t.charAt(e);switch(i){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(i)}}}write(t){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(t),this._isStartOfLine=!1}writeLine(t=null){t&&this.write(t),this._indention.length>0&&!this._isStartOfLine&&(this._result.push("\n"),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class Ph extends Bs{constructor(){super(),this.nodeType=qt.Document}parse(t){te.parse(t,0,this)}toString(){return this.toFormattedString()}toFormattedString(t="",e=!1){return TS.write(this,t,e)}}class $${constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=w.Quarter}}class j${constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return`${this.path};${this.name};${this.role}`}}class W{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1,this._doubleBars=new Set,this._keySignatures=new Map}parseXml(t,e){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._sustainPedalsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;const i=new Ph;try{i.parse(t)}catch(s){throw new Ht("Could not parse XML",s)}if(this.parseDom(i),this.buildModel(),H.consolidate(this.score),this.score.finish(e),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[s,r]of this._lyricsByTrack)this._tracksById.get(s).applyLyrics(r)}parseDom(t){const e=t.firstElement;if(e){if("GPIF"!==e.localName)throw new Ht("Root node of XML was not GPIF");this.score=new Dr;for(const i of e.childElements())switch(i.localName){case"Score":this.parseScoreNode(i);break;case"MasterTrack":this.parseMasterTrackNode(i);break;case"Tracks":this.parseTracksNode(i);break;case"MasterBars":this.parseMasterBarsNode(i);break;case"Bars":this.parseBars(i);break;case"Voices":this.parseVoices(i);break;case"Beats":this.parseBeats(i);break;case"Notes":this.parseNotes(i);break;case"Rhythms":this.parseRhythms(i)}}}parseScoreNode(t){for(const e of t.childElements())switch(e.localName){case"Title":this.score.title=e.innerText;break;case"SubTitle":this.score.subTitle=e.innerText;break;case"Artist":this.score.artist=e.innerText;break;case"Album":this.score.album=e.innerText;break;case"Words":this.score.words=e.innerText;break;case"Music":this.score.music=e.innerText;break;case"WordsAndMusic":const i=e.innerText;""!==i&&(i&&!this.score.words&&(this.score.words=i),i&&!this.score.music&&(this.score.music=i));break;case"Copyright":this.score.copyright=e.innerText;break;case"Tabber":this.score.tab=e.innerText;break;case"Instructions":this.score.instructions=e.innerText;break;case"Notices":this.score.notices=e.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=W.parseIntSafe(e.innerText,4);break;case"ScoreSystemsLayout":this.score.systemsLayout=W.splitSafe(e.innerText).map(s=>W.parseIntSafe(s,4))}}static parseIntSafe(t,e){if(!t)return e;const i=Number.parseInt(t);return Number.isNaN(i)?e:i}static parseFloatSafe(t,e){if(!t)return e;const i=Number.parseFloat(t);return Number.isNaN(i)?e:i}static splitSafe(t,e=" "){return t?t.split(e).map(i=>i.trim()).filter(i=>i.length>0):[]}parseMasterTrackNode(t){for(const e of t.childElements())switch(e.localName){case"Automations":this.parseAutomations(e,this._masterTrackAutomations,null,null);break;case"Tracks":this._tracksMapping=W.splitSafe(e.innerText);break;case"Anacrusis":this._hasAnacrusis=!0}}parseAutomations(t,e,i,s){for(const r of t.childElements())"Automation"===r.localName&&this.parseAutomation(r,e,i,s)}parseAutomation(t,e,i,s){let r=null,a=!1,o=-1,l=0,c=0,u=null,h=0,f=null;for(const g of t.childElements())switch(g.localName){case"Type":r=g.innerText;break;case"Linear":a="true"===g.innerText.toLowerCase();break;case"Bar":o=W.parseIntSafe(g.innerText,0);break;case"Position":l=W.parseFloatSafe(g.innerText,0);break;case"Value":if(g.firstElement&&g.firstElement.nodeType===qt.CDATA)u=g.innerText;else{const m=W.splitSafe(g.innerText);1===m.length?(c=W.parseFloatSafe(m[0],0),h=1):(c=W.parseFloatSafe(m[0],0),h=W.parseIntSafe(m[1],0))}break;case"Text":f=g.innerText}if(!r)return;let p=null;switch(r){case"Tempo":p=Xt.buildTempoAutomation(a,l,c,h);break;case"Sound":u&&i&&i.has(u)&&(p=Xt.buildInstrumentAutomation(a,l,i.get(u).program));break;case"SustainPedal":if(s){let g;s.has(o)?g=s.get(o):(g=[],s.set(o,g));const m=new Ua;switch(m.ratioPosition=l,h){case 1:m.pedalType=jt.Down;break;case 3:m.pedalType=jt.Up}g.push(m)}}p&&(f&&(p.text=f),o>=0&&(e.has(o)||e.set(o,[]),e.get(o).push(p)))}parseTracksNode(t){for(const e of t.childElements())"Track"===e.localName&&this.parseTrack(e)}parseTrack(t){this._articulationByName=new Map;const e=new Wo;e.ensureStaveCount(1),e.staves[0].showStandardNotation=!0;const s=t.getAttribute("id");for(const r of t.childElements())switch(r.localName){case"Name":e.name=r.innerText;break;case"Color":const a=W.splitSafe(r.innerText);if(a.length>=3){const c=W.parseIntSafe(a[0],0),u=W.parseIntSafe(a[1],0),h=W.parseIntSafe(a[2],0);e.color=new st(c,u,h,255)}break;case"Instrument":const o=r.getAttribute("ref");(o.endsWith("-gs")||o.endsWith("GrandStaff"))&&(e.ensureStaveCount(2),e.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(e,r);break;case"NotationPatch":this.parseNotationPatch(e,r);break;case"ShortName":e.shortName=r.innerText;break;case"SystemsDefautLayout":e.defaultSystemsLayout=W.parseIntSafe(r.innerText,4);break;case"SystemsLayout":e.systemsLayout=W.splitSafe(r.innerText).map(c=>W.parseIntSafe(c,4));break;case"Lyrics":this.parseLyrics(s,r);break;case"Properties":this.parseTrackProperties(e,r);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(e,r);break;case"Sounds":this.parseSounds(s,e,r);break;case"PlaybackState":const l=r.innerText;e.playbackInfo.isSolo="Solo"===l,e.playbackInfo.isMute="Mute"===l;break;case"PartSounding":this.parsePartSounding(e,r);break;case"Staves":this.parseStaves(e,r);break;case"Transpose":this.parseTranspose(e,r);break;case"RSE":this.parseRSE(e,r);break;case"Automations":this.parseTrackAutomations(s,r)}this._tracksById.set(s,e)}parseTrackAutomations(t,e){const i=new Map;this._automationsPerTrackIdAndBarIndex.set(t,i);const s=new Map;this._sustainPedalsPerTrackIdAndBarIndex.set(t,s),this.parseAutomations(e,i,this._soundsByTrack.get(t),s)}parseNotationPatch(t,e){for(const i of e.childElements())switch(i.localName){case"LineCount":const s=W.parseIntSafe(i.innerText,5);for(const r of t.staves)r.standardNotationLineCount=s;break;case"Elements":this.parseElements(t,i)}}parseInstrumentSet(t,e){for(const i of e.childElements())switch(i.localName){case"Type":if("drumKit"===i.innerText)for(const r of t.staves)r.isPercussion=!0;break;case"Elements":this.parseElements(t,i);break;case"LineCount":const s=W.parseIntSafe(i.innerText,5);for(const r of t.staves)r.standardNotationLineCount=s}}parseElements(t,e){for(const i of e.childElements())"Element"===i.localName&&this.parseElement(t,i)}parseElement(t,e){const i=e.findChildElement("Type")?.innerText??"";for(const s of e.childElements())switch(s.localName){case"Name":case"Articulations":this.parseArticulations(t,s,i)}}parseArticulations(t,e,i){for(const s of e.childElements())"Articulation"===s.localName&&this.parseArticulation(t,s,i)}parseArticulation(t,e,i){const s=new q;s.outputMidiNumber=-1,s.elementType=i;let r="";for(const a of e.childElements()){const o=a.innerText;switch(a.localName){case"Name":r=a.innerText;break;case"OutputMidiNumber":s.outputMidiNumber=W.parseIntSafe(o,0);break;case"TechniqueSymbol":s.techniqueSymbol=this.parseTechniqueSymbol(o);break;case"TechniquePlacement":switch(o){case"outside":case"above":s.techniqueSymbolPlacement=ge.Bottom;break;case"inside":s.techniqueSymbolPlacement=ge.Middle;break;case"below":s.techniqueSymbolPlacement=ge.Top}break;case"Noteheads":const l=W.splitSafe(o);l.length>=1&&(s.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(s.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(s.noteHeadWhole=this.parseNoteHead(l[2])),s.noteHeadHalf===d.None&&(s.noteHeadHalf=s.noteHeadDefault),s.noteHeadWhole===d.None&&(s.noteHeadWhole=s.noteHeadDefault);break;case"StaffLine":s.staffLine=W.parseIntSafe(o,0)}}-1!==s.outputMidiNumber?(t.percussionArticulations.push(s),r.length>0&&this._articulationByName.set(r,s)):r.length>0&&this._articulationByName.has(r)&&(this._articulationByName.get(r).staffLine=s.staffLine)}parseTechniqueSymbol(t){switch(t){case"pictEdgeOfCymbal":return d.PictEdgeOfCymbal;case"articStaccatoAbove":return d.ArticStaccatoAbove;case"noteheadParenthesis":return d.NoteheadParenthesis;case"stringsUpBow":return d.StringsUpBow;case"stringsDownBow":return d.StringsDownBow;case"guitarGolpe":return d.GuitarGolpe;default:return d.None}}parseNoteHead(t){switch(t){case"noteheadDoubleWholeSquare":return d.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return d.NoteheadDoubleWhole;case"noteheadWhole":return d.NoteheadWhole;case"noteheadHalf":return d.NoteheadHalf;case"noteheadBlack":return d.NoteheadBlack;case"noteheadNull":return d.NoteheadNull;case"noteheadXOrnate":return d.NoteheadXOrnate;case"noteheadTriangleUpWhole":return d.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return d.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return d.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return d.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return d.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return d.NoteheadDiamondWhiteWide;case"noteheadCircleX":return d.NoteheadCircleX;case"noteheadXWhole":return d.NoteheadXWhole;case"noteheadXHalf":return d.NoteheadXHalf;case"noteheadXBlack":return d.NoteheadXBlack;case"noteheadParenthesis":return d.NoteheadParenthesis;case"noteheadSlashedBlack2":return d.NoteheadSlashedBlack2;case"noteheadCircleSlash":return d.NoteheadCircleSlash;case"noteheadHeavyX":return d.NoteheadHeavyX;case"noteheadHeavyXHat":return d.NoteheadHeavyXHat;default:return x.warning("GPIF","Unknown notehead symbol",t),d.None}}parseStaves(t,e){let i=0;for(const s of e.childElements())"Staff"===s.localName&&(t.ensureStaveCount(i+1),this.parseStaff(t.staves[i],s),i++)}parseStaff(t,e){for(const i of e.childElements())"Properties"===i.localName&&this.parseStaffProperties(t,i)}parseStaffProperties(t,e){for(const i of e.childElements())"Property"===i.localName&&this.parseStaffProperty(t,i)}parseStaffProperty(t,e){switch(e.getAttribute("name")){case"Tuning":for(const r of e.childElements())switch(r.localName){case"Pitches":const a=W.splitSafe(e.findChildElement("Pitches")?.innerText),o=new Array(a.length);for(let l=0;l<o.length;l++)o[o.length-1-l]=W.parseIntSafe(a[l],0);t.stringTuning.tunings=o;break;case"Label":t.stringTuning.name=r.innerText}t.isPercussion||(t.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(t,e);break;case"CapoFret":const s=W.parseIntSafe(e.findChildElement("Fret")?.innerText,0);t.capo=s}}parseLyrics(t,e){const i=[];for(const s of e.childElements())"Line"===s.localName&&i.push(this.parseLyricsLine(s));this._lyricsByTrack.set(t,i)}parseLyricsLine(t){const e=new vc;for(const i of t.childElements())switch(i.localName){case"Offset":e.startBar=W.parseIntSafe(i.innerText,0);break;case"Text":e.text=i.innerText}return e}parseDiagramCollectionForTrack(t,e){const i=e.findChildElement("Items");if(i)for(const s of i.childElements())"Item"===s.localName&&this.parseDiagramItemForTrack(t,s)}parseDiagramCollectionForStaff(t,e){const i=e.findChildElement("Items");if(i)for(const s of i.childElements())"Item"===s.localName&&this.parseDiagramItemForStaff(t,s)}parseDiagramItemForTrack(t,e){const i=new Qr,s=e.getAttribute("id");for(const r of t.staves)r.addChord(s,i);this.parseDiagramItemForChord(i,e)}parseDiagramItemForStaff(t,e){const i=new Qr,s=e.getAttribute("id");t.addChord(s,i),this.parseDiagramItemForChord(i,e)}parseDiagramItemForChord(t,e){t.name=e.getAttribute("name");const i=e.findChildElement("Diagram");if(!i)return t.showDiagram=!1,void(t.showFingering=!1);const s=W.parseIntSafe(i.getAttribute("stringCount"),6),r=W.parseIntSafe(i.getAttribute("baseFret"),0);t.firstFret=r+1;for(let a=0;a<s;a++)t.strings.push(-1);for(const a of i.childElements())switch(a.localName){case"Fret":const o=W.parseIntSafe(a.getAttribute("string"),0);t.strings[s-o-1]=r+W.parseIntSafe(a.getAttribute("fret"),0);break;case"Fingering":const l=new Map;for(const c of a.childElements())if("Position"===c.localName){let u=se.Unknown;const h=r+W.parseIntSafe(c.getAttribute("fret"),0);switch(c.getAttribute("finger")){case"Index":u=se.IndexFinger;break;case"Middle":u=se.MiddleFinger;break;case"Rank":u=se.AnnularFinger;break;case"Pinky":u=se.LittleFinger;break;case"Thumb":u=se.Thumb}u!==se.Unknown&&(l.has(u)?t.barreFrets.push(h):l.set(u,!0))}break;case"Property":switch(a.getAttribute("name")){case"ShowName":t.showName="true"===a.getAttribute("value");break;case"ShowDiagram":t.showDiagram="true"===a.getAttribute("value");break;case"ShowFingering":t.showFingering="true"===a.getAttribute("value")}}}parseTrackProperties(t,e){for(const i of e.childElements())"Property"===i.localName&&this.parseTrackProperty(t,i)}parseTrackProperty(t,e){switch(e.getAttribute("name")){case"Tuning":const s=W.splitSafe(e.findChildElement("Pitches")?.innerText),r=new Array(s.length);for(let o=0;o<r.length;o++)r[r.length-1-o]=W.parseIntSafe(s[o],0);for(const o of t.staves)o.stringTuning.tunings=r,o.showStandardNotation=!0,o.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(t,e);break;case"CapoFret":const a=W.parseIntSafe(e.findChildElement("Fret")?.innerText,0);for(const o of t.staves)o.capo=a}}parseGeneralMidi(t,e){for(const s of e.childElements())switch(s.localName){case"Program":t.playbackInfo.program=W.parseIntSafe(s.innerText,0);break;case"Port":t.playbackInfo.port=W.parseIntSafe(s.innerText,0);break;case"PrimaryChannel":t.playbackInfo.primaryChannel=W.parseIntSafe(s.innerText,0);break;case"SecondaryChannel":t.playbackInfo.secondaryChannel=W.parseIntSafe(s.innerText,0)}if("Percussion"===e.getAttribute("table"))for(const s of t.staves)s.isPercussion=!0}parseSounds(t,e,i){for(const s of i.childElements())"Sound"===s.localName&&this.parseSound(t,e,s)}parseSound(t,e,i){const s=new j$;for(const r of i.childElements())switch(r.localName){case"Name":s.name=r.innerText;break;case"Path":s.path=r.innerText;break;case"Role":s.role=r.innerText;break;case"MIDI":this.parseSoundMidi(s,r)}("Factory"===s.role||0===e.playbackInfo.program)&&(e.playbackInfo.program=s.program),this._soundsByTrack.has(t)||this._soundsByTrack.set(t,new Map),this._soundsByTrack.get(t).set(s.uniqueId,s)}parseSoundMidi(t,e){for(const i of e.childElements())"Program"===i.localName&&(t.program=W.parseIntSafe(i.innerText,0))}parsePartSounding(t,e){for(const i of e.childElements())if("TranspositionPitch"===i.localName)for(const s of t.staves)s.displayTranspositionPitch=W.parseIntSafe(i.innerText,0)}parseTranspose(t,e){let i=0,s=0;for(const r of e.childElements())switch(r.localName){case"Chromatic":s=W.parseIntSafe(r.innerText,0);break;case"Octave":i=W.parseIntSafe(r.innerText,0)}for(const r of t.staves)r.displayTranspositionPitch=12*i+s}parseRSE(t,e){for(const i of e.childElements())"ChannelStrip"===i.localName&&this.parseChannelStrip(t,i)}parseChannelStrip(t,e){for(const i of e.childElements())"Parameters"===i.localName&&this.parseChannelStripParameters(t,i)}parseChannelStripParameters(t,e){if(e.firstChild&&e.firstChild.value){const i=W.splitSafe(e.firstChild.value);i.length>=12&&(t.playbackInfo.balance=Math.floor(16*W.parseFloatSafe(i[11],.5)),t.playbackInfo.volume=Math.floor(16*W.parseFloatSafe(i[12],.9)))}}parseMasterBarsNode(t){for(const e of t.childElements())"MasterBar"===e.localName&&this.parseMasterBar(e)}parseMasterBar(t){const e=new Cr;0===this._masterBars.length&&this._hasAnacrusis&&(e.isAnacrusis=!0);for(const i of t.childElements())switch(i.localName){case"Time":const s=i.innerText.split("/");e.timeSignatureNumerator=W.parseIntSafe(s[0],4),e.timeSignatureDenominator=W.parseIntSafe(s[1],4);break;case"FreeTime":e.isFreeTime=!0;break;case"DoubleBar":e.isDoubleBar=!0,this._doubleBars.add(e);break;case"Section":e.section=new Tc,e.section.marker=i.findChildElement("Letter")?.innerText??"",e.section.text=i.findChildElement("Text")?.innerText??"";break;case"Repeat":"true"===i.getAttribute("start").toLowerCase()&&(e.isRepeatStart=!0),"true"===i.getAttribute("end").toLowerCase()&&i.getAttribute("count")&&(e.repeatCount=W.parseIntSafe(i.getAttribute("count"),1));break;case"AlternateEndings":const r=W.splitSafe(i.innerText);let a=0;for(let u=0;u<r.length;u++)a|=1<<-1+W.parseIntSafe(r[u],0);e.alternateEndings=a;break;case"Bars":this._barsOfMasterBar.push(W.splitSafe(i.innerText));break;case"TripletFeel":switch(i.innerText){case"NoTripletFeel":e.tripletFeel=_e.NoTripletFeel;break;case"Triplet8th":e.tripletFeel=_e.Triplet8th;break;case"Triplet16th":e.tripletFeel=_e.Triplet16th;break;case"Dotted8th":e.tripletFeel=_e.Dotted8th;break;case"Dotted16th":e.tripletFeel=_e.Dotted16th;break;case"Scottish8th":e.tripletFeel=_e.Scottish8th;break;case"Scottish16th":e.tripletFeel=_e.Scottish16th}break;case"Key":const o=W.parseIntSafe(i.findChildElement("AccidentalCount")?.innerText,0),l=i.findChildElement("Mode");let c=li.Major;if(l)switch(l.innerText.toLowerCase()){case"major":c=li.Major;break;case"minor":c=li.Minor}this._keySignatures.set(this._masterBars.length,[o,c]);break;case"Fermatas":this.parseFermatas(e,i);break;case"XProperties":this.parseMasterBarXProperties(e,i);break;case"Directions":this.parseDirections(e,i)}this._masterBars.push(e)}parseDirections(t,e){for(const i of e.childElements())switch(i.localName){case"Target":switch(i.innerText){case"Coda":t.addDirection(A.TargetCoda);break;case"DoubleCoda":t.addDirection(A.TargetDoubleCoda);break;case"Segno":t.addDirection(A.TargetSegno);break;case"SegnoSegno":t.addDirection(A.TargetSegnoSegno);break;case"Fine":t.addDirection(A.TargetFine)}break;case"Jump":switch(i.innerText){case"DaCapo":t.addDirection(A.JumpDaCapo);break;case"DaCapoAlCoda":t.addDirection(A.JumpDaCapoAlCoda);break;case"DaCapoAlDoubleCoda":t.addDirection(A.JumpDaCapoAlDoubleCoda);break;case"DaCapoAlFine":t.addDirection(A.JumpDaCapoAlFine);break;case"DaSegno":t.addDirection(A.JumpDalSegno);break;case"DaSegnoAlCoda":t.addDirection(A.JumpDalSegnoAlCoda);break;case"DaSegnoAlDoubleCoda":t.addDirection(A.JumpDalSegnoAlDoubleCoda);break;case"DaSegnoAlFine":t.addDirection(A.JumpDalSegnoAlFine);break;case"DaSegnoSegno":t.addDirection(A.JumpDalSegnoSegno);break;case"DaSegnoSegnoAlCoda":t.addDirection(A.JumpDalSegnoSegnoAlCoda);break;case"DaSegnoSegnoAlDoubleCoda":t.addDirection(A.JumpDalSegnoSegnoAlDoubleCoda);break;case"DaSegnoSegnoAlFine":t.addDirection(A.JumpDalSegnoSegnoAlFine);break;case"DaCoda":t.addDirection(A.JumpDaCoda);break;case"DaDoubleCoda":t.addDirection(A.JumpDaDoubleCoda)}}}parseFermatas(t,e){for(const i of e.childElements())"Fermata"===i.localName&&this.parseFermata(t,i)}parseFermata(t,e){let i=0;const s=new kc;for(const r of e.childElements())switch(r.localName){case"Type":switch(r.innerText){case"Short":s.type=jn.Short;break;case"Medium":s.type=jn.Medium;break;case"Long":s.type=jn.Long}break;case"Length":s.length=W.parseFloatSafe(r.innerText,0);break;case"Offset":const a=r.innerText.split("/");2===a.length&&(i=W.parseIntSafe(a[0],4)/W.parseIntSafe(a[1],4)*P.QuarterTime|0)}t.addFermata(i,s)}parseBars(t){for(const e of t.childElements())"Bar"===e.localName&&this.parseBar(e)}parseBar(t){const e=new vr,i=t.getAttribute("id");for(const s of t.childElements())switch(s.localName){case"Voices":this._voicesOfBar.set(i,W.splitSafe(s.innerText));break;case"Clef":switch(s.innerText){case"Neutral":e.clef=Be.Neutral;break;case"G2":e.clef=Be.G2;break;case"F4":e.clef=Be.F4;break;case"C4":e.clef=Be.C4;break;case"C3":e.clef=Be.C3}break;case"Ottavia":switch(s.innerText){case"8va":e.clefOttava=we._8va;break;case"15ma":e.clefOttava=we._15ma;break;case"8vb":e.clefOttava=we._8vb;break;case"15mb":e.clefOttava=we._15mb}break;case"SimileMark":switch(s.innerText){case"Simple":e.simileMark=$t.Simple;break;case"FirstOfDouble":e.simileMark=$t.FirstOfDouble;break;case"SecondOfDouble":e.simileMark=$t.SecondOfDouble}break;case"XProperties":this.parseBarXProperties(s,e)}this._barsById.set(i,e)}parseVoices(t){for(const e of t.childElements())"Voice"===e.localName&&this.parseVoice(e)}parseVoice(t){const e=new Fi,i=t.getAttribute("id");for(const s of t.childElements())"Beats"===s.localName&&this._beatsOfVoice.set(i,W.splitSafe(s.innerText));this._voiceById.set(i,e)}parseBeats(t){for(const e of t.childElements())"Beat"===e.localName&&this.parseBeat(e)}parseBeat(t){const e=new Vn,i=t.getAttribute("id");for(const s of t.childElements())switch(s.localName){case"Notes":this._notesOfBeat.set(i,W.splitSafe(s.innerText));break;case"Rhythm":this._rhythmOfBeat.set(i,s.getAttribute("ref"));break;case"Fadding":switch(s.innerText){case"FadeIn":e.fade=un.FadeIn;break;case"FadeOut":e.fade=un.FadeOut;break;case"VolumeSwell":e.fade=un.VolumeSwell}break;case"Tremolo":switch(s.innerText){case"1/2":e.tremoloSpeed=w.Eighth;break;case"1/4":e.tremoloSpeed=w.Sixteenth;break;case"1/8":e.tremoloSpeed=w.ThirtySecond}break;case"Chord":e.chordId=s.innerText;break;case"Hairpin":switch(s.innerText){case"Crescendo":e.crescendo=ii.Crescendo;break;case"Decrescendo":e.crescendo=ii.Decrescendo}break;case"Arpeggio":e.brushType="Up"===s.innerText?Y.ArpeggioUp:Y.ArpeggioDown;break;case"Properties":this.parseBeatProperties(s,e);break;case"XProperties":this.parseBeatXProperties(s,e);break;case"FreeText":e.text=s.innerText;break;case"TransposedPitchStemOrientation":switch(s.innerText){case"Upward":e.preferredBeamDirection=B.Up;break;case"Downward":e.preferredBeamDirection=B.Down}break;case"Dynamic":switch(s.innerText){case"PPP":e.dynamics=ie.PPP;break;case"PP":e.dynamics=ie.PP;break;case"P":e.dynamics=ie.P;break;case"MP":e.dynamics=ie.MP;break;case"MF":e.dynamics=ie.MF;break;case"F":e.dynamics=ie.F;break;case"FF":e.dynamics=ie.FF;break;case"FFF":e.dynamics=ie.FFF}break;case"GraceNotes":switch(s.innerText){case"OnBeat":e.graceType=re.OnBeat;break;case"BeforeBeat":e.graceType=re.BeforeBeat}break;case"Legato":"true"===s.getAttribute("origin")&&(e.isLegatoOrigin=!0);break;case"Whammy":const r=new V(0,0);r.value=this.toBendValue(W.parseFloatSafe(s.getAttribute("originValue"),0)),r.offset=this.toBendOffset(W.parseFloatSafe(s.getAttribute("originOffset"),0)),e.addWhammyBarPoint(r);const a=new V(0,0);a.value=this.toBendValue(W.parseFloatSafe(s.getAttribute("middleValue"),0)),a.offset=this.toBendOffset(W.parseFloatSafe(s.getAttribute("middleOffset1"),0)),e.addWhammyBarPoint(a);const o=new V(0,0);o.value=this.toBendValue(W.parseFloatSafe(s.getAttribute("middleValue"),0)),o.offset=this.toBendOffset(W.parseFloatSafe(s.getAttribute("middleOffset2"),0)),e.addWhammyBarPoint(o);const l=new V(0,0);l.value=this.toBendValue(W.parseFloatSafe(s.getAttribute("destinationValue"),0)),l.offset=this.toBendOffset(W.parseFloatSafe(s.getAttribute("destinationOffset"),0)),e.addWhammyBarPoint(l);break;case"Ottavia":switch(s.innerText){case"8va":e.ottava=we._8va;break;case"8vb":e.ottava=we._8vb;break;case"15ma":e.ottava=we._15ma;break;case"15mb":e.ottava=we._15mb}break;case"Lyrics":e.lyrics=this.parseBeatLyrics(s),this._skipApplyLyrics=!0;break;case"Slashed":e.slashed=!0;break;case"DeadSlapped":e.deadSlapped=!0;break;case"Golpe":switch(s.innerText){case"Finger":e.golpe=Ci.Finger;break;case"Thumb":e.golpe=Ci.Thumb}break;case"Wah":switch(s.innerText){case"Open":e.wahPedal=Li.Open;break;case"Closed":e.wahPedal=Li.Closed}break;case"UserTransposedPitchStemOrientation":switch(s.innerText){case"Downward":e.preferredBeamDirection=B.Down;break;case"Upward":e.preferredBeamDirection=B.Up}break;case"Timer":e.showTimer=!0,e.timer=W.parseIntSafe(s.innerText,-1),e.timer<0&&(e.timer=null)}this._beatById.set(i,e)}parseBeatLyrics(t){const e=[];for(const i of t.childElements())"Line"===i.localName&&e.push(i.innerText);return e}parseBeatXProperties(t,e){for(const i of t.childElements())if("XProperty"===i.localName){let r=0;switch(i.getAttribute("id")){case"1124204546":switch(r=W.parseIntSafe(i.findChildElement("Int")?.innerText,0),r){case 1:e.beamingMode=St.ForceMergeWithNext;break;case 2:e.beamingMode=St.ForceSplitToNext}break;case"1124204552":1===(r=W.parseIntSafe(i.findChildElement("Int")?.innerText,0),r)&&e.beamingMode!==St.ForceSplitToNext&&(e.beamingMode=St.ForceSplitOnSecondaryToNext);break;case"1124204545":r=W.parseIntSafe(i.findChildElement("Int")?.innerText,0),e.invertBeamDirection=1===r;break;case"687935489":r=W.parseIntSafe(i.findChildElement("Int")?.innerText,0),e.brushDuration=r}}}parseBarXProperties(t,e){for(const i of t.childElements())if("XProperty"===i.localName&&"1124139520"===i.getAttribute("id")){const r=i.findChildElement("Double")??i.findChildElement("Float");e.displayScale=W.parseFloatSafe(r?.innerText,1)}}parseMasterBarXProperties(t,e){for(const i of e.childElements())"XProperty"===i.localName&&"1124073984"===i.getAttribute("id")&&(t.displayScale=W.parseFloatSafe(i.findChildElement("Double")?.innerText,1))}parseBeatProperties(t,e){let i=!1,s=null,r=null,a=null,o=null,l=null;for(const c of t.childElements())if("Property"===c.localName)switch(c.getAttribute("name")){case"Brush":e.brushType="Up"===c.findChildElement("Direction")?.innerText?Y.BrushUp:Y.BrushDown;break;case"PickStroke":e.pickStroke="Up"===c.findChildElement("Direction")?.innerText?vn.Up:vn.Down;break;case"Slapped":c.findChildElement("Enable")&&(e.slap=!0);break;case"Popped":c.findChildElement("Enable")&&(e.pop=!0);break;case"VibratoWTremBar":switch(c.findChildElement("Strength")?.innerText){case"Wide":e.vibrato=Ie.Wide;break;case"Slight":e.vibrato=Ie.Slight}break;case"WhammyBar":i=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":s||(s=new V(0,0)),s.value=this.toBendValue(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarOriginOffset":s||(s=new V(0,0)),s.offset=this.toBendOffset(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleValue":r=this.toBendValue(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset1":a=this.toBendOffset(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationValue":l||(l=new V(V.MaxPosition,0)),l.value=this.toBendValue(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationOffset":l||(l=new V(0,0)),l.offset=this.toBendOffset(W.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"BarreFret":e.barreFret=W.parseIntSafe(c.findChildElement("Fret")?.innerText,0);break;case"BarreString":switch(c.findChildElement("String")?.innerText){case"0":e.barreShape=Ri.Full;break;case"1":e.barreShape=Ri.Half}break;case"Rasgueado":switch(c.findChildElement("Rasgueado")?.innerText){case"ii_1":e.rasgueado=X.Ii;break;case"mi_1":e.rasgueado=X.Mi;break;case"mii_1":e.rasgueado=X.MiiTriplet;break;case"mii_2":e.rasgueado=X.MiiAnapaest;break;case"pmp_1":e.rasgueado=X.PmpTriplet;break;case"pmp_2":e.rasgueado=X.PmpAnapaest;break;case"pei_1":e.rasgueado=X.PeiTriplet;break;case"pei_2":e.rasgueado=X.PeiAnapaest;break;case"pai_1":e.rasgueado=X.PaiTriplet;break;case"pai_2":e.rasgueado=X.PaiAnapaest;break;case"ami_1":e.rasgueado=X.AmiTriplet;break;case"ami_2":e.rasgueado=X.AmiAnapaest;break;case"ppp_1":e.rasgueado=X.Ppp;break;case"amii_1":e.rasgueado=X.Amii;break;case"amip_1":e.rasgueado=X.Amip;break;case"eami_1":e.rasgueado=X.Eami;break;case"eamii_1":e.rasgueado=X.Eamii;break;case"peami_1":e.rasgueado=X.Peami}}i&&(s||(s=new V(0,0)),l||(l=new V(V.MaxPosition,0)),e.addWhammyBarPoint(s),a&&r&&e.addWhammyBarPoint(new V(a,r)),o&&r&&e.addWhammyBarPoint(new V(o,r)),!a&&!o&&r&&e.addWhammyBarPoint(new V(V.MaxPosition/2|0,r)),e.addWhammyBarPoint(l))}parseNotes(t){for(const e of t.childElements())"Note"===e.localName&&this.parseNote(e)}parseNote(t){const e=new is,i=t.getAttribute("id");for(const s of t.childElements())switch(s.localName){case"Properties":this.parseNoteProperties(s,e,i);break;case"AntiAccent":"normal"===s.innerText.toLowerCase()&&(e.isGhost=!0);break;case"LetRing":e.isLetRing=!0;break;case"Trill":e.trillValue=W.parseIntSafe(s.innerText,-1),e.trillSpeed=w.Sixteenth;break;case"Accent":const r=W.parseIntSafe(s.innerText,0);1&r&&(e.isStaccato=!0),4&r&&(e.accentuated=Ot.Heavy),8&r&&(e.accentuated=Ot.Normal),16&r&&(e.accentuated=Ot.Tenuto);break;case"Tie":"true"===s.getAttribute("destination").toLowerCase()&&(e.isTieDestination=!0);break;case"Vibrato":switch(s.innerText){case"Slight":e.vibrato=Ie.Slight;break;case"Wide":e.vibrato=Ie.Wide}break;case"LeftFingering":switch(s.innerText){case"P":e.leftHandFinger=se.Thumb;break;case"I":e.leftHandFinger=se.IndexFinger;break;case"M":e.leftHandFinger=se.MiddleFinger;break;case"A":e.leftHandFinger=se.AnnularFinger;break;case"C":e.leftHandFinger=se.LittleFinger}break;case"RightFingering":switch(s.innerText){case"P":e.rightHandFinger=se.Thumb;break;case"I":e.rightHandFinger=se.IndexFinger;break;case"M":e.rightHandFinger=se.MiddleFinger;break;case"A":e.rightHandFinger=se.AnnularFinger;break;case"C":e.rightHandFinger=se.LittleFinger}break;case"InstrumentArticulation":e.percussionArticulation=W.parseIntSafe(s.innerText,0);break;case"Ornament":switch(s.innerText){case"Turn":e.ornament=Vt.Turn;break;case"InvertedTurn":e.ornament=Vt.InvertedTurn;break;case"UpperMordent":e.ornament=Vt.UpperMordent;break;case"LowerMordent":e.ornament=Vt.LowerMordent}}this._noteById.set(i,e)}parseNoteProperties(t,e,i){let s=!1,r=null,a=null,o=null,l=null,c=null,u=-1,h=-1;for(const f of t.childElements())if("Property"===f.localName)switch(f.getAttribute("name")){case"ShowStringNumber":f.findChildElement("Enable")&&(e.showStringNumber=!0);break;case"String":e.string=W.parseIntSafe(f.findChildElement("String")?.innerText,0)+1;break;case"Fret":e.fret=W.parseIntSafe(f.findChildElement("Fret")?.innerText,0);break;case"Element":u=W.parseIntSafe(f.findChildElement("Element")?.innerText,0);break;case"Variation":h=W.parseIntSafe(f.findChildElement("Variation")?.innerText,0);break;case"Tapped":this._tappedNotes.set(i,!0);break;case"HarmonicType":const g=f.findChildElement("HType");if(g)switch(g.innerText){case"NoHarmonic":e.harmonicType=ae.None;break;case"Natural":e.harmonicType=ae.Natural;break;case"Artificial":e.harmonicType=ae.Artificial;break;case"Pinch":e.harmonicType=ae.Pinch;break;case"Tap":e.harmonicType=ae.Tap;break;case"Semi":e.harmonicType=ae.Semi;break;case"Feedback":e.harmonicType=ae.Feedback}break;case"HarmonicFret":const m=f.findChildElement("HFret");m&&(e.harmonicValue=W.parseFloatSafe(m.innerText,0));break;case"Muted":f.findChildElement("Enable")&&(e.isDead=!0);break;case"PalmMuted":f.findChildElement("Enable")&&(e.isPalmMute=!0);break;case"Octave":e.octave=W.parseIntSafe(f.findChildElement("Number")?.innerText,0),-1===e.tone&&(e.tone=0);break;case"Tone":e.tone=W.parseIntSafe(f.findChildElement("Step")?.innerText,0);break;case"ConcertPitch":this.parseConcertPitch(f,e);break;case"Bended":s=!0;break;case"BendOriginValue":r||(r=new V(0,0)),r.value=this.toBendValue(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendOriginOffset":r||(r=new V(0,0)),r.offset=this.toBendOffset(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendMiddleValue":a=this.toBendValue(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset1":o=this.toBendOffset(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset2":l=this.toBendOffset(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendDestinationValue":c||(c=new V(V.MaxPosition,0)),c.value=this.toBendValue(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"BendDestinationOffset":c||(c=new V(0,0)),c.offset=this.toBendOffset(W.parseFloatSafe(f.findChildElement("Float")?.innerText,0));break;case"HopoOrigin":f.findChildElement("Enable")&&(e.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":e.isLeftHandTapped=!0;break;case"Slide":const y=W.parseIntSafe(f.findChildElement("Flags")?.innerText,0);1&y?e.slideOutType=Se.Shift:2&y?e.slideOutType=Se.Legato:4&y?e.slideOutType=Se.OutDown:8&y&&(e.slideOutType=Se.OutUp),16&y?e.slideInType=pn.IntoFromBelow:32&y&&(e.slideInType=pn.IntoFromAbove),64&y?e.slideOutType=Se.PickSlideDown:128&y&&(e.slideOutType=Se.PickSlideUp)}s&&(r||(r=new V(0,0)),c||(c=new V(V.MaxPosition,0)),e.addBendPoint(r),o&&a&&e.addBendPoint(new V(o,a)),l&&a&&e.addBendPoint(new V(l,a)),!o&&!l&&a&&e.addBendPoint(new V(V.MaxPosition/2|0,a)),e.addBendPoint(c)),-1!==u&&-1!==h&&(e.percussionArticulation=nn.articulationFromElementVariation(u,h))}parseConcertPitch(t,e){const i=t.findChildElement("Pitch");if(i)for(const s of i.childElements())if("Accidental"===s.localName)switch(s.innerText){case"x":e.accidentalMode=ke.ForceDoubleSharp;break;case"#":e.accidentalMode=ke.ForceSharp;break;case"b":e.accidentalMode=ke.ForceFlat;break;case"bb":e.accidentalMode=ke.ForceDoubleFlat}}toBendValue(t){return t*W.BendPointValueFactor|0}toBendOffset(t){return t*W.BendPointPositionFactor}parseRhythms(t){for(const e of t.childElements())"Rhythm"===e.localName&&this.parseRhythm(e)}parseRhythm(t){const e=new $$,i=t.getAttribute("id");e.id=i;for(const s of t.childElements())switch(s.localName){case"NoteValue":switch(s.innerText){case"Long":e.value=w.QuadrupleWhole;break;case"DoubleWhole":e.value=w.DoubleWhole;break;case"Whole":e.value=w.Whole;break;case"Half":e.value=w.Half;break;case"Quarter":e.value=w.Quarter;break;case"Eighth":e.value=w.Eighth;break;case"16th":e.value=w.Sixteenth;break;case"32nd":e.value=w.ThirtySecond;break;case"64th":e.value=w.SixtyFourth;break;case"128th":e.value=w.OneHundredTwentyEighth;break;case"256th":e.value=w.TwoHundredFiftySixth}break;case"PrimaryTuplet":e.tupletNumerator=W.parseIntSafe(s.getAttribute("num"),-1),e.tupletDenominator=W.parseIntSafe(s.getAttribute("den"),-1);break;case"AugmentationDot":e.dots=W.parseIntSafe(s.getAttribute("count"),0)}this._rhythmById.set(i,e)}buildModel(){for(let i=0,s=this._masterBars.length;i<s;i++)this.score.addMasterBar(this._masterBars[i]);const t=this._masterBars[this._masterBars.length-1];this._doubleBars.has(t)&&(this._doubleBars.delete(t),t.isDoubleBar=!1);for(const i of this._tracksMapping){if(!i)continue;const s=this._tracksById.get(i);this.score.addTrack(s)}let e;for(const i of this._barsOfMasterBar){let s=0;e=[De.C,li.Major];for(let r=0,a=0;r<i.length&&a<this.score.tracks.length;r++){const o=i[r];if(o!==W.InvalidId){const l=this._barsById.get(o),c=this.score.tracks[a],u=c.staves[s];u.addBar(l);const h=u.bars.length-1;if(this._keySignatures.has(h)&&(e=this._keySignatures.get(h)),l.keySignature=e[0],l.keySignatureType=e[1],this._doubleBars.has(l.masterBar)&&(l.barLineRight=pe.LightLight),this._voicesOfBar.has(o))for(const f of this._voicesOfBar.get(o))if(f!==W.InvalidId){const p=this._voiceById.get(f);if(l.addVoice(p),this._beatsOfVoice.has(f))for(const g of this._beatsOfVoice.get(f))if(g!==W.InvalidId){const m=_S.clone(this._beatById.get(g));p.addBeat(m);const y=this._rhythmOfBeat.get(g),b=this._rhythmById.get(y);if(m.duration=b.value,m.dots=b.dots,m.tupletNumerator=b.tupletNumerator,m.tupletDenominator=b.tupletDenominator,this._notesOfBeat.has(g))for(const _ of this._notesOfBeat.get(g))if(_!==W.InvalidId){const v=wI.clone(this._noteById.get(_));u.isPercussion?(v.fret=-1,v.string=-1):v.percussionArticulation=-1,m.addNote(v),this._tappedNotes.has(_)&&(m.tap=!0)}}}else{const p=new Fi;l.addVoice(p);const g=new Vn;g.isEmpty=!0,g.duration=w.Quarter,p.addBeat(g)}s===c.staves.length-1?(a++,s=0,e=[De.C,li.Major]):(s++,e=[De.C,li.Major])}else a++}}for(const i of this._tracksMapping){if(!i)continue;const s=this._tracksById.get(i);let r=!1;for(const a of s.staves)if(a.isPercussion){r=!0;break}if(r||(s.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(i)){const a=this._automationsPerTrackIdAndBarIndex.get(i);for(const[o,l]of a)if(s.staves.length>0&&o<s.staves[0].bars.length){const c=s.staves[0].bars[o];if(c.voices.length>0&&c.voices[0].beats.length>0){const u=c.voices[0].beats[0];for(const h of l)u.automations.push(h)}}}if(this._sustainPedalsPerTrackIdAndBarIndex.has(i)){const a=this._sustainPedalsPerTrackIdAndBarIndex.get(i);for(const[o,l]of a)s.staves.length>0&&o<s.staves[0].bars.length&&(s.staves[0].bars[o].sustainPedals=l)}}for(const[i,s]of this._masterTrackAutomations){const r=this.score.masterBars[i];for(let a=0,o=s.length;a<o;a++){const l=s[a];l.type===Bt.Tempo&&(0===i&&(this.score.tempo=0|l.value,l.text&&(this.score.tempoLabel=l.text)),r.tempoAutomations.push(l))}}}}W.InvalidId="-1",W.BendPointPositionFactor=V.MaxPosition/100,W.BendPointValueFactor=.04;class kS{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class TI{constructor(){this.showNumbered=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class CS{apply(t){if(this.scoreViews.length>0){let e=0;t.stylesheet.multiTrackMultiBarRest=this.scoreViews[0].isMultiRest;for(const i of this.scoreViews[0].trackViewGroups){if(e<t.tracks.length){const s=t.tracks[e];for(const r of s.staves)r.showTablature=i.showTablature,r.showStandardNotation=i.showStandardNotation,r.showSlash=i.showSlash,r.showNumbered=i.showNumbered}e++}for(let i=1;i<this.scoreViews.length;i++)this.scoreViews[i].isMultiRest&&(t.stylesheet.perTrackMultiBarRest||(t.stylesheet.perTrackMultiBarRest=new Set),e=i-1,t.stylesheet.perTrackMultiBarRest.add(e))}}constructor(t){this.scoreViews=[];const e=Wt.fromBuffer(t),i=T.readInt32BE(e);for(let s=0;s<i;s++){const r=new kS;this.scoreViews.push(r),r.isMultiRest=Ve.gpReadBool(e);const a=T.readInt32BE(e);for(let o=0;o<a;o++){let l=e.readByte();0===l&&(l=1);const c=new TI;c.showStandardNotation=0!=(1&l),c.showTablature=0!=(2&l),c.showSlash=0!=(4&l),c.showNumbered=0!=(8&l),r.trackViewGroups.push(c)}}}static writeForScore(t){const e=Wt.withCapacity(128),i=[new kS];i[0].isMultiRest=t.stylesheet.multiTrackMultiBarRest;for(const s of t.tracks){const r=new TI;r.showStandardNotation=s.staves[0].showStandardNotation,r.showTablature=s.staves[0].showTablature,r.showSlash=s.staves[0].showSlash,r.showNumbered=s.staves[0].showNumbered,i[0].trackViewGroups.push(r);const a=new kS;a.isMultiRest=!0===t.stylesheet.perTrackMultiBarRest?.has(s.index),a.trackViewGroups.push(r),i.push(a)}T.writeInt32BE(e,i.length);for(const s of i){e.writeByte(s.isMultiRest?1:0),T.writeInt32BE(e,s.trackViewGroups.length);for(const r of s.trackViewGroups){let a=0;r.showStandardNotation&&(a|=1),r.showTablature&&(a|=2),r.showSlash&&(a|=4),r.showNumbered&&(a|=8),e.writeByte(a)}}return T.writeInt32BE(e,1),e.toArray()}}let DS=class{};class dg extends DS{constructor(t){super(),this.n=t}}class Go extends DS{constructor(t,e){super(),this.left=t,this.right=e}}class NS extends DS{constructor(t,e){super(),this.n=t,this.table=e}}class qn{static make(t,e,i,s){const r=[],a=[];if(s>32)throw new gn("Invalid huffman");for(let c=0;c<s;c++)r.push(0),a.push(0);for(let c=0;c<i;c++){const u=t[c+e];if(u>=s)throw new gn("Invalid huffman");r[u]++}let o=0;for(let c=1;c<s-1;c++)o=o+r[c]<<1,a[c]=o;const l=new Map;for(let c=0;c<i;c++){const u=t[c+e];if(0!==u){const h=a[u-1];a[u-1]=h+1,l.set(h<<5|u,c)}}return qn.treeCompress(new Go(qn.treeMake(l,s,0,1),qn.treeMake(l,s,1,1)))}static treeMake(t,e,i,s){if(s>e)throw new gn("Invalid huffman");const r=i<<5|s;return t.has(r)?new dg(t.get(r)):new Go(qn.treeMake(t,e,i<<=1,s+=1),qn.treeMake(t,e,1|i,s))}static treeCompress(t){const e=qn.treeDepth(t);if(0===e)return t;if(1===e){if(t instanceof Go)return new Go(qn.treeCompress(t.left),qn.treeCompress(t.right));throw new gn("assert")}const i=1<<e,s=[];for(let r=0;r<i;r++)s.push(new dg(-1));return qn.treeWalk(s,0,0,e,t),new NS(e,s)}static treeWalk(t,e,i,s,r){r instanceof Go&&s>0?(qn.treeWalk(t,e,i+1,s-1,r.left),qn.treeWalk(t,e|1<<i,i+1,s-1,r.right)):t[e]=qn.treeCompress(r)}static treeDepth(t){if(t instanceof dg)return 0;if(t instanceof NS)throw new gn("assert");if(t instanceof Go){const e=qn.treeDepth(t.left),i=qn.treeDepth(t.right);return 1+(e<i?e:i)}return 0}}var mn=function(n){return n[n.Head=0]="Head",n[n.Block=1]="Block",n[n.CData=2]="CData",n[n.Flat=3]="Flat",n[n.Crc=4]="Crc",n[n.Dist=5]="Dist",n[n.DistOne=6]="DistOne",n[n.Done=7]="Done",n}(mn||{});let q$=(()=>{class n{constructor(){this.buffer=new Uint8Array(n.BufferSize),this.pos=0}slide(){const e=new Uint8Array(n.BufferSize);this.pos-=n.Size,e.set(this.buffer.subarray(n.Size,n.Size+this.pos),0),this.buffer=e}addBytes(e,i,s){this.pos+s>n.BufferSize&&this.slide(),this.buffer.set(e.subarray(i,i+s),this.pos),this.pos+=s}addByte(e){this.pos===n.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}return n.Size=32768,n.BufferSize=65536,n})();class gi{static buildFixedHuffman(){const t=[];for(let e=0;e<288;e++)t.push(e<=143?8:e<=255?9:e<=279?7:8);return qn.make(t,0,288,10)}constructor(t){this._nbits=0,this._bits=0,this._state=mn.Block,this._isFinal=!1,this._huffman=gi._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new q$,this._input=t;for(let e=0;e<19;e++)this._lengths.push(-1)}readBytes(t,e,i){if(this._needed=i,this._outpos=e,this._output=t,i>0)for(;this.inflateLoop(););return i-this._needed}inflateLoop(){switch(this._state){case mn.Head:const t=this._input.readByte();if(8!=(15&t))throw new gn("Invalid data");const i=this._input.readByte(),s=0!=(32&i);if(((t<<8)+i)%31!=0)throw new gn("Invalid data");if(s)throw new gn("Unsupported dictionary");return this._state=mn.Block,!0;case mn.Crc:return this._state=mn.Done,!0;case mn.Done:return!1;case mn.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=T.readUInt16LE(this._input),T.readUInt16LE(this._input)!==65535-this._len)throw new gn("Invalid data");this._state=mn.Flat;const u=this.inflateLoop();return this.resetBits(),u;case 1:return this._huffman=gi._fixedHuffman,this._huffdist=null,this._state=mn.CData,!0;case 2:const h=this.getBits(5)+257,f=this.getBits(5)+1,p=this.getBits(4)+4;for(let m=0;m<p;m++)this._lengths[gi.CodeLengthsPos[m]]=this.getBits(3);for(let m=p;m<19;m++)this._lengths[gi.CodeLengthsPos[m]]=0;this._huffman=qn.make(this._lengths,0,19,8);const g=[];for(let m=0;m<h+f;m++)g.push(0);return this.inflateLengths(g,h+f),this._huffdist=qn.make(g,h,f,16),this._huffman=qn.make(g,0,h,16),this._state=mn.CData,!0;default:throw new gn("Invalid data")}case mn.Flat:{const c=this._len<this._needed?this._len:this._needed,u=T.readByteArray(this._input,c);return this._len-=c,this.addBytes(u,0,c),0===this._len&&(this._state=this._isFinal?mn.Crc:mn.Block),this._needed>0}case mn.DistOne:{const c=this._len<this._needed?this._len:this._needed;return this.addDistOne(c),this._len-=c,0===this._len&&(this._state=mn.CData),this._needed>0}case mn.Dist:for(;this._len>0&&this._needed>0;){const c=this._len<this._dist?this._len:this._dist,u=this._needed<c?this._needed:c;this.addDist(this._dist,u),this._len-=u}return 0===this._len&&(this._state=mn.CData),this._needed>0;case mn.CData:let r=this.applyHuffman(this._huffman);if(r<256)return this.addByte(r),this._needed>0;if(256===r)return this._state=this._isFinal?mn.Crc:mn.Block,!0;r=r-257&255;let a=gi.LenExtraBitsTbl[r];if(-1===a)throw new gn("Invalid data");this._len=gi.LenBaseValTbl[r]+this.getBits(a);const o=this._huffdist,l=o?this.applyHuffman(o):this.getRevBits(5);if(a=gi.DistExtraBitsTbl[l],-1===a)throw new gn("Invalid data");if(this._dist=gi.DistBaseValTbl[l]+this.getBits(a),this._dist>this._window.available())throw new gn("Invalid data");return this._state=1===this._dist?mn.DistOne:mn.Dist,!0}return!1}addDistOne(t){const e=this._window.getLastChar();for(let i=0;i<t;i++)this.addByte(e)}addByte(t){this._window.addByte(t),this._output[this._outpos]=t,this._needed--,this._outpos++}addDist(t,e){this.addBytes(this._window.buffer,this._window.pos-t,e)}getBit(){0===this._nbits&&(this._nbits=8,this._bits=this._input.readByte());const t=1==(1&this._bits);return this._nbits--,this._bits=this._bits>>1,t}getBits(t){for(;this._nbits<t;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;const e=this._bits&(1<<t)-1;return this._nbits-=t,this._bits=this._bits>>t,e}getRevBits(t){return 0===t?0:this.getBit()?1<<t-1|this.getRevBits(t-1):this.getRevBits(t-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(t,e,i){this._window.addBytes(t,e,i),this._output.set(t.subarray(e,e+i),this._outpos),this._needed-=i,this._outpos+=i}inflateLengths(t,e){let i=0,s=0;for(;i<e;){const r=this.applyHuffman(this._huffman);switch(r){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:s=r,t[i]=r,i++;break;case 16:const a=i+3+this.getBits(2);if(a>e)throw new gn("Invalid data");for(;i<a;)t[i]=s,i++;break;case 17:if(i+=3+this.getBits(3),i>e)throw new gn("Invalid data");break;case 18:if(i+=11+this.getBits(7),i>e)throw new gn("Invalid data");break;default:throw new gn("Invalid data")}}}applyHuffman(t){if(t instanceof dg)return t.n;if(t instanceof Go)return this.applyHuffman(this.getBit()?t.right:t.left);if(t instanceof NS)return this.applyHuffman(t.table[this.getBits(t.n)]);throw new gn("Invalid data")}}gi.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],gi.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],gi.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],gi.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],gi.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gi._fixedHuffman=gi.buildFixedHuffman();let Hi=(()=>{class n{constructor(e,i){this.fullName=e;const s=e.lastIndexOf("/");this.fileName=-1===s||s===e.length-1?this.fullName:e.substr(s+1),this.data=i}}return n.OptionalDataDescriptorSignature=134695760,n.CompressionMethodDeflate=8,n.LocalFileHeaderSignature=67324752,n.CentralFileHeaderSignature=33639248,n.EndOfCentralDirSignature=101010256,n})();class xS{constructor(t){this._readable=t}read(){const t=[];for(;;){const e=this.readEntry();if(!e)break;t.push(e)}return t}readEntry(){const t=this._readable;if(T.readInt32LE(t)!==Hi.LocalFileHeaderSignature)return null;T.readUInt16LE(t);const i=T.readUInt16LE(t),s=T.readUInt16LE(t),r=0!==s;if(r&&s!==Hi.CompressionMethodDeflate)return null;T.readInt16LE(this._readable),T.readInt16LE(this._readable),T.readInt32LE(t),T.readInt32LE(t);const a=T.readInt32LE(t),o=T.readInt16LE(t),l=T.readInt16LE(t),c=T.toString(T.readByteArray(t,o),"utf-8");let u;if(t.skip(l),r){const h=Wt.empty(),f=new gi(this._readable),p=new Uint8Array(65536);for(;;){const g=f.readBytes(p,0,p.length);if(h.write(p,0,g),g<p.length)break}u=h.toArray()}else u=T.readByteArray(this._readable,a);return 8&i&&(T.readInt32LE(this._readable)===Hi.OptionalDataDescriptorSignature&&T.readInt32LE(this._readable),T.readInt32LE(this._readable),T.readInt32LE(this._readable)),new Hi(c,u)}}class Y${constructor(){this.trackViewGroups=[]}}class X${constructor(){this.isVisible=!1}}var kI=function(n){return n[n.PageVertical=0]="PageVertical",n[n.PageGrid=1]="PageGrid",n[n.PageParchment=2]="PageParchment",n[n.ScreenVertical=3]="ScreenVertical",n[n.ScreenHorizontal=4]="ScreenHorizontal",n[n.PageHorizontal=5]="PageHorizontal",n}(kI||{});class ES{constructor(t,e){this.zoomLevel=4,this.view=kI.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const i=Wt.fromBuffer(e);this.zoomLevel=T.readInt32BE(i),this.view=i.readByte(),this.muiltiVoiceCursor=0!==i.readByte();const s=t.scoreViews.length;for(let r=0;r<s;r++){const a=new Y$;this.scoreViews.push(a);const o=t.scoreViews[r];for(let l=0;l<o.trackViewGroups.length;l++){const c=new X$;c.isVisible=0!==i.readByte(),a.trackViewGroups.push(c)}}}apply(t){if(this.scoreViews.length>0){let e=0;for(const i of this.scoreViews[0].trackViewGroups)e<t.tracks.length&&(t.tracks[e].isVisibleOnMultiTrack=i.isVisible),e++}}static writeForScore(t){const e=Wt.withCapacity(128);T.writeInt32BE(e,4),e.writeByte(0),e.writeByte(t.tracks.length>0&&t.tracks[0].staves[0].bars[0].isMultiVoice?255:0);for(const s of t.tracks)e.writeByte(s.isVisibleOnMultiTrack?255:0);for(const s of t.tracks)e.writeByte(255);return e.toArray()}}class J$ extends Ho{get name(){return"Guitar Pro 7-8"}readScore(){x.debug(this.name,"Loading ZIP entries");const t=new xS(this.data);let e;try{e=t.read()}catch(u){throw new Ht("No Zip archive",u)}x.debug(this.name,"Zip entries loaded");let i=null,s=null,r=null,a=null;for(const u of e)switch(u.fileName){case"score.gpif":i=T.toString(u.data,this.settings.importer.encoding);break;case"BinaryStylesheet":s=u.data;break;case"PartConfiguration":r=u.data;break;case"LayoutConfiguration":a=u.data}if(!i)throw new Ht("No score.gpif found in zip archive");x.debug(this.name,"Start Parsing score.gpif");const o=new W;o.parseXml(i,this.settings),x.debug(this.name,"score.gpif parsed");const l=o.score;s&&(x.debug(this.name,"Start Parsing BinaryStylesheet"),new Oi(s).apply(l),x.debug(this.name,"BinaryStylesheet parsed"));let c=null;return r&&(x.debug(this.name,"Start Parsing Part Configuration"),c=new CS(r),c.apply(l),x.debug(this.name,"Part Configuration parsed")),a&&null!=c&&(x.debug(this.name,"Start Parsing Layout Configuration"),new ES(c,a).apply(l),x.debug(this.name,"Layout Configuration parsed")),l}}class Ih extends nt{constructor(){super(it.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,Ih.prototype)}}let Q$=(()=>{class n{constructor(e){this._currentByte=0,this._position=n.ByteSize,this._source=e}readByte(){return this.readBits(8)}readBytes(e){const i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=255&this.readByte();return i}readBits(e){let i=0,s=e-1;for(;s>=0;)i|=this.readBit()<<s,s--;return i}readBitsReversed(e){let i=0;for(let s=0;s<e;s++)i|=this.readBit()<<s;return i}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),-1===this._currentByte)throw new Ih;this._position=0}const e=this._currentByte>>n.ByteSize-this._position-1&1;return this._position++,e}readAll(){const e=Wt.empty();try{for(;;)e.writeByte(255&this.readByte())}catch(i){if(!(i instanceof Ih))throw i}return e.toArray()}}return n.ByteSize=8,n})();class K${constructor(){this.fileName="",this.fileSize=0,this.data=null}}let Z$=(()=>{class n{constructor(){this.files=[],this.files=[],this.fileFilter=e=>!0}load(e){const i=new Q$(e);this.readBlock(i)}readHeader(e){return this.getString(e.readBytes(4),0,4)}decompress(e,i=!1){const s=Wt.empty();let r;const a=this.getInteger(e.readBytes(4),0);try{for(;s.length<a;)if(1===e.readBits(1)){const f=e.readBits(4),p=e.readBitsReversed(f),g=e.readBitsReversed(f),m=s.length-p,y=Math.min(p,g);r=s.getBuffer(),s.write(r,m,y)}else{const f=e.readBitsReversed(2);for(let p=0;p<f;p++)s.writeByte(e.readByte())}}catch(h){if(!(h instanceof Ih))throw h}r=s.getBuffer();const o=i?4:0,l=s.length-o,c=new Uint8Array(l);return c.set(r.subarray(o,o+l),0),c}readBlock(e){const i=this.readHeader(e);if("BCFZ"===i)this.readUncompressedBlock(this.decompress(e,!0));else{if("BCFS"!==i)throw new Ht("Unsupported format");this.readUncompressedBlock(e.readAll())}}readUncompressedBlock(e){let s=4096;for(;s+3<e.length;){if(2===this.getInteger(e,s)){const a=new K$;a.fileName=this.getString(e,s+4,127),a.fileSize=this.getInteger(e,s+140);const o=!this.fileFilter||this.fileFilter(a.fileName);o&&this.files.push(a);const l=s+148;let c=0,u=0;const h=o?Wt.withCapacity(a.fileSize):null;for(;c=this.getInteger(e,l+4*u++),0!==c;)s=4096*c,o&&h.write(e,s,4096);if(o){a.data=new Uint8Array(Math.min(a.fileSize,h.length));const f=h.toArray();a.data.set(f.subarray(0,0+a.data.length),0)}}s+=4096}}getString(e,i,s){let r="";for(let a=0;a<s;a++){const o=255&e[i+a];if(0===o)break;r+=String.fromCharCode(o)}return r}getInteger(e,i){return e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]}}return n.HeaderBcFs="BCFS",n.HeaderBcFz="BCFZ",n})();class e9 extends Ho{get name(){return"Guitar Pro 6"}readScore(){x.debug(this.name,"Loading GPX filesystem");const t=new Z$;t.fileFilter=c=>c.endsWith("score.gpif")||c.endsWith("BinaryStylesheet")||c.endsWith("PartConfiguration")||c.endsWith("LayoutConfiguration"),t.load(this.data),x.debug(this.name,"GPX filesystem loaded");let e=null,i=null,s=null,r=null;for(const c of t.files)switch(c.fileName){case"score.gpif":e=T.toString(c.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=c.data;break;case"PartConfiguration":s=c.data;break;case"LayoutConfiguration":r=c.data}if(!e)throw new Ht("No score.gpif found in GPX");x.debug(this.name,"Start Parsing score.gpif");const a=new W;a.parseXml(e,this.settings),x.debug(this.name,"score.gpif parsed");const o=a.score;i&&(x.debug(this.name,"Start Parsing BinaryStylesheet"),new Oi(i).apply(o),x.debug(this.name,"BinaryStylesheet parsed"));let l=null;return s&&(x.debug(this.name,"Start Parsing Part Configuration"),l=new CS(s),l.apply(o),x.debug(this.name,"Part Configuration parsed")),r&&null!=l&&(x.debug(this.name,"Start Parsing Layout Configuration"),new ES(l,r).apply(o),x.debug(this.name,"Layout Configuration parsed")),o}}var le=function(n){return n[n.None=0]="None",n[n.Natural=1]="Natural",n[n.Sharp=2]="Sharp",n[n.Flat=3]="Flat",n[n.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",n[n.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",n[n.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",n[n.DoubleSharp=7]="DoubleSharp",n[n.DoubleFlat=8]="DoubleFlat",n}(le||{});class t9{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}let Js=(()=>{class n{constructor(e){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,i){return i<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[i].staffLine:nn.getArticulationByInputMidiNumber(i)?.staffLine??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let i=e.displayValue;switch(e.accidentalMode){case ke.ForceDoubleFlat:i+=2;break;case ke.ForceDoubleSharp:i-=2;break;case ke.ForceFlat:i+=1;break;case ke.ForceSharp:i-=1}return i}applyAccidental(e){const i=n.getNoteValue(e);return this.getAccidental(i,e.hasQuarterToneOffset,e.beat,!1,e)}applyAccidentalForValue(e,i,s,r){return this.getAccidental(i,s,e,r,null)}static computeLineWithoutAccidentals(e,i){let s=0;const r=n.getNoteValue(i);return s=i.isPercussion?n.getPercussionLine(e,r):n.calculateNoteSteps(e.keySignature,e.clef,r),s}static computeAccidental(e,i,s,r,a=null){const l=e+7,c=s%12,u=l<7?le.Flat:le.Sharp,h=n.KeySignatureLookup[l][c],f=n.AccidentalNotes[c];let p=le.None;if(r)switch(p=f?u:le.Natural,p){case le.Natural:p=le.NaturalQuarterNoteUp;break;case le.Sharp:p=le.SharpQuarterNoteUp;break;case le.Flat:p=le.FlatQuarterNoteUp}else{switch(i){case ke.ForceSharp:p=le.Sharp;break;case ke.ForceDoubleSharp:p=le.DoubleSharp;break;case ke.ForceFlat:p=le.Flat;break;case ke.ForceDoubleFlat:p=le.DoubleFlat;break;default:f?p=u:h&&(p=le.Natural)}p!==le.None?null!=a?a===p&&(p=le.None):h&&p===u&&(p=le.None):null!==a&&(p=a===le.Natural?le.None:le.Natural)}return p}getAccidental(e,i,s,r,a=null){let o=0,l=le.None;if(null!=a?a.isPercussion:this._bar.staff.isPercussion)o=n.getPercussionLine(this._bar,e);else{const u=a?a.accidentalMode:ke.Default;o=n.calculateNoteSteps(this._bar.keySignature,this._bar.clef,e);const h=this._registeredAccidentals.has(o)?this._registeredAccidentals.get(o):null;l=n.computeAccidental(this._bar.keySignature,u,e,i,h);let f=!1;switch(l){case le.NaturalQuarterNoteUp:case le.SharpQuarterNoteUp:case le.FlatQuarterNoteUp:break;default:if(a&&a.isTieDestination&&0===a.beat.index){const p=this._barRenderer.scoreRenderer.layout?.getRendererForBar(this._barRenderer.staff.staffId,a.tieOrigin.beat.voice.bar);p&&p.staff===this._barRenderer.staff&&p.accidentalHelper.getNoteLine(a.tieOrigin)===o&&(f=!0)}f?l=le.None:l!==le.None&&this._registeredAccidentals.set(o,l)}}return a?(this._appliedScoreLines.set(a.id,o),this._notesByValue.set(e,a)):this._appliedScoreLinesByValue.set(e,o),(-1e3===this.minLine||this.minLine<o)&&(this.minLine=o,this.minLineBeat=s),(-1e3===this.maxLine||this.maxLine>o)&&(this.maxLine=o,this.maxLineBeat=s),r||this.registerLine(s,o),l}registerLine(e,i){let s;this._beatLines.has(e.id)?s=this._beatLines.get(e.id):(s=new t9,this._beatLines.set(e.id,s)),(-1e3===s.minLine||i<s.minLine)&&(s.minLine=i),(-1e3===s.minLine||i>s.maxLine)&&(s.maxLine=i)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}static calculateNoteSteps(e,i,s){const a=e,l=s%12;let u=n.OctaveSteps[i];return u-=((s/12|0)-1)*n.StepsPerOctave,u-=(H.keySignatureIsSharp(a)||H.keySignatureIsNatural(a)?n.SharpNoteSteps:n.FlatNoteSteps)[l],u}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,i=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):i&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}return n.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],n.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1],n.StepsPerOctave=7,n.OctaveSteps=[38,32,30,26,38],n.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6],n.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6],n})();class n9{constructor(){this.currentDynamics=ie.F,this.slideOrigins=new Map,this.transpose=0,this.isExplicitlyBeamed=!1,this.tieStarts=new Set,this.tieStartIds=new Map,this.slideOrigins=new Map,this.slurStarts=new Map}}class i9 extends q{constructor(){super(...arguments),this.outputMidiChannel=-1,this.outputMidiProgram=-1,this.outputVolume=-1,this.outputBalance=-1}}class fg{constructor(t){this.instruments=new Map,this._instrumentIdToArticulationIndex=new Map,this._lyricsLine=0,this._lyricsLines=new Map,this.track=t}getLyricLine(t){if(this._lyricsLines.has(t))return this._lyricsLines.get(t);const e=this._lyricsLine;return this._lyricsLines.set(t,e),this._lyricsLine++,e}getOrCreateArticulation(t,e){const i=12*e.octave+e.tone,s=`${t}_${i}`;if(this._instrumentIdToArticulationIndex.has(s))return this._instrumentIdToArticulationIndex.get(s);let r;r=this.instruments.has(t)?this.instruments.get(t):fg.defaultNoteArticulation;const a=this.track.percussionArticulations.length,o=e.beat.voice.bar;let l;l=0===i?4:Js.calculateNoteSteps(o.keySignature,o.clef,i);const p=new q(r.elementType,l-(9-(2*e.beat.voice.bar.staff.standardNotationLineCount-1)),r.outputMidiNumber,r.noteHeadDefault,r.noteHeadHalf,r.noteHeadWhole,r.techniqueSymbol,r.techniqueSymbolPlacement);return this._instrumentIdToArticulationIndex.set(s,a),this.track.percussionArticulations.push(p),a}}fg.defaultNoteArticulation=new q("Default",0,0,d.NoteheadBlack,d.NoteheadHalf,d.NoteheadWhole);class rt extends Ho{constructor(){super(...arguments),this._idToTrackInfo=new Map,this._indexToTrackInfo=new Map,this._staffToContext=new Map,this._divisionsPerQuarterNote=1,this._currentDynamics=ie.F,this._musicalPosition=0,this._lastBeat=null,this._nextMasterBarRepeatEnding=0,this._nextBeatAutomations=null,this._nextBeatChord=null,this._nextBeatCrescendo=null,this._nextBeatLetRing=!1,this._nextBeatPalmMute=!1,this._nextBeatOttavia=null,this._nextBeatText=null,this._simileMarkAllStaves=null,this._simileMarkPerStaff=null,this._isBeatSlash=!1,this._keyAllStaves=null,this._currentTrillStep=-1}get name(){return"MusicXML"}readScore(){const t=this.extractMusicXml(),e=new Ph;try{e.parse(t)}catch(i){throw new Ht("Unsupported format",i)}return this._score=new Dr,this._score.tempo=120,this._score.stylesheet.hideDynamics=!0,this.parseDom(e),H.consolidate(this._score),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const t=new xS(this.data);let e;try{e=t.read()}catch{e=[]}if(0===e.length)return this.data.reset(),T.toString(this.data.readAll(),this.settings.importer.encoding);const i=e.find(c=>"META-INF/container.xml"===c.fullName);if(!i)throw new Ht("No compressed MusicXML");const s=new Ph;try{s.parse(T.toString(i.data,this.settings.importer.encoding))}catch(c){throw new Ht("Malformed container.xml, could not parse as XML",c)}const r=s.firstElement;if(!r||"container"!==r.localName)throw new Ht("Malformed container.xml, root element not 'container'");const a=r.findChildElement("rootfiles");if(!a)throw new Ht("Malformed container.xml, 'container/rootfiles' not found");let o="";for(const c of a.childElements())if("rootfile"===c.localName){o=c.getAttribute("full-path");break}if(!o)throw new Ht("Unsupported compressed MusicXML, missing rootfile");const l=e.find(c=>c.fullName===o);if(!l)throw new Ht(`Malformed container.xml, '${o}' not contained in zip`);return T.toString(l.data,this.settings.importer.encoding)}parseDom(t){const e=t.firstElement;if(!e)throw new Ht("Unsupported format");switch(e.localName){case"score-partwise":this.parsePartwise(e);break;case"score-timewise":this.parseTimewise(e);break;default:throw new Ht("Unsupported format")}}parsePartwise(t){for(const e of t.childElements())switch(e.localName){case"credit":this.parseCredit(e);break;case"identification":this.parseIdentification(e);break;case"movement-title":this.parseMovementTitle(e);break;case"part":this.parsePartwisePart(e);break;case"part-list":this.parsePartList(e);break;case"work":this.parseWork(e)}}parseTimewise(t){let e=0;for(const i of t.childElements())switch(i.localName){case"credit":this.parseCredit(i);break;case"identification":this.parseIdentification(i);break;case"movement-title":this.parseMovementTitle(i);break;case"part-list":this.parsePartList(i);break;case"work":this.parseWork(i);break;case"measure":this.parseTimewiseMeasure(i,e),e++}}parseCredit(t){if("1"!==t.getAttribute("page","1"))return;const e=[];let i=null,s="";for(const r of t.childElements())switch(r.localName){case"credit-type":e.push(r.innerText);break;case"credit-words":null===i&&(i=r),s+=r.innerText}if(e.length>0)for(const r of e)switch(r){case"title":this._score.title=rt.sanitizeDisplay(s);break;case"subtitle":this._score.subTitle=rt.sanitizeDisplay(s);break;case"composer":case"arranger":this._score.artist=rt.sanitizeDisplay(s);break;case"lyricist":this._score.words=rt.sanitizeDisplay(s);break;case"rights":this._score.copyright=rt.sanitizeDisplay(s)}else if(i){const r=i.getAttribute("font-size","0"),a=i.getAttribute("font-size","top"),o=i.getAttribute("halign","left");if("top"===a){if(s.includes("copyright")||s.includes("Copyright")||s.includes("\xa9")||s.includes("(c)")||s.includes("(C)"))return void(this._score.copyright=rt.sanitizeDisplay(s));if("center"===o||"center"===r){if(0===this._score.title.length)return void(this._score.title=rt.sanitizeDisplay(s));if(0===this._score.subTitle.length)return void(this._score.subTitle=rt.sanitizeDisplay(s));if(0===this._score.album.length)return void(this._score.album=rt.sanitizeDisplay(s))}else if(("right"===o||"right"===r)&&0===this._score.music.length)return void(this._score.music=rt.sanitizeDisplay(s));if(0===this._score.artist.length)return void(this._score.artist=rt.sanitizeDisplay(s));if(0===this._score.words.length)return void(this._score.words=rt.sanitizeDisplay(s))}}}static sanitizeDisplay(t){return t.replaceAll("\r","").replaceAll("\n"," ").replaceAll("\t","\xa0\xa0").replaceAll(" ","\xa0")}parseIdentification(t){for(const e of t.childElements())switch(e.localName){case"creator":if(e.attributes.has("type"))switch(e.attributes.get("type")){case"composer":this._score.artist=rt.sanitizeDisplay(e.innerText);break;case"lyricist":this._score.words=rt.sanitizeDisplay(e.innerText);break;case"arranger":this._score.music=rt.sanitizeDisplay(e.innerText)}else this._score.artist=rt.sanitizeDisplay(e.innerText);break;case"rights":this._score.copyright.length>0&&(this._score.copyright+=", "),this._score.copyright+=e.innerText,e.attributes.has("type")&&(this._score.copyright+=` (${e.attributes.get("type")})`);break;case"encoding":this.parseEncoding(e)}}parseEncoding(t){for(const e of t.childElements())switch(e.localName){case"encoder":this._score.tab.length>0&&(this._score.tab+=", "),this._score.tab+=e.innerText,e.attributes.has("type")&&(this._score.tab+=` (${e.attributes.get("type")})`);break;case"encoding-description":this._score.notices+=rt.sanitizeDisplay(e.innerText)}}parseMovementTitle(t){0===this._score.title.length?this._score.title=rt.sanitizeDisplay(t.innerText):this._score.subTitle=rt.sanitizeDisplay(t.innerText)}parsePartList(t){for(const e of t.childElements())"score-part"===e.localName&&this.parseScorePart(e)}parseScorePart(t){const e=new Wo;e.ensureStaveCount(1),this._score.addTrack(e);const i=t.attributes.get("id"),s=new fg(e);this._idToTrackInfo.set(i,s),this._indexToTrackInfo.set(e.index,s);for(const r of t.childElements())switch(r.localName){case"part-name":e.name=rt.sanitizeDisplay(r.innerText);break;case"part-name-display":e.name=this.parsePartDisplayAsText(r);break;case"part-abbreviation":e.shortName=rt.sanitizeDisplay(r.innerText);break;case"part-abbreviation-display":e.shortName=this.parsePartDisplayAsText(r);break;case"score-instrument":this.parseScoreInstrument(r,s);break;case"midi-device":r.attributes.has("port")&&(e.playbackInfo.port=Number.parseInt(r.attributes.get("port"),10));break;case"midi-instrument":this.parseScorePartMidiInstrument(r,s)}s.firstArticulation&&(s.firstArticulation.outputMidiProgram>=0&&(e.playbackInfo.program=s.firstArticulation.outputMidiProgram),s.firstArticulation.outputBalance>=0&&(e.playbackInfo.balance=s.firstArticulation.outputBalance),s.firstArticulation.outputVolume>=0&&(e.playbackInfo.volume=s.firstArticulation.outputVolume),s.firstArticulation.outputMidiChannel>=0&&(e.playbackInfo.primaryChannel=s.firstArticulation.outputMidiChannel,e.playbackInfo.secondaryChannel=s.firstArticulation.outputMidiChannel))}parseScoreInstrument(t,e){const i=new i9;e.firstArticulation||(e.firstArticulation=i),e.instruments.set(t.getAttribute("id",""),i)}parseScorePartMidiInstrument(t,e){const i=t.getAttribute("id","");if(!e.instruments.has(i))return;const s=e.instruments.get(i);for(const r of t.childElements())switch(r.localName){case"midi-channel":s.outputMidiChannel=Number.parseInt(r.innerText)-1;break;case"midi-program":s.outputMidiProgram=Number.parseInt(r.innerText)-1;break;case"midi-unpitched":s.outputMidiNumber=Number.parseInt(r.innerText)-1;break;case"volume":s.outputVolume=rt.interpolatePercent(Number.parseFloat(r.innerText));break;case"pan":s.outputBalance=rt.interpolatePan(Number.parseFloat(r.innerText))}}static interpolatePercent(t){return 0|rt.interpolate(0,100,0,16,t)}static interpolatePan(t){return 0|rt.interpolate(-90,90,0,16,t)}static interpolate(t,e,i,s,r){return i+(r-t)/(e-t)*(s-i)}parsePartDisplayAsText(t){let e="";for(const i of t.childElements())switch(i.localName){case"display-text":e+=i.innerText;break;case"accidental-text":switch(i.innerText){case"sharp":e+="\u266f";break;case"natural":e+="\u266e";break;case"flat":e+="\u266d";break;case"double-sharp":e+="\u{1d12a}";break;case"sharp-sharp":e+="\u266f\u266f";break;case"flat-flat":e+="\u{1d12b}";break;case"natural-sharp":e+="\u266e\u266f";break;case"natural-flat":e+="\u266e\u266d";break;case"sharp-down":e+="\u{1d131}";break;case"sharp-up":e+="\u{1d130}";break;case"natural-down":e+="\u{1d12f}";break;case"natural-up":e+="\u{1d12e}";break;case"flat-down":e+="\u{1d12d}";break;case"flat-up":e+="\u{1d12c}";break;case"arrow-down":e+="\u2193";break;case"arrow-up":e+="\u2191";break;case"triple-sharp":e+="\u266f\u{1d12a}";break;case"triple-flat":e+="\u{1d12c}\u{1d12c}\u{1d12c}";break;case"sharp-1":e+="\u266f\xb9";break;case"sharp-2":e+="\u266f\xb2";break;case"sharp-3":e+="\u266f\xb3";break;case"sharp-4":e+="\u266f\u2074";break;case"sharp-5":e+="\u266f\u2075";break;case"flat-1":e+="\u266d\xb9";break;case"flat-2":e+="\u266d\xb2";break;case"flat-3":e+="\u266d\xb3";break;case"flat-4":e+="\u266d\u2074";break;case"flat-5":e+="\u266d\u2075"}}return rt.sanitizeDisplay(e)}parseWork(t){for(const e of t.childElements())"work-title"===e.localName&&(this._score.title=rt.sanitizeDisplay(e.innerText))}parsePartwisePart(t){const e=t.attributes.get("id");if(!e||!this._idToTrackInfo.has(e))return;const i=this._idToTrackInfo.get(e).track;let s=0;for(const r of t.childElements())"measure"===r.localName&&(this.parsePartwiseMeasure(r,i,s),s++)}parsePartwiseMeasure(t,e,i){const s=this.getOrCreateMasterBar(t,i);this.parsePartMeasure(t,s,e)}parseTimewiseMeasure(t,e){const i=this.getOrCreateMasterBar(t,e);for(const s of t.childElements())"part"===s.localName&&this.parseTimewisePart(s,i)}getOrCreateMasterBar(t,e){const i="yes"===t.attributes.get("implicit");for(;this._score.masterBars.length<=e;){const r=new Cr;i&&(r.isAnacrusis=!0),this._score.addMasterBar(r),r.index>0&&(r.timeSignatureDenominator=r.previousMasterBar.timeSignatureDenominator,r.timeSignatureNumerator=r.previousMasterBar.timeSignatureNumerator,r.tripletFeel=r.previousMasterBar.tripletFeel)}return this._score.masterBars[e]}parseTimewisePart(t,e){const i=t.attributes.get("id");if(!i||!this._idToTrackInfo.has(i))return;const s=this._idToTrackInfo.get(i).track;this.parsePartMeasure(t,e,s)}parsePartMeasure(t,e,i){this._musicalPosition=0,this._lastBeat=null,e.alternateEndings=this._nextMasterBarRepeatEnding;const s=[];for(const a of t.childElements())switch(a.localName){case"note":this.parseNote(a,e,i);break;case"backup":this.parseBackup(a);break;case"forward":this.parseForward(a);break;case"direction":this.parseDirection(a,e,i);break;case"attributes":this.parseAttributes(a,e,i);break;case"harmony":this.parseHarmony(a,i);break;case"print":this.parsePrint(a,e,i);break;case"sound":this.parseSound(a,e,i);break;case"barline":s.push(a)}for(const a of s)this.parseBarLine(a,e,i);this.applySimileMarks(e,i);const r=this.getOrCreateStaff(i,0);this.getOrCreateBar(r,e),this._keyAllStaves=null}parsePrint(t,e,i){("yes"===t.getAttribute("new-system","no")||"yes"===t.getAttribute("new-page","no"))&&i.addLineBreaks(e.index)}applySimileMarks(t,e){if(null!==this._simileMarkAllStaves){for(const i of e.staves){const s=this.getOrCreateBar(i,t);s.simileMark=this._simileMarkAllStaves,s.simileMark!==$t.None&&this.clearBar(s)}this._simileMarkAllStaves=this._simileMarkAllStaves===$t.FirstOfDouble?$t.SecondOfDouble:null}if(null!==this._simileMarkPerStaff){const i=Array.from(this._simileMarkPerStaff.keys());for(const s of i){const r=this.getOrCreateStaff(e,s),a=this.getOrCreateBar(r,t);a.simileMark=this._simileMarkPerStaff.get(s),a.simileMark!==$t.None&&this.clearBar(a),a.simileMark===$t.FirstOfDouble?this._simileMarkPerStaff.set(s,$t.SecondOfDouble):this._simileMarkPerStaff.delete(s)}0===this._simileMarkPerStaff.size&&(this._simileMarkPerStaff=null)}}clearBar(t){for(const e of t.voices){const i=new Vn;i.isEmpty=!0,e.addBeat(i)}}parseBarLine(t,e,i){for(const s of t.childElements())switch(s.localName){case"bar-style":this.parseBarStyle(s,e,i,t.getAttribute("location","right"));break;case"ending":this.parseEnding(s,e);break;case"repeat":this.parseRepeat(s,e)}}parseRepeat(t,e){const i=t.getAttribute("direction");let s=Number.parseInt(t.getAttribute("times"));(s<0||Number.isNaN(s))&&(s=2),"backward"===i?e.repeatCount=s:"forward"===i&&(e.isRepeatStart=!0)}parseEnding(t,e){const i=t.getAttribute("number").split(",").map(r=>Number.parseInt(r));let s=0;for(const r of i)s|=1<<r-1&255;switch(e.alternateEndings=s,t.getAttribute("type","")){case"start":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding|s;break;case"stop":case"discontinue":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding&~s}}parseBarStyle(t,e,i,s){let r=pe.Automatic;switch(t.innerText){case"dashed":r=pe.Dashed;break;case"dotted":r=pe.Dotted;break;case"heavy":r=pe.Heavy;break;case"heavy-heavy":r=pe.HeavyHeavy;break;case"heavy-light":r=pe.HeavyLight;break;case"light-heavy":r=pe.LightHeavy;break;case"light-light":r=pe.LightLight;break;case"none":r=pe.None;break;case"regular":r=pe.Regular;break;case"short":r=pe.Short;break;case"tick":r=pe.Tick}for(const a of i.staves){const o=this.getOrCreateBar(a,e);switch(s){case"left":o.barLineLeft=r;break;case"right":o.barLineRight=r}}}parseSound(t,e,i){for(const s of t.childElements())switch(s.localName){case"midi-instrument":this.parseSoundMidiInstrument(s,e);break;case"swing":this.parseSwing(s,e)}if(t.attributes.has("coda")&&e.addDirection(A.TargetCoda),t.attributes.has("tocoda")&&e.addDirection(A.JumpDaCoda),t.attributes.has("dacapo")&&e.addDirection(A.JumpDaCapo),t.attributes.has("dalsegno")&&e.addDirection(A.JumpDalSegno),t.attributes.has("fine")&&e.addDirection(A.TargetFine),t.attributes.has("segno")&&e.addDirection(A.TargetSegno),t.attributes.has("pan")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const s=new Xt;s.type=Bt.Balance,s.value=rt.interpolatePan(Number.parseFloat(t.attributes.get("pan"))),this._nextBeatAutomations.push(s)}if(t.attributes.has("tempo")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const s=new Xt;s.type=Bt.Tempo,s.value=rt.interpolatePercent(Number.parseFloat(t.attributes.get("tempo"))),this._nextBeatAutomations.push(s)}}parseSwing(t,e){let i=0,s=0,r=null;for(const a of t.childElements())switch(a.localName){case"straight":return void(e.tripletFeel=_e.NoTripletFeel);case"first":i=Number.parseInt(a.innerText);break;case"second":s=Number.parseInt(a.innerText);break;case"swing-type":r=this.parseBeatDuration(a)}r||(r=w.Eighth),r===w.Eighth?2===i&&1===s?e.tripletFeel=_e.Triplet8th:3===i&&1===s?e.tripletFeel=_e.Dotted8th:1===i&&3===s&&(e.tripletFeel=_e.Scottish8th):r===w.Sixteenth&&(2===i&&1===s?e.tripletFeel=_e.Triplet16th:3===i&&1===s?e.tripletFeel=_e.Dotted16th:1===i&&3===s&&(e.tripletFeel=_e.Scottish16th))}parseSoundMidiInstrument(t,e){let i;for(const s of t.childElements())switch(s.localName){case"midi-program":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new Xt,i.type=Bt.Instrument,i.value=Number.parseInt(s.innerText)-1,this._nextBeatAutomations.push(i);break;case"volume":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new Xt,i.type=Bt.Volume,i.value=rt.interpolatePercent(Number.parseFloat(s.innerText)),this._nextBeatAutomations.push(i);break;case"pan":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new Xt,i.type=Bt.Balance,i.value=rt.interpolatePan(Number.parseFloat(s.innerText)),this._nextBeatAutomations.push(i)}}parseHarmony(t,e){const i=new Qr;let s=!1,r="";for(const a of t.childElements())switch(a.localName){case"root":i.name=this.parseHarmonyRoot(a);break;case"kind":i.name=i.name+this.parseHarmonyKind(a),"yes"===a.getAttribute("parentheses-degrees","no")&&(s=!0);break;case"frame":this.parseHarmonyFrame(a,i);break;case"degree":r+=this.parseDegree(a)}r&&(i.name+=s?`(${r})`:r),null===this._nextBeatChord&&(this._nextBeatChord=i)}parseDegree(t){let e="",i="",s="";for(const r of t.childElements())switch(r.localName){case"degree-value":e=r.innerText;break;case"degree-alter":switch(r.innerText){case"-1":i="\u266d";break;case"1":i="\u266f"}break;case"degree-type":s+=r.getAttribute("text","")}return`${s}${i}${e}`}parseHarmonyRoot(t){let e="",i="";for(const s of t.childElements())switch(s.localName){case"root-step":e=s.innerText;break;case"root-alter":switch(Number.parseFloat(s.innerText)){case-2:i="bb";break;case-1:i="b";break;case 0:i="";break;case 1:i="#";break;case 2:i="##"}}return e+i}parseHarmonyKind(t){const e=t.getAttribute("text");let i="";if(e)i=e;else{const s=t.innerText;switch(s){case"major":i="";break;case"minor":i="m";break;case"augmented":i="+";break;case"diminished":i="\u25cb";break;case"dominant":i="7";break;case"major-seventh":i="7M";break;case"minor-seventh":i="m7";break;case"diminished-seventh":i="\u25cb7";break;case"augmented-seventh":i="+7";break;case"half-diminished":i="\u2349";break;case"major-minor":i="mMaj";break;case"major-sixth":i="maj6";break;case"minor-sixth":i="m6";break;case"dominant-ninth":i="9";break;case"major-ninth":i="maj9";break;case"minor-ninth":i="m9";break;case"dominant-11th":i="11";break;case"major-11th":i="maj11";break;case"minor-11th":i="m11";break;case"dominant-13th":i="13";break;case"major-13th":i="maj13";break;case"minor-13th":i="m13";break;case"suspended-second":i="sus2";break;case"suspended-fourth":i="sus4";break;case"Neapolitan":i="\u266dII";break;case"Italian":i="It\u207a\u2076";break;case"French":case"German":i="Fr\u207a\u2076";break;default:i=s}}return i}parseHarmonyFrame(t,e){for(const i of t.childElements())switch(i.localName){case"frame-strings":const s=Number.parseInt(i.innerText);e.strings=new Array(s);for(let o=0;o<s;o++)e.strings[o]=-1;break;case"first-fret":e.firstFret=Number.parseInt(i.innerText);break;case"frame-note":let r=null,a=null;for(const o of i.childElements())switch(o.localName){case"string":r=Number.parseInt(o.innerText);break;case"fret":a=Number.parseInt(o.innerText),r&&a>=0&&(e.strings[r-1]=a);break;case"barre":r&&a&&"start"===o.getAttribute("type")&&e.barreFrets.push(a)}}}parseAttributes(t,e,i){let s,r,a;if(null==this._lastBeat)for(const o of t.childElements())switch(o.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(o.innerText);break;case"key":this.parseKey(o,e,i);break;case"time":this.parseTime(o,e);break;case"staves":i.ensureStaveCount(Number.parseInt(o.innerText));break;case"clef":s=Number.parseInt(o.getAttribute("number","1"))-1,r=this.getOrCreateStaff(i,s),a=this.getOrCreateBar(r,e),this.parseClef(o,a);break;case"staff-details":s=Number.parseInt(o.getAttribute("number","1"))-1,r=this.getOrCreateStaff(i,s),this.parseStaffDetails(o,r);break;case"transpose":this.parseTranspose(o,i);break;case"measure-style":this.parseMeasureStyle(o,i,!1)}else for(const o of t.childElements())switch(o.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(o.innerText);break;case"measure-style":this.parseMeasureStyle(o,i,!0)}}parseMeasureStyle(t,e,i){for(const s of t.childElements())switch(s.localName){case"measure-repeat":if(!i){let r=null;switch(s.getAttribute("type")){case"start":switch(Number.parseInt(s.getAttribute("slashes","1"))){case 1:r=$t.Simple;break;case 2:r=$t.FirstOfDouble}break;case"stop":r=null}if(t.attributes.has("number")){this._simileMarkPerStaff=this._simileMarkPerStaff??new Map;const a=Number.parseInt(t.attributes.get("number"))-1;null==r?this._simileMarkPerStaff.delete(a):this._simileMarkPerStaff.set(a,r)}else this._simileMarkAllStaves=r}break;case"slash":switch(s.getAttribute("type")){case"start":this._isBeatSlash=!0;break;case"stop":this._isBeatSlash=!1}}}parseTranspose(t,e){let i=0;for(const s of t.childElements())switch(s.localName){case"chromatic":i+=Number.parseFloat(s.innerText);break;case"octave-change":i+=12*Number.parseFloat(s.innerText)}if(t.attributes.has("number")){const s=this.getOrCreateStaff(e,Number.parseInt(t.attributes.get("number"))-1);this.getStaffContext(s).transpose=i,s.displayTranspositionPitch=i}else for(const s of e.staves)this.getStaffContext(s).transpose=i,s.displayTranspositionPitch=i}parseStaffDetails(t,e){for(const i of t.childElements())switch(i.localName){case"staff-lines":e.standardNotationLineCount=Number.parseInt(i.innerText);break;case"staff-tuning":this.parseStaffTuning(i,e);break;case"capo":e.capo=Number.parseInt(i.innerText)}}parseStaffTuning(t,e){0===e.stringTuning.tunings.length&&(e.showTablature=!0,e.showStandardNotation=!1,e.stringTuning.tunings=new Array(e.standardNotationLineCount).fill(0));const i=Number.parseInt(t.getAttribute("line"));let s="C",r="",a=0;for(const l of t.childElements())switch(l.localName){case"tuning-step":s=l.innerText;break;case"tuning-alter":a=Number.parseFloat(l.innerText);break;case"tuning-octave":r=l.innerText}const o=H.getTuningForText(s+r)+a;e.tuning[e.tuning.length-i]=o}parseClef(t,e){let i="s",s=0;for(const r of t.childElements())switch(r.localName){case"sign":i=r.innerText.toLowerCase();break;case"line":s=Number.parseInt(r.innerText);break;case"clef-octave-change":switch(Number.parseInt(r.innerText)){case-2:e.clefOttava=we._15mb;break;case-1:e.clefOttava=we._8vb;break;case 1:e.clefOttava=we._8va;break;case 2:e.clefOttava=we._15mb}}switch(i){case"g":default:e.clef=Be.G2;break;case"f":e.clef=Be.F4;break;case"c":e.clef=3===s?Be.C3:Be.C4;break;case"percussion":e.clef=Be.Neutral,e.staff.isPercussion=!0;break;case"tab":e.clef=Be.G2,e.staff.showTablature=!0}}parseTime(t,e){let i=!1,s=!1;for(const r of t.childElements()){const a=r.innerText;switch(r.localName){case"beats":i||(e.timeSignatureNumerator=-1===a.indexOf("+")?Number.parseInt(a):a.split("+").map(o=>Number.parseInt(o)).reduce((o,l)=>l+o,0),i=!0);break;case"beat-type":s||(e.timeSignatureDenominator=-1===a.indexOf("+")?Number.parseInt(a):a.split("+").map(o=>Number.parseInt(o)).reduce((o,l)=>l+o,0),s=!0)}}switch(t.getAttribute("symbol","")){case"common":case"cut":e.timeSignatureCommon=!0}}parseKey(t,e,i){let a,o,s=-De.C,r="";for(const l of t.childElements())switch(l.localName){case"fifths":s=Number.parseInt(l.innerText);break;case"mode":r=l.innerText}if(a=-7<=s&&s<=7?s:De.C,o="minor"===r?li.Minor:li.Major,t.attributes.has("number")){const l=this.getOrCreateStaff(i,Number.parseInt(t.attributes.get("number"))-1),c=this.getOrCreateBar(l,e);c.keySignature=a,c.keySignatureType=o}else{this._keyAllStaves=[a,o];for(const l of i.staves)l.bars.length>e.index&&(l.bars[e.index].keySignature=a,l.bars[e.index].keySignatureType=o)}}parseDirection(t,e,i){const s=[];let r=null,a=-1,o=-1;for(const f of t.childElements())switch(f.localName){case"direction-type":s.push(f.firstElement);break;case"offset":r=Number.parseFloat(f.innerText);break;case"voice":break;case"staff":a=Number.parseInt(f.innerText)-1;break;case"sound":f.attributes.has("tempo")&&(o=Number.parseFloat(f.attributes.get("tempo")))}let l=null;l=a>=0?this.getOrCreateStaff(i,a):null!==this._lastBeat?this._lastBeat.voice.bar.staff:this.getOrCreateStaff(i,0);const c=l?this.getOrCreateBar(l,e):null,u=()=>{let f=this._musicalPosition;return null!==r&&(f+=r),f/e.calculateDuration(!1)};if(o>0){const f=new Xt;f.type=Bt.Tempo,f.value=o,f.ratioPosition=u(),this.hasSameTempo(e,f)||(e.tempoAutomations.push(f),0===e.index&&(e.score.tempo=f.value))}let h="";for(const f of s)switch(f.localName){case"rehearsal":e.section=new Tc,e.section.marker=f.innerText;break;case"segno":e.addDirection(A.TargetSegno);break;case"coda":e.addDirection(A.TargetCoda);break;case"words":h=f.innerText;break;case"wedge":switch(f.getAttribute("type")){case"crescendo":this._nextBeatCrescendo=ii.Crescendo;break;case"diminuendo":this._nextBeatCrescendo=ii.Decrescendo;break;case"stop":this._nextBeatCrescendo=null}break;case"dynamics":const p=this.parseDynamics(f);null!==p&&(this._currentDynamics=p,this._score.stylesheet.hideDynamics=!1);break;case"dashes":const g=f.getAttribute("type","start");switch(h){case"LetRing":this._nextBeatLetRing="start"===g||"continue"===g;break;case"P.M.":this._nextBeatPalmMute="start"===g||"continue"===g}h="";break;case"pedal":const m=this.parsePedal(f);m&&c&&(m.ratioPosition=u(),(m.pedalType!==jt.Up||c.sustainPedals.length>0&&c.sustainPedals[c.sustainPedals.length-1].pedalType!==jt.Up)&&c.sustainPedals.push(m));break;case"metronome":this.parseMetronome(f,e,u());break;case"octave-shift":this._nextBeatOttavia=this.parseOctaveShift(f)}h&&(this._nextBeatText=h)}parseOctaveShift(t){const e=t.getAttribute("type");switch(Number.parseInt(t.getAttribute("size","8"))){case 15:switch(e){case"up":return we._15mb;case"down":return we._15ma;case"stop":return we.Regular;case"continue":return this._nextBeatOttavia}break;case 8:switch(e){case"up":return we._8vb;case"down":return we._8va;case"stop":return we.Regular;case"continue":return this._nextBeatOttavia}}return null}parseMetronome(t,e,i){let s=null,r=-1;for(const a of t.childElements())switch(a.localName){case"beat-unit":s=this.parseBeatDuration(a);break;case"per-minute":r=Number.parseFloat(a.innerText)}if(null!==s&&r>0){const a=new Xt;a.type=Bt.Tempo,a.value=r*(s/4)|0,a.ratioPosition=i,this.hasSameTempo(e,a)||(e.tempoAutomations.push(a),0===e.index&&(e.score.tempo=a.value))}}hasSameTempo(t,e){for(const i of t.tempoAutomations)if(e.ratioPosition===i.ratioPosition&&e.value===i.value)return!0;return!1}parsePedal(t){const e=new Ua;switch(t.getAttribute("type")){case"start":e.pedalType=jt.Down;break;case"stop":e.pedalType=jt.Up;break;case"continue":e.pedalType=jt.Hold;break;default:return null}return e}parseDynamics(t){for(const e of t.childElements()){const i=e.localName.toUpperCase();switch(i){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":return ie[i]}}return null}parseForward(t){for(const e of t.childElements())"duration"===e.localName&&(this._musicalPosition+=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(e.innerText)))}parseBackup(t){for(const e of t.childElements())if("duration"===e.localName&&this._lastBeat){let s=this._musicalPosition;s-=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(e.innerText)),s<0&&(s=0),this._musicalPosition=s}}getOrCreateStaff(t,e){for(;t.staves.length<=e;){const i=new hg;t.addStaff(i),this._score.masterBars.length>0&&this.getOrCreateBar(i,this._score.masterBars[this._score.masterBars.length-1])}return t.staves[e]}getOrCreateBar(t,e){const i=0===t.bars.length?1:t.bars[0].voices.length;for(;t.bars.length<=e.index;){const s=new vr;t.addBar(s),s.previousBar&&(s.clef=s.previousBar.clef,s.clefOttava=s.previousBar.clefOttava,s.keySignature=s.previousBar.keySignature,s.keySignatureType=s.previousBar.keySignatureType),null!=this._keyAllStaves&&(s.keySignature=this._keyAllStaves[0],s.keySignatureType=this._keyAllStaves[1]);for(let r=0;r<i;r++){const a=new Fi;s.addVoice(a)}}return t.bars[e.index]}getOrCreateVoice(t,e){let i=!1;for(;t.voices.length<=e;)t.addVoice(new Fi),i=!0;if(i)for(const s of t.staff.bars)for(;s.voices.length<=e;)s.addVoice(new Fi);return t.voices[e]}parseNote(t,e,i){let s=null,r=re.None,a=0,o=null,l=!1,c=0,u=0,h=-1,f=null,p=0,g=-1,m=-1,y=null,b=null,_=!1,v=null;const k="no"!==t.getAttribute("print-object","yes"),F=()=>{if(null!==s)return;l&&!this._lastBeat&&(x.warning("MusicXML","Malformed MusicXML, <chord /> cannot be set on the first note of a measure"),l=!1),l&&!b&&(x.warning("MusicXML","Cannot mix <chord /> and <rest />"),l=!1);const D=this.getOrCreateStaff(i,c);if(l)return s=this._lastBeat,void s.addNote(b);const C=this.getOrCreateBar(D,e),oe=this.getOrCreateVoice(C,u);let Fe=this._musicalPosition-(0===oe.beats.length?0:oe.beats[oe.beats.length-1].displayEnd);if(Fe>0){if(this._lastBeat&&this._lastBeat.beamingMode===St.ForceMergeWithNext&&this._lastBeat.voice.bar.staff.index!==c&&oe.beats.length>0&&oe.beats[oe.beats.length-1].beamingMode===St.ForceMergeWithNext){const xn=oe.beats[oe.beats.length-1].duration;for(;Fe>0;){const mi=this.createRestForGap(Fe,xn);if(null===mi)break;this.insertBeatToVoice(mi,oe),Fe-=mi.playbackDuration}}if(Fe>0){const xn=new Vn;xn.dynamics=this._currentDynamics,xn.isEmpty=!0,xn.duration=w.TwoHundredFiftySixth,xn.overrideDisplayDuration=Fe,xn.updateDurations(),this.insertBeatToVoice(xn,oe)}}else Fe<0&&x.error("MusicXML","Unsupported forward/backup detected. Cannot fill new beats into already filled area of voice");h<0&&null!==f&&(h=P.toTicks(f),p>0&&(h=P.applyDot(h,2===p)));const ne=new Vn;s=ne,null===o?ne.beamingMode=this.getStaffContext(D).isExplicitlyBeamed?St.ForceSplitToNext:St.Auto:(ne.beamingMode=o,this.getStaffContext(D).isExplicitlyBeamed=!0),ne.isEmpty=!1,ne.dynamics=this._currentDynamics,this._isBeatSlash&&(ne.slashed=!0);const ot=this._nextBeatAutomations;if(this._nextBeatAutomations=null,null!==ot)for(const xn of ot)ne.automations.push(xn);const Nn=this._nextBeatChord;this._nextBeatChord=null,null!==Nn&&(ne.chordId=Nn.uniqueId,oe.bar.staff.hasChord(Nn.uniqueId)||oe.bar.staff.addChord(ne.chordId,Nn));const ci=this._nextBeatCrescendo;null!==ci&&(ne.crescendo=ci);const ji=this._nextBeatOttavia;if(null!==ji&&(ne.ottava=ji),ne.isLetRing=this._nextBeatLetRing,ne.isPalmMute=this._nextBeatPalmMute,this._nextBeatText&&(ne.text=this._nextBeatText,this._nextBeatText=null),null!==b&&ne.addNote(b),this.insertBeatToVoice(ne,oe),null!==b){b.isVisible=k;const xn=this._indexToTrackInfo.get(i.index);null!==v?b.percussionArticulation=xn.getOrCreateArticulation(v,b):_||(b.percussionArticulation=xn.getOrCreateArticulation("",b))}r!==re.None?(ne.graceType=r,this.applyBeatDurationFromTicks(ne,a,null,!1)):(ne.tupletNumerator=g,ne.tupletDenominator=m,ne.dots=p,ne.preferredBeamDirection=y,this.applyBeatDurationFromTicks(ne,h,f,!0)),this._musicalPosition=ne.displayEnd,this._lastBeat=ne};for(const D of t.childElements())switch(D.localName){case"grace":const C=Number.parseFloat(D.getAttribute("make-time","-1"));C>=0?(a=this.musicXmlDivisionsToAlphaTabTicks(C),r=re.BeforeBeat):r=re.OnBeat,"yes"===D.getAttribute("slash")&&(r=re.BeforeBeat);break;case"chord":l=!0;break;case"cue":return;case"pitch":b=this.parsePitch(D),_=!0;break;case"unpitched":b=this.parseUnpitched(D,i);break;case"rest":b=null,null===f&&(f=w.Whole);break;case"duration":h=this.parseDuration(D);break;case"instrument":v=D.getAttribute("id","");break;case"voice":u=Number.parseInt(D.innerText),Number.isNaN(u)?(x.warning("MusicXML","Voices need to be specified as numbers"),u=0):u-=1;break;case"type":f=this.parseBeatDuration(D);break;case"dot":p++;break;case"accidental":null===b?x.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseAccidental(D,b);break;case"time-modification":for(const oe of D.childElements())switch(oe.localName){case"actual-notes":g=Number.parseInt(oe.innerText);break;case"normal-notes":m=Number.parseInt(oe.innerText)}break;case"stem":y=this.parseStem(D);break;case"notehead":null===b?x.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseNoteHead(D,b,f??w.Quarter,y??this.estimateBeamDirection(b));break;case"staff":c=Number.parseInt(D.innerText)-1;break;case"beam":if("1"===D.getAttribute("number","1"))switch(D.innerText){case"begin":case"continue":o=St.ForceMergeWithNext;break;case"end":o=St.ForceSplitToNext}break;case"notations":F(),this.parseNotations(D,b,s);break;case"lyric":F(),this.parseLyric(D,s,i);break;case"play":this.parsePlay(D,b)}if(_){const D=this.getOrCreateStaff(i,c),C=this.getStaffContext(D).transpose;if(0!==C){const oe=12*b.octave+b.tone+C;b.octave=oe/12|0,b.tone=oe-12*b.octave}}F()}parsePlay(t,e){for(const i of t.childElements())"mute"===i.localName&&e&&"palm"===i.innerText&&(e.isPalmMute=!0)}estimateBeamDirection(t){return t.calculateRealValue(!1,!1)<rt.B4Value?B.Down:B.Up}parseNoteHead(t,e,i,s){"yes"===t.getAttribute("parentheses","no")&&(e.isGhost=!0);const r=t.getAttribute("filled","");let a;switch("yes"===r?a=!0:"no"===r&&(a=!1),e.style=new SS,t.innerText){case"arrow down":e.style.noteHeadCenterOnStem=!0,this.applyNoteHead(e,i,a,d.NoteheadTriangleDownDoubleWhole,d.NoteheadTriangleDownWhole,d.NoteheadTriangleDownHalf,d.NoteheadTriangleDownBlack);break;case"arrow up":e.style.noteHeadCenterOnStem=!0,this.applyNoteHead(e,i,a,d.NoteheadTriangleUpDoubleWhole,d.NoteheadTriangleUpWhole,d.NoteheadTriangleUpHalf,d.NoteheadTriangleUpBlack);break;case"back slashed":this.applyNoteHead(e,i,a,d.NoteheadSlashedDoubleWhole2,d.NoteheadSlashedWhole2,d.NoteheadSlashedHalf2,d.NoteheadSlashedBlack2);break;case"circle dot":e.style.noteHead=d.NoteheadRoundWhiteWithDot;break;case"circle-x":this.applyNoteHead(e,i,a,d.NoteheadCircleXDoubleWhole,d.NoteheadCircleXWhole,d.NoteheadCircleXHalf,d.NoteheadCircleX);break;case"circled":this.applyNoteHead(e,i,a,d.NoteheadCircledDoubleWhole,d.NoteheadCircledWhole,d.NoteheadCircledHalf,d.NoteheadCircledBlack);break;case"cluster":this.applyNoteHead(e,i,a,d.NoteheadClusterDoubleWhole3rd,d.NoteheadClusterWhole3rd,d.NoteheadClusterHalf3rd,d.NoteheadClusterQuarter3rd);break;case"cross":this.applyNoteHead(e,i,a,d.NoteheadPlusDoubleWhole,d.NoteheadPlusWhole,d.NoteheadPlusHalf,d.NoteheadPlusBlack);break;case"diamond":this.applyNoteHead(e,i,a,d.NoteheadDiamondDoubleWhole,d.NoteheadDiamondWhole,d.NoteheadDiamondHalf,d.NoteheadDiamondBlack);break;case"do":this.applyNoteHead(e,i,a,d.NoteShapeTriangleUpWhite,d.NoteShapeTriangleUpWhite,d.NoteShapeTriangleUpWhite,d.NoteShapeTriangleUpBlack);break;case"fa":s===B.Up?this.applyNoteHead(e,i,a,d.NoteShapeTriangleRightWhite,d.NoteShapeTriangleRightWhite,d.NoteShapeTriangleRightWhite,d.NoteShapeTriangleRightBlack):this.applyNoteHead(e,i,a,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftBlack);break;case"fa up":this.applyNoteHead(e,i,a,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftWhite,d.NoteShapeTriangleLeftBlack);break;case"inverted triangle":this.applyNoteHead(e,i,a,d.NoteheadTriangleDownDoubleWhole,d.NoteheadTriangleDownWhole,d.NoteheadTriangleDownHalf,d.NoteheadTriangleDownBlack);break;case"la":case"square":this.applyNoteHead(e,i,a,d.NoteShapeSquareWhite,d.NoteShapeSquareWhite,d.NoteShapeSquareWhite,d.NoteShapeSquareBlack);break;case"left triangle":this.applyNoteHead(e,i,a,d.NoteheadTriangleRightWhite,d.NoteheadTriangleRightWhite,d.NoteheadTriangleRightWhite,d.NoteheadTriangleRightBlack);break;case"mi":this.applyNoteHead(e,i,a,d.NoteShapeDiamondWhite,d.NoteShapeDiamondWhite,d.NoteShapeDiamondWhite,d.NoteShapeDiamondBlack);break;case"none":e.style.noteHead=d.NoteheadNull;break;case"normal":this.applyNoteHead(e,i,a,d.NoteheadDoubleWhole,d.NoteheadWhole,d.NoteheadHalf,d.NoteheadBlack);break;case"re":this.applyNoteHead(e,i,a,d.NoteShapeMoonWhite,d.NoteShapeMoonWhite,d.NoteShapeMoonWhite,d.NoteShapeMoonBlack);break;case"rectangle":this.applyNoteHead(e,i,a,d.NoteheadSquareWhite,d.NoteheadSquareWhite,d.NoteheadSquareWhite,d.NoteheadSquareBlack);break;case"slash":this.applyNoteHead(e,i,a,d.NoteheadSlashWhiteWhole,d.NoteheadSlashWhiteWhole,d.NoteheadSlashWhiteHalf,d.NoteheadSlashVerticalEnds);break;case"slashed":this.applyNoteHead(e,i,a,d.NoteheadSlashedDoubleWhole1,d.NoteheadSlashedWhole1,d.NoteheadSlashedHalf1,d.NoteheadSlashedBlack1);break;case"so":this.applyNoteHead(e,i,a,d.NoteShapeRoundWhite,d.NoteShapeRoundWhite,d.NoteShapeRoundWhite,d.NoteShapeRoundBlack);break;case"ti":this.applyNoteHead(e,i,a,d.NoteShapeTriangleRoundWhite,d.NoteShapeTriangleRoundWhite,d.NoteShapeTriangleRoundWhite,d.NoteShapeTriangleRoundBlack);break;case"triangle":this.applyNoteHead(e,i,a,d.NoteheadTriangleUpDoubleWhole,d.NoteheadTriangleUpWhole,d.NoteheadTriangleUpHalf,d.NoteheadTriangleUpBlack);break;case"x":this.applyNoteHead(e,i,a,d.NoteheadXDoubleWhole,d.NoteheadXWhole,d.NoteheadXHalf,d.NoteheadXBlack)}}createRestForGap(t,e){let i=P.toTicks(e);for(;i>t;){if(e===w.TwoHundredFiftySixth)return null;i=P.toTicks(e*=2)}const s=new Vn;return s.dynamics=this._currentDynamics,s.isEmpty=!1,s.duration=e,s.overrideDisplayDuration=i,s.updateDurations(),s}insertBeatToVoice(t,e){if(e.beats.length>0){const i=e.beats[e.beats.length-1];i.nextBeat=t,t.previousBeat=i;let s=i;for(;null!==s&&s.graceType!==re.None;)s=s.index>0?s.previousBeat:null;null!==s&&(t.displayStart=s.displayEnd)}e.addBeat(t)}musicXmlDivisionsToAlphaTabTicks(t){return t*P.QuarterTime/this._divisionsPerQuarterNote}parseBeatDuration(t){switch(t.innerText){case"1024th":case"512th":case"256th":return w.TwoHundredFiftySixth;case"128th":return w.OneHundredTwentyEighth;case"64th":return w.SixtyFourth;case"32nd":return w.ThirtySecond;case"16th":return w.Sixteenth;case"eighth":return w.Eighth;case"quarter":return w.Quarter;case"half":return w.Half;case"whole":return w.Whole;case"breve":return w.DoubleWhole;case"long":return w.QuadrupleWhole}return null}applyBeatDurationFromTicks(t,e,i,s){if(!i)for(let r=0;r<rt.allDurations.length&&e>=rt.allDurationTicks[r];r++)i=rt.allDurations[r];t.duration=i??w.Sixteenth,s&&(t.overrideDisplayDuration=e),t.updateDurations()}parseLyric(t,e,i){const r=this._indexToTrackInfo.get(i.index).getLyricLine(t.getAttribute("number",""));for(null===e.lyrics&&(e.lyrics=[]);e.lyrics.length<=r;)e.lyrics.push("");for(const a of t.childElements())switch(a.localName){case"text":e.lyrics[r]?e.lyrics[r]+=` ${a.innerText}`:e.lyrics[r]=a.innerText;break;case"elision":e.lyrics[r]+=a.innerText}}parseNotations(t,e,i){for(const s of t.childElements())switch(s.localName){case"tied":e&&this.parseTied(s,e,i.voice.bar.staff);break;case"slur":e&&this.parseSlur(s,e);break;case"glissando":e&&this.parseGlissando(s,e);break;case"slide":e&&this.parseSlide(s,e);break;case"ornaments":e&&this.parseOrnaments(s,e);break;case"technical":this.parseTechnical(s,e,i);break;case"articulations":e&&this.parseArticulations(s,e);break;case"dynamics":const r=this.parseDynamics(s);null!==r&&(i.dynamics=r,this._currentDynamics=r);break;case"fermata":this.parseFermata(s,i);break;case"arpeggiate":this.parseArpeggiate(s,i)}}getStaffContext(t){if(!this._staffToContext.has(t)){const e=new n9;return this._staffToContext.set(t,e),e}return this._staffToContext.get(t)}parseGlissando(t,e){const i=t.getAttribute("type"),s=t.getAttribute("number","1"),r=this.getStaffContext(e.beat.voice.bar.staff);switch(i){case"start":r.slideOrigins.set(s,e);break;case"stop":if(r.slideOrigins.has(s)){const a=r.slideOrigins.get(s);a.slideTarget=e,e.slideOrigin=a,a.slideOutType=Se.Shift}}}parseSlur(t,e){const i=t.getAttribute("number","1"),s=this.getStaffContext(e.beat.voice.bar.staff);switch(t.getAttribute("type")){case"start":s.slurStarts.set(i,e);break;case"stop":if(s.slurStarts.has(i)){e.isSlurDestination=!0;const r=s.slurStarts.get(i);r.slurDestination=e,e.slurOrigin=r,s.slurStarts.delete(i)}}}parseArpeggiate(t,e){switch(t.getAttribute("direction","down")){case"down":e.brushType=Y.ArpeggioDown;break;case"up":e.brushType=Y.ArpeggioUp}}parseFermata(t,e){let i;switch(t.innerText){case"normal":default:i=jn.Medium;break;case"angled":i=jn.Short;break;case"square":i=jn.Long}e.fermata=new kc,e.fermata.type=i}parseArticulations(t,e){for(const i of t.childElements())switch(i.localName){case"accent":e.accentuated=Ot.Normal;break;case"strong-accent":e.accentuated=Ot.Heavy;break;case"staccato":e.isStaccato=!0;break;case"tenuto":e.accentuated=Ot.Tenuto}}parseTechnical(t,e,i){const s=[];for(const r of t.childElements())switch(r.localName){case"up-bow":i.pickStroke=vn.Up;break;case"down-bow":i.pickStroke=vn.Down;break;case"harmonic":break;case"fingering":e&&(e.leftHandFinger=this.parseFingering(r));break;case"pluck":e&&(e.rightHandFinger=this.parseFingering(r));break;case"fret":e&&(e.fret=Number.parseInt(r.innerText));break;case"string":e&&(e.string=i.voice.bar.staff.tuning.length-Number.parseInt(r.innerText)+1);break;case"hammer-on":case"pull-off":e&&(e.isHammerPullOrigin=!0);break;case"bend":s.push(r);break;case"tap":i.tap=!0;break;case"smear":e&&(e.vibrato=Ie.Slight);break;case"golpe":switch(r.getAttribute("placement","above")){case"above":i.golpe=Ci.Finger;break;case"below":i.golpe=Ci.Thumb}}e&&s.length>0&&this.parseBends(s,e)}parseBends(t,e){const i=V.MaxPosition/t.length;let s=0,r=0,a=!0;for(const o of t){const l=o.findChildElement("bend-alter");if(l){const c=Math.round(2*Math.abs(Number.parseFloat(l.innerText)));o.findChildElement("pre-bend")?a?(s+=c,e.addBendPoint(new V(r,s)),r+=i,e.addBendPoint(new V(r,s)),a=!1):r+=i:o.findChildElement("release")?(a&&(s+=c),e.addBendPoint(new V(r,s)),r+=i,s-=c,e.addBendPoint(new V(r,s)),a=!1):(e.addBendPoint(new V(r,s)),s+=c,r+=i,e.addBendPoint(new V(r,s)),a=!1)}}}parseFingering(t){switch(t.innerText){case"0":return se.NoOrDead;case"1":case"p":case"t":return se.Thumb;case"2":case"i":return se.IndexFinger;case"3":case"m":return se.MiddleFinger;case"4":case"a":return se.AnnularFinger;case"5":case"c":return se.LittleFinger}return se.Unknown}parseOrnaments(t,e){let i=-1;for(const s of t.childElements())switch(s.localName){case"trill-mark":i=Number.parseInt(s.getAttribute("trill-step","2")),e.isStringed?e.trillValue=e.stringTuning+i:e.isPercussion||(e.trillValue=e.calculateRealValue(!1,!1)+i);break;case"turn":e.ornament=Vt.Turn;break;case"inverted-turn":e.ornament=Vt.InvertedTurn;break;case"wavy-line":i>0?"start"===s.getAttribute("type")&&(this._currentTrillStep=i):this._currentTrillStep>0?"stop"===s.getAttribute("type")?this._currentTrillStep=-1:e.isStringed?e.trillValue=e.stringTuning+this._currentTrillStep:e.isPercussion||(e.trillValue=e.calculateRealValue(!1,!1)+this._currentTrillStep):e.vibrato=Ie.Slight;break;case"mordent":e.ornament=Vt.LowerMordent;break;case"inverted-mordent":e.ornament=Vt.UpperMordent;break;case"tremolo":switch(s.innerText){case"1":e.beat.tremoloSpeed=w.Eighth;break;case"2":e.beat.tremoloSpeed=w.Sixteenth;break;case"3":e.beat.tremoloSpeed=w.ThirtySecond}}}parseSlide(t,e){const i=t.getAttribute("type"),s=t.getAttribute("number","1"),r=this.getStaffContext(e.beat.voice.bar.staff);switch(i){case"start":r.slideOrigins.set(s,e);break;case"stop":if(r.slideOrigins.has(s)){const a=r.slideOrigins.get(s);a.slideTarget=e,e.slideOrigin=a,a.slideOutType=Se.Shift}}}parseTied(t,e,i){const s=t.getAttribute("type"),r=t.getAttribute("number",""),a=this.getStaffContext(i);if("start"===s){if(r){if(a.tieStartIds.has(r)){const o=a.tieStartIds.get(r);a.tieStarts.delete(o)}a.tieStartIds.set(r,e)}a.tieStarts.add(e)}else if("stop"===s&&!e.isTieDestination){let o=null;if(r){if(!a.tieStartIds.has(r))return;o=a.tieStartIds.get(r),a.tieStartIds.delete(r),a.tieStarts.delete(e)}else{const l=this.calculatePitchedNoteValue(e);for(const c of a.tieStarts)if(this.calculatePitchedNoteValue(c)===l){o=c,a.tieStarts.delete(o);break}}if(!o)return;e.isTieDestination=!0,e.tieOrigin=o}}parseStem(t){switch(t.innerText){case"down":return B.Down;case"up":return B.Up;default:return null}}parseAccidental(t,e){switch(t.innerText){case"sharp":e.accidentalMode=ke.ForceSharp;break;case"natural":e.accidentalMode=ke.ForceNatural;break;case"flat":e.accidentalMode=ke.ForceFlat;break;case"double-sharp":e.accidentalMode=ke.ForceDoubleSharp;break;case"flat-flat":e.accidentalMode=ke.ForceDoubleFlat}}calculatePitchedNoteValue(t){return 12*t.octave+t.tone}parseDuration(t){return this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText))}parseUnpitched(t,e){let i="",s=0;for(const a of t.childElements())switch(a.localName){case"display-step":i=a.innerText;break;case"display-octave":s=Number.parseInt(a.innerText)+1}const r=new is;if(""===i)r.octave=0,r.tone=0;else{const a=12*s+H.getToneForText(i).noteValue;r.octave=a/12|0,r.tone=a-12*r.octave}return r}parsePitch(t){let e="",i=0,s=0;for(const o of t.childElements())switch(o.localName){case"step":e=o.innerText;break;case"alter":i=Number.parseFloat(o.innerText),Number.isNaN(i)&&(i=0);break;case"octave":s=Number.parseInt(o.innerText)+1}i|=0;const r=12*s+H.getToneForText(e).noteValue+i,a=new is;return a.octave=r/12|0,a.tone=r-12*a.octave,a}applyNoteHead(t,e,i,s,r,a,o){if(void 0===i)switch(e){case w.QuadrupleWhole:case w.DoubleWhole:t.style.noteHead=s;break;case w.Whole:t.style.noteHead=r;break;case w.Half:t.style.noteHead=a;break;default:t.style.noteHead=o}else if(!0===i)t.style.noteHead=o;else switch(e){case w.QuadrupleWhole:case w.DoubleWhole:t.style.noteHead=s;break;case w.Whole:t.style.noteHead=r;break;default:t.style.noteHead=a}}}rt.B4Value=71,rt.allDurations=[w.TwoHundredFiftySixth,w.OneHundredTwentyEighth,w.SixtyFourth,w.ThirtySecond,w.Sixteenth,w.Eighth,w.Quarter,w.Half,w.Whole,w.DoubleWhole,w.QuadrupleWhole],rt.allDurationTicks=rt.allDurations.map(n=>P.toTicks(n));var Cc=function(n){return n[n.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",n[n.MultiTrack=1]="MultiTrack",n}(Cc||{});class BS{constructor(){this.events=[]}addEvent(t){if(0===this.events.length||t.tick>=this.events[this.events.length-1].tick)this.events.push(t);else{let e=this.events.length;for(;e>0&&this.events[e-1].tick>t.tick;)e--;this.events.splice(e,0,t)}}writeTo(t){const e=Wt.empty();let i=0;for(const a of this.events)Kr.writeVariableInt(e,a.tick-i),a.writeTo(e),i=a.tick;const s=new Uint8Array([77,84,114,107]);t.write(s,0,s.length);const r=e.toArray();T.writeInt32BE(t,r.length),t.write(r,0,r.length)}}class Kr{constructor(){this.format=Cc.SingleTrackMultiChannel,this.division=P.QuarterTime,this.tracks=[]}get events(){if(1===this.tracks.length)return this.tracks[0].events;const t=[];for(const e of this.tracks)this.events.push(...e.events);return t.sort((e,i)=>e.tick-i.tick),t}ensureTracks(t){for(;this.tracks.length<t;)this.tracks.push(new BS)}addEvent(t){this.format===Cc.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(t)):(this.ensureTracks(t.track+1),this.tracks[t.track].addEvent(t))}toBinary(){const t=Wt.empty();return this.writeTo(t),t.toArray()}writeTo(t){const e=new Uint8Array([77,84,104,100]);t.write(e,0,e.length),T.writeInt32BE(t,6),T.writeInt16BE(t,this.format),T.writeInt16BE(t,this.tracks.length),T.writeInt16BE(t,this.division);for(const i of this.tracks)i.writeTo(t)}static writeVariableInt(t,e){const i=new Uint8Array(4);let s=0;do{i[s++]=127&e,e>>=7}while(e>0);for(;s>0;)s--,t.writeByte(s>0?128|i[s]:i[s])}}var He=function(n){return n[n.TimeSignature=88]="TimeSignature",n[n.NoteOn=128]="NoteOn",n[n.NoteOff=144]="NoteOff",n[n.ControlChange=176]="ControlChange",n[n.ProgramChange=192]="ProgramChange",n[n.TempoChange=81]="TempoChange",n[n.PitchBend=224]="PitchBend",n[n.PerNotePitchBend=96]="PerNotePitchBend",n[n.EndOfTrack=47]="EndOfTrack",n[n.AlphaTabRest=241]="AlphaTabRest",n[n.AlphaTabMetronome=242]="AlphaTabMetronome",n[n.SystemExclusive=240]="SystemExclusive",n[n.SystemExclusive2=247]="SystemExclusive2",n[n.Meta=255]="Meta",n}(He||{});class Qs{constructor(t,e,i){this.track=t,this.tick=e,this.type=i}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class PS extends Qs{constructor(t,e,i,s,r,a){super(t,e,He.TimeSignature),this.track=t,this.tick=e,this.numerator=i,this.denominatorIndex=s,this.midiClocksPerMetronomeClick=r,this.thirtySecondNodesInQuarter=a}writeTo(t){t.writeByte(255),t.writeByte(88),Kr.writeVariableInt(t,4),t.writeByte(255&this.numerator),t.writeByte(255&this.denominatorIndex),t.writeByte(255&this.midiClocksPerMetronomeClick),t.writeByte(255&this.thirtySecondNodesInQuarter)}}let Mh=(()=>{class n extends Qs{writeTo(e){e.writeByte(240);const i=Wt.withCapacity(16);i.writeByte(n.AlphaTabManufacturerId),this.writeEventData(i),i.writeByte(247),Kr.writeVariableInt(e,i.length),i.copyTo(e)}}return n.AlphaTabManufacturerId=125,n.MetronomeEventId=0,n.RestEventId=1,n})();class IS extends Mh{constructor(t,e,i,s,r){super(t,e,He.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=i,this.metronomeDurationInMilliseconds=r,this.metronomeDurationInTicks=s}writeEventData(t){t.writeByte(Mh.MetronomeEventId),t.writeByte(this.metronomeNumerator),T.writeInt32LE(t,this.metronomeDurationInTicks),T.writeInt32LE(t,this.metronomeDurationInMilliseconds)}}class MS extends Mh{constructor(t,e,i){super(t,e,He.AlphaTabRest),this.channel=i}writeEventData(t){t.writeByte(Mh.RestEventId),t.writeByte(this.channel)}}class AS extends Qs{constructor(t,e,i,s,r,a){super(t,e,i),this.channel=s,this.noteKey=r,this.noteVelocity=a}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class FS extends AS{constructor(t,e,i,s,r){super(t,e,He.NoteOn,i,s,r)}writeTo(t){t.writeByte(15&this.channel|144),t.writeByte(255&this.noteKey),t.writeByte(255&this.noteVelocity)}}class LS extends AS{constructor(t,e,i,s,r){super(t,e,He.NoteOff,i,s,r)}writeTo(t){t.writeByte(15&this.channel|128),t.writeByte(255&this.noteKey),t.writeByte(255&this.noteVelocity)}}class RS extends Qs{constructor(t,e,i,s,r){super(t,e,He.ControlChange),this.channel=i,this.controller=s,this.value=r}writeTo(t){t.writeByte(15&this.channel|176),t.writeByte(255&this.controller),t.writeByte(255&this.value)}get data1(){return this.controller}get data2(){return this.value}}class OS extends Qs{constructor(t,e,i,s){super(t,e,He.ProgramChange),this.channel=i,this.program=s}writeTo(t){t.writeByte(15&this.channel|192),t.writeByte(255&this.program)}get data1(){return this.program}}class VS extends Qs{constructor(t,e){super(0,t,He.TempoChange),this.microSecondsPerQuarterNote=e}writeTo(t){t.writeByte(255),t.writeByte(81),t.writeByte(3),t.writeByte(this.microSecondsPerQuarterNote>>16&255),t.writeByte(this.microSecondsPerQuarterNote>>8&255),t.writeByte(255&this.microSecondsPerQuarterNote)}}class HS extends Qs{constructor(t,e,i,s){super(t,e,He.PitchBend),this.channel=i,this.value=s}writeTo(t){t.writeByte(15&this.channel|224),t.writeByte(127&this.value),t.writeByte(this.value>>7&127)}get data1(){return 127&this.value}get data2(){return this.value>>7&127}}class WS extends Qs{constructor(t,e,i,s,r){super(t,e,He.PerNotePitchBend),this.channel=i,this.noteKey=s,this.value=r}writeTo(t){throw new nt(it.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class US extends Qs{constructor(t,e){super(t,e,He.EndOfTrack)}writeTo(t){t.writeByte(255),t.writeByte(47),t.writeByte(0)}}class Ah{constructor(t,e){this.time=0,this.eventIndex=t,this.event=e,this.isMetronome=this.event.type===He.AlphaTabMetronome}static newMetronomeEvent(t,e,i,s,r){const a=new IS(0,e,i,s,r);return new Ah(t,a)}}class CI{constructor(t,e,i){this.bpm=t,this.ticks=e,this.time=i}}class GS{constructor(){this.tempoChanges=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=P.QuarterTime,this.eventIndex=0,this.currentTime=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0}}class s9{get isPlayingMain(){return this._currentState===this._mainState}get isPlayingOneTimeMidi(){return this._currentState===this._oneTimeState}get isPlayingCountIn(){return this._currentState===this._countInState}constructor(t){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this.instrumentPrograms=new Set,this.percussionKeys=new Set,this._synthesizer=t,this._mainState=new GS,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(t){this._mainState.playbackRange=t,t&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,t.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,t.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}mainSeek(t){if(t*=this.playbackSpeed,this.mainPlaybackRange&&(t<this._mainState.playbackRangeStartTime?t=this._mainState.playbackRangeStartTime:t>this._mainState.playbackRangeEndTime&&(t=this._mainState.playbackRangeEndTime)),t>this._mainState.currentTime)this.mainSilentProcess(t-this._mainState.currentTime);else if(t<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this.isPlayingMain){const e=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(e)}this.mainSilentProcess(t)}}mainSilentProcess(t){if(t<=0)return;const e=Date.now(),i=this._mainState.currentTime+t;if(this.isPlayingMain)for(;this._mainState.currentTime<i;)this.fillMidiEventQueueLimited(i-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(he.MicroBufferSize);this._mainState.currentTime=i;const s=Date.now()-e;x.debug("Sequencer",`Silent seek finished in ${s}ms (main)`)}loadOneTimeMidi(t){this._oneTimeState=this.createStateFromFile(t),this._currentState=this._oneTimeState}loadMidi(t){this.instrumentPrograms.clear(),this.percussionKeys.clear(),this._mainState=this.createStateFromFile(t),this._currentState=this._mainState}createStateFromFile(t){const e=new GS;this.percussionKeys.add(he.MetronomeKey),e.tempoChanges=[],e.division=t.division,e.eventIndex=0,e.currentTime=0,e.synthData=[];let i=120,s=0,r=0,a=0,o=0,l=0,c=0,u=0,h=0;for(const f of t.events){const p=new Ah(e.synthData.length,f);e.synthData.push(p);const g=f.tick-h;if(s+=g,r+=g*(6e4/(i*t.division)),p.time=r,h=f.tick,o>0)for(;c<s;){const m=Ah.newMetronomeEvent(e.synthData.length,c,Math.floor(c/o)%a,o,l);e.synthData.push(m),m.time=u,c+=o,u+=l}if(f.type===He.TempoChange)i=6e7/f.microSecondsPerQuarterNote,e.tempoChanges.push(new CI(i,s,r)),l=o*(6e4/(i*t.division));else if(f.type===He.TimeSignature){const m=f,y=Math.pow(2,m.denominatorIndex);a=m.numerator,o=e.division*(4/y)|0,l=o*(6e4/(i*t.division)),0===e.firstTimeSignatureDenominator&&(e.firstTimeSignatureNumerator=m.numerator,e.firstTimeSignatureDenominator=y)}else if(f.type===He.ProgramChange){const m=f,y=m.channel;e.firstProgramEventPerChannel.has(y)||e.firstProgramEventPerChannel.set(y,p),y===he.PercussionChannel||this.instrumentPrograms.add(m.program)}else f.type===He.NoteOn&&f.channel===he.PercussionChannel&&this.percussionKeys.add(f.noteKey)}return e.synthData.sort((f,p)=>f.time>p.time?1:f.time<p.time?-1:f.eventIndex-p.eventIndex),e.endTime=r,e.endTick=s,e}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueLimited(t){let e=he.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,i=this.internalEndTime;t>0&&(t<e&&(e=t),i=Math.min(this.internalEndTime,this._currentState.currentTime+t));let s=!1;for(this._currentState.currentTime+=e;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<i;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,s=!0;return s}mainTickPositionToTimePosition(t){return this.tickPositionToTimePositionWithSpeed(this._mainState,t,this.playbackSpeed)}mainTimePositionToTickPosition(t){return this.timePositionToTickPositionWithSpeed(this._mainState,t,this.playbackSpeed)}currentTimePositionToTickPosition(t){return this.timePositionToTickPositionWithSpeed(this._currentState,t,this.playbackSpeed)}tickPositionToTimePositionWithSpeed(t,e,i){let s=0,r=120,a=0;for(const o of t.tempoChanges){if(e<o.ticks)break;s=o.time,r=o.bpm,a=o.ticks}return s+=(e-=a)*(6e4/(r*t.division)),s/i}timePositionToTickPositionWithSpeed(t,e,i){e*=i;let s=0,r=120,a=0;for(const o of t.tempoChanges){if(e<o.time)break;s=o.ticks,r=o.bpm,a=o.time}return s+=(e-=a)/(6e4/(r*t.division))|0,s+1}get internalEndTime(){return this.isPlayingMain&&this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this._currentState.currentTime=this.isPlayingMain&&this.mainPlaybackRange?this.mainPlaybackRange.startTick:0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const t=new GS;t.division=this._mainState.division;let e=120,i=4,s=4;0===this._mainState.eventIndex?(e=this._mainState.tempoChanges[0].bpm,i=this._mainState.firstTimeSignatureNumerator,s=this._mainState.firstTimeSignatureDenominator):(e=this._synthesizer.currentTempo,i=this._synthesizer.timeSignatureNumerator,s=this._synthesizer.timeSignatureDenominator),t.tempoChanges.push(new CI(e,0,0));const r=t.division*(4/s)|0,a=r*(6e4/(e*this._mainState.division));let o=0,l=0;for(let c=0;c<i;c++){const u=Ah.newMetronomeEvent(t.synthData.length,o,c,r,a);t.synthData.push(u),u.time=l,o+=r,l+=a}t.synthData.sort((c,u)=>c.time>u.time?1:c.time<u.time?-1:c.eventIndex-u.eventIndex),t.endTime=l,t.endTick=o,this._countInState=t}}var yn=function(n){return n[n.Paused=0]="Paused",n[n.Playing=1]="Playing",n}(yn||{});class Fh{constructor(t,e){this.state=t,this.stopped=e}}class Lh{constructor(t,e,i,s,r){this.currentTime=t,this.endTime=e,this.currentTick=i,this.endTick=s,this.isSeek=r}}let zo=(()=>{class n{constructor(){this.id="",this.size=0}static load(e,i,s){if(e&&n.HeaderSize>e.size||s.position+n.HeaderSize>=s.length||(i.id=T.read8BitStringLength(s,4),i.id.charCodeAt(0)<=32||i.id.charCodeAt(0)>=122)||(i.size=T.readUInt32LE(s),e&&n.HeaderSize+i.size>e.size))return!1;e&&(e.size-=n.HeaderSize+i.size);const r="RIFF"===i.id;return!(r&&e||(r||"LIST"===i.id)&&(i.id=T.read8BitStringLength(s,4),i.id.charCodeAt(0)<=32||i.id.charCodeAt(0)>=122||(i.size-=4,0)))}}return n.HeaderSize=8,n})();class r9{constructor(t,e,i,s){this.packetData=t,this.isBeginningOfStream=e,this.isEndOfStream=i,this.granulePosition=i?s:null}addData(t){const e=this.packetData,i=new Uint8Array(e.length+t.length);i.set(e,0),i.set(t,e.length)}}var pg=function(n){return n[n.ContinuesPacket=1]="ContinuesPacket",n[n.BeginningOfStream=2]="BeginningOfStream",n[n.EndOfStream=4]="EndOfStream",n}(pg||{});class a9{constructor(t){this._readable=t}read(){const t=[];for(;this.findAndReadPage(t););return t}findAndReadPage(t){return!!this.seekPageHeader()&&this.readPage(t)}seekPageHeader(){for(let t=0;t<65536;t++){if(1399285583===T.readInt32LE(this._readable))return!0;this._readable.position-=3}return!1}readPage(t){const e=this._readable.readByte();if(-1===e||0!==e)return!1;const i=this._readable.readByte(),s=T.readInt64LE(this._readable);this._readable.skip(4),this._readable.skip(4),this._readable.skip(4);const r=this._readable.readByte();if(-1===r)return!1;const a=[];let o=0;for(let l=0;l<r;l++){const c=this._readable.readByte();o===a.length&&a.push(0),a[o]+=c,c<255&&o++}for(let l=0;l<a.length;l++){const c=new Uint8Array(a[l]);if(this._readable.read(c,0,c.length)!==c.length)return!1;if(i&pg.ContinuesPacket){if(0===t.length)throw new nt(it.Format,"OGG: Continuation page without any previous packets");t[t.length-1].addData(c)}else{const h=new r9(c,0!=(i&pg.BeginningOfStream)&&0===l,0!=(i&pg.EndOfStream)&&l===a.length-1,s);t.push(h)}}return!0}}class o9{constructor(){this.audioChannels=0,this.audioSampleRate=0,this.samples=new Float32Array(0),this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=0,this.blocksize1=0}}class DI{constructor(){this.value=0,this.bitsRead=0}}let NI=(()=>{class n{constructor(e){this._bitBucket=0n,this._bitCount=0n,this._overflowBits=0n,this._source=e}readByte(){return this.readBits(n.ByteSize)}readBit(){return 1===this.readBits(1)}readBytes(e){const i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=255&this.readByte();return i}readBits(e){if(0===e)return 0;const i=this.tryPeekBits(e);return this.skipBits(e),i.value}tryPeekBits(e){if(e<0||e>32)throw new nt(it.General,"IO: Cannot read more than 32 bits in one go");if(0===e)return new DI;const i=new DI;for(;this._bitCount<e;){const r=BigInt(this._source.readByte());if(-1n===r)return i.bitsRead=Number(this._bitCount),i.value=Number(this._bitBucket),this._bitBucket=0n,this._bitCount=0n,i;this._bitBucket=(0xffn&r)<<this._bitCount|this._bitBucket,this._bitCount+=8n,this._bitCount>32&&(this._overflowBits=r>>40n-this._bitCount&0xffn)}let s=this._bitBucket;return e<64&&(s&=(1n<<BigInt(e))-1n),i.value=Number(s),i.bitsRead=e,i}skipBits(e){let i=BigInt(e);if(0!==e)if(this._bitCount>i){if(this._bitBucket=e>31?0n:this._bitBucket>>i,this._bitCount>32){const s=this._bitCount-32n;this._bitBucket=this._bitBucket|this._overflowBits<<this._bitCount-i-s,s>e&&(this._overflowBits=this._overflowBits>>i&0xffn)}this._bitCount-=i}else if(this._bitCount===i)this._bitBucket=0n,this._bitCount=0n;else{for(i-=this._bitCount,this._bitCount=0n,this._bitBucket=0n;i>8;){if(-1===this._source.readByte()){i=0n;break}i-=8n}if(i>0){const s=BigInt(this._source.readByte());-1n===s||(this._bitBucket=s>>i,this._bitCount=8n-i)}}}}return n.ByteSize=8,n})();class l9{constructor(){this.codebooks=[],this.timeDomainTransforms=[],this.floors=[],this.residues=[],this.mappings=[],this.modes=[]}}class xr{static ilog(t){let e=0;for(;t>0;)++e,t>>=1;return e}static bitReverse(t,e=32){let i=BigInt(t);return i=(i&BigInt(2863311530))>>1n|(i&BigInt(1431655765))<<1n,i=(i&BigInt(3435973836))>>2n|(i&BigInt(858993459))<<2n,i=(i&BigInt(4042322160))>>4n|(i&BigInt(252645135))<<4n,i=(i&BigInt(4278255360))>>8n|(i&BigInt(16711935))<<8n,i=(i>>16n|i<<16n)>>32n-BigInt(e),Number(BigInt.asUintN(32,i))}static convertFromVorbisFloat32(t){const e=BigInt(t);let i=e&BigInt(2097151);const s=e&BigInt(2147483648),r=(e&BigInt(2145386496))>>21n;return 0n!==s&&(i=-i),Number(i)*Math.pow(2,Number(r)-788)}}class c9{constructor(t){this._data=t}get(t){return this._data[t]}}class zS{get(t){return t}}zS.instance=new zS;class u9{constructor(t,e){if(this._maxBits=0,this._overflowList=null,this._prefixList=null,this._prefixBitLength=0,this.dimensions=0,this.entries=0,this.mapType=0,5653314!==t.readBits(24))throw new nt(it.Format,"Vorbis: Book header had invalid signature!");this.dimensions=t.readBits(16),this.entries=t.readBits(24),this._lengths=new Int32Array(this.entries),this.initTree(t,e),this.initLookupTable(t)}get(t,e){return this._lookupTable[t*this.dimensions+e]}decodeScalar(t){let e=t.tryPeekBits(this._prefixBitLength);if(0===e.bitsRead)return-1;let i=this._prefixList[e.value];if(null!=i)return t.skipBits(i.length),i.value;if(e=t.tryPeekBits(this._maxBits),null!==this._overflowList)for(let s=0;s<this._overflowList.length;s++)if(i=this._overflowList[s],i.bits===(e.value&i.mask))return t.skipBits(i.length),i.value;return-1}initTree(t,e){let i,r,s=0;if(t.readBit()){let a=t.readBits(5)+1;for(let o=0;o<this.entries;){let l=t.readBits(xr.ilog(this.entries-o));for(;--l>=0;)this._lengths[o++]=a;++a}s=0,i=!1,r=a}else{r=-1,i=t.readBit();for(let a=0;a<this.entries;a++)!i||t.readBit()?(this._lengths[a]=t.readBits(5)+1,++s):this._lengths[a]=-1,this._lengths[a]>r&&(r=this._lengths[a])}if(this._maxBits=r,r>-1){let o,a=null;i&&s>=this.entries>>2&&(a=new Int32Array(this.entries),a.set(this._lengths.subarray(0,this.entries),0),i=!1),o=i?s:0;let l=null,c=null;if(i?0!==o&&(a=new Int32Array(o),c=new Int32Array(o),l=new Int32Array(o)):c=new Int32Array(this.entries),!this.computeCodewords(i,c,a,this._lengths,this.entries,l))throw new nt(it.Format,"Vorbis: Failed to compute codewords");const u=null==l?zS.instance:new c9(l);e.generateTable(u,a??this._lengths,c),this._prefixList=e.prefixTree,this._prefixBitLength=e.tableBits,this._overflowList=e.overflowList}}computeCodewords(t,e,i,s,r,a){const o=new Uint32Array(32);let l=0,c=0;for(l=0;l<r&&!(s[l]>0);++l);if(l===r)return!0;this.addEntry(t,e,i,0,l,c++,s[l],a);for(let u=1;u<=s[l];++u)o[u]=1<<32-u;for(let u=l+1;u<r;++u){let h=s[u];if(h<=0)continue;for(;h>0&&0===o[h];)--h;if(0===h)return!1;const f=o[h];if(o[h]=0,this.addEntry(t,e,i,xr.bitReverse(f),u,c++,s[u],a),h!==s[u])for(let p=s[u];p>h;--p)o[p]=f+(1<<32-p)}return!0}addEntry(t,e,i,s,r,a,o,l){t?(e[a]=s,i[a]=o,l[a]=r):e[r]=s}initLookupTable(t){if(this.mapType=t.readBits(4),0===this.mapType)return;const e=xr.convertFromVorbisFloat32(t.readBits(32)),i=xr.convertFromVorbisFloat32(t.readBits(32)),s=t.readBits(4)+1,r=t.readBit();let a=this.entries*this.dimensions;const o=new Float32Array(a);1===this.mapType&&(a=this.lookup1Values());const l=new Uint32Array(a);for(let c=0;c<a;c++)l[c]=t.readBits(s);if(1===this.mapType)for(let c=0;c<this.entries;c++){let u=0,h=1;for(let f=0;f<this.dimensions;f++){const g=l[c/h%a|0]*i+e+u;o[c*this.dimensions+f]=g,r&&(u=g),h*=a}}else for(let c=0;c<this.entries;c++){let u=0,h=c*this.dimensions;for(let f=0;f<this.dimensions;f++){const p=l[h]*i+e+u;o[c*this.dimensions+f]=p,r&&(u=p),++h}}this._lookupTable=o}lookup1Values(){let t=Math.floor(Math.exp(Math.log(this.entries)/this.dimensions));return Math.floor(Math.pow(t+1,this.dimensions))<=this.entries&&++t,t}}class h9{constructor(){this.value=0,this.length=0,this.bits=0,this.mask=0}}let d9=(()=>{class n{constructor(){this.tableBits=0,this.prefixTree=[],this.overflowList=null}generateTable(e,i,s){const r=new Array(i.length);let a=0;for(let u=0;u<r.length;u++){const h=new h9;h.value=e.get(u),h.length=i[u]<=0?99999:i[u],h.bits=s[u],h.mask=(1<<i[u])-1,r[u]=h,i[u]>0&&a<i[u]&&(a=i[u])}r.sort((u,h)=>{const f=u.length-h.length;return 0===f?u.bits-h.bits:f});const o=a>n.MAX_TABLE_BITS?n.MAX_TABLE_BITS:a,l=[];let c=null;for(let u=0;u<r.length&&r[u].length<99999;u++){const h=r[u].length;if(h>o)for(c=[];u<r.length&&r[u].length<99999;u++)c.push(r[u]);else{const f=1<<o-h,p=r[u];for(let g=0;g<f;g++){const m=g<<h|p.bits;for(;l.length<=m;)l.push(null);l[m]=p}}}for(;l.length<1<<o;)l.push(null);this.tableBits=o,this.prefixTree=l,this.overflowList=c}}return n.MAX_TABLE_BITS=10,n})();class f9{constructor(t){t.readBits(16)}}class p9{get executeChannel(){return(this.forceEnergy||this.amp>0)&&!this.forceNoEnergy}constructor(t){this.amp=0,this.forceEnergy=!1,this.forceNoEnergy=!1,this.coeff=t}}class gg{constructor(t,e,i,s){if(this._order=t.readBits(8),this._rate=t.readBits(16),this._bark_map_size=t.readBits(16),this._ampBits=t.readBits(6),this._ampOfs=t.readBits(8),this._books=new Array(t.readBits(4)+1),this._order<1||this._rate<1||this._bark_map_size<1||0===this._books.length)throw new nt(it.Format,"Vorbis: Invalid Floor0 Data");this._ampDiv=(1<<this._ampBits)-1;for(let r=0;r<this._books.length;r++){const a=t.readBits(8);if(a<0||a>=s.length)throw new nt(it.Format,"Vorbis: Invalid Floor0 Data");const o=s[a];if(0===o.mapType||o.dimensions<1)throw new nt(it.Format,"Vorbis: Invalid Floor0 Data");this._books[r]=o}this._bookBits=xr.ilog(this._books.length),this._barkMaps=new Map([[e,this.synthesizeBarkCurve(e/2)],[i,this.synthesizeBarkCurve(i/2)]]),this._wMap=new Map([[e,this.synthesizeWDelMap(e/2)],[i,this.synthesizeWDelMap(i/2)]])}synthesizeBarkCurve(t){const e=this._bark_map_size/gg.toBARK(this._rate/2),i=new Int32Array(t+1);for(let s=0;s<t-1;s++)i[s]=Math.min(this._bark_map_size-1,Math.floor(gg.toBARK(this._rate/2/t*s)*e));return i[t]=-1,i}static toBARK(t){return 13.1*Math.atan(74e-5*t)+2.24*Math.atan(1.85e-8*t*t)+1e-4*t}synthesizeWDelMap(t){const e=Math.PI/this._bark_map_size,i=new Float32Array(t);for(let s=0;s<t;s++)i[s]=2*Math.cos(e*s);return i}unpack(t,e,i){const s=new p9(new Float32Array(this._order+1));if(s.amp=t.readBits(this._ampBits),s.amp>0){s.amp=s.amp/this._ampDiv*this._ampOfs;const r=t.readBits(this._bookBits);if(r>=this._books.length)return s.amp=0,s;const a=this._books[r];for(let l=0;l<this._order;){const c=a.decodeScalar(t);if(-1===c)return s.amp=0,s;for(let u=0;l<this._order&&u<a.dimensions;u++,l++)s.coeff[l]=a.get(c,u)}let o=0;for(let l=0;l<this._order;){for(let c=0;l<this._order&&c<a.dimensions;l++,c++)s.coeff[l]+=o;o=s.coeff[l-1]}}return s}apply(t,e,i){const s=t,r=e/2;if(s.amp>0){const a=this._barkMaps.get(e),o=this._wMap.get(e);let l=0;for(l=0;l<this._order;l++)s.coeff[l]=2*Math.cos(s.coeff[l]);for(l=0;l<r;){let c=0;const u=a[l];let h=.5,f=.5;const p=o[u];for(c=1;c<this._order;c+=2)f*=p-s.coeff[c-1],h*=p-s.coeff[c];for(c===this._order?(f*=p-s.coeff[c-1],h*=h*(4-p*p),f*=f):(h*=h*(2-p),f*=f*(2+p)),f=s.amp/Math.sqrt(h+f)-this._ampOfs,f=Math.exp(.11512925*f),i[l]*=f;a[++l]===u;)i[l]*=f}}else i.fill(0,0,r)}}class g9{constructor(){this.posts=new Int32Array(64),this.postCount=0,this.forceEnergy=!1,this.forceNoEnergy=!1}get executeChannel(){return(this.forceEnergy||this.postCount>0)&&!this.forceNoEnergy}}class Zr{constructor(t,e){let i=-1;this._partitionClass=new Int32Array(t.readBits(5));for(let a=0;a<this._partitionClass.length;a++)this._partitionClass[a]=t.readBits(4),this._partitionClass[a]>i&&(i=this._partitionClass[a]);++i,this._classDimensions=new Int32Array(i),this._classSubclasses=new Int32Array(i),this._classMasterbooks=new Array(i),this._classMasterBookIndex=new Int32Array(i),this._subclassBooks=new Array(i),this._subclassBookIndex=new Array(i);for(let a=0;a<i;a++){this._classDimensions[a]=t.readBits(3)+1,this._classSubclasses[a]=t.readBits(2),this._classSubclasses[a]>0&&(this._classMasterBookIndex[a]=t.readBits(8),this._classMasterbooks[a]=e[this._classMasterBookIndex[a]]),this._subclassBooks[a]=new Array(1<<this._classSubclasses[a]),this._subclassBookIndex[a]=new Int32Array(this._subclassBooks[a].length);for(let o=0;o<this._subclassBooks[a].length;o++){const l=t.readBits(8)-1;l>=0&&(this._subclassBooks[a][o]=e[l]),this._subclassBookIndex[a][o]=l}}this._multiplier=t.readBits(2),this._range=Zr._rangeLookup[this._multiplier],this._yBits=Zr._yBitsLookup[this._multiplier],++this._multiplier;const s=t.readBits(4),r=[];r.push(0),r.push(1<<s);for(let a=0;a<this._partitionClass.length;a++){const o=this._partitionClass[a];for(let l=0;l<this._classDimensions[o];l++)r.push(t.readBits(s))}this._xList=new Int32Array(r),this._lNeigh=new Int32Array(r.length),this._hNeigh=new Int32Array(r.length),this._sortIdx=new Int32Array(r.length),this._sortIdx[0]=0,this._sortIdx[1]=1;for(let a=2;a<this._lNeigh.length;a++){this._lNeigh[a]=0,this._hNeigh[a]=1,this._sortIdx[a]=a;for(let o=2;o<a;o++){const l=this._xList[o];l<this._xList[a]?l>this._xList[this._lNeigh[a]]&&(this._lNeigh[a]=o):l<this._xList[this._hNeigh[a]]&&(this._hNeigh[a]=o)}}for(let a=0;a<this._sortIdx.length-1;a++)for(let o=a+1;o<this._sortIdx.length;o++){if(this._xList[a]===this._xList[o])throw new nt(it.Format,"Vorbis: Invalid Floor1 Data");if(this._xList[this._sortIdx[a]]>this._xList[this._sortIdx[o]]){const l=this._sortIdx[a];this._sortIdx[a]=this._sortIdx[o],this._sortIdx[o]=l}}}unpack(t,e,i){const s=new g9;if(t.readBit()){let r=2;s.posts[0]=t.readBits(this._yBits),s.posts[1]=t.readBits(this._yBits);for(let a=0;a<this._partitionClass.length;a++){const o=this._partitionClass[a],l=this._classDimensions[o],c=this._classSubclasses[o],u=(1<<c)-1;let h=0;if(c>0&&(h=this._classMasterbooks[o].decodeScalar(t),-1===h)){r=0;break}for(let f=0;f<l;f++){const p=this._subclassBooks[o][h&u];if(h>>=c,null!=p&&(s.posts[r]=p.decodeScalar(t),-1===s.posts[r])){r=0,a=this._partitionClass.length;break}++r}}s.postCount=r}return s}apply(t,e,i){const s=t,r=e/2;if(s.postCount>0){const a=this.unwrapPosts(s);let o=0,l=s.posts[0]*this._multiplier;for(let c=1;c<s.postCount;c++){const u=this._sortIdx[c];if(a[u]){const h=this._xList[u],f=s.posts[u]*this._multiplier;o<r&&this.renderLineMulti(o,l,Math.min(h,r),f,i),o=h,l=f}if(o>=r)break}o<r&&this.renderLineMulti(o,l,r,l,i)}else i.fill(0,0,r)}unwrapPosts(t){const e=new Array(64);e.fill(!1),e[0]=!0,e[1]=!0;const i=new Int32Array(64);i[0]=t.posts[0],i[1]=t.posts[1];for(let s=2;s<t.postCount;s++){const r=this._lNeigh[s],a=this._hNeigh[s],o=this.renderPoint(this._xList[r],i[r],this._xList[a],i[a],this._xList[s]),l=t.posts[s],c=this._range-o,u=o;let h;h=c<u?2*c:2*u,0!==l?(e[r]=!0,e[a]=!0,e[s]=!0,i[s]=l>=h?c>u?l-u+o:o-l+c-1:l%2==1?o-(l+1)/2:o+l/2):(e[s]=!1,i[s]=o)}for(let s=0;s<t.postCount;s++)t.posts[s]=i[s];return e}renderPoint(t,e,i,s,r){const a=s-e,o=i-t,u=Math.abs(a)*(r-t)/o|0;return a<0?e-u:e+u}renderLineMulti(t,e,i,s,r){const a=s-e,o=i-t;let l=Math.abs(a);const c=1-2*(a>>31&1),u=a/o|0;let h=t,f=e,p=-o;for(r[t]*=Zr.inverse_dB_table[e],l-=Math.abs(u)*o;++h<i;)f+=u,p+=l,p>=0&&(p-=o,f+=c),r[h]*=Zr.inverse_dB_table[f]}}Zr._rangeLookup=[256,128,86,64],Zr._yBitsLookup=[8,7,7,6],Zr.inverse_dB_table=new Float32Array([1.0649863e-7,1.1341951e-7,1.2079015e-7,1.2863978e-7,1.3699951e-7,1.4590251e-7,1.5538408e-7,1.6548181e-7,1.7623575e-7,1.8768855e-7,1.9988561e-7,2.128753e-7,2.2670913e-7,2.4144197e-7,2.5713223e-7,2.7384213e-7,2.9163793e-7,3.1059021e-7,3.3077411e-7,3.5226968e-7,3.7516214e-7,3.9954229e-7,4.255068e-7,4.5315863e-7,4.8260743e-7,5.1396998e-7,5.4737065e-7,5.8294187e-7,6.2082472e-7,6.6116941e-7,7.0413592e-7,7.4989464e-7,7.9862701e-7,8.505263e-7,9.0579828e-7,9.6466216e-7,10273513e-13,10941144e-13,11652161e-13,12409384e-13,13215816e-13,14074654e-13,14989305e-13,15963394e-13,17000785e-13,18105592e-13,19282195e-13,20535261e-13,21869758e-13,23290978e-13,24804557e-13,26416497e-13,2813319e-12,29961443e-13,31908506e-13,33982101e-13,36190449e-13,38542308e-13,41047004e-13,4371447e-12,46555282e-13,49580707e-13,5280274e-12,5623416e-12,59888572e-13,63780469e-13,67925283e-13,72339451e-13,77040476e-13,82047e-10,87378876e-13,93057248e-13,99104632e-13,10554501e-12,11240392e-12,11970856e-12,12748789e-12,13577278e-12,14459606e-12,15399272e-12,16400004e-12,17465768e-12,18600792e-12,19809576e-12,21096914e-12,22467911e-12,23928002e-12,25482978e-12,27139006e-12,28902651e-12,30780908e-12,32781225e-12,34911534e-12,37180282e-12,39596466e-12,42169667e-12,4491009e-11,47828601e-12,50936773e-12,54246931e-12,57772202e-12,61526565e-12,65524908e-12,69783085e-12,74317983e-12,79147585e-12,8429104e-11,89768747e-12,95602426e-12,.00010181521,.00010843174,.00011547824,.00012298267,.00013097477,.00013948625,.00014855085,.00015820453,.00016848555,.00017943469,.00019109536,.00020351382,.00021673929,.00023082423,.00024582449,.00026179955,.00027881276,.00029693158,.00031622787,.00033677814,.00035866388,.00038197188,.00040679456,.00043323036,.00046138411,.00049136745,.00052329927,.00055730621,.00059352311,.00063209358,.00067317058,716917e-9,.0007635063,.00081312324,.00086596457,.00092223983,.00098217216,.0010459992,.0011139742,.0011863665,.0012634633,.0013455702,.0014330129,.0015261382,.0016253153,.0017309374,.0018434235,.0019632195,.0020908006,.0022266726,.0023713743,.0025254795,.0026895994,.0028643847,.0030505286,.0032487691,.0034598925,.0036847358,.0039241906,.0041792066,.004450795,.0047400328,.0050480668,.0053761186,.0057254891,.0060975636,.0064938176,.0069158225,.0073652516,.0078438871,.0083536271,.0088964928,.009474637,.010090352,.01074608,.011444421,.012188144,.012980198,.013823725,.014722068,.015678791,.016697687,.017782797,.018938423,.020169149,.021479854,.022875735,.02436233,.025945531,.027631618,.029427276,.031339626,.033376252,.035545228,.037855157,.040315199,.042935108,.045725273,.048696758,.051861348,.055231591,.05882085,.062643361,.066714279,.071049749,.075666962,.080584227,.085821044,.091398179,.097337747,.1036633,.11039993,.11757434,.12521498,.13335215,.14201813,.15124727,.16107617,.1715438,.18269168,.19456402,.20720788,.22067342,.23501402,.25028656,.26655159,.28387361,.30232132,.32196786,.34289114,.36517414,.38890521,.41417847,.44109412,.4697589,.50028648,.53279791,.56742212,.6042964,.64356699,.68538959,.72993007,.77736504,.8278826,.88168307,.9389798,1]);class m9{constructor(t,e,i,s){const r=t.readBits(16);switch(r){case 0:this.floor=new gg(t,e,i,s);break;case 1:this.floor=new Zr(t,s);break;default:throw new nt(it.Format,`Vorbis: Invalid Floor type: ${r}`)}}apply(t,e,i){this.floor.apply(t,e,i)}unpack(t,e,i){return this.floor.unpack(t,e,i)}}class Rh{constructor(t,e,i){this._begin=t.readBits(24),this._end=t.readBits(24),this._partitionSize=t.readBits(24)+1,this._classifications=t.readBits(6)+1,this._classBook=i[t.readBits(8)],this._cascade=new Int32Array(this._classifications);let s=0;for(let h=0;h<this._classifications;h++){const f=t.readBits(3);this._cascade[h]=t.readBit()?t.readBits(5)<<3|f:f,s+=Rh.icount(this._cascade[h])}const r=new Int32Array(s);for(let h=0;h<s;h++)if(r[h]=t.readBits(8),0===i[r[h]].mapType)throw new nt(it.Format,"Vorbis: Invalid Residue 0");const a=this._classBook.entries;let o=this._classBook.dimensions,l=1;for(;o>0;){if(l*=this._classifications,l>a)throw new nt(it.Format,"Vorbis: Invalid Residue 0");--o}this._books=new Array(this._classifications),s=0;let u,c=0;for(let h=0;h<this._classifications;h++)if(u=xr.ilog(this._cascade[h]),this._books[h]=new Array(u),u>0){c=Math.max(c,u);for(let f=0;f<u;f++)(this._cascade[h]&1<<f)>0&&(this._books[h][f]=i[r[s++]])}this._maxStages=c,this._decodeMap=new Array(l);for(let h=0;h<l;h++){let f=h,p=l/this._classifications|0;this._decodeMap[h]=new Int32Array(this._classBook.dimensions);for(let g=0;g<this._classBook.dimensions;g++){const m=f/p|0;f-=m*p,p=p/this._classifications|0,this._decodeMap[h][g]=m}}this._channels=e}static icount(t){let e=0;for(;0!==t;)e+=1&t,t>>=1;return e}decode(t,e,i,s){const a=(this._end<i/2?this._end:i/2)-this._begin;if(a>0&&-1!==e.indexOf(!1)){const o=a/this._partitionSize,l=(o+this._classBook.dimensions-1)/this._classBook.dimensions|0,c=[];for(let u=0;u<this._channels;u++)c.push(new Array(l));for(let u=0;u<this._maxStages;u++)for(let h=0,f=0;h<o;f++){if(0===u)for(let p=0;p<this._channels;p++){const g=this._classBook.decodeScalar(t);if(!(g>=0&&g<this._decodeMap.length)){h=o,u=this._maxStages;break}c[p][f]=this._decodeMap[g]}for(let p=0;h<o&&p<this._classBook.dimensions;p++,h++){const g=this._begin+h*this._partitionSize;for(let m=0;m<this._channels;m++){const y=c[m][f][p];if(this._cascade[y]&1<<u){const b=this._books[y][u];if(b&&this.writeVectors(b,t,s,m,g,this._partitionSize)){h=o,u=this._maxStages;break}}}}}}}writeVectors(t,e,i,s,r,a){const o=i[s],l=a/t.dimensions,c=new Int32Array(l);for(let u=0;u<l;u++)if(c[u]=t.decodeScalar(e),-1===c[u])return!0;for(let u=0;u<t.dimensions;u++)for(let h=0;h<l;h++,r++)o[r]+=t.get(c[h],u);return!1}}class y9 extends Rh{writeVectors(t,e,i,s,r,a){const o=i[s];for(let l=0;l<a;){const c=t.decodeScalar(e);if(-1===c)return!0;for(let u=0;u<t.dimensions;l++,u++)o[r+l]+=t.get(c,u)}return!1}}class b9 extends Rh{constructor(t,e,i){super(t,1,i),this._realChannels=e}decode(t,e,i,s){super.decode(t,e,i*this._realChannels,s)}writeVectors(t,e,i,s,r,a){let o=0;r/=this._realChannels;for(let l=0;l<a;){const c=t.decodeScalar(e);if(-1===c)return!0;for(let u=0;u<t.dimensions;u++,l++)i[o][r]+=t.get(c,u),++o===this._realChannels&&(o=0,r++)}return!1}}class w9{constructor(t,e,i){const s=t.readBits(16);switch(s){case 0:this.residue=new Rh(t,e,i);break;case 1:this.residue=new y9(t,e,i);break;case 2:this.residue=new b9(t,e,i);break;default:throw new nt(it.Format,`Vorbis: Invalid Residue type: ${s}`)}}decode(t,e,i,s){this.residue.decode(t,e,i,s)}}class S9{constructor(t,e,i,s,r){if(0!==t.readBits(16))throw new nt(it.Format,"Vorbis: Invalid mapping type!");let o=1;t.readBit()&&(o+=t.readBits(4));let l=0;t.readBit()&&(l=t.readBits(8)+1);const c=xr.ilog(e-1);this._couplingAngle=new Int32Array(l),this._couplingMangitude=new Int32Array(l);for(let h=0;h<l;h++){const f=t.readBits(c),p=t.readBits(c);if(f===p||f>e-1||p>e-1)throw new nt(it.Format,"Vorbis: Invalid magnitude or angle in mapping header!");this._couplingAngle[h]=p,this._couplingMangitude[h]=f}if(0!==t.readBits(2))throw new nt(it.Format,"Vorbis: Reserved bits not 0 in mapping header.");const u=new Int32Array(e);if(o>1)for(let h=0;h<e;h++)if(u[h]=t.readBits(4),u[h]>o)throw new nt(it.Format,"Vorbis: Invalid channel mux submap index in mapping header!");this._submapFloor=new Array(o),this._submapResidue=new Array(o);for(let h=0;h<o;h++){t.skipBits(8);const f=t.readBits(8);if(f>=i.length)throw new nt(it.Format,"Vorbis: Invalid floor number in mapping header!");const p=t.readBits(8);if(p>=s.length)throw new nt(it.Format,"Vorbis: Invalid residue number in mapping header!");this._submapFloor[h]=i[f],this._submapResidue[h]=s[p]}this._channelFloor=new Array(e),this._channelResidue=new Array(e);for(let h=0;h<e;h++)this._channelFloor[h]=this._submapFloor[u[h]],this._channelResidue[h]=this._submapResidue[u[h]];this._mdct=r}decodePacket(t,e,i){const s=e>>1,r=new Array(this._channelFloor.length),a=new Array(this._channelFloor.length);a.fill(!1);for(let o=0;o<this._channelFloor.length;o++)r[o]=this._channelFloor[o].unpack(t,e,o),a[o]=!r[o].executeChannel,i[o].fill(0,0,s);for(let o=0;o<this._couplingAngle.length;o++)(r[this._couplingAngle[o]].executeChannel||r[this._couplingMangitude[o]].executeChannel)&&(r[this._couplingAngle[o]].forceEnergy=!0,r[this._couplingMangitude[o]].forceEnergy=!0);for(let o=0;o<this._submapFloor.length;o++){for(let l=0;l<this._channelFloor.length;l++)(this._submapFloor[o]!==this._channelFloor[l]||this._submapResidue[o]!==this._channelResidue[l])&&(r[l].forceNoEnergy=!0);this._submapResidue[o].decode(t,a,e,i)}for(let o=this._couplingAngle.length-1;o>=0;o--)if(r[this._couplingAngle[o]].executeChannel||r[this._couplingMangitude[o]].executeChannel){const l=i[this._couplingMangitude[o]],c=i[this._couplingAngle[o]];for(let u=0;u<s;u++){let h,f;const p=l[u],g=c[u];p>0?g>0?(h=p,f=p-g):(f=p,h=p+g):g>0?(h=p,f=p+g):(f=p,h=p-g),l[u]=h,c[u]=f}}for(let o=0;o<this._channelFloor.length;o++)r[o].executeChannel?(this._channelFloor[o].apply(r[o],e,i[o]),this._mdct.reverse(i[o],e)):i[o].fill(0,s,2*s)}}class xI{constructor(){this.packetStartIndex=0,this.packetTotalLength=0,this.packetValidLength=0}}class _9{constructor(){this.overlapInfo=new xI,this.windowIndex=0}}class v9{constructor(t=null){this.samplePosition=null,this.samplePosition=t}}let T9=(()=>{class n{constructor(e,i,s,r,a){if(this._overlapInfo=null,this._channels=i,this._blockFlag=e.readBit(),0!==e.readBits(32))throw new nt(it.Format,"Vorbis: Mode header had invalid window or transform type!");const o=e.readBits(8);if(o>=a.length)throw new nt(it.Format,"Vorbis: Mode header had invalid mapping index!");this._mapping=a[o],this._blockFlag?(this._blockSize=r,this._windows=[n.calcWindow(s,r,s),n.calcWindow(r,r,s),n.calcWindow(s,r,r),n.calcWindow(r,r,r)],this._overlapInfo=[n.calcOverlap(s,r,s),n.calcOverlap(r,r,s),n.calcOverlap(s,r,r),n.calcOverlap(r,r,r)]):(this._blockSize=s,this._windows=[n.calcWindow(s,s,s)])}decode(e,i){const s=this.getPacketInfo(e);this._mapping.decodePacket(e,this._blockSize,i);const r=this._windows[s.windowIndex];for(let a=0;a<this._blockSize;a++)for(let o=0;o<this._channels;o++)i[o][a]*=r[a];return s.overlapInfo}getPacketInfo(e){const i=new _9;if(this._blockFlag){const s=e.readBit(),r=e.readBit();i.windowIndex=(s?1:0)+(r?2:0);const a=this._overlapInfo[i.windowIndex];i.overlapInfo.packetStartIndex=a.packetStartIndex,i.overlapInfo.packetValidLength=a.packetValidLength,i.overlapInfo.packetTotalLength=a.packetTotalLength}else i.windowIndex=0,i.overlapInfo.packetStartIndex=0,i.overlapInfo.packetValidLength=this._blockSize/2,i.overlapInfo.packetTotalLength=this._blockSize;return i}static calcWindow(e,i,s){const r=new Float32Array(i),a=e/2,l=s/2,c=i/4-a/2,u=i-i/4-l/2;for(let h=0;h<a;h++){let f=Math.sin((h+.5)/a*n.M_PI2);f*=f,r[c+h]=Math.sin(f*n.M_PI2)}for(let h=c+a;h<u;h++)r[h]=1;for(let h=0;h<l;h++){let f=Math.sin((l-h-.5)/l*n.M_PI2);f*=f,r[u+h]=Math.sin(f*n.M_PI2)}return r}static calcOverlap(e,i,s){const a=s/4,o=i/4-e/4,l=i/4*3+a,c=l-2*a,u=new xI;return u.packetStartIndex=o,u.packetValidLength=c,u.packetTotalLength=l,u}}return n.M_PI2=1.57079632695,n})(),k9=(()=>{class n{constructor(e){this._n=e,this._n2=e>>1,this._n4=this._n2>>1,this._n8=this._n4>>1,this._ld=xr.ilog(e)-1,this._a=new Float32Array(this._n2),this._b=new Float32Array(this._n2),this._c=new Float32Array(this._n4);let i=0,s=0;for(;i<this._n4;++i,s+=2)this._a[s]=Math.cos(4*i*n.M_PI/e),this._a[s+1]=-Math.sin(4*i*n.M_PI/e),this._b[s]=.5*Math.cos((s+1)*n.M_PI/e/2),this._b[s+1]=.5*Math.sin((s+1)*n.M_PI/e/2);for(i=0,s=0;i<this._n8;++i,s+=2)this._c[s]=Math.cos(2*(s+1)*n.M_PI/e),this._c[s+1]=-Math.sin(2*(s+1)*n.M_PI/e);this._bitrev=new Uint16Array(this._n8);for(let r=0;r<this._n8;++r)this._bitrev[r]=ye.int32ToUint16(xr.bitReverse(r,this._ld-3)<<2)}calcReverse(e){let i,s;const r=new Float32Array(this._n2);{let o=this._n2-2,l=0,c=0;const u=this._n2;for(;c!==u;)r[o+1]=e[c]*this._a[l]-e[c+2]*this._a[l+1],r[o]=e[c]*this._a[l+1]+e[c+2]*this._a[l],o-=2,l+=2,c+=4;for(c=this._n2-3;o>=0;)r[o+1]=-e[c+2]*this._a[l]- -e[c]*this._a[l+1],r[o]=-e[c+2]*this._a[l+1]+-e[c]*this._a[l],o-=2,l+=2,c-=4}i=e,s=r;{let o=this._n2-8,l=this._n4,c=0,u=this._n4,h=0;for(;o>=0;){let f,p;p=s[l+1]-s[c+1],f=s[l]-s[c],i[u+1]=s[l+1]+s[c+1],i[u]=s[l]+s[c],i[h+1]=p*this._a[o+4]-f*this._a[o+5],i[h]=f*this._a[o+4]+p*this._a[o+5],p=s[l+3]-s[c+3],f=s[l+2]-s[c+2],i[u+3]=s[l+3]+s[c+3],i[u+2]=s[l+2]+s[c+2],i[h+3]=p*this._a[o]-f*this._a[o+1],i[h+2]=f*this._a[o]+p*this._a[o+1],o-=8,u+=4,h+=4,l+=4,c+=4}}this.step3_iter0_loop(this._n>>4,i,this._n2-1-0*this._n4,-this._n8),this.step3_iter0_loop(this._n>>4,i,this._n2-1-1*this._n4,-this._n8),this.step3_inner_r_loop(this._n>>5,i,this._n2-1-0*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,i,this._n2-1-1*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,i,this._n2-1-2*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,i,this._n2-1-3*this._n8,-(this._n>>4),16);let a=2;for(;a<this._ld-3>>1;++a){const o=this._n>>a+2,l=o>>1,c=1<<a+1;for(let u=0;u<c;++u)this.step3_inner_r_loop(this._n>>a+4,i,this._n2-1-o*u,-l,1<<a+3)}for(;a<this._ld-6;++a){const o=this._n>>a+2,l=1<<a+3,c=o>>1,h=1<<a+1;let f=this._n2-1,p=0;for(let g=this._n>>a+6;g>0;--g)this.step3_inner_s_loop(h,i,f,-c,p,l,o),p+=4*l,f-=8}this.step3_inner_s_loop_ld654(this._n>>5,i,this._n2-1,this._n);{let o=0,l=this._n4-4,c=this._n2-4;for(;l>=0;){let u;u=this._bitrev[o],s[c+3]=i[u],s[c+2]=i[u+1],s[l+3]=i[u+2],s[l+2]=i[u+3],u=this._bitrev[o+1],s[c+1]=i[u],s[c]=i[u+1],s[l+1]=i[u+2],s[l]=i[u+3],l-=4,c-=4,o+=2}}{let o=0,l=0,c=this._n2-4;for(;l<c;){let u,h,f,p,g,m;u=s[l]-s[c+2],h=s[l+1]+s[c+3],f=this._c[o+1]*u+this._c[o]*h,p=this._c[o+1]*h-this._c[o]*u,g=s[l]+s[c+2],m=s[l+1]-s[c+3],s[l]=g+f,s[l+1]=m+p,s[c+2]=g-f,s[c+3]=p-m,u=s[l+2]-s[c],h=s[l+3]+s[c+1],f=this._c[o+3]*u+this._c[o+2]*h,p=this._c[o+3]*h-this._c[o+2]*u,g=s[l+2]+s[c],m=s[l+3]-s[c+1],s[l+2]=g+f,s[l+3]=m+p,s[c]=g-f,s[c+1]=p-m,o+=4,l+=4,c-=4}}{let o=this._n2-8,l=this._n2-8,c=0,u=this._n2-4,h=this._n2,f=this._n-4;for(;l>=0;){let p,g,m,y;y=r[l+6]*this._b[o+7]-r[l+7]*this._b[o+6],m=-r[l+6]*this._b[o+6]-r[l+7]*this._b[o+7],e[c]=y,e[u+3]=-y,e[h]=m,e[f+3]=m,g=r[l+4]*this._b[o+5]-r[l+5]*this._b[o+4],p=-r[l+4]*this._b[o+4]-r[l+5]*this._b[o+5],e[c+1]=g,e[u+2]=-g,e[h+1]=p,e[f+2]=p,y=r[l+2]*this._b[o+3]-r[l+3]*this._b[o+2],m=-r[l+2]*this._b[o+2]-r[l+3]*this._b[o+3],e[c+2]=y,e[u+1]=-y,e[h+2]=m,e[f+1]=m,g=r[l]*this._b[o+1]-r[l+1]*this._b[o],p=-r[l]*this._b[o]-r[l+1]*this._b[o+1],e[c+3]=g,e[u]=-g,e[h+3]=p,e[f]=p,o-=8,l-=8,c+=4,h+=4,u-=4,f-=4}}}step3_inner_r_loop(e,i,s,r,a){let o,l,c=s,u=c+r,h=0;for(let f=e>>2;f>0;--f)o=i[c]-i[u],l=i[c-1]-i[u-1],i[c]+=i[u],i[c-1]+=i[u-1],i[u]=o*this._a[h]-l*this._a[h+1],i[u-1]=l*this._a[h]+o*this._a[h+1],h+=a,o=i[c-2]-i[u-2],l=i[c-3]-i[u-3],i[c-2]+=i[u-2],i[c-3]+=i[u-3],i[u-2]=o*this._a[h]-l*this._a[h+1],i[u-3]=l*this._a[h]+o*this._a[h+1],h+=a,o=i[c-4]-i[u-4],l=i[c-5]-i[u-5],i[c-4]+=i[u-4],i[c-5]+=i[u-5],i[u-4]=o*this._a[h]-l*this._a[h+1],i[u-5]=l*this._a[h]+o*this._a[h+1],h+=a,o=i[c-6]-i[u-6],l=i[c-7]-i[u-7],i[c-6]+=i[u-6],i[c-7]+=i[u-7],i[u-6]=o*this._a[h]-l*this._a[h+1],i[u-7]=l*this._a[h]+o*this._a[h+1],h+=a,c-=8,u-=8}step3_iter0_loop(e,i,s,r){let a=s,o=a+r,l=0;for(let c=e>>2;c>0;--c){let u,h;u=i[a]-i[o],h=i[a-1]-i[o-1],i[a]+=i[o],i[a-1]+=i[o-1],i[o]=u*this._a[l]-h*this._a[l+1],i[o-1]=h*this._a[l]+u*this._a[l+1],l+=8,u=i[a-2]-i[o-2],h=i[a-3]-i[o-3],i[a-2]+=i[o-2],i[a-3]+=i[o-3],i[o-2]=u*this._a[l]-h*this._a[l+1],i[o-3]=h*this._a[l]+u*this._a[l+1],l+=8,u=i[a-4]-i[o-4],h=i[a-5]-i[o-5],i[a-4]+=i[o-4],i[a-5]+=i[o-5],i[o-4]=u*this._a[l]-h*this._a[l+1],i[o-5]=h*this._a[l]+u*this._a[l+1],l+=8,u=i[a-6]-i[o-6],h=i[a-7]-i[o-7],i[a-6]+=i[o-6],i[a-7]+=i[o-7],i[o-6]=u*this._a[l]-h*this._a[l+1],i[o-7]=h*this._a[l]+u*this._a[l+1],l+=8,a-=8,o-=8}}step3_inner_s_loop(e,i,s,r,a,o,l){const c=this._a[a],u=this._a[a+1],h=this._a[a+o],f=this._a[a+o+1],p=this._a[a+2*o],g=this._a[a+2*o+1],m=this._a[a+3*o],y=this._a[a+3*o+1];let b,_,v=s,k=v+r;for(let F=e;F>0;--F)b=i[v]-i[k],_=i[v-1]-i[k-1],i[v]+=i[k],i[v-1]+=i[k-1],i[k]=b*c-_*u,i[k-1]=_*c+b*u,b=i[v-2]-i[k-2],_=i[v-3]-i[k-3],i[v-2]+=i[k-2],i[v-3]+=i[k-3],i[k-2]=b*h-_*f,i[k-3]=_*h+b*f,b=i[v-4]-i[k-4],_=i[v-5]-i[k-5],i[v-4]+=i[k-4],i[v-5]+=i[k-5],i[k-4]=b*p-_*g,i[k-5]=_*p+b*g,b=i[v-6]-i[k-6],_=i[v-7]-i[k-7],i[v-6]+=i[k-6],i[v-7]+=i[k-7],i[k-6]=b*m-_*y,i[k-7]=_*m+b*y,v-=l,k-=l}step3_inner_s_loop_ld654(e,i,s,r){const o=this._a[r>>3];let l=s;const c=l-16*e;for(;l>c;){let u,h;u=i[l]-i[l-8],h=i[l-1]-i[l-9],i[l]+=i[l-8],i[l-1]+=i[l-9],i[l-8]=u,i[l-9]=h,u=i[l-2]-i[l-10],h=i[l-3]-i[l-11],i[l-2]+=i[l-10],i[l-3]+=i[l-11],i[l-10]=(u+h)*o,i[l-11]=(h-u)*o,u=i[l-12]-i[l-4],h=i[l-5]-i[l-13],i[l-4]+=i[l-12],i[l-5]+=i[l-13],i[l-12]=h,i[l-13]=u,u=i[l-14]-i[l-6],h=i[l-7]-i[l-15],i[l-6]+=i[l-14],i[l-7]+=i[l-15],i[l-14]=(u+h)*o,i[l-15]=(u-h)*o,this.iter_54(i,l),this.iter_54(i,l-8),l-=16}}iter_54(e,i){const s=e[i]-e[i-4],r=e[i]+e[i-4],a=e[i-2]+e[i-6],o=e[i-2]-e[i-6];e[i]=r+a,e[i-2]=r-a;const l=e[i-3]-e[i-7];e[i-4]=s+l,e[i-6]=s-l;const c=e[i-1]-e[i-5],u=e[i-1]+e[i-5],h=e[i-3]+e[i-7];e[i-1]=u+h,e[i-3]=u-h,e[i-5]=c-o,e[i-7]=c+o}}return n.M_PI=3.141592653589793,n})();class C9{constructor(){this._setupCache=new Map}reverse(t,e){let i;this._setupCache.has(e)?i=this._setupCache.get(e):(i=new k9(e),this._setupCache.set(e,i)),i.calcReverse(t)}}class $S{constructor(t,e,i){this._packetIndex=0,this._stream=t,this._setup=e,this._packets=i,this._currentPosition=0,this._prevPacketBuf=null,this._prevPacketStart=0,this._prevPacketEnd=0,this._prevPacketStop=0,this._nextPacketBuf=null,this._eosFound=!1,this._hasPosition=!1,this._modeFieldBits=xr.ilog(e.modes.length-1)}decode(){let t=new Float32Array(this._packets[this._packets.length-1].granulePosition*this._stream.audioChannels);const e=new Float32Array(.2*this._stream.audioSampleRate*this._stream.audioChannels);let i=0,s=0;for(;i=this.read(e,0,e.length),0!==i;){if(s+i>=t.length){const r=new Float32Array(t.length+e.length);r.set(t,0),t=r}t.set(e.subarray(0,i),s),s+=i}return t.subarray(0,s)}read(t,e,i){if(0===i)return 0;let s=e;const r=e+i;for(;s<r;){if(this._prevPacketStart===this._prevPacketEnd){if(this._eosFound){this._nextPacketBuf=null,this._prevPacketBuf=null;break}const o=this.readNextPacket((s-e)/this._stream.audioChannels);null===o&&(this._prevPacketEnd=this._prevPacketStop),null!==o&&null!==o.samplePosition&&!this._hasPosition&&(this._hasPosition=!0,this._currentPosition=o.samplePosition-(this._prevPacketEnd-this._prevPacketStart)-(s-e)/this._stream.audioChannels)}const a=Math.min((r-s)/this._stream.audioChannels,this._prevPacketEnd-this._prevPacketStart);a>0&&(s+=this.copyBuffer(t,s,a))}return this._currentPosition+=(i=s-e)/this._stream.audioChannels,i}copyBuffer(t,e,i){let s=e;for(;i>0;this._prevPacketStart++,i--)for(let r=0;r<this._stream.audioChannels;r++)t[s++]=this._prevPacketBuf[r][this._prevPacketStart];return s-e}readNextPacket(t){const e=this.decodeNextPacket();if(this._eosFound=this._eosFound||e.isEndOfStream,null==e.curPacket)return null;if(null!==e.samplePosition&&e.isEndOfStream){const s=e.samplePosition-(this._currentPosition+t+e.validLen-e.startIndex);s<0&&(e.validLen+=s,e.validLen<0&&(e.validLen=0))}return this._prevPacketEnd>0?($S.overlapBuffers(this._prevPacketBuf,e.curPacket,this._prevPacketStart,this._prevPacketStop,e.startIndex,this._stream.audioChannels),this._prevPacketStart=e.startIndex):null==this._prevPacketBuf&&(this._prevPacketStart=e.validLen),this._nextPacketBuf=this._prevPacketBuf,this._prevPacketEnd=e.validLen,this._prevPacketStop=e.totalLen,this._prevPacketBuf=e.curPacket,new v9(e.samplePosition)}static overlapBuffers(t,e,i,s,r,a){for(;i<s;i++,r++)for(let o=0;o<a;o++)e[o][r]+=t[o][i]}decodeNextPacket(){const t=new D9;let e=null;if(this._packetIndex>=this._packets.length)t.isEndOfStream=!0;else{e=this._packets[this._packetIndex++];const i=new NI(Wt.fromBuffer(e.packetData));if(t.isEndOfStream=e.isEndOfStream,!i.readBit()){const s=this._setup.modes[i.readBits(this._modeFieldBits)];if(null==this._nextPacketBuf){this._nextPacketBuf=new Array(this._stream.audioChannels);for(let a=0;a<this._stream.audioChannels;a++)this._nextPacketBuf[a]=new Float32Array(this._stream.blocksize1)}const r=s.decode(i,this._nextPacketBuf);return t.startIndex=r.packetStartIndex,t.validLen=r.packetValidLength,t.totalLen=r.packetTotalLength,t.samplePosition=e.granulePosition,t.curPacket=this._nextPacketBuf,t}}return t}}class D9{constructor(){this.curPacket=null,this.startIndex=0,this.validLen=0,this.totalLen=0,this.isEndOfStream=!1,this.samplePosition=null}}var mg=function(n){return n[n.IdentificationHeader=1]="IdentificationHeader",n[n.Comment=3]="Comment",n[n.SetupHeader=5]="SetupHeader",n}(mg||{});class ea{constructor(t){this._packetIndex=-1,this._packets=t}read(){let t;for(;;){if(t=this.nextPacket(),null==t)return null;if(t.isBeginningOfStream){const e=this.readStream(t);if(null!=e)return e}}}nextPacket(){return this._packetIndex++,this._packetIndex<this._packets.length?this._packets[this._packetIndex]:null}readStream(t){const e=new o9;if(!this.readIdentificationHeader(e,t)||!this.readComments(this.nextPacket()))return null;const i=new l9;if(!this.readSetupHeader(e,i,this.nextPacket()))return null;const s=[];let r;for(;r=this.nextPacket(),null!=r&&(s.push(r),!r.isEndOfStream););const a=new $S(e,i,s);return e.samples=a.decode(),e}comonHeaderDecode(t,e){const i=new Uint8Array(7);if(e.read(i,0,i.length),i[0]!==t)return!1;for(let s=0;s<ea.VorbisHeaderMarker.length;s++)if(i[1+s]!==ea.VorbisHeaderMarker[s])return!1;return!0}comonHeaderDecodeBit(t,e){const i=e.readBytes(7);if(i[0]!==t)return!1;for(let s=0;s<ea.VorbisHeaderMarker.length;s++)if(i[1+s]!==ea.VorbisHeaderMarker[s])return!1;return!0}readIdentificationHeader(t,e){const i=Wt.fromBuffer(e.packetData);if(!this.comonHeaderDecode(mg.IdentificationHeader,i)||0!==T.readUInt32LE(i)||(t.audioChannels=i.readByte(),t.audioSampleRate=T.readUInt32LE(i),t.audioChannels<=0||t.audioSampleRate<=0))return!1;t.bitrateMaximum=T.readInt32LE(i),t.bitrateNominal=T.readInt32LE(i),t.bitrateMinimum=T.readInt32LE(i);const r=i.readByte();return t.blocksize0=1<<(15&r),t.blocksize1=1<<(r>>4),!(t.blocksize0>t.blocksize1||!ea.isAllowedBlockSize(t.blocksize0)||!ea.isAllowedBlockSize(t.blocksize0)||0===i.readByte())}static isAllowedBlockSize(t){switch(t){case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:return!0;default:return!1}}readComments(t){if(null==t)return!1;const e=Wt.fromBuffer(t.packetData);if(!this.comonHeaderDecode(mg.Comment,e))return!1;const i=T.readUInt32LE(e);e.skip(i);const s=T.readUInt32LE(e);for(let a=0;a<s;a++){const o=T.readUInt32LE(e);e.skip(o)}return 0!==e.readByte()}readSetupHeader(t,e,i){if(null==i)return!1;const s=new NI(Wt.fromBuffer(i.packetData)),r=new C9,a=new d9;if(!this.comonHeaderDecodeBit(mg.SetupHeader,s))return!1;let o=s.readByte()+1;for(let l=0;l<o;l++)e.codebooks.push(new u9(s,a));o=s.readBits(6)+1;for(let l=0;l<o;l++)e.timeDomainTransforms.push(new f9(s));o=s.readBits(6)+1;for(let l=0;l<o;l++)e.floors.push(new m9(s,t.blocksize0,t.blocksize1,e.codebooks));o=s.readBits(6)+1;for(let l=0;l<o;l++)e.residues.push(new w9(s,t.audioChannels,e.codebooks));o=s.readBits(6)+1;for(let l=0;l<o;l++)e.mappings.push(new S9(s,t.audioChannels,e.floors,e.residues,r));o=s.readBits(6)+1;for(let l=0;l<o;l++)e.modes.push(new T9(s,t.audioChannels,t.blocksize0,t.blocksize1,e.mappings));return!!s.readBit()}}ea.VorbisHeaderMarker=new Uint8Array([118,111,114,98,105,115]);class N9{constructor(t){this.streams=[];const i=new a9(t).read(),s=new ea(i);for(;;){const r=s.read();if(null==r)break;this.streams.push(r)}}}class x9{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.sampleData=new Uint8Array(0),this._sampleCache=new Map}decodeSamples(t,e,i){const s=`${t}_${e}_${i}`;if(!this._sampleCache.has(s)){let r;const a=this.sampleData.slice(t,e);if(i)r=new N9(Wt.fromBuffer(a)).streams[0].samples;else{const o=new DataView(a.buffer,a.byteOffset,a.length);r=new Float32Array(a.length/2);for(let l=0;l<r.length;l++)r[l]=o.getInt16(2*l,!0)/32767}return this._sampleCache.set(s,r),r}return this._sampleCache.get(s)}load(t){const e=new zo,i=new zo;if(!zo.load(null,e,t)||"sfbk"!==e.id)throw new gn("Soundfont is not a valid Soundfont2 file");for(;zo.load(e,i,t);){const s=new zo;if("pdta"===i.id)for(;zo.load(i,s,t);)switch(s.id){case"phdr":for(let r=0,a=s.size/AI.SizeInFile|0;r<a;r++)this.phdrs.push(new AI(t));break;case"pbag":for(let r=0,a=s.size/MI.SizeInFile|0;r<a;r++)this.pbags.push(new MI(t));break;case"pmod":for(let r=0,a=s.size/FI.SizeInFile|0;r<a;r++)this.pmods.push(new FI(t));break;case"pgen":for(let r=0,a=s.size/ta.SizeInFile|0;r<a;r++)this.pgens.push(new ta(t));break;case"inst":for(let r=0,a=s.size/II.SizeInFile|0;r<a;r++)this.insts.push(new II(t));break;case"ibag":for(let r=0,a=s.size/EI.SizeInFile|0;r<a;r++)this.ibags.push(new EI(t));break;case"imod":for(let r=0,a=s.size/BI.SizeInFile|0;r<a;r++)this.imods.push(new BI(t));break;case"igen":for(let r=0,a=s.size/PI.SizeInFile|0;r<a;r++)this.igens.push(new PI(t));break;case"shdr":for(let r=0,a=s.size/LI.SizeInFile|0;r<a;r++)this.sHdrs.push(new LI(t));break;default:t.position+=s.size}else if("sdta"===i.id)for(;zo.load(i,s,t);)"smpl"===s.id?(this.sampleData=new Uint8Array(s.size),t.read(this.sampleData,0,s.size)):t.position+=s.size;else t.position+=i.size}}}let EI=(()=>{class n{constructor(e){this.instGenNdx=T.readUInt16LE(e),this.instModNdx=T.readUInt16LE(e)}}return n.SizeInFile=4,n})(),BI=(()=>{class n{constructor(e){this.modSrcOper=T.readUInt16LE(e),this.modDestOper=T.readUInt16LE(e),this.modAmount=T.readInt16LE(e),this.modAmtSrcOper=T.readUInt16LE(e),this.modTransOper=T.readUInt16LE(e)}}return n.SizeInFile=10,n})(),PI=(()=>{class n{constructor(e){this.genOper=T.readUInt16LE(e),this.genAmount=new RI(e)}}return n.SizeInFile=4,n})(),II=(()=>{class n{constructor(e){this.instName=T.read8BitStringLength(e,20),this.instBagNdx=T.readUInt16LE(e)}}return n.SizeInFile=22,n})(),MI=(()=>{class n{constructor(e){this.genNdx=T.readUInt16LE(e),this.modNdx=T.readUInt16LE(e)}}return n.SizeInFile=4,n})(),ta=(()=>{class n{constructor(e){this.genOper=T.readUInt16LE(e),this.genAmount=new RI(e)}}return n.SizeInFile=4,n.GenInstrument=41,n.GenKeyRange=43,n.GenVelRange=44,n.GenSampleId=53,n})(),AI=(()=>{class n{constructor(e){this.presetName=T.read8BitStringLength(e,20),this.preset=T.readUInt16LE(e),this.bank=T.readUInt16LE(e),this.presetBagNdx=T.readUInt16LE(e),this.library=T.readUInt32LE(e),this.genre=T.readUInt32LE(e),this.morphology=T.readUInt32LE(e)}}return n.SizeInFile=38,n})(),FI=(()=>{class n{constructor(e){this.modSrcOper=T.readUInt16LE(e),this.modDestOper=T.readUInt16LE(e),this.modAmount=T.readUInt16LE(e),this.modAmtSrcOper=T.readUInt16LE(e),this.modTransOper=T.readUInt16LE(e)}}return n.SizeInFile=10,n})(),LI=(()=>{class n{constructor(e){this.sampleName=T.read8BitStringLength(e,20),this.start=T.readUInt32LE(e),this.end=T.readUInt32LE(e),this.startLoop=T.readUInt32LE(e),this.endLoop=T.readUInt32LE(e),this.sampleRate=T.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=T.readSInt8(e),this.sampleLink=T.readUInt16LE(e),this.sampleType=T.readUInt16LE(e)}}return n.SizeInFile=46,n})();class RI{get shortAmount(){return ye.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return 255&this.wordAmount}get highByteAmount(){return(65280&this.wordAmount)>>8&255}constructor(t){this.wordAmount=T.readUInt16LE(t)}}class E9{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class B9{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(t,e){const i=this.channelList[this.activeChannel],s=e.region.pan+i.panOffset;e.playingChannel=this.activeChannel,e.mixVolume=i.mixVolume,e.noteGainDb+=i.gainDb,e.updatePitchRatio(i,t.outSampleRate),s<=-.5?(e.panFactorLeft=1,e.panFactorRight=0):s>=.5?(e.panFactorLeft=0,e.panFactorRight=1):(e.panFactorLeft=Math.sqrt(.5-s),e.panFactorRight=Math.sqrt(.5+s))}}var za=function(n){return n[n.None=0]="None",n[n.Continuous=1]="Continuous",n[n.Sustain=2]="Sustain",n}(za||{}),Dc=function(n){return n[n.StereoInterleaved=0]="StereoInterleaved",n[n.StereoUnweaved=1]="StereoUnweaved",n[n.Mono=2]="Mono",n}(Dc||{});class P9{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null}}class bn{static timecents2Secs(t){return Math.pow(2,t/1200)}static decibelsToGain(t){return t>-100?Math.pow(10,.05*t):0}static gainToDecibels(t){return t<=1e-5?-100:20*Math.log10(t)}static cents2Hertz(t){return 8.176*Math.pow(2,t/1200)}}class Oh{constructor(t){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,t&&(this.delay=t.delay,this.attack=t.attack,this.hold=t.hold,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.keynumToHold=t.keynumToHold,this.keynumToDecay=t.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(t){this.delay=this.delay<-11950?0:bn.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:bn.timecents2Secs(this.attack),this.release=this.release<-11950?0:bn.timecents2Secs(this.release),0===this.keynumToHold&&(this.hold=this.hold<-11950?0:bn.timecents2Secs(this.hold)),0===this.keynumToDecay&&(this.decay=this.decay<-11950?0:bn.timecents2Secs(this.decay)),this.sustain=this.sustain<0?0:t?bn.decibelsToGain(-this.sustain/10):1-this.sustain/1e3}}var je=function(n){return n[n.StartAddrsOffset=0]="StartAddrsOffset",n[n.EndAddrsOffset=1]="EndAddrsOffset",n[n.StartloopAddrsOffset=2]="StartloopAddrsOffset",n[n.EndloopAddrsOffset=3]="EndloopAddrsOffset",n[n.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",n[n.ModLfoToPitch=5]="ModLfoToPitch",n[n.VibLfoToPitch=6]="VibLfoToPitch",n[n.ModEnvToPitch=7]="ModEnvToPitch",n[n.InitialFilterFc=8]="InitialFilterFc",n[n.InitialFilterQ=9]="InitialFilterQ",n[n.ModLfoToFilterFc=10]="ModLfoToFilterFc",n[n.ModEnvToFilterFc=11]="ModEnvToFilterFc",n[n.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",n[n.ModLfoToVolume=13]="ModLfoToVolume",n[n.Unused1=14]="Unused1",n[n.ChorusEffectsSend=15]="ChorusEffectsSend",n[n.ReverbEffectsSend=16]="ReverbEffectsSend",n[n.Pan=17]="Pan",n[n.Unused2=18]="Unused2",n[n.Unused3=19]="Unused3",n[n.Unused4=20]="Unused4",n[n.DelayModLFO=21]="DelayModLFO",n[n.FreqModLFO=22]="FreqModLFO",n[n.DelayVibLFO=23]="DelayVibLFO",n[n.FreqVibLFO=24]="FreqVibLFO",n[n.DelayModEnv=25]="DelayModEnv",n[n.AttackModEnv=26]="AttackModEnv",n[n.HoldModEnv=27]="HoldModEnv",n[n.DecayModEnv=28]="DecayModEnv",n[n.SustainModEnv=29]="SustainModEnv",n[n.ReleaseModEnv=30]="ReleaseModEnv",n[n.KeynumToModEnvHold=31]="KeynumToModEnvHold",n[n.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",n[n.DelayVolEnv=33]="DelayVolEnv",n[n.AttackVolEnv=34]="AttackVolEnv",n[n.HoldVolEnv=35]="HoldVolEnv",n[n.DecayVolEnv=36]="DecayVolEnv",n[n.SustainVolEnv=37]="SustainVolEnv",n[n.ReleaseVolEnv=38]="ReleaseVolEnv",n[n.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",n[n.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",n[n.Instrument=41]="Instrument",n[n.Reserved1=42]="Reserved1",n[n.KeyRange=43]="KeyRange",n[n.VelRange=44]="VelRange",n[n.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",n[n.Keynum=46]="Keynum",n[n.Velocity=47]="Velocity",n[n.InitialAttenuation=48]="InitialAttenuation",n[n.Reserved2=49]="Reserved2",n[n.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",n[n.CoarseTune=51]="CoarseTune",n[n.FineTune=52]="FineTune",n[n.SampleID=53]="SampleID",n[n.SampleModes=54]="SampleModes",n[n.Reserved3=55]="Reserved3",n[n.ScaleTuning=56]="ScaleTuning",n[n.ExclusiveClass=57]="ExclusiveClass",n[n.OverridingRootKey=58]="OverridingRootKey",n[n.Unused5=59]="Unused5",n[n.EndOper=60]="EndOper",n}(je||{});class Er{constructor(t){this.loopMode=za.None,this.samples=Er.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new Oh,this.modEnv=new Oh,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,t&&(this.loopMode=t.loopMode,this.samples=t.samples,this.sampleRate=t.sampleRate,this.loKey=t.loKey,this.hiKey=t.hiKey,this.loVel=t.loVel,this.hiVel=t.hiVel,this.group=t.group,this.offset=t.offset,this.end=t.end,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.transpose=t.transpose,this.tune=t.tune,this.pitchKeyCenter=t.pitchKeyCenter,this.pitchKeyTrack=t.pitchKeyTrack,this.attenuation=t.attenuation,this.pan=t.pan,this.ampEnv=new Oh(t.ampEnv),this.modEnv=new Oh(t.modEnv),this.initialFilterQ=t.initialFilterQ,this.initialFilterFc=t.initialFilterFc,this.modEnvToPitch=t.modEnvToPitch,this.modEnvToFilterFc=t.modEnvToFilterFc,this.modLfoToFilterFc=t.modLfoToFilterFc,this.modLfoToVolume=t.modLfoToVolume,this.delayModLFO=t.delayModLFO,this.freqModLFO=t.freqModLFO,this.modLfoToPitch=t.modLfoToPitch,this.delayVibLFO=t.delayVibLFO,this.freqVibLFO=t.freqVibLFO,this.vibLfoToPitch=t.vibLfoToPitch)}clear(t){this.loopMode=za.None,this.samples=Er.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!t&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(t,e){switch(t){case je.StartAddrsOffset:this.offset+=ye.int16ToUint32(e.shortAmount);break;case je.EndAddrsOffset:this.end+=ye.int16ToUint32(e.shortAmount);break;case je.StartloopAddrsOffset:this.loopStart+=ye.int16ToUint32(e.shortAmount);break;case je.EndloopAddrsOffset:this.loopEnd+=ye.int16ToUint32(e.shortAmount);break;case je.StartAddrsCoarseOffset:this.offset+=32768*ye.int16ToUint32(e.shortAmount);break;case je.ModLfoToPitch:this.modLfoToPitch=e.shortAmount;break;case je.VibLfoToPitch:this.vibLfoToPitch=e.shortAmount;break;case je.ModEnvToPitch:this.modEnvToPitch=e.shortAmount;break;case je.InitialFilterFc:this.initialFilterFc=e.shortAmount;break;case je.InitialFilterQ:this.initialFilterQ=e.shortAmount;break;case je.ModLfoToFilterFc:this.modLfoToFilterFc=e.shortAmount;break;case je.ModEnvToFilterFc:this.modEnvToFilterFc=e.shortAmount;break;case je.EndAddrsCoarseOffset:this.end+=32768*ye.int16ToUint32(e.shortAmount);break;case je.ModLfoToVolume:this.modLfoToVolume=e.shortAmount;break;case je.Pan:this.pan=e.shortAmount/1e3;break;case je.DelayModLFO:this.delayModLFO=e.shortAmount;break;case je.FreqModLFO:this.freqModLFO=e.shortAmount;break;case je.DelayVibLFO:this.delayVibLFO=e.shortAmount;break;case je.FreqVibLFO:this.freqVibLFO=e.shortAmount;break;case je.DelayModEnv:this.modEnv.delay=e.shortAmount;break;case je.AttackModEnv:this.modEnv.attack=e.shortAmount;break;case je.HoldModEnv:this.modEnv.hold=e.shortAmount;break;case je.DecayModEnv:this.modEnv.decay=e.shortAmount;break;case je.SustainModEnv:this.modEnv.sustain=e.shortAmount;break;case je.ReleaseModEnv:this.modEnv.release=e.shortAmount;break;case je.KeynumToModEnvHold:this.modEnv.keynumToHold=e.shortAmount;break;case je.KeynumToModEnvDecay:this.modEnv.keynumToDecay=e.shortAmount;break;case je.DelayVolEnv:this.ampEnv.delay=e.shortAmount;break;case je.AttackVolEnv:this.ampEnv.attack=e.shortAmount;break;case je.HoldVolEnv:this.ampEnv.hold=e.shortAmount;break;case je.DecayVolEnv:this.ampEnv.decay=e.shortAmount;break;case je.SustainVolEnv:this.ampEnv.sustain=e.shortAmount;break;case je.ReleaseVolEnv:this.ampEnv.release=e.shortAmount;break;case je.KeynumToVolEnvHold:this.ampEnv.keynumToHold=e.shortAmount;break;case je.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=e.shortAmount;break;case je.KeyRange:this.loKey=e.lowByteAmount,this.hiKey=e.highByteAmount;break;case je.VelRange:this.loVel=e.lowByteAmount,this.hiVel=e.highByteAmount;break;case je.StartloopAddrsCoarseOffset:this.loopStart+=32768*ye.int16ToUint32(e.shortAmount);break;case je.InitialAttenuation:this.attenuation+=.1*e.shortAmount;break;case je.EndloopAddrsCoarseOffset:this.loopEnd+=32768*ye.int16ToUint32(e.shortAmount);break;case je.CoarseTune:this.transpose+=e.shortAmount;break;case je.FineTune:this.tune+=e.shortAmount;break;case je.SampleModes:this.loopMode=3==(3&e.wordAmount)?za.Sustain:1==(3&e.wordAmount)?za.Continuous:za.None;break;case je.ScaleTuning:this.pitchKeyTrack=e.shortAmount;break;case je.ExclusiveClass:this.group=e.wordAmount;break;case je.OverridingRootKey:this.pitchKeyCenter=e.shortAmount}}}Er.NoSamples=new Float32Array(0);var _t=function(n){return n[n.None=0]="None",n[n.Delay=1]="Delay",n[n.Attack=2]="Attack",n[n.Hold=3]="Hold",n[n.Decay=4]="Decay",n[n.Sustain=5]="Sustain",n[n.Release=6]="Release",n[n.Done=7]="Done",n}(_t||{});let OI=(()=>{class n{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=_t.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(e,i){if(this.parameters)for(;;)switch(e){case _t.None:if(this.samplesUntilNextSegment=this.parameters.delay*i|0,this.samplesUntilNextSegment>0)return this.segment=_t.Delay,this.segmentIsExponential=!1,this.level=0,void(this.slope=0);e=_t.Delay;break;case _t.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*i|0,this.samplesUntilNextSegment>0)return this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*i|0),this.segment=_t.Attack,this.segmentIsExponential=!1,this.level=0,void(this.slope=1/this.samplesUntilNextSegment);e=_t.Attack;break;case _t.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*i|0,this.samplesUntilNextSegment>0)return this.segment=_t.Hold,this.segmentIsExponential=!1,this.level=1,void(this.slope=0);e=_t.Hold;break;case _t.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*i|0,this.samplesUntilNextSegment>0){if(this.segment=_t.Decay,this.level=1,this.isAmpEnv){const s=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(s),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/s|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*i|0,this.segmentIsExponential=!1;return}e=_t.Decay;break;case _t.Decay:return this.segment=_t.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,void(this.segmentIsExponential=!1);case _t.Sustain:return this.segment=_t.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?n.FastReleaseTime:this.parameters.release)*i|0,void(this.isAmpEnv?(this.slope=Math.exp(-9.226/this.samplesUntilNextSegment),this.segmentIsExponential=!0):(this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1));default:return this.segment=_t.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,void(this.samplesUntilNextSegment=134217727)}}setup(e,i,s,r,a){this.parameters=new Oh(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-i),this.parameters.hold=this.parameters.hold<-1e4?0:bn.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-i),this.parameters.decay=this.parameters.decay<-1e4?0:bn.timecents2Secs(this.parameters.decay)),this.midiVelocity=0|s,this.isAmpEnv=r,this.nextSegment(_t.None,a)}process(e,i){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,i)}}return n.FastReleaseTime=.01,n})();class VI{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(t,e,i){this.samplesUntil=t*i|0,this.delta=4*bn.cents2Hertz(e)/i,this.level=0}process(t){this.samplesUntil>t?this.samplesUntil-=t:(this.level+=this.delta*t,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level))}}class HI{constructor(t){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,t&&(this.qInv=t.qInv,this.a0=t.a0,this.a1=t.a1,this.b1=t.b1,this.b2=t.b2,this.z1=t.z1,this.z2=t.z2,this.active=t.active)}setup(t){const e=Math.tan(Math.PI*t),i=e*e,s=1/(1+e*this.qInv+i);this.a0=i*s,this.a1=2*this.a0,this.b1=2*(i-1)*s,this.b2=(1-e*this.qInv+i)*s}process(t){const e=t*this.a0+this.z1;return this.z1=t*this.a1+this.z2-this.b1*e,this.z2=t*this.a0-this.b2*e,e}}class Vh{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new OI,this.modEnv=new OI,this.lowPass=new HI,this.modLfo=new VI,this.vibLfo=new VI,this.mixVolume=0,this.mute=!1}updatePitchRatio(t,e){let i=t.pitchWheel;t.perNotePitchWheel.has(this.playingKey)&&(i+=t.perNotePitchWheel.get(this.playingKey)-8192),this.calcPitchRatio(8192===i?t.tuning:i/16383*t.pitchRange*2-t.pitchRange+t.tuning,e)}calcPitchRatio(t,e){if(!this.region)return;let s=this.region.pitchKeyCenter+this.region.pitchKeyTrack/100*(this.playingKey+this.region.transpose+this.region.tune/100-this.region.pitchKeyCenter);0!==t&&(s+=t),this.pitchInputTimecents=100*s,this.pitchOutputFactor=this.region.sampleRate/(bn.timecents2Secs(100*this.region.pitchKeyCenter)*e)}end(t){this.region&&(this.ampEnv.nextSegment(_t.Sustain,t),this.modEnv.nextSegment(_t.Sustain,t),this.region.loopMode===za.Sustain&&(this.loopEnd=this.loopStart))}endQuick(t){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(_t.Sustain,t),this.modEnv.parameters.release=0,this.modEnv.nextSegment(_t.Sustain,t)}render(t,e,i,s,r){if(!this.region)return;const a=this.region,o=a.samples;let l=0,c=t.outputMode===Dc.StereoUnweaved?s:-1;const u=0!==a.modEnvToPitch||0!==a.modEnvToFilterFc,h=this.modLfo.delta>0&&(0!==a.modLfoToPitch||0!==a.modLfoToFilterFc||0!==a.modLfoToVolume),f=this.vibLfo.delta>0&&0!==a.vibLfoToPitch,p=this.loopStart<this.loopEnd,g=this.loopStart,m=this.loopEnd,y=a.end,b=m+1;let _=this.sourceSamplePosition;const v=new HI(this.lowPass),k=0!==a.modLfoToFilterFc||0!==a.modEnvToFilterFc;let F=0,D=0,C=0,oe=0;const at=0!==a.modLfoToPitch||0!==a.modEnvToPitch||0!==a.vibLfoToPitch;let Fe=0,ne=0,ot=0,Nn=0;const ci=0!==a.modLfoToVolume;let ji=0,xn=0;for(k?(F=t.outSampleRate,D=a.initialFilterFc,C=a.modLfoToFilterFc,oe=a.modEnvToFilterFc):(F=0,D=0,C=0,oe=0),at?(Fe=0,ne=a.modLfoToPitch,ot=a.vibLfoToPitch,Nn=a.modEnvToPitch):(Fe=bn.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,ne=0,ot=0,Nn=0),ci?xn=.1*a.modLfoToVolume:(ji=bn.decibelsToGain(this.noteGainDb),xn=0);s>0;){let mi,to,ua=0,Is=s>Vh.RenderEffectSampleBlock?Vh.RenderEffectSampleBlock:s;if(s-=Is,k){const Wn=D+this.modLfo.level*C+this.modEnv.level*oe;v.active=Wn<=13500,v.active&&v.setup(bn.cents2Hertz(Wn)/F)}switch(at&&(Fe=bn.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*ne+this.vibLfo.level*ot+this.modEnv.level*Nn))*this.pitchOutputFactor),ci&&(ji=bn.decibelsToGain(this.noteGainDb+this.modLfo.level*xn)),mi=ji*this.ampEnv.level,r?mi=0:mi*=this.mixVolume,this.ampEnv.process(Is,t.outSampleRate),u&&this.modEnv.process(Is,t.outSampleRate),h&&this.modLfo.process(Is),f&&this.vibLfo.process(Is),t.outputMode){case Dc.StereoInterleaved:for(to=mi*this.panFactorLeft,ua=mi*this.panFactorRight;Is-- >0&&_<y;){const Wn=0|_,nr=_-Wn;let wn=o[Wn]*(1-nr)+o[Wn>=m&&p?g:Wn+1]*nr;v.active&&(wn=v.process(wn)),e[i+l]+=wn*to,l++,e[i+l]+=wn*ua,l++,_+=Fe,_>=b&&p&&(_-=m-g+1)}break;case Dc.StereoUnweaved:for(to=mi*this.panFactorLeft,ua=mi*this.panFactorRight;Is-- >0&&_<y;){const Wn=0|_,nr=_-Wn;let wn=o[Wn]*(1-nr)+o[Wn>=m&&p?g:Wn+1]*nr;v.active&&(wn=v.process(wn)),e[i+l]+=wn*to,l++,e[i+c]+=wn*ua,c++,_+=Fe,_>=b&&p&&(_-=m-g+1)}break;case Dc.Mono:for(;Is-- >0&&_<y;){const Wn=0|_,nr=_-Wn;let wn=o[Wn]*(1-nr)+o[Wn>=m&&p?g:Wn+1]*nr;v.active&&(wn=v.process(wn)),e[i+l]=wn*mi,l++,_+=Fe,_>=b&&p&&(_-=m-g+1)}}if(_>=y||this.ampEnv.segment===_t.Done)return void this.kill()}this.sourceSamplePosition=_,(v.active||k)&&(this.lowPass=v)}kill(){this.playingPreset=-1}}Vh.RenderEffectSampleBlock=he.MicroBufferSize;class jS{constructor(){this._items=[],this._position=0,this.isEmpty=!0}clear(){this._items=[],this._position=0,this.isEmpty=!0}enqueue(t){this.isEmpty=!1,this._items.push(t)}peek(){return this._items[this._position]}dequeue(){const t=this._items[this._position];return this._position++,this._position>=this._items.length/2&&(this._items=this._items.slice(this._position),this._position=0),this.isEmpty=0===this._items.length,t}toArray(){const t=this._items.slice(this._position);return t.reverse(),t}}var bt=function(n){return n[n.BankSelectCoarse=0]="BankSelectCoarse",n[n.ModulationCoarse=1]="ModulationCoarse",n[n.DataEntryCoarse=6]="DataEntryCoarse",n[n.VolumeCoarse=7]="VolumeCoarse",n[n.PanCoarse=10]="PanCoarse",n[n.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",n[n.BankSelectFine=32]="BankSelectFine",n[n.ModulationFine=33]="ModulationFine",n[n.DataEntryFine=38]="DataEntryFine",n[n.VolumeFine=39]="VolumeFine",n[n.PanFine=42]="PanFine",n[n.ExpressionControllerFine=43]="ExpressionControllerFine",n[n.HoldPedal=64]="HoldPedal",n[n.LegatoPedal=68]="LegatoPedal",n[n.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",n[n.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",n[n.RegisteredParameterFine=100]="RegisteredParameterFine",n[n.RegisteredParameterCourse=101]="RegisteredParameterCourse",n[n.AllSoundOff=120]="AllSoundOff",n[n.ResetControllers=121]="ResetControllers",n[n.AllNotesOff=123]="AllNotesOff",n}(bt||{});class qS{constructor(t){this._midiEventQueue=new jS,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this._liveTranspositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=Dc.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=t}synthesize(t,e,i){return this.fillWorkingBuffer(t,e,i)}synthesizeSilent(t){this.fillWorkingBuffer(null,0,t)}channelGetMixVolume(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].mixVolume:1}channelSetMixVolume(t,e){const i=this.channelInit(t);for(const s of this._voices)s.playingChannel===t&&-1!==s.playingPreset&&(s.mixVolume=e);i.mixVolume=e}channelSetMute(t,e){e?this._mutedChannels.set(t,!0):this._mutedChannels.delete(t)}channelSetSolo(t,e){e?this._soloChannels.set(t,!0):this._soloChannels.delete(t),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(t,e){let i=0;this._liveTranspositionPitches.has(t)&&(i=this._liveTranspositionPitches.get(t)),0===e?this._liveTranspositionPitches.delete(t):this._liveTranspositionPitches.set(t,e);for(const s of this._voices)if(s.playingChannel===t&&9!==s.playingChannel){let r=0;r-=i,r+=e,s.playingKey+=r,this._channels&&s.updatePitchRatio(this._channels.channelList[s.playingChannel],this.outSampleRate)}}applyTranspositionPitches(t){const e=this._transpositionPitches;for(const i of this._voices)if(i.playingChannel>=0&&9!==i.playingChannel){let s=0;e.has(i.playingChannel)&&(s-=e.get(i.playingChannel)),t.has(i.playingChannel)&&(s+=t.get(i.playingChannel)),i.playingKey+=s,this._channels&&i.updatePitchRatio(this._channels.channelList[i.playingChannel],this.outSampleRate)}this._transpositionPitches=t}dispatchEvent(t){this._midiEventQueue.enqueue(t)}fillWorkingBuffer(t,e,i){const s=this._isAnySolo,r=[];for(;!this._midiEventQueue.isEmpty;){const a=this._midiEventQueue.dequeue();a.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(he.MetronomeChannel,he.MetronomeKey),this.channelNoteOn(he.MetronomeChannel,he.MetronomeKey,95/127)):a.event&&this.processMidiMessage(a.event),r.push(a)}for(const a of this._voices)if(-1!==a.playingPreset){const o=a.playingChannel,l=this._mutedChannels.has(o)||s&&o!==he.MetronomeChannel&&!this._soloChannels.has(o);t?a.render(this,t,e,i,l):a.kill()}return r}processMidiMessage(t){switch(x.debug("Midi",`Processing Midi message ${He[t.type]}/${t.tick}`),t.type){case He.TimeSignature:const i=t;this.timeSignatureNumerator=i.numerator,this.timeSignatureDenominator=Math.pow(2,i.denominatorIndex);break;case He.NoteOn:this.channelNoteOn(t.channel,t.noteKey,t.noteVelocity/127);break;case He.NoteOff:this.channelNoteOff(t.channel,t.noteKey);break;case He.ControlChange:this.channelMidiControl(t.channel,t.controller,t.value);break;case He.ProgramChange:this.channelSetPresetNumber(t.channel,t.program,9===t.channel);break;case He.TempoChange:this.currentTempo=6e7/t.microSecondsPerQuarterNote;break;case He.PitchBend:this.channelSetPitchWheel(t.channel,t.value);break;case He.PerNotePitchBend:let h=t.value;h=h*he.MaxPitchWheel/he.MaxPitchWheel20,this.channelSetPerNotePitchWheel(t.channel,t.noteKey,h)}}get metronomeVolume(){return this.channelGetMixVolume(he.MetronomeChannel)}set metronomeVolume(t){this.setupMetronomeChannel(t)}setupMetronomeChannel(t){this.channelSetMixVolume(he.MetronomeChannel,t),t>0&&(this.channelSetVolume(he.MetronomeChannel,1),this.channelSetPresetNumber(he.MetronomeChannel,0,!0))}get masterVolume(){return bn.decibelsToGain(this.globalGainDb)}set masterVolume(t){const e=bn.gainToDecibels(t),i=e-this.globalGainDb;if(0!==i){for(const s of this._voices)-1!==s.playingPreset&&(s.noteGainDb+=i);this.globalGainDb=e}}resetSoft(){for(const t of this._voices)-1!==t.playingPreset&&(t.ampEnv.segment<_t.Release||0!==t.ampEnv.parameters.release)&&t.endQuick(this.outSampleRate);if(this._channels)for(const t of this._channels.channelList)t.presetIndex=0,t.bank=0,t.pitchWheel=8192,t.midiPan=8192,t.perNotePitchWheel.clear(),t.midiVolume=16383,t.midiExpression=16383,t.midiRpn=65535,t.midiData=0,t.panOffset=0,t.gainDb=0,t.pitchRange=2,t.tuning=0}get presetCount(){return this.presets?.length??0}reset(){for(const t of this._voices)-1!==t.playingPreset&&(t.ampEnv.segment<_t.Release||0!==t.ampEnv.parameters.release)&&t.endQuick(this.outSampleRate);this._channels=null}setOutput(t,e,i){this.outputMode=t,this.outSampleRate=e>=1?e:44100,this.globalGainDb=i}noteOn(t,e,i){if(!this.presets)return;const s=127*i|0;if(t<0||t>=this.presets.length)return;if(i<=0)return void this.noteOff(t,e);const r=this._voicePlayIndex++;for(const a of this.presets[t].regions){if(e<a.loKey||e>a.hiKey||s<a.loVel||s>a.hiVel)continue;let o=null;if(0!==a.group)for(const u of this._voices)u.playingPreset===t&&u.region.group===a.group?u.endQuick(this.outSampleRate):-1===u.playingPreset&&!o&&(o=u);else for(const u of this._voices)-1===u.playingPreset&&(o=u);if(!o){for(let u=0;u<4;u++){const h=new Vh;h.playingPreset=-1,this._voices.push(h)}o=this._voices[this._voices.length-4]}o.region=a,o.playingPreset=t,o.playingKey=e,o.playIndex=r,o.noteGainDb=this.globalGainDb-a.attenuation-bn.gainToDecibels(1/i),this._channels?this._channels.setupVoice(this,o):(o.calcPitchRatio(0,this.outSampleRate),o.panFactorLeft=Math.sqrt(.5-a.pan),o.panFactorRight=Math.sqrt(.5+a.pan)),o.sourceSamplePosition=a.offset;const l=a.loopMode!==za.None&&a.loopStart<a.loopEnd;o.loopStart=l?a.loopStart:0,o.loopEnd=l?a.loopEnd:0,o.ampEnv.setup(a.ampEnv,e,s,!0,this.outSampleRate),o.modEnv.setup(a.modEnv,e,s,!1,this.outSampleRate),o.lowPass.qInv=1/Math.pow(10,a.initialFilterQ/10/20),o.lowPass.z1=0,o.lowPass.z2=0,o.lowPass.active=a.initialFilterFc<=13500,o.lowPass.active&&o.lowPass.setup(bn.cents2Hertz(a.initialFilterFc)/this.outSampleRate),o.modLfo.setup(a.delayModLFO,a.freqModLFO,this.outSampleRate),o.vibLfo.setup(a.delayVibLFO,a.freqVibLFO,this.outSampleRate)}}bankNoteOn(t,e,i,s){const r=this.getPresetIndex(t,e);return-1!==r&&(this.noteOn(r,i,s),!0)}noteOff(t,e){let i=null,s=null;const r=[];for(const a of this._voices)a.playingPreset!==t||a.playingKey!==e||a.ampEnv.segment>=_t.Release||(!i||a.playIndex<i.playIndex?(i=a,s=a,r.push(a)):a.playIndex===i.playIndex&&(s=a,r.push(a)));if(i)for(const a of r)a!==i&&a!==s&&(a.playIndex!==i.playIndex||a.playingPreset!==t||a.playingKey!==e||a.ampEnv.segment>=_t.Release)||a.end(this.outSampleRate)}bankNoteOff(t,e,i){const s=this.getPresetIndex(t,e);return-1!==s&&(this.noteOff(s,i),!0)}noteOffAll(t){for(const e of this._voices)-1!==e.playingPreset&&(t?e.endQuick(this.outSampleRate):e.ampEnv.segment<_t.Release&&e.end(this.outSampleRate))}get activeVoiceCount(){let t=0;for(const e of this._voices)-1!==e.playingPreset&&t++;return t}channelInit(t){if(this._channels&&t<this._channels.channelList.length)return this._channels.channelList[t];this._channels||(this._channels=new B9);for(let e=this._channels.channelList.length;e<=t;e++){const i=new E9;i.presetIndex=0,i.bank=0,i.pitchWheel=8192,i.midiPan=8192,i.midiVolume=16383,i.midiExpression=16383,i.midiRpn=65535,i.midiData=0,i.panOffset=0,i.gainDb=0,i.pitchRange=2,i.tuning=0,i.mixVolume=1,this._channels.channelList.push(i)}return this._channels.channelList[t]}getPresetIndex(t,e){if(!this.presets)return-1;for(let i=this.presets.length-1;i>=0;i--){const s=this.presets[i];if(s.presetNumber===e&&s.bank===t)return i}return-1}getPresetName(t){return this.presets?t<0||t>=this.presets.length?null:this.presets[t].name:null}bankGetPresetName(t,e){return this.getPresetName(this.getPresetIndex(t,e))}channelNoteOn(t,e,i){!this._channels||t>this._channels.channelList.length||(this._transpositionPitches.has(t)&&(e+=this._transpositionPitches.get(t)),this._liveTranspositionPitches.has(t)&&(e+=this._liveTranspositionPitches.get(t)),this._channels.activeChannel=t,this.noteOn(this._channels.channelList[t].presetIndex,e,i))}channelNoteOff(t,e){this._transpositionPitches.has(t)&&(e+=this._transpositionPitches.get(t)),this._liveTranspositionPitches.has(t)&&(e+=this._liveTranspositionPitches.get(t));const i=[];let s=null,r=null;for(const o of this._voices)-1===o.playingPreset||o.playingChannel!==t||o.playingKey!==e||o.ampEnv.segment>=_t.Release||(!s||o.playIndex<s.playIndex?(s=o,r=o,i.push(o)):o.playIndex===s.playIndex&&(r=o,i.push(o)));if(this.channelInit(t).perNotePitchWheel.delete(e),s)for(const o of i)o!==s&&o!==r&&(o.playIndex!==s.playIndex||-1===o.playingPreset||o.playingChannel!==t||o.playingKey!==e||o.ampEnv.segment>=_t.Release)||o.end(this.outSampleRate)}channelNoteOffAll(t){this.channelInit(t).perNotePitchWheel.clear();for(const i of this._voices)-1!==i.playingPreset&&i.playingChannel===t&&i.ampEnv.segment<_t.Release&&i.end(this.outSampleRate)}channelSoundsOffAll(t){this.channelInit(t).perNotePitchWheel.clear();for(const i of this._voices)-1!==i.playingPreset&&i.playingChannel===t&&(i.ampEnv.segment<_t.Release||0===i.ampEnv.parameters.release)&&i.endQuick(this.outSampleRate)}channelSetPresetIndex(t,e){this.channelInit(t).presetIndex=ye.int32ToUint16(e)}channelSetPresetNumber(t,e,i=!1){const s=this.channelInit(t);let r=0;return i?(r=this.getPresetIndex(128|32767&s.bank,e),-1===r&&(r=this.getPresetIndex(128,e)),-1===r&&(r=this.getPresetIndex(128,0)),-1===r&&(r=this.getPresetIndex(2047&s.bank,e))):r=this.getPresetIndex(2047&s.bank,e),s.presetIndex=r,-1!==r}channelSetBank(t,e){this.channelInit(t).bank=ye.int32ToUint16(e)}channelSetBankPreset(t,e,i){const s=this.channelInit(t),r=this.getPresetIndex(e,i);return-1!==r&&(s.presetIndex=ye.int32ToUint16(r),s.bank=ye.int32ToUint16(e),!0)}channelSetPan(t,e){for(const i of this._voices)if(i.playingChannel===t&&-1!==i.playingPreset){const s=i.region.pan+e-.5;s<=-.5?(i.panFactorLeft=1,i.panFactorRight=0):s>=.5?(i.panFactorLeft=0,i.panFactorRight=1):(i.panFactorLeft=Math.sqrt(.5-s),i.panFactorRight=Math.sqrt(.5+s))}this.channelInit(t).panOffset=e-.5}channelSetVolume(t,e){const i=this.channelInit(t),s=bn.gainToDecibels(e),r=s-i.gainDb;if(0!==r){for(const a of this._voices)a.playingChannel===t&&-1!==a.playingPreset&&(a.noteGainDb+=r);i.gainDb=s}}channelSetPitchWheel(t,e){const i=this.channelInit(t);i.pitchWheel!==e&&(i.pitchWheel=ye.int32ToUint16(e),this.channelApplyPitch(t,i))}channelSetPerNotePitchWheel(t,e,i){this._transpositionPitches.has(t)&&(e+=this._transpositionPitches.get(t)),this._liveTranspositionPitches.has(t)&&(e+=this._liveTranspositionPitches.get(t));const s=this.channelInit(t);s.perNotePitchWheel.has(e)&&s.perNotePitchWheel.get(e)===i||(s.perNotePitchWheel.set(e,i),this.channelApplyPitch(t,s,e))}channelApplyPitch(t,e,i=-1){for(const s of this._voices)s.playingChannel===t&&-1!==s.playingPreset&&(-1===i||s.playingKey===i)&&s.updatePitchRatio(e,this.outSampleRate)}channelSetPitchRange(t,e){const i=this.channelInit(t);i.pitchRange!==e&&(i.pitchRange=e,8192!==i.pitchWheel&&this.channelApplyPitch(t,i))}channelSetTuning(t,e){const i=this.channelInit(t);i.tuning!==e&&(i.tuning=e,this.channelApplyPitch(t,i))}channelMidiControl(t,e,i){const s=this.channelInit(t);switch(e){case bt.DataEntryFine:return s.midiData=ye.int32ToUint16(16256&s.midiData|i),void(0===s.midiRpn?this.channelSetPitchRange(t,(s.midiData>>7)+.01*(127&s.midiData)):1===s.midiRpn?this.channelSetTuning(t,(0|s.tuning)+(s.midiData-8192)/8192):2===s.midiRpn&&this.channelSetTuning(t,i-64+(s.tuning-(0|s.tuning))));case bt.VolumeCoarse:return s.midiVolume=ye.int32ToUint16(127&s.midiVolume|i<<7),void this.channelSetVolume(t,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));case bt.VolumeFine:return s.midiVolume=ye.int32ToUint16(16256&s.midiVolume|i),void this.channelSetVolume(t,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));case bt.ExpressionControllerCoarse:return s.midiExpression=ye.int32ToUint16(127&s.midiExpression|i<<7),void this.channelSetVolume(t,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));case bt.ExpressionControllerFine:return s.midiExpression=ye.int32ToUint16(16256&s.midiExpression|i),void this.channelSetVolume(t,Math.pow(s.midiVolume/16383*(s.midiExpression/16383),3));case bt.PanCoarse:return s.midiPan=ye.int32ToUint16(127&s.midiPan|i<<7),void this.channelSetPan(t,s.midiPan/16383);case bt.PanFine:return s.midiPan=ye.int32ToUint16(16256&s.midiPan|i),void this.channelSetPan(t,s.midiPan/16383);case bt.DataEntryCoarse:return s.midiData=ye.int32ToUint16(127&s.midiData|i<<7),void(0===s.midiRpn?this.channelSetPitchRange(t,(s.midiData>>7)+.01*(127&s.midiData)):1===s.midiRpn?this.channelSetTuning(t,(0|s.tuning)+(s.midiData-8192)/8192):2===s.midiRpn&&e===bt.DataEntryCoarse&&this.channelSetTuning(t,i-64+(s.tuning-(0|s.tuning))));case bt.BankSelectCoarse:return void(s.bank=ye.int32ToUint16(32768|i));case bt.BankSelectFine:return void(s.bank=ye.int32ToUint16((32768&s.bank?(127&s.bank)<<7:0)|i));case bt.RegisteredParameterCourse:return void(s.midiRpn=ye.int32ToUint16(127&(65535===s.midiRpn?0:s.midiRpn)|i<<7));case bt.RegisteredParameterFine:return void(s.midiRpn=ye.int32ToUint16(16256&(65535===s.midiRpn?0:s.midiRpn)|i));case bt.NonRegisteredParameterFine:case bt.NonRegisteredParameterCourse:return void(s.midiRpn=65535);case bt.AllSoundOff:return void this.channelSoundsOffAll(t);case bt.AllNotesOff:return void this.channelNoteOffAll(t);case bt.ResetControllers:return s.midiVolume=16383,s.midiExpression=16383,s.midiPan=8192,s.bank=0,this.channelSetVolume(t,1),this.channelSetPan(t,.5),void this.channelSetPitchRange(t,2)}}channelGetPresetIndex(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].presetIndex:0}channelGetPresetBank(t){return this._channels&&t<this._channels.channelList.length?32767&this._channels.channelList[t].bank:0}channelGetPan(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].panOffset-.5:.5}channelGetVolume(t){return this._channels&&t<this._channels.channelList.length?bn.decibelsToGain(this._channels.channelList[t].gainDb):1}channelGetPitchWheel(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].pitchWheel:8192}channelGetPitchRange(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].pitchRange:2}channelGetTuning(t){return this._channels&&t<this._channels.channelList.length?this._channels.channelList[t].tuning:0}resetPresets(){this.presets=[]}loadPresets(t,e,i,s){const r=[];for(let a=0;a<t.phdrs.length-1;a++){const o=t.phdrs[a];let l=0;const c=new P9;r.push(c),c.name=o.presetName,c.bank=o.bank,c.presetNumber=o.preset;let u=0;for(let f=o.presetBagNdx;f<t.phdrs[a+1].presetBagNdx;f++){let g=0,m=127,y=0,b=127;for(let _=t.pbags[f].genNdx;_<t.pbags[f+1].genNdx;_++){const v=t.pgens[_];if(v.genOper!==ta.GenKeyRange)if(v.genOper!==ta.GenVelRange){if(!(v.genOper!==ta.GenInstrument||v.genAmount.wordAmount>=t.insts.length))for(let F=t.insts[v.genAmount.wordAmount].instBagNdx;F<t.insts[v.genAmount.wordAmount+1].instBagNdx;F++){let C=0,oe=127,at=0,Fe=127;for(let ne=t.ibags[F].instGenNdx;ne<t.ibags[F+1].instGenNdx;ne++){const ot=t.igens[ne];ot.genOper!==ta.GenKeyRange?ot.genOper!==ta.GenVelRange?53===ot.genOper&&oe>=g&&C<=m&&Fe>=y&&at<=b&&u++:(at=ot.genAmount.lowByteAmount,Fe=ot.genAmount.highByteAmount):(C=ot.genAmount.lowByteAmount,oe=ot.genAmount.highByteAmount)}}}else y=v.genAmount.lowByteAmount,b=v.genAmount.highByteAmount;else g=v.genAmount.lowByteAmount,m=v.genAmount.highByteAmount}}c.regions=new Array(u);let h=new Er;h.clear(!0);for(let f=o.presetBagNdx;f<t.phdrs[a+1].presetBagNdx;f++){const p=t.pbags[f],g=new Er(h);let m=!1;for(let y=p.genNdx;y<t.pbags[f+1].genNdx;y++){const b=t.pgens[y];if(b.genOper===ta.GenInstrument){const _=b.genAmount.wordAmount;if(_>=t.insts.length)continue;let v=new Er;v.clear(!1);const k=t.insts[_];for(let F=k.instBagNdx;F<t.insts[_+1].instBagNdx;F++){const D=t.ibags[F],C=new Er(v);let oe=!1;for(let at=D.instGenNdx;at<t.ibags[F+1].instGenNdx;at++){const Fe=t.igens[at];if(Fe.genOper===ta.GenSampleId){if(C.hiKey<g.loKey||C.loKey>g.hiKey||C.hiVel<g.loVel||C.loVel>g.hiVel)continue;g.loKey>C.loKey&&(C.loKey=g.loKey),g.hiKey<C.hiKey&&(C.hiKey=g.hiKey),g.loVel>C.loVel&&(C.loVel=g.loVel),g.hiVel<C.hiVel&&(C.hiVel=g.hiVel),C.offset+=g.offset,C.end+=g.end,C.loopStart+=g.loopStart,C.loopEnd+=g.loopEnd,C.transpose+=g.transpose,C.tune+=g.tune,C.pitchKeyTrack+=g.pitchKeyTrack,C.attenuation+=g.attenuation,C.pan+=g.pan,C.ampEnv.delay+=g.ampEnv.delay,C.ampEnv.attack+=g.ampEnv.attack,C.ampEnv.hold+=g.ampEnv.hold,C.ampEnv.decay+=g.ampEnv.decay,C.ampEnv.sustain+=g.ampEnv.sustain,C.ampEnv.release+=g.ampEnv.release,C.modEnv.delay+=g.modEnv.delay,C.modEnv.attack+=g.modEnv.attack,C.modEnv.hold+=g.modEnv.hold,C.modEnv.decay+=g.modEnv.decay,C.modEnv.sustain+=g.modEnv.sustain,C.modEnv.release+=g.modEnv.release,C.initialFilterQ+=g.initialFilterQ,C.initialFilterFc+=g.initialFilterFc,C.modEnvToPitch+=g.modEnvToPitch,C.modEnvToFilterFc+=g.modEnvToFilterFc,C.delayModLFO+=g.delayModLFO,C.freqModLFO+=g.freqModLFO,C.modLfoToPitch+=g.modLfoToPitch,C.modLfoToFilterFc+=g.modLfoToFilterFc,C.modLfoToVolume+=g.modLfoToVolume,C.delayVibLFO+=g.delayVibLFO,C.freqVibLFO+=g.freqVibLFO,C.vibLfoToPitch+=g.vibLfoToPitch,C.ampEnv.envToSecs(!0),C.modEnv.envToSecs(!1),C.delayModLFO=C.delayModLFO<-11950?0:bn.timecents2Secs(C.delayModLFO),C.delayVibLFO=C.delayVibLFO<-11950?0:bn.timecents2Secs(C.delayVibLFO),C.pan<-.5?C.pan=-.5:C.pan>.5&&(C.pan=.5),(C.initialFilterQ<1500||C.initialFilterQ>13500)&&(C.initialFilterQ=0);const ne=t.sHdrs[Fe.genAmount.wordAmount];C.offset+=ne.start,C.end+=ne.end,C.loopStart+=ne.startLoop,C.loopEnd+=ne.endLoop,ne.endLoop>0&&(C.loopEnd-=1),-1===C.pitchKeyCenter&&(C.pitchKeyCenter=ne.originalPitch),C.tune+=ne.pitchCorrection,C.sampleRate=ne.sampleRate;const ot=o.bank===he.PercussionBank;ot&&qS.setContainsRange(i,C.loKey,C.hiKey)||!ot&&e.has(o.preset)?1&ne.sampleType?(x.debug("AlphaSynth",`Loading of used sample ${ne.sampleName} for preset ${o.presetName} (bank ${c.bank} program ${c.presetNumber})`),0!=(16&ne.sampleType)?C.samples=t.decodeSamples(ne.start,ne.end,!0):(C.samples=t.decodeSamples(2*C.offset,2*C.end,!1),C.loopStart>0&&(C.loopStart-=C.offset),C.loopEnd>0&&(C.loopEnd-=C.offset)),C.offset=0,C.end=C.samples.length-1):(x.warning("AlphaSynth",`Skipping load of unsupported sample ${ne.sampleName} for preset ${o.presetName}, sample type ${ne.sampleType} is not supported (bank ${c.bank} program ${c.presetNumber})`),C.samples=new Float32Array(0)):(x.debug("AlphaSynth",`Skipping load of unused sample ${ne.sampleName} for preset ${o.presetName} (bank ${c.bank} program ${c.presetNumber})`),C.samples=new Float32Array(0)),c.regions[l]=new Er(C),l++,oe=!0}else C.operator(Fe.genOper,Fe.genAmount)}D===t.ibags[k.instBagNdx]&&!oe&&(v=new Er(C))}m=!0}else g.operator(b.genOper,b.genAmount)}p===t.pbags[o.presetBagNdx]&&!m&&(h=g)}}if(s&&this.presets)for(const a of r)this.presets.push(a);else this.presets=r}static setContainsRange(t,e,i){for(let s=e;s<=i;s++)if(t.has(s))return!0;return!1}hasSamplesForProgram(t){const e=this.presets;if(!e)return!1;for(const i of e)if(i.presetNumber===t)for(const s of i.regions)if(s.samples.length>0)return!0;return!1}hasSamplesForPercussion(t){const e=this.presets;if(!e)return!1;for(const i of e)if(i.bank===he.PercussionBank)for(const s of i.regions)if(s.loKey>=t&&s.hiKey<=t&&s.samples.length>0)return!0;return!1}}class Cn{constructor(){this._listeners=[]}on(t){this._listeners.push(t)}off(t){this._listeners=this._listeners.filter(e=>e!==t)}trigger(){for(const t of this._listeners)t()}}class qe{constructor(){this._listeners=[]}on(t){this._listeners.push(t)}off(t){this._listeners=this._listeners.filter(e=>e!==t)}trigger(t){for(const e of this._listeners)e(t)}}class YS{constructor(t){this.events=t}}class XS{constructor(t){this.playbackRange=t}}class WI{get output(){return this._output}get isReadyForPlayback(){return this.isReady&&this._isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return x.logLevel}set logLevel(t){x.logLevel=t}get masterVolume(){return this._synthesizer.masterVolume}set masterVolume(t){t=Math.max(t,he.MinVolume),this._synthesizer.masterVolume=t}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(t){t=Math.max(t,he.MinVolume),this._metronomeVolume=t,this._synthesizer.metronomeVolume=t}get countInVolume(){return this._countInVolume}set countInVolume(t){t=Math.max(t,he.MinVolume),this._countInVolume=t}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(t){this._midiEventsPlayedFilter=new Set(t)}get playbackSpeed(){return this._sequencer.playbackSpeed}set playbackSpeed(t){t=H.clamp(t,he.MinPlaybackSpeed,he.MaxPlaybackSpeed);const e=this._sequencer.playbackSpeed;this._sequencer.playbackSpeed=t,this.timePosition=this.timePosition*(e/t)}get tickPosition(){return this._tickPosition}set tickPosition(t){this.timePosition=this._sequencer.mainTickPositionToTimePosition(t)}get timePosition(){return this._timePosition}set timePosition(t){x.debug("AlphaSynth",`Seeking to position ${t}ms (main)`),this._sequencer.mainSeek(t),this.updateTimePosition(t,!0),this._sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this._sequencer.mainPlaybackRange}set playbackRange(t){this._sequencer.mainPlaybackRange=t,t&&(this.tickPosition=t.startTick),this.playbackRangeChanged.trigger(new XS(t))}get isLooping(){return this._sequencer.isLooping}set isLooping(t){this._sequencer.isLooping=t}destroy(){x.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(t,e){this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new jS,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this._synthStopping=!1,this.isReady=!1,this.state=yn.Paused,this._loadedSoundFonts=[],this.ready=new Cn,this.readyForPlayback=new Cn,this.finished=new Cn,this.soundFontLoaded=new Cn,this.soundFontLoadFailed=new qe,this.midiLoaded=new qe,this.midiLoadFailed=new qe,this.stateChanged=new qe,this.positionChanged=new qe,this.midiEventsPlayed=new qe,this.playbackRangeChanged=new qe,x.debug("AlphaSynth","Initializing player"),this.state=yn.Paused,x.debug("AlphaSynth","Creating output"),this._output=t,x.debug("AlphaSynth","Creating synthesizer"),this._synthesizer=new qS(this.output.sampleRate),this._sequencer=new s9(this._synthesizer),x.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{if(this.state===yn.Playing&&(!this._sequencer.isFinished||this._synthesizer.activeVoiceCount>0)){let i=new Float32Array(he.MicroBufferSize*he.MicroBufferCount*he.AudioChannels),s=0;for(let r=0;r<he.MicroBufferCount;r++){this._sequencer.fillMidiEventQueue();const a=this._synthesizer.synthesize(i,s,he.MicroBufferSize);s+=he.MicroBufferSize*he.AudioChannels;for(const o of a)this._midiEventsPlayedFilter.has(o.event.type)&&this._playedEventsQueue.enqueue(o);if(this._sequencer.isFinished)break}s<i.length&&(i=i.subarray(0,s)),this._notPlayedSamples+=i.length,this.output.addSamples(i)}else{const i=new Float32Array(0);this.output.addSamples(i)}}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(e)}play(){return!(this.state!==yn.Paused||!this._isMidiLoaded||(this.output.activate(),this.playInternal(),this._countInVolume>0&&(x.debug("AlphaSynth","Starting countin"),this._sequencer.startCountIn(),this._synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),0))}playInternal(){this._sequencer.isPlayingOneTimeMidi&&(x.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),x.debug("AlphaSynth","Starting playback"),this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=yn.Playing,this.stateChanged.trigger(new Fh(this.state,!1))}pause(){this.state===yn.Paused||!this._isMidiLoaded||(x.debug("AlphaSynth","Pausing playback"),this.state=yn.Paused,this.stateChanged.trigger(new Fh(this.state,!1)),this.output.pause(),this._synthesizer.noteOffAll(!1))}playPause(){this.state===yn.Paused&&this._isMidiLoaded?this.play():this.pause()}stop(){this._isMidiLoaded&&(x.debug("AlphaSynth","Stopping playback"),this.state=yn.Paused,this.output.pause(),this._notPlayedSamples=0,this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=this._sequencer.mainPlaybackRange?this._sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new Fh(this.state,!0)))}playOneTimeMidiFile(t){this._sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this._sequencer.loadOneTimeMidi(t),this._synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this._synthesizer.resetPresets(),this._loadedSoundFonts=[],this._isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(t,e){this.pause();const i=Wt.fromBuffer(t);try{x.debug("AlphaSynth","Loading soundfont from bytes");const s=new x9;s.load(i),e||(this._loadedSoundFonts=[]),this._loadedSoundFonts.push(s),this._isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),x.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(s){x.error("AlphaSynth",`Could not load soundfont from bytes ${s}`),this.soundFontLoadFailed.trigger(s)}}checkReadyForPlayback(){if(this.isReadyForPlayback){this._synthesizer.setupMetronomeChannel(this.metronomeVolume);const t=this._sequencer.instrumentPrograms,e=this._sequencer.percussionKeys;let i=!1;for(const s of this._loadedSoundFonts)this._synthesizer.loadPresets(s,t,e,i),i=!0;this.readyForPlayback.trigger()}}loadMidiFile(t){this.stop();try{x.debug("AlphaSynth","Loading midi from model"),this._sequencer.loadMidi(t),this._isMidiLoaded=!0,this.midiLoaded.trigger(new Lh(0,this._sequencer.currentEndTime,0,this._sequencer.currentEndTick,!1)),x.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(e){x.error("AlphaSynth",`Could not load midi from model ${e}`),this.midiLoadFailed.trigger(e)}}applyTranspositionPitches(t){this._synthesizer.applyTranspositionPitches(t)}setChannelTranspositionPitch(t,e){this._synthesizer.setChannelTranspositionPitch(t,e)}setChannelMute(t,e){this._synthesizer.channelSetMute(t,e)}resetChannelStates(){this._synthesizer.resetChannelStates()}setChannelSolo(t,e){this._synthesizer.channelSetSolo(t,e)}setChannelVolume(t,e){e=Math.max(e,he.MinVolume),this._synthesizer.channelSetMixVolume(t,e)}onSamplesPlayed(t){if(0===t)return;const e=t/this._synthesizer.outSampleRate*1e3;this._notPlayedSamples-=t*he.AudioChannels,this.updateTimePosition(this._timePosition+e,!1),this.checkForFinish()}checkForFinish(){let t=0,e=0;this.playbackRange&&this._sequencer.isPlayingMain?(t=this.playbackRange.startTick,e=this.playbackRange.endTick):e=this._sequencer.currentEndTick,this._tickPosition>=e&&this._notPlayedSamples<=0&&(this._notPlayedSamples=0,this._sequencer.isPlayingCountIn?(x.debug("AlphaSynth","Finished playback (count-in)"),this._sequencer.resetCountIn(),this.timePosition=this._sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this._sequencer.isPlayingOneTimeMidi?(x.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=yn.Paused,this.stopOneTimeMidi()):this.isLooping?(x.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=t,this._synthStopping=!1):this._synthesizer.activeVoiceCount>0?this._synthStopping||(this._synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,x.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop()))}stopOneTimeMidi(){this.output.pause(),this._synthesizer.noteOffAll(!0),this._sequencer.resetOneTimeMidi(),this.timePosition=this._sequencer.currentTime}updateTimePosition(t,e){let i=t;this._timePosition=i;let s=this._sequencer.currentTimePositionToTickPosition(i);this._tickPosition=s;const r=this._sequencer.currentEndTime,a=this._sequencer.currentEndTick;if(i>r&&(i=r,s=a),x.debug("AlphaSynth",`Position changed: (time: ${i}/${r}, tick: ${s}/${a}, Active Voices: ${this._synthesizer.activeVoiceCount} (${this._sequencer.isPlayingMain?"main":this._sequencer.isPlayingCountIn?"count-in":"one-time"})`),this._sequencer.isPlayingMain&&this.positionChanged.trigger(new Lh(i,r,s,a,e)),e)this._playedEventsQueue.clear();else{const l=new jS;for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<i;){const c=this._playedEventsQueue.dequeue();l.enqueue(c.event)}l.isEmpty||this.midiEventsPlayed.trigger(new YS(l.toArray()))}}hasSamplesForProgram(t){return this._synthesizer.hasSamplesForProgram(t)}hasSamplesForPercussion(t){return this._synthesizer.hasSamplesForPercussion(t)}}class E{static parseEnum(t,e){switch(typeof t){case"string":const i=Number.parseInt(t);return Number.isNaN(i)?e[Object.keys(e).find(s=>s.toLowerCase()===t.toLowerCase())]:i;case"number":return t;case"undefined":case"object":return}throw new nt(it.Format,`Could not parse enum value '${t}'`)}static forEach(t,e){if(t instanceof Map)t.forEach(e);else if("object"==typeof t)for(const i in t)e(t[i],i)}static getValue(t,e){return t instanceof Map?t.get(e):"object"==typeof t?t[e]:null}}class I9{constructor(t,e,i){this.text=t,this.startPos=e,this.endPos=i}}class Nc{constructor(t){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=t,this._tokens=this.splitToTokens(t)}splitToTokens(t){const e=[];let i=0;for(;i<t.length;){let s=i;for(;s<t.length&&" "!==t.charAt(s);)s++;s>i&&e.push(new I9(t.substring(i,s),i,s)),i=s+1}return e}parse(){if(this.reset(),1===this._tokens.length)switch(this._currentToken?.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(t){const e=new Nc(t);return e.parseOnlyFamilies=!0,e.parse(),e.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const t=this._input.substr(this._currentToken.startPos).trim();let e=0;for(;e<t.length;){const i=t.charAt(e);if(" "===i||","===i)e++;else if('"'===i||"'"===i){const s=this.findEndOfQuote(t,e+1,i);this.families.push(t.substring(e+1,s).split(`\\${i}`).join(i)),e=s+1}else{const s=this.findEndOfQuote(t,e+1,",");this.families.push(t.substring(e,s).trim()),e=s+1}}}findEndOfQuote(t,e,i){let s=!1;for(;e<t.length;){const r=t.charAt(e);if(!s&&r===i)return e;s=!s&&"\\"===r,e+=1}return t.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const t=this._currentToken.text.split("/");if(t.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),t.length>=2)if("/"===t[1]){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=t[0],this.lineHeight=t[1];else{if(!(t.length>=1))throw new Error("Missing font size");if(this.size=t[0],this._currentToken&&0===this._currentToken.text.indexOf("/"))if("/"===this._currentToken.text){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}}nextToken(){this._currentTokenIndex++,this._currentToken=this._currentTokenIndex<this._tokens.length?this._tokens[this._currentTokenIndex]:null}fontStyleVariantWeight(){let t=!1,e=!1,i=!1,s=3;const r=[];for(;;){if(!this._currentToken)return;const a=this._currentToken.text;switch(a){case"normal":case"inherit":r.push(a),s--,this.nextToken();break;case"italic":case"oblique":this.style=a,t=!0,s--,this.nextToken();break;case"small-caps":this.variant=a,e=!0,s--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=a,i=!0,s--,this.nextToken();break;default:return}if(0===s)break}for(;r.length>0;){const a=r.pop();i?e?t||(this.style=a):this.variant=a:this.weight=a}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(t){return-1===t.indexOf(" ")?t:`"${t.replaceAll('"','\\"')}"`}}var Tt=function(n){return n[n.Plain=0]="Plain",n[n.Italic=1]="Italic",n}(Tt||{}),Wi=function(n){return n[n.Regular=0]="Regular",n[n.Bold=1]="Bold",n}(Wi||{});class ve{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(t){this.families=Nc.parseFamilies(t)}get families(){return this._families}set families(t){this._families=t,this.reset()}get size(){return this._size}set size(t){this._size=t,this.reset()}get style(){return this._style}set style(t){this._style=t,this.reset()}get weight(){return this._weight}set weight(t){this._weight=t,this.reset()}get isBold(){return this.weight===Wi.Bold}get isItalic(){return this.style===Tt.Italic}constructor(t,e,i=Tt.Plain,s=Wi.Regular){this._cssScale=0,this._families=Nc.parseFamilies(t),this._size=e,this._style=i,this._weight=s,this._css=this.toCssString()}withSize(t){return ve.withFamilyList(this._families,t,this._style,this._weight)}static withFamilyList(t,e,i=Tt.Plain,s=Wi.Regular){const r=new ve("",e,i,s);return r.families=t,r}toCssString(t=1){if(!(this._css&&Math.abs(t-this._cssScale)<.01)){let e="";this.isBold&&(e+="bold "),this.isItalic&&(e+="italic "),e+=this.size*t,e+="px ",e+=this.families.map(i=>Nc.quoteFont(i)).join(", "),this._css=e,this._cssScale=t}return this._css}static fromJson(t){if(t instanceof ve)return t;switch(typeof t){case"undefined":default:return null;case"object":{const e=t,i=e.get("families"),s=e.get("size"),r=E.parseEnum(e.get("style"),Tt),a=E.parseEnum(e.get("weight"),Wi);return ve.withFamilyList(i,s,r,a)}case"string":{const e=new Nc(t);e.parse();const i=e.families,s=e.size.toLowerCase();let r=0;switch(s){case"xx-small":r=7;break;case"x-small":r=10;break;case"small":case"smaller":r=13;break;case"medium":r=16;break;case"large":case"larger":r=18;break;case"x-large":r=24;break;case"xx-large":r=32;break;default:try{r=s.endsWith("em")?16*Number.parseFloat(s.substr(0,s.length-2)):s.endsWith("pt")?16*Number.parseFloat(s.substr(0,s.length-2))/12:s.endsWith("px")?Number.parseFloat(s.substr(0,s.length-2)):12}catch{r=12}}let a=Tt.Plain;"italic"===e.style&&(a=Tt.Italic);let o=Wi.Regular;switch(e.weight.toLowerCase()){case"normal":case"lighter":break;default:o=Wi.Bold}return ve.withFamilyList(i,r,a,o)}}}static toJson(t){const e=new Map;return e.set("families",t.families),e.set("size",t.size),e.set("style",t.style),e.set("weight",t.weight),e}}let M9=(()=>{class n{constructor(){this.copyrightFont=new ve(n.sansFont,12,Tt.Plain,Wi.Bold),this.titleFont=new ve(n.serifFont,32,Tt.Plain),this.subTitleFont=new ve(n.serifFont,20,Tt.Plain),this.wordsFont=new ve(n.serifFont,15,Tt.Plain),this.effectFont=new ve(n.serifFont,12,Tt.Italic),this.timerFont=new ve(n.serifFont,12,Tt.Plain),this.directionsFont=new ve(n.serifFont,14,Tt.Plain),this.fretboardNumberFont=new ve(n.sansFont,11,Tt.Plain),this.numberedNotationFont=new ve(n.sansFont,16,Tt.Plain),this.numberedNotationGraceFont=new ve(n.sansFont,14,Tt.Plain),this.tablatureFont=new ve(n.sansFont,13,Tt.Plain),this.graceFont=new ve(n.sansFont,11,Tt.Plain),this.staffLineColor=new st(165,165,165,255),this.barSeparatorColor=new st(34,34,17,255),this.barNumberFont=new ve(n.sansFont,11,Tt.Plain),this.barNumberColor=new st(200,0,0,255),this.fingeringFont=new ve(n.serifFont,14,Tt.Plain),this.inlineFingeringFont=new ve(n.serifFont,12,Tt.Plain),this.markerFont=new ve(n.serifFont,14,Tt.Plain,Wi.Bold),this.mainGlyphColor=new st(0,0,0,255),this.secondaryGlyphColor=new st(0,0,0,100),this.scoreInfoColor=new st(0,0,0,255)}getFontForElement(e){switch(e){case U.Title:return this.titleFont;case U.SubTitle:case U.Artist:case U.Album:return this.subTitleFont;case U.Words:case U.Music:case U.WordsAndMusic:case U.Transcriber:return this.wordsFont;case U.Copyright:case U.CopyrightSecondLine:return this.copyrightFont}return this.wordsFont}}return n.sansFont="Arial, sans-serif",n.serifFont="Georgia, serif",n})();var $o=function(n){return n[n.Automatic=0]="Automatic",n[n.UseModelLayout=1]="UseModelLayout",n}($o||{});class A9{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=Wa.Page,this.staveProfile=_r.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new M9,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=3,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.firstStaffPaddingLeft=6,this.staffPaddingLeft=2,this.systemsLayoutMode=$o.Automatic}}class F9{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var $a=function(n){return n[n.Off=0]="Off",n[n.Continuous=1]="Continuous",n[n.OffScreen=2]="OffScreen",n}($a||{});class L9{constructor(){this.noteWideLength=240,this.noteWideAmplitude=1,this.noteSlightLength=360,this.noteSlightAmplitude=.5,this.beatWideLength=480,this.beatWideAmplitude=2,this.beatSlightLength=480,this.beatSlightAmplitude=2}}class R9{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var yg=function(n){return n[n.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",n[n.WebAudioScriptProcessor=1]="WebAudioScriptProcessor",n}(yg||{});class O9{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=yg.WebAudioAudioWorklets,this.enablePlayer=!1,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=$a.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new L9,this.slide=new R9,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class Hh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Hh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("scriptfile",t.scriptFile),e.set("fontdirectory",t.fontDirectory),e.set("file",t.file),e.set("tex",t.tex),e.set("tracks",t.tracks),e.set("enablelazyloading",t.enableLazyLoading),e.set("engine",t.engine),e.set("loglevel",t.logLevel),e.set("useworkers",t.useWorkers),e.set("includenotebounds",t.includeNoteBounds),e}static setProperty(t,e,i){switch(e){case"scriptfile":return t.scriptFile=i,!0;case"fontdirectory":return t.fontDirectory=i,!0;case"file":return t.file=i,!0;case"tex":return t.tex=i,!0;case"tracks":return t.tracks=i,!0;case"enablelazyloading":return t.enableLazyLoading=i,!0;case"engine":return t.engine=i,!0;case"loglevel":return t.logLevel=E.parseEnum(i,kr),!0;case"useworkers":return t.useWorkers=i,!0;case"includenotebounds":return t.includeNoteBounds=i,!0}return!1}}class Wh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Wh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("copyrightfont",ve.toJson(t.copyrightFont)),e.set("titlefont",ve.toJson(t.titleFont)),e.set("subtitlefont",ve.toJson(t.subTitleFont)),e.set("wordsfont",ve.toJson(t.wordsFont)),e.set("effectfont",ve.toJson(t.effectFont)),e.set("timerfont",ve.toJson(t.timerFont)),e.set("directionsfont",ve.toJson(t.directionsFont)),e.set("fretboardnumberfont",ve.toJson(t.fretboardNumberFont)),e.set("numberednotationfont",ve.toJson(t.numberedNotationFont)),e.set("numberednotationgracefont",ve.toJson(t.numberedNotationGraceFont)),e.set("tablaturefont",ve.toJson(t.tablatureFont)),e.set("gracefont",ve.toJson(t.graceFont)),e.set("stafflinecolor",st.toJson(t.staffLineColor)),e.set("barseparatorcolor",st.toJson(t.barSeparatorColor)),e.set("barnumberfont",ve.toJson(t.barNumberFont)),e.set("barnumbercolor",st.toJson(t.barNumberColor)),e.set("fingeringfont",ve.toJson(t.fingeringFont)),e.set("inlinefingeringfont",ve.toJson(t.inlineFingeringFont)),e.set("markerfont",ve.toJson(t.markerFont)),e.set("mainglyphcolor",st.toJson(t.mainGlyphColor)),e.set("secondaryglyphcolor",st.toJson(t.secondaryGlyphColor)),e.set("scoreinfocolor",st.toJson(t.scoreInfoColor)),e}static setProperty(t,e,i){switch(e){case"copyrightfont":return t.copyrightFont=ve.fromJson(i),!0;case"titlefont":return t.titleFont=ve.fromJson(i),!0;case"subtitlefont":return t.subTitleFont=ve.fromJson(i),!0;case"wordsfont":return t.wordsFont=ve.fromJson(i),!0;case"effectfont":return t.effectFont=ve.fromJson(i),!0;case"timerfont":return t.timerFont=ve.fromJson(i),!0;case"directionsfont":return t.directionsFont=ve.fromJson(i),!0;case"fretboardnumberfont":return t.fretboardNumberFont=ve.fromJson(i),!0;case"numberednotationfont":return t.numberedNotationFont=ve.fromJson(i),!0;case"numberednotationgracefont":return t.numberedNotationGraceFont=ve.fromJson(i),!0;case"tablaturefont":return t.tablatureFont=ve.fromJson(i),!0;case"gracefont":return t.graceFont=ve.fromJson(i),!0;case"stafflinecolor":return t.staffLineColor=st.fromJson(i),!0;case"barseparatorcolor":return t.barSeparatorColor=st.fromJson(i),!0;case"barnumberfont":return t.barNumberFont=ve.fromJson(i),!0;case"barnumbercolor":return t.barNumberColor=st.fromJson(i),!0;case"fingeringfont":return t.fingeringFont=ve.fromJson(i),!0;case"inlinefingeringfont":return t.inlineFingeringFont=ve.fromJson(i),!0;case"markerfont":return t.markerFont=ve.fromJson(i),!0;case"mainglyphcolor":return t.mainGlyphColor=st.fromJson(i),!0;case"secondaryglyphcolor":return t.secondaryGlyphColor=st.fromJson(i),!0;case"scoreinfocolor":return t.scoreInfoColor=st.fromJson(i),!0}return!1}}class Uh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Uh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("scale",t.scale),e.set("stretchforce",t.stretchForce),e.set("layoutmode",t.layoutMode),e.set("staveprofile",t.staveProfile),e.set("barsperrow",t.barsPerRow),e.set("startbar",t.startBar),e.set("barcount",t.barCount),e.set("barcountperpartial",t.barCountPerPartial),e.set("justifylastsystem",t.justifyLastSystem),e.set("resources",Wh.toJson(t.resources)),e.set("padding",t.padding),e.set("firstsystempaddingtop",t.firstSystemPaddingTop),e.set("systempaddingtop",t.systemPaddingTop),e.set("systempaddingbottom",t.systemPaddingBottom),e.set("lastsystempaddingbottom",t.lastSystemPaddingBottom),e.set("systemlabelpaddingleft",t.systemLabelPaddingLeft),e.set("systemlabelpaddingright",t.systemLabelPaddingRight),e.set("accoladebarpaddingright",t.accoladeBarPaddingRight),e.set("notationstaffpaddingtop",t.notationStaffPaddingTop),e.set("notationstaffpaddingbottom",t.notationStaffPaddingBottom),e.set("effectstaffpaddingtop",t.effectStaffPaddingTop),e.set("effectstaffpaddingbottom",t.effectStaffPaddingBottom),e.set("firststaffpaddingleft",t.firstStaffPaddingLeft),e.set("staffpaddingleft",t.staffPaddingLeft),e.set("systemslayoutmode",t.systemsLayoutMode),e}static setProperty(t,e,i){switch(e){case"scale":return t.scale=i,!0;case"stretchforce":return t.stretchForce=i,!0;case"layoutmode":return t.layoutMode=E.parseEnum(i,Wa),!0;case"staveprofile":return t.staveProfile=E.parseEnum(i,_r),!0;case"barsperrow":return t.barsPerRow=i,!0;case"startbar":return t.startBar=i,!0;case"barcount":return t.barCount=i,!0;case"barcountperpartial":return t.barCountPerPartial=i,!0;case"justifylastsystem":return t.justifyLastSystem=i,!0;case"padding":return t.padding=i,!0;case"firstsystempaddingtop":return t.firstSystemPaddingTop=i,!0;case"systempaddingtop":return t.systemPaddingTop=i,!0;case"systempaddingbottom":return t.systemPaddingBottom=i,!0;case"lastsystempaddingbottom":return t.lastSystemPaddingBottom=i,!0;case"systemlabelpaddingleft":return t.systemLabelPaddingLeft=i,!0;case"systemlabelpaddingright":return t.systemLabelPaddingRight=i,!0;case"accoladebarpaddingright":return t.accoladeBarPaddingRight=i,!0;case"notationstaffpaddingtop":return t.notationStaffPaddingTop=i,!0;case"notationstaffpaddingbottom":return t.notationStaffPaddingBottom=i,!0;case"effectstaffpaddingtop":return t.effectStaffPaddingTop=i,!0;case"effectstaffpaddingbottom":return t.effectStaffPaddingBottom=i,!0;case"firststaffpaddingleft":return t.firstStaffPaddingLeft=i,!0;case"staffpaddingleft":return t.staffPaddingLeft=i,!0;case"systemslayoutmode":return t.systemsLayoutMode=E.parseEnum(i,$o),!0}if(["resources"].indexOf(e)>=0)return Wh.fromJson(t.resources,i),!0;for(const s of["resources"])if(0===e.indexOf(s)&&Wh.setProperty(t.resources,e.substring(s.length),i))return!0;return!1}}class Gh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Gh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;e.set("notationmode",t.notationMode),e.set("fingeringmode",t.fingeringMode);{const i=new Map;e.set("elements",i);for(const[s,r]of t.elements)i.set(s.toString(),r)}return e.set("rhythmmode",t.rhythmMode),e.set("rhythmheight",t.rhythmHeight),e.set("transpositionpitches",t.transpositionPitches),e.set("displaytranspositionpitches",t.displayTranspositionPitches),e.set("smallgracetabnotes",t.smallGraceTabNotes),e.set("extendbendarrowsontiednotes",t.extendBendArrowsOnTiedNotes),e.set("extendlineeffectstobeatend",t.extendLineEffectsToBeatEnd),e.set("slurheight",t.slurHeight),e}static setProperty(t,e,i){switch(e){case"notationmode":return t.notationMode=E.parseEnum(i,_n),!0;case"fingeringmode":return t.fingeringMode=E.parseEnum(i,Tr),!0;case"elements":return t.elements=new Map,E.forEach(i,(s,r)=>{t.elements.set(E.parseEnum(r,Te),s)}),!0;case"rhythmmode":return t.rhythmMode=E.parseEnum(i,Xs),!0;case"rhythmheight":return t.rhythmHeight=i,!0;case"transpositionpitches":return t.transpositionPitches=i,!0;case"displaytranspositionpitches":return t.displayTranspositionPitches=i,!0;case"smallgracetabnotes":return t.smallGraceTabNotes=i,!0;case"extendbendarrowsontiednotes":return t.extendBendArrowsOnTiedNotes=i,!0;case"extendlineeffectstobeatend":return t.extendLineEffectsToBeatEnd=i,!0;case"slurheight":return t.slurHeight=i,!0}return!1}}class zh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>zh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("encoding",t.encoding),e.set("mergepartgroupsinmusicxml",t.mergePartGroupsInMusicXml),e.set("beattextaslyrics",t.beatTextAsLyrics),e}static setProperty(t,e,i){switch(e){case"encoding":return t.encoding=i,!0;case"mergepartgroupsinmusicxml":return t.mergePartGroupsInMusicXml=i,!0;case"beattextaslyrics":return t.beatTextAsLyrics=i,!0}return!1}}class $h{static fromJson(t,e){e&&E.forEach(e,(i,s)=>$h.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("notewidelength",t.noteWideLength),e.set("notewideamplitude",t.noteWideAmplitude),e.set("noteslightlength",t.noteSlightLength),e.set("noteslightamplitude",t.noteSlightAmplitude),e.set("beatwidelength",t.beatWideLength),e.set("beatwideamplitude",t.beatWideAmplitude),e.set("beatslightlength",t.beatSlightLength),e.set("beatslightamplitude",t.beatSlightAmplitude),e}static setProperty(t,e,i){switch(e){case"notewidelength":return t.noteWideLength=i,!0;case"notewideamplitude":return t.noteWideAmplitude=i,!0;case"noteslightlength":return t.noteSlightLength=i,!0;case"noteslightamplitude":return t.noteSlightAmplitude=i,!0;case"beatwidelength":return t.beatWideLength=i,!0;case"beatwideamplitude":return t.beatWideAmplitude=i,!0;case"beatslightlength":return t.beatSlightLength=i,!0;case"beatslightamplitude":return t.beatSlightAmplitude=i,!0}return!1}}class jh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>jh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("simpleslidepitchoffset",t.simpleSlidePitchOffset),e.set("simpleslidedurationratio",t.simpleSlideDurationRatio),e.set("shiftslidedurationratio",t.shiftSlideDurationRatio),e}static setProperty(t,e,i){switch(e){case"simpleslidepitchoffset":return t.simpleSlidePitchOffset=i,!0;case"simpleslidedurationratio":return t.simpleSlideDurationRatio=i,!0;case"shiftslidedurationratio":return t.shiftSlideDurationRatio=i,!0}return!1}}class qh{static fromJson(t,e){e&&E.forEach(e,(i,s)=>qh.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("soundfont",t.soundFont),e.set("outputmode",t.outputMode),e.set("enableplayer",t.enablePlayer),e.set("enablecursor",t.enableCursor),e.set("enableanimatedbeatcursor",t.enableAnimatedBeatCursor),e.set("enableelementhighlighting",t.enableElementHighlighting),e.set("enableuserinteraction",t.enableUserInteraction),e.set("scrolloffsetx",t.scrollOffsetX),e.set("scrolloffsety",t.scrollOffsetY),e.set("scrollmode",t.scrollMode),e.set("scrollspeed",t.scrollSpeed),e.set("nativebrowsersmoothscroll",t.nativeBrowserSmoothScroll),e.set("songbookbendduration",t.songBookBendDuration),e.set("songbookdipduration",t.songBookDipDuration),e.set("vibrato",$h.toJson(t.vibrato)),e.set("slide",jh.toJson(t.slide)),e.set("playtripletfeel",t.playTripletFeel),e.set("buffertimeinmilliseconds",t.bufferTimeInMilliseconds),e}static setProperty(t,e,i){switch(e){case"soundfont":return t.soundFont=i,!0;case"scrollelement":return t.scrollElement=i,!0;case"outputmode":return t.outputMode=E.parseEnum(i,yg),!0;case"enableplayer":return t.enablePlayer=i,!0;case"enablecursor":return t.enableCursor=i,!0;case"enableanimatedbeatcursor":return t.enableAnimatedBeatCursor=i,!0;case"enableelementhighlighting":return t.enableElementHighlighting=i,!0;case"enableuserinteraction":return t.enableUserInteraction=i,!0;case"scrolloffsetx":return t.scrollOffsetX=i,!0;case"scrolloffsety":return t.scrollOffsetY=i,!0;case"scrollmode":return t.scrollMode=E.parseEnum(i,$a),!0;case"scrollspeed":return t.scrollSpeed=i,!0;case"nativebrowsersmoothscroll":return t.nativeBrowserSmoothScroll=i,!0;case"songbookbendduration":return t.songBookBendDuration=i,!0;case"songbookdipduration":return t.songBookDipDuration=i,!0;case"playtripletfeel":return t.playTripletFeel=i,!0;case"buffertimeinmilliseconds":return t.bufferTimeInMilliseconds=i,!0}if(["vibrato"].indexOf(e)>=0)return $h.fromJson(t.vibrato,i),!0;for(const s of["vibrato"])if(0===e.indexOf(s)&&$h.setProperty(t.vibrato,e.substring(s.length),i))return!0;if(["slide"].indexOf(e)>=0)return jh.fromJson(t.slide,i),!0;for(const s of["slide"])if(0===e.indexOf(s)&&jh.setProperty(t.slide,e.substring(s.length),i))return!0;return!1}}class ja{static fromJson(t,e){e&&E.forEach(e,(i,s)=>ja.setProperty(t,s.toLowerCase(),i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("core",Hh.toJson(t.core)),e.set("display",Uh.toJson(t.display)),e.set("notation",Gh.toJson(t.notation)),e.set("importer",zh.toJson(t.importer)),e.set("player",qh.toJson(t.player)),e}static setProperty(t,e,i){if(["core",""].indexOf(e)>=0)return Hh.fromJson(t.core,i),!0;for(const s of["core",""])if(0===e.indexOf(s)&&Hh.setProperty(t.core,e.substring(s.length),i))return!0;if(["display",""].indexOf(e)>=0)return Uh.fromJson(t.display,i),!0;for(const s of["display",""])if(0===e.indexOf(s)&&Uh.setProperty(t.display,e.substring(s.length),i))return!0;if(["notation"].indexOf(e)>=0)return Gh.fromJson(t.notation,i),!0;for(const s of["notation"])if(0===e.indexOf(s)&&Gh.setProperty(t.notation,e.substring(s.length),i))return!0;if(["importer"].indexOf(e)>=0)return zh.fromJson(t.importer,i),!0;for(const s of["importer"])if(0===e.indexOf(s)&&zh.setProperty(t.importer,e.substring(s.length),i))return!0;if(["player"].indexOf(e)>=0)return qh.fromJson(t.player,i),!0;for(const s of["player"])if(0===e.indexOf(s)&&qh.setProperty(t.player,e.substring(s.length),i))return!0;return!1}}class qa{constructor(){this.core=new AM,this.display=new A9,this.notation=new Nh,this.importer=new F9,this.player=new O9}setSongBookModeSettings(){this.notation.notationMode=_n.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=Tr.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(Te.ParenthesisOnTiedBends,!1),this.notation.elements.set(Te.TabNotesOnTiedBends,!1),this.notation.elements.set(Te.ZerosOnDiveWhammys,!0)}static get songBook(){const t=new qa;return t.setSongBookModeSettings(),t}fillFromJson(t){ja.fromJson(this,t)}}class bg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>bg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("marker",t.marker),e.set("text",t.text),e}static setProperty(t,e,i){switch(e){case"marker":return t.marker=i,!0;case"text":return t.text=i,!0}return!1}}class xc{static fromJson(t,e){e&&E.forEach(e,(i,s)=>xc.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("islinear",t.isLinear),e.set("type",t.type),e.set("value",t.value),e.set("ratioposition",t.ratioPosition),e.set("text",t.text),e}static setProperty(t,e,i){switch(e){case"islinear":return t.isLinear=i,!0;case"type":return t.type=E.parseEnum(i,Bt),!0;case"value":return t.value=i,!0;case"ratioposition":return t.ratioPosition=i,!0;case"text":return t.text=i,!0}return!1}}class wg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>wg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("type",t.type),e.set("length",t.length),e}static setProperty(t,e,i){switch(e){case"type":return t.type=E.parseEnum(i,jn),!0;case"length":return t.length=i,!0}return!1}}class Sg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Sg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;if(e.set("alternateendings",t.alternateEndings),e.set("isdoublebar",t.isDoubleBar),e.set("isrepeatstart",t.isRepeatStart),e.set("repeatcount",t.repeatCount),e.set("timesignaturenumerator",t.timeSignatureNumerator),e.set("timesignaturedenominator",t.timeSignatureDenominator),e.set("timesignaturecommon",t.timeSignatureCommon),e.set("isfreetime",t.isFreeTime),e.set("tripletfeel",t.tripletFeel),t.section&&e.set("section",bg.toJson(t.section)),e.set("tempoautomations",t.tempoAutomations.map(i=>xc.toJson(i))),null!==t.fermata){const i=new Map;e.set("fermata",i);for(const[s,r]of t.fermata)i.set(s.toString(),wg.toJson(r))}if(e.set("start",t.start),e.set("isanacrusis",t.isAnacrusis),e.set("displayscale",t.displayScale),e.set("displaywidth",t.displayWidth),null!==t.directions){const i=[];e.set("directions",i);for(const s of t.directions)i.push(s)}return e}static setProperty(t,e,i){switch(e){case"alternateendings":return t.alternateEndings=i,!0;case"isdoublebar":return t.isDoubleBar=i,!0;case"isrepeatstart":return t.isRepeatStart=i,!0;case"repeatcount":return t.repeatCount=i,!0;case"timesignaturenumerator":return t.timeSignatureNumerator=i,!0;case"timesignaturedenominator":return t.timeSignatureDenominator=i,!0;case"timesignaturecommon":return t.timeSignatureCommon=i,!0;case"isfreetime":return t.isFreeTime=i,!0;case"tripletfeel":return t.tripletFeel=E.parseEnum(i,_e),!0;case"section":return i?(t.section=new Tc,bg.fromJson(t.section,i)):t.section=null,!0;case"tempoautomations":t.tempoAutomations=[];for(const s of i){const r=new Xt;xc.fromJson(r,s),t.tempoAutomations.push(r)}return!0;case"fermata":return t.fermata=new Map,E.forEach(i,(s,r)=>{const a=new kc;wg.fromJson(a,s),t.addFermata(Number.parseInt(r),a)}),!0;case"start":return t.start=i,!0;case"isanacrusis":return t.isAnacrusis=i,!0;case"displayscale":return t.displayScale=i,!0;case"displaywidth":return t.displayWidth=i,!0;case"directions":for(const s of i)t.addDirection(E.parseEnum(s,A));return!0}return!1}}class Ec{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Ec.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("offset",t.offset),e.set("value",t.value),e}static setProperty(t,e,i){switch(e){case"offset":return t.offset=i,!0;case"value":return t.value=i,!0}return!1}}class _g{static fromJson(t,e){e&&E.forEach(e,(i,s)=>_g.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;e.set("notehead",t.noteHead),e.set("noteheadcenteronstem",t.noteHeadCenterOnStem);{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){switch(e){case"notehead":return t.noteHead=E.parseEnum(i,d),!0;case"noteheadcenteronstem":return t.noteHeadCenterOnStem=i,!0;case"colors":return t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,si),st.fromJson(s))}),!0}return!1}}class vg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>vg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("id",t.id),e.set("accentuated",t.accentuated),e.set("bendtype",t.bendType),e.set("bendstyle",t.bendStyle),e.set("iscontinuedbend",t.isContinuedBend),null!==t.bendPoints&&e.set("bendpoints",t.bendPoints?.map(i=>Ec.toJson(i))),e.set("fret",t.fret),e.set("string",t.string),e.set("showstringnumber",t.showStringNumber),e.set("octave",t.octave),e.set("tone",t.tone),e.set("percussionarticulation",t.percussionArticulation),e.set("isvisible",t.isVisible),e.set("islefthandtapped",t.isLeftHandTapped),e.set("ishammerpullorigin",t.isHammerPullOrigin),e.set("isslurdestination",t.isSlurDestination),e.set("harmonictype",t.harmonicType),e.set("harmonicvalue",t.harmonicValue),e.set("isghost",t.isGhost),e.set("isletring",t.isLetRing),e.set("ispalmmute",t.isPalmMute),e.set("isdead",t.isDead),e.set("isstaccato",t.isStaccato),e.set("slideintype",t.slideInType),e.set("slideouttype",t.slideOutType),e.set("vibrato",t.vibrato),e.set("istiedestination",t.isTieDestination),e.set("lefthandfinger",t.leftHandFinger),e.set("righthandfinger",t.rightHandFinger),e.set("trillvalue",t.trillValue),e.set("trillspeed",t.trillSpeed),e.set("durationpercent",t.durationPercent),e.set("accidentalmode",t.accidentalMode),e.set("dynamics",t.dynamics),e.set("ornament",t.ornament),t.style&&e.set("style",_g.toJson(t.style)),t.toJson(e),e}static setProperty(t,e,i){switch(e){case"id":return t.id=i,!0;case"accentuated":return t.accentuated=E.parseEnum(i,Ot),!0;case"bendtype":return t.bendType=E.parseEnum(i,J),!0;case"bendstyle":return t.bendStyle=E.parseEnum(i,ct),!0;case"iscontinuedbend":return t.isContinuedBend=i,!0;case"bendpoints":if(i){t.bendPoints=[];for(const s of i){const r=new V;Ec.fromJson(r,s),t.addBendPoint(r)}}return!0;case"fret":return t.fret=i,!0;case"string":return t.string=i,!0;case"showstringnumber":return t.showStringNumber=i,!0;case"octave":return t.octave=i,!0;case"tone":return t.tone=i,!0;case"percussionarticulation":return t.percussionArticulation=i,!0;case"isvisible":return t.isVisible=i,!0;case"islefthandtapped":return t.isLeftHandTapped=i,!0;case"ishammerpullorigin":return t.isHammerPullOrigin=i,!0;case"isslurdestination":return t.isSlurDestination=i,!0;case"harmonictype":return t.harmonicType=E.parseEnum(i,ae),!0;case"harmonicvalue":return t.harmonicValue=i,!0;case"isghost":return t.isGhost=i,!0;case"isletring":return t.isLetRing=i,!0;case"ispalmmute":return t.isPalmMute=i,!0;case"isdead":return t.isDead=i,!0;case"isstaccato":return t.isStaccato=i,!0;case"slideintype":return t.slideInType=E.parseEnum(i,pn),!0;case"slideouttype":return t.slideOutType=E.parseEnum(i,Se),!0;case"vibrato":return t.vibrato=E.parseEnum(i,Ie),!0;case"istiedestination":return t.isTieDestination=i,!0;case"lefthandfinger":return t.leftHandFinger=E.parseEnum(i,se),!0;case"righthandfinger":return t.rightHandFinger=E.parseEnum(i,se),!0;case"trillvalue":return t.trillValue=i,!0;case"trillspeed":return t.trillSpeed=E.parseEnum(i,w),!0;case"durationpercent":return t.durationPercent=i,!0;case"accidentalmode":return t.accidentalMode=E.parseEnum(i,ke),!0;case"dynamics":return t.dynamics=E.parseEnum(i,ie),!0;case"ornament":return t.ornament=E.parseEnum(i,Vt),!0;case"style":return i?(t.style=new SS,_g.fromJson(t.style,i)):t.style=void 0,!0}return t.setProperty(e,i)}}class Tg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Tg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){return"colors"===e&&(t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,ht),st.fromJson(s))}),!0)}}class kg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>kg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("id",t.id),e.set("notes",t.notes.map(i=>vg.toJson(i))),e.set("isempty",t.isEmpty),e.set("whammystyle",t.whammyStyle),e.set("ottava",t.ottava),e.set("islegatoorigin",t.isLegatoOrigin),e.set("duration",t.duration),e.set("automations",t.automations.map(i=>xc.toJson(i))),e.set("dots",t.dots),e.set("fade",t.fade),e.set("lyrics",t.lyrics),e.set("pop",t.pop),e.set("slap",t.slap),e.set("tap",t.tap),e.set("text",t.text),e.set("slashed",t.slashed),e.set("deadslapped",t.deadSlapped),e.set("brushtype",t.brushType),e.set("brushduration",t.brushDuration),e.set("tupletdenominator",t.tupletDenominator),e.set("tupletnumerator",t.tupletNumerator),e.set("iscontinuedwhammy",t.isContinuedWhammy),e.set("whammybartype",t.whammyBarType),null!==t.whammyBarPoints&&e.set("whammybarpoints",t.whammyBarPoints?.map(i=>Ec.toJson(i))),e.set("vibrato",t.vibrato),e.set("chordid",t.chordId),e.set("gracetype",t.graceType),e.set("pickstroke",t.pickStroke),e.set("tremolospeed",t.tremoloSpeed),e.set("crescendo",t.crescendo),e.set("displaystart",t.displayStart),e.set("playbackstart",t.playbackStart),e.set("displayduration",t.displayDuration),e.set("playbackduration",t.playbackDuration),e.set("overridedisplayduration",t.overrideDisplayDuration),e.set("golpe",t.golpe),e.set("dynamics",t.dynamics),e.set("invertbeamdirection",t.invertBeamDirection),e.set("preferredbeamdirection",t.preferredBeamDirection),e.set("beamingmode",t.beamingMode),e.set("wahpedal",t.wahPedal),e.set("barrefret",t.barreFret),e.set("barreshape",t.barreShape),e.set("rasgueado",t.rasgueado),e.set("showtimer",t.showTimer),e.set("timer",t.timer),t.style&&e.set("style",Tg.toJson(t.style)),e}static setProperty(t,e,i){switch(e){case"id":return t.id=i,!0;case"notes":t.notes=[];for(const s of i){const r=new is;vg.fromJson(r,s),t.addNote(r)}return!0;case"isempty":return t.isEmpty=i,!0;case"whammystyle":return t.whammyStyle=E.parseEnum(i,ct),!0;case"ottava":return t.ottava=E.parseEnum(i,we),!0;case"islegatoorigin":return t.isLegatoOrigin=i,!0;case"duration":return t.duration=E.parseEnum(i,w),!0;case"automations":t.automations=[];for(const s of i){const r=new Xt;xc.fromJson(r,s),t.automations.push(r)}return!0;case"dots":return t.dots=i,!0;case"fade":return t.fade=E.parseEnum(i,un),!0;case"lyrics":return t.lyrics=i,!0;case"pop":return t.pop=i,!0;case"slap":return t.slap=i,!0;case"tap":return t.tap=i,!0;case"text":return t.text=i,!0;case"slashed":return t.slashed=i,!0;case"deadslapped":return t.deadSlapped=i,!0;case"brushtype":return t.brushType=E.parseEnum(i,Y),!0;case"brushduration":return t.brushDuration=i,!0;case"tupletdenominator":return t.tupletDenominator=i,!0;case"tupletnumerator":return t.tupletNumerator=i,!0;case"iscontinuedwhammy":return t.isContinuedWhammy=i,!0;case"whammybartype":return t.whammyBarType=E.parseEnum(i,Re),!0;case"whammybarpoints":if(i){t.whammyBarPoints=[];for(const s of i){const r=new V;Ec.fromJson(r,s),t.addWhammyBarPoint(r)}}return!0;case"vibrato":return t.vibrato=E.parseEnum(i,Ie),!0;case"chordid":return t.chordId=i,!0;case"gracetype":return t.graceType=E.parseEnum(i,re),!0;case"pickstroke":return t.pickStroke=E.parseEnum(i,vn),!0;case"tremolospeed":return t.tremoloSpeed=E.parseEnum(i,w)??null,!0;case"crescendo":return t.crescendo=E.parseEnum(i,ii),!0;case"displaystart":return t.displayStart=i,!0;case"playbackstart":return t.playbackStart=i,!0;case"displayduration":return t.displayDuration=i,!0;case"playbackduration":return t.playbackDuration=i,!0;case"overridedisplayduration":return t.overrideDisplayDuration=i,!0;case"golpe":return t.golpe=E.parseEnum(i,Ci),!0;case"dynamics":return t.dynamics=E.parseEnum(i,ie),!0;case"invertbeamdirection":return t.invertBeamDirection=i,!0;case"preferredbeamdirection":return t.preferredBeamDirection=E.parseEnum(i,B)??null,!0;case"beamingmode":return t.beamingMode=E.parseEnum(i,St),!0;case"wahpedal":return t.wahPedal=E.parseEnum(i,Li),!0;case"barrefret":return t.barreFret=i,!0;case"barreshape":return t.barreShape=E.parseEnum(i,Ri),!0;case"rasgueado":return t.rasgueado=E.parseEnum(i,X),!0;case"showtimer":return t.showTimer=i,!0;case"timer":return t.timer=i,!0;case"style":return i?(t.style=new SI,Tg.fromJson(t.style,i)):t.style=void 0,!0}return!1}}class Cg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Cg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){return"colors"===e&&(t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,xh),st.fromJson(s))}),!0)}}class Dg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Dg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("id",t.id),e.set("beats",t.beats.map(i=>kg.toJson(i))),t.style&&e.set("style",Cg.toJson(t.style)),e}static setProperty(t,e,i){switch(e){case"id":return t.id=i,!0;case"beats":t.beats=[];for(const s of i){const r=new Vn;kg.fromJson(r,s),t.addBeat(r)}return!0;case"style":return i?(t.style=new mI,Cg.fromJson(t.style,i)):t.style=void 0,!0}return!1}}class Ng{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Ng.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("ratioposition",t.ratioPosition),e.set("pedaltype",t.pedalType),e}static setProperty(t,e,i){switch(e){case"ratioposition":return t.ratioPosition=i,!0;case"pedaltype":return t.pedalType=E.parseEnum(i,jt),!0}return!1}}class xg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>xg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){return"colors"===e&&(t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,Le),st.fromJson(s))}),!0)}}class Eg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Eg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("id",t.id),e.set("clef",t.clef),e.set("clefottava",t.clefOttava),e.set("voices",t.voices.map(i=>Dg.toJson(i))),e.set("similemark",t.simileMark),e.set("displayscale",t.displayScale),e.set("displaywidth",t.displayWidth),e.set("sustainpedals",t.sustainPedals.map(i=>Ng.toJson(i))),e.set("barlineleft",t.barLineLeft),e.set("barlineright",t.barLineRight),e.set("keysignature",t.keySignature),e.set("keysignaturetype",t.keySignatureType),t.style&&e.set("style",xg.toJson(t.style)),e}static setProperty(t,e,i){switch(e){case"id":return t.id=i,!0;case"clef":return t.clef=E.parseEnum(i,Be),!0;case"clefottava":return t.clefOttava=E.parseEnum(i,we),!0;case"voices":t.voices=[];for(const s of i){const r=new Fi;Dg.fromJson(r,s),t.addVoice(r)}return!0;case"similemark":return t.simileMark=E.parseEnum(i,$t),!0;case"displayscale":return t.displayScale=i,!0;case"displaywidth":return t.displayWidth=i,!0;case"sustainpedals":t.sustainPedals=[];for(const s of i){const r=new Ua;Ng.fromJson(r,s),t.sustainPedals.push(r)}return!0;case"barlineleft":return t.barLineLeft=E.parseEnum(i,pe),!0;case"barlineright":return t.barLineRight=E.parseEnum(i,pe),!0;case"keysignature":return t.keySignature=E.parseEnum(i,De),!0;case"keysignaturetype":return t.keySignatureType=E.parseEnum(i,li),!0;case"style":return i?(t.style=new gI,xg.fromJson(t.style,i)):t.style=void 0,!0}return!1}}class Bg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Bg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("name",t.name),e.set("firstfret",t.firstFret),e.set("strings",t.strings),e.set("barrefrets",t.barreFrets),e.set("showname",t.showName),e.set("showdiagram",t.showDiagram),e.set("showfingering",t.showFingering),e}static setProperty(t,e,i){switch(e){case"name":return t.name=i,!0;case"firstfret":return t.firstFret=i,!0;case"strings":return t.strings=i,!0;case"barrefrets":return t.barreFrets=i,!0;case"showname":return t.showName=i,!0;case"showdiagram":return t.showDiagram=i,!0;case"showfingering":return t.showFingering=i,!0}return!1}}class Pg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Pg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("isstandard",t.isStandard),e.set("name",t.name),e.set("tunings",t.tunings),e}static setProperty(t,e,i){switch(e){case"isstandard":return t.isStandard=i,!0;case"name":return t.name=i,!0;case"tunings":return t.tunings=i,!0}return!1}}class Ig{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Ig.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;if(e.set("bars",t.bars.map(i=>Eg.toJson(i))),null!==t.chords){const i=new Map;e.set("chords",i);for(const[s,r]of t.chords)i.set(s.toString(),Bg.toJson(r))}return e.set("capo",t.capo),e.set("transpositionpitch",t.transpositionPitch),e.set("displaytranspositionpitch",t.displayTranspositionPitch),e.set("stringtuning",Pg.toJson(t.stringTuning)),e.set("showslash",t.showSlash),e.set("shownumbered",t.showNumbered),e.set("showtablature",t.showTablature),e.set("showstandardnotation",t.showStandardNotation),e.set("ispercussion",t.isPercussion),e.set("standardnotationlinecount",t.standardNotationLineCount),e}static setProperty(t,e,i){switch(e){case"bars":t.bars=[];for(const s of i){const r=new vr;Eg.fromJson(r,s),t.addBar(r)}return!0;case"chords":return t.chords=new Map,E.forEach(i,(s,r)=>{const a=new Qr;Bg.fromJson(a,s),t.addChord(r,a)}),!0;case"capo":return t.capo=i,!0;case"transpositionpitch":return t.transpositionPitch=i,!0;case"displaytranspositionpitch":return t.displayTranspositionPitch=i,!0;case"stringtuning":return Pg.fromJson(t.stringTuning,i),!0;case"showslash":return t.showSlash=i,!0;case"shownumbered":return t.showNumbered=i,!0;case"showtablature":return t.showTablature=i,!0;case"showstandardnotation":return t.showStandardNotation=i,!0;case"ispercussion":return t.isPercussion=i,!0;case"standardnotationlinecount":return t.standardNotationLineCount=i,!0}return!1}}class Mg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Mg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("volume",t.volume),e.set("balance",t.balance),e.set("port",t.port),e.set("program",t.program),e.set("primarychannel",t.primaryChannel),e.set("secondarychannel",t.secondaryChannel),e.set("ismute",t.isMute),e.set("issolo",t.isSolo),e}static setProperty(t,e,i){switch(e){case"volume":return t.volume=i,!0;case"balance":return t.balance=i,!0;case"port":return t.port=i,!0;case"program":return t.program=i,!0;case"primarychannel":return t.primaryChannel=i,!0;case"secondarychannel":return t.secondaryChannel=i,!0;case"ismute":return t.isMute=i,!0;case"issolo":return t.isSolo=i,!0}return!1}}class Ag{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Ag.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("elementtype",t.elementType),e.set("staffline",t.staffLine),e.set("noteheaddefault",t.noteHeadDefault),e.set("noteheadhalf",t.noteHeadHalf),e.set("noteheadwhole",t.noteHeadWhole),e.set("techniquesymbol",t.techniqueSymbol),e.set("techniquesymbolplacement",t.techniqueSymbolPlacement),e.set("outputmidinumber",t.outputMidiNumber),e}static setProperty(t,e,i){switch(e){case"elementtype":return t.elementType=i,!0;case"staffline":return t.staffLine=i,!0;case"noteheaddefault":return t.noteHeadDefault=E.parseEnum(i,d),!0;case"noteheadhalf":return t.noteHeadHalf=E.parseEnum(i,d),!0;case"noteheadwhole":return t.noteHeadWhole=E.parseEnum(i,d),!0;case"techniquesymbol":return t.techniqueSymbol=E.parseEnum(i,d),!0;case"techniquesymbolplacement":return t.techniqueSymbolPlacement=E.parseEnum(i,ge),!0;case"outputmidinumber":return t.outputMidiNumber=i,!0}return!1}}class Fg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Fg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){return"colors"===e&&(t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,Nr),st.fromJson(s))}),!0)}}class Lg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Lg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;if(e.set("staves",t.staves.map(i=>Ig.toJson(i))),e.set("playbackinfo",Mg.toJson(t.playbackInfo)),e.set("color",st.toJson(t.color)),e.set("name",t.name),e.set("isvisibleonmultitrack",t.isVisibleOnMultiTrack),e.set("shortname",t.shortName),e.set("defaultsystemslayout",t.defaultSystemsLayout),e.set("systemslayout",t.systemsLayout),void 0!==t.lineBreaks){const i=[];e.set("linebreaks",i);for(const s of t.lineBreaks)i.push(s)}return e.set("percussionarticulations",t.percussionArticulations.map(i=>Ag.toJson(i))),t.style&&e.set("style",Fg.toJson(t.style)),e}static setProperty(t,e,i){switch(e){case"staves":t.staves=[];for(const s of i){const r=new hg;Ig.fromJson(r,s),t.addStaff(r)}return!0;case"playbackinfo":return Mg.fromJson(t.playbackInfo,i),!0;case"color":return t.color=st.fromJson(i),!0;case"name":return t.name=i,!0;case"isvisibleonmultitrack":return t.isVisibleOnMultiTrack=i,!0;case"shortname":return t.shortName=i,!0;case"defaultsystemslayout":return t.defaultSystemsLayout=i,!0;case"systemslayout":return t.systemsLayout=i,!0;case"linebreaks":for(const s of i)t.addLineBreaks(s);return!0;case"percussionarticulations":t.percussionArticulations=[];for(const s of i){const r=new q;Ag.fromJson(r,s),t.percussionArticulations.push(r)}return!0;case"style":return i?(t.style=new _I,Fg.fromJson(t.style,i)):t.style=void 0,!0}return!1}}class Rg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Rg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;if(e.set("hidedynamics",t.hideDynamics),e.set("bracketextendmode",t.bracketExtendMode),e.set("usesystemsignseparator",t.useSystemSignSeparator),e.set("globaldisplaytuning",t.globalDisplayTuning),null!==t.perTrackDisplayTuning){const i=new Map;e.set("pertrackdisplaytuning",i);for(const[s,r]of t.perTrackDisplayTuning)i.set(s.toString(),r)}if(e.set("globaldisplaychorddiagramsontop",t.globalDisplayChordDiagramsOnTop),null!==t.perTrackChordDiagramsOnTop){const i=new Map;e.set("pertrackchorddiagramsontop",i);for(const[s,r]of t.perTrackChordDiagramsOnTop)i.set(s.toString(),r)}if(e.set("singletracktracknamepolicy",t.singleTrackTrackNamePolicy),e.set("multitracktracknamepolicy",t.multiTrackTrackNamePolicy),e.set("firstsystemtracknamemode",t.firstSystemTrackNameMode),e.set("othersystemstracknamemode",t.otherSystemsTrackNameMode),e.set("firstsystemtracknameorientation",t.firstSystemTrackNameOrientation),e.set("othersystemstracknameorientation",t.otherSystemsTrackNameOrientation),e.set("multitrackmultibarrest",t.multiTrackMultiBarRest),null!==t.perTrackMultiBarRest){const i=[];e.set("pertrackmultibarrest",i);for(const s of t.perTrackMultiBarRest)i.push(s)}return e}static setProperty(t,e,i){switch(e){case"hidedynamics":return t.hideDynamics=i,!0;case"bracketextendmode":return t.bracketExtendMode=E.parseEnum(i,Ys),!0;case"usesystemsignseparator":return t.useSystemSignSeparator=i,!0;case"globaldisplaytuning":return t.globalDisplayTuning=i,!0;case"pertrackdisplaytuning":return t.perTrackDisplayTuning=new Map,E.forEach(i,(s,r)=>{t.perTrackDisplayTuning.set(Number.parseInt(r),s)}),!0;case"globaldisplaychorddiagramsontop":return t.globalDisplayChordDiagramsOnTop=i,!0;case"pertrackchorddiagramsontop":return t.perTrackChordDiagramsOnTop=new Map,E.forEach(i,(s,r)=>{t.perTrackChordDiagramsOnTop.set(Number.parseInt(r),s)}),!0;case"singletracktracknamepolicy":return t.singleTrackTrackNamePolicy=E.parseEnum(i,Et),!0;case"multitracktracknamepolicy":return t.multiTrackTrackNamePolicy=E.parseEnum(i,Et),!0;case"firstsystemtracknamemode":return t.firstSystemTrackNameMode=E.parseEnum(i,zn),!0;case"othersystemstracknamemode":return t.otherSystemsTrackNameMode=E.parseEnum(i,zn),!0;case"firstsystemtracknameorientation":return t.firstSystemTrackNameOrientation=E.parseEnum(i,$n),!0;case"othersystemstracknameorientation":return t.otherSystemsTrackNameOrientation=E.parseEnum(i,$n),!0;case"multitrackmultibarrest":return t.multiTrackMultiBarRest=i,!0;case"pertrackmultibarrest":return t.perTrackMultiBarRest=new Set(i),!0}return!1}}class Og{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Og.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("template",t.template),e.set("isvisible",t.isVisible),e.set("textalign",t.textAlign),e}static setProperty(t,e,i){switch(e){case"template":return t.template=i,!0;case"isvisible":return t.isVisible=i,!0;case"textalign":return t.textAlign=E.parseEnum(i,K),!0}return!1}}class Vg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Vg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;{const i=new Map;e.set("headerandfooter",i);for(const[s,r]of t.headerAndFooter)i.set(s.toString(),Og.toJson(r))}{const i=new Map;e.set("colors",i);for(const[s,r]of t.colors)i.set(s.toString(),st.toJson(r))}return e}static setProperty(t,e,i){switch(e){case"headerandfooter":return t.headerAndFooter=new Map,E.forEach(i,(s,r)=>{const a=new gs;Og.fromJson(a,s),t.headerAndFooter.set(E.parseEnum(r,U),a)}),!0;case"colors":return t.colors=new Map,E.forEach(i,(s,r)=>{t.colors.set(E.parseEnum(r,U),st.fromJson(s))}),!0}return!1}}class Hg{static fromJson(t,e){e&&E.forEach(e,(i,s)=>Hg.setProperty(t,s,i))}static toJson(t){if(!t)return null;const e=new Map;return e.set("album",t.album),e.set("artist",t.artist),e.set("copyright",t.copyright),e.set("instructions",t.instructions),e.set("music",t.music),e.set("notices",t.notices),e.set("subtitle",t.subTitle),e.set("title",t.title),e.set("words",t.words),e.set("tab",t.tab),e.set("tempo",t.tempo),e.set("tempolabel",t.tempoLabel),e.set("masterbars",t.masterBars.map(i=>Sg.toJson(i))),e.set("tracks",t.tracks.map(i=>Lg.toJson(i))),e.set("defaultsystemslayout",t.defaultSystemsLayout),e.set("systemslayout",t.systemsLayout),e.set("stylesheet",Rg.toJson(t.stylesheet)),t.style&&e.set("style",Vg.toJson(t.style)),e}static setProperty(t,e,i){switch(e){case"album":return t.album=i,!0;case"artist":return t.artist=i,!0;case"copyright":return t.copyright=i,!0;case"instructions":return t.instructions=i,!0;case"music":return t.music=i,!0;case"notices":return t.notices=i,!0;case"subtitle":return t.subTitle=i,!0;case"title":return t.title=i,!0;case"words":return t.words=i,!0;case"tab":return t.tab=i,!0;case"tempo":return t.tempo=i,!0;case"tempolabel":return t.tempoLabel=i,!0;case"masterbars":t.masterBars=[];for(const s of i){const r=new Cr;Sg.fromJson(r,s),t.addMasterBar(r)}return!0;case"tracks":t.tracks=[];for(const s of i){const r=new Wo;Lg.fromJson(r,s),t.addTrack(r)}return!0;case"defaultsystemslayout":return t.defaultSystemsLayout=i,!0;case"systemslayout":return t.systemsLayout=i,!0;case"stylesheet":return Rg.fromJson(t.stylesheet,i),!0;case"style":return i?(t.style=new Vo,Vg.fromJson(t.style,i)):t.style=void 0,!0}return!1}}class on{static jsonReplacer(t,e){if(e instanceof Map){if("fromEntries"in Object)return Object.fromEntries(e);const i={};for(const[s,r]of e)i[s]=r;return i}return ArrayBuffer.isView(e)?Array.apply([],[e]):e}static scoreToJson(t){const e=on.scoreToJsObject(t);return JSON.stringify(e,on.jsonReplacer)}static jsonToScore(t,e){return on.jsObjectToScore(JSON.parse(t),e)}static scoreToJsObject(t){return Hg.toJson(t)}static jsObjectToScore(t,e){const i=new Dr;return Hg.fromJson(i,t),i.finish(e??new qa),i}static settingsToJson(t){const e=on.settingsToJsObject(t);return JSON.stringify(e,on.jsonReplacer)}static jsonToSettings(t){return on.jsObjectToSettings(JSON.parse(t))}static settingsToJsObject(t){return ja.toJson(t)}static jsObjectToSettings(t){const e=new qa;return ja.fromJson(e,t),e}static jsObjectToMidiFile(t){const e=new Kr;return E.forEach(t,(i,s)=>{switch(s){case"division":e.division=i;break;case"tracks":for(const r of i){const a=on.jsObjectToMidiTrack(r);e.tracks.push(a)}}}),e}static jsObjectToMidiTrack(t){const e=new BS;return E.forEach(t,(i,s)=>{if("events"===s)for(const r of i){const a=on.jsObjectToMidiEvent(r);e.events.push(a)}}),e}static jsObjectToMidiEvent(t){const e=E.getValue(t,"track"),i=E.getValue(t,"tick"),s=E.getValue(t,"type");switch(s){case He.TimeSignature:return new PS(e,i,E.getValue(t,"numerator"),E.getValue(t,"denominatorIndex"),E.getValue(t,"midiClocksPerMetronomeClick"),E.getValue(t,"thirdySecondNodesInQuarter"));case He.AlphaTabRest:return new MS(e,i,E.getValue(t,"channel"));case He.AlphaTabMetronome:return new IS(e,i,E.getValue(t,"metronomeNumerator"),E.getValue(t,"metronomeDurationInTicks"),E.getValue(t,"metronomeDurationInMilliseconds"));case He.NoteOn:return new FS(e,i,E.getValue(t,"channel"),E.getValue(t,"noteKey"),E.getValue(t,"noteVelocity"));case He.NoteOff:return new LS(e,i,E.getValue(t,"channel"),E.getValue(t,"noteKey"),E.getValue(t,"noteVelocity"));case He.ControlChange:return new RS(e,i,E.getValue(t,"channel"),E.getValue(t,"controller"),E.getValue(t,"value"));case He.ProgramChange:return new OS(e,i,E.getValue(t,"channel"),E.getValue(t,"program"));case He.TempoChange:return new VS(i,E.getValue(t,"microSecondsPerQuarterNote"));case He.PitchBend:return new HS(e,i,E.getValue(t,"channel"),E.getValue(t,"value"));case He.PerNotePitchBend:return new WS(e,i,E.getValue(t,"channel"),E.getValue(t,"noteKey"),E.getValue(t,"value"));case He.EndOfTrack:return new US(e,i)}throw new nt(it.Format,`Unknown Midi Event type: ${s}`)}static midiFileToJsObject(t){const e=new Map;e.set("division",t.division);const i=[];for(const s of t.tracks)i.push(on.midiTrackToJsObject(s));return e.set("tracks",i),e}static midiTrackToJsObject(t){const e=new Map,i=[];for(const s of t.events)i.push(on.midiEventToJsObject(s));return e.set("events",i),e}static midiEventToJsObject(t){const e=new Map;switch(e.set("track",t.track),e.set("tick",t.tick),e.set("type",t.type),t.type){case He.TimeSignature:e.set("numerator",t.numerator),e.set("denominatorIndex",t.denominatorIndex),e.set("midiClocksPerMetronomeClick",t.midiClocksPerMetronomeClick),e.set("thirdySecondNodesInQuarter",t.thirtySecondNodesInQuarter);break;case He.AlphaTabRest:e.set("channel",t.channel);break;case He.AlphaTabMetronome:e.set("metronomeNumerator",t.metronomeNumerator),e.set("metronomeDurationInMilliseconds",t.metronomeDurationInMilliseconds),e.set("metronomeDurationInTicks",t.metronomeDurationInTicks);break;case He.NoteOn:case He.NoteOff:e.set("channel",t.channel),e.set("noteKey",t.noteKey),e.set("noteVelocity",t.noteVelocity);break;case He.ControlChange:e.set("channel",t.channel),e.set("controller",t.controller),e.set("value",t.value);break;case He.ProgramChange:e.set("channel",t.channel),e.set("program",t.program);break;case He.TempoChange:e.set("microSecondsPerQuarterNote",t.microSecondsPerQuarterNote);break;case He.PitchBend:e.set("channel",t.channel),e.set("value",t.value);break;case He.PerNotePitchBend:e.set("channel",t.channel),e.set("noteKey",t.noteKey),e.set("value",t.value)}return e}}class kt{constructor(){this.ready=new Cn,this.samplesPlayed=new qe,this.sampleRequest=new Cn}get sampleRate(){return kt.preferredSampleRate}open(){x.debug("AlphaSynth","Initializing synth worker"),this._worker=N.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(t){const e=t.data;switch(e.cmd){case kt.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case kt.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(e.samples)}}addSamples(t){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:t})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}enumerateOutputDevices(){return qi(function*(){return[]})()}setOutputDevice(t){return qi(function*(){})()}getOutputDevice(){return qi(function*(){return null})()}}kt.CmdOutputPrefix="alphaSynth.output.",kt.CmdOutputAddSamples=`${kt.CmdOutputPrefix}addSamples`,kt.CmdOutputPlay=`${kt.CmdOutputPrefix}play`,kt.CmdOutputPause=`${kt.CmdOutputPrefix}pause`,kt.CmdOutputResetSamples=`${kt.CmdOutputPrefix}resetSamples`,kt.CmdOutputStop=`${kt.CmdOutputPrefix}stop`,kt.CmdOutputSampleRequest=`${kt.CmdOutputPrefix}sampleRequest`,kt.CmdOutputSamplesPlayed=`${kt.CmdOutputPrefix}samplesPlayed`,kt.preferredSampleRate=0;class JS{constructor(t,e){this._main=t,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new WI(new kt,e),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){const t=N.globalThis;t.addEventListener("message",e=>{const i=e.data;"alphaSynth.initialize"===i.cmd&&(kt.preferredSampleRate=i.sampleRate,x.logLevel=i.logLevel,N.globalThis.alphaSynthWebWorker=new JS(t,i.bufferTimeInMilliseconds))})}handleMessage(t){const e=t.data;switch(e.cmd){case"alphaSynth.setLogLevel":x.logLevel=e.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=e.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=e.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=e.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=e.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=e.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=e.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=e.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=e.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=e.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(on.jsObjectToMidiFile(e.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(e.data,e.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(on.jsObjectToMidiFile(e.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(e.channel,e.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(e.channel,e.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(e.channel,e.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(e.channel,e.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(e.transpositionPitches)))}}onPositionChanged(t){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:t.currentTime,endTime:t.endTime,currentTick:t.currentTick,endTick:t.endTick,isSeek:t.isSeek})}onPlayerStateChanged(t){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:t.state,stopped:t.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(t){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(t)})}serializeException(t){const e=JSON.parse(JSON.stringify(t));return t.message&&(e.message=t.message),t.stack&&(e.stack=t.stack),t.constructor&&t.constructor.name&&(e.type=t.constructor.name),e}onMidiLoaded(t){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:t.currentTime,endTime:t.endTime,currentTick:t.currentTick,endTick:t.endTick,isSeek:t.isSeek})}onMidiLoadFailed(t){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(t)})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(t){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:t.events.map(on.midiEventToJsObject)})}onPlaybackRangeChanged(t){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:t.playbackRange})}}var Ui=function(n){return n[n.Browser=0]="Browser",n[n.NodeJs=1]="NodeJs",n[n.BrowserModule=2]="BrowserModule",n}(Ui||{});class QS{constructor(t,e){this.characterWidths=t,this.fontSizeToHeight=e}}class ri{static generateFontLookup(t){if(!ri.FontSizeLookupTables.has(t))if(N.isRunningInWorker||N.webPlatform===Ui.NodeJs){const e=new QS(new Uint8Array([8]),1.2);ri.FontSizeLookupTables.set(t,e)}else{const i=document.createElement("canvas").getContext("2d"),s=11;i.font=`${s}px ${t}`;const r=[];let a="";for(let f=ri.ControlChars;f<255;f++){const p=String.fromCharCode(f);a+=p;const g=i.measureText(p);r.push(g.width)}const o=i.measureText(`${a}\xc4\xd6\xdc\xc1\xc8`),l=0-Math.abs(o.fontBoundingBoxAscent),u=0+Math.abs(o.fontBoundingBoxDescent)-l,h=new QS(new Uint8Array(r),u/s);ri.FontSizeLookupTables.set(t,h)}}static measureString(t,e,i,s,r){let a,l=e[0];for(let h=0;h<e.length;h++)if(ri.FontSizeLookupTables.has(e[h])){l=e[h];break}ri.FontSizeLookupTables.has(l)||ri.generateFontLookup(l),a=ri.FontSizeLookupTables.get(l);let c=1;s===Tt.Italic&&(c*=1.1),r===Wi.Bold&&(c*=1.1);let u=0;for(let h=0;h<t.length;h++){const f=Math.min(a.characterWidths.length-1,t.charCodeAt(h)-ri.ControlChars);f>=0&&(u+=a.characterWidths[f]*i/11)}return c*=1.07,new Eh(u*c,i*a.fontSizeToHeight)}}ri.FontSizeLookupTables=new Map,ri.ControlChars=32;class na{constructor(){this.id=H.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class KS{constructor(){this.beats=[]}addBeat(t){t.barBounds=this,this.beats.push(t),this.masterBarBounds.addBeat(t)}findBeatAtPos(t){let e=null;for(const i of this.beats)if(!e||i.realBounds.x<t)e=i;else if(i.realBounds.x>t)break;return e}finish(t=1){this.realBounds.scaleWith(t),this.visualBounds.scaleWith(t),this.beats.sort((e,i)=>e.realBounds.x-i.realBounds.x);for(const e of this.beats)e.finish(t)}}class ZS{constructor(){this.onNotesX=0,this.notes=null}addNote(t){this.notes||(this.notes=[]),t.beatBounds=this,this.notes.push(t)}findNoteAtPos(t,e){const i=this.notes;if(!i)return null;for(const s of i)if(s.noteHeadBounds.x<=t&&s.noteHeadBounds.y<=e&&t<=s.noteHeadBounds.x+s.noteHeadBounds.w&&e<=s.noteHeadBounds.y+s.noteHeadBounds.h)return s.note;return null}finish(t=1){if(this.realBounds.scaleWith(t),this.visualBounds.scaleWith(t),this.onNotesX*=t,this.notes)for(const e of this.notes)e.finish(t)}}class e_{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(t){t.masterBarBounds=this,this.bars.push(t)}findBeatAtPos(t,e){let i=null;for(const r of this.bars){const a=r.findBeatAtPos(t);if(a&&(!i||i.realBounds.x<a.realBounds.x)){const o=Math.abs(a.realBounds.x-t);(!i||o<1e7)&&(i=a)}}return i?i.beat:null}finish(t=1){this.realBounds.scaleWith(t),this.visualBounds.scaleWith(t),this.lineAlignedBounds.scaleWith(t),this.bars.sort((e,i)=>e.realBounds.y<i.realBounds.y?-1:e.realBounds.y>i.realBounds.y?1:e.realBounds.x<i.realBounds.x?-1:e.realBounds.x>i.realBounds.x?1:0);for(const e of this.bars)e.finish(t)}addBeat(t){this.staffSystemBounds.boundsLookup.addBeat(t)}}class Bc{finish(t=1){this.noteHeadBounds.scaleWith(t)}}class t_{constructor(){this.index=0,this.bars=[]}finish(t=1){this.realBounds.scaleWith(t),this.visualBounds.scaleWith(t);for(const e of this.bars)e.finish(t)}addBar(t){this.boundsLookup.addMasterBar(t),t.staffSystemBounds=this,this.bars.push(t)}findBarAtPos(t){let e=null;for(const i of this.bars)if(!e||i.realBounds.x<t)e=i;else if(t>i.realBounds.x+i.realBounds.w)break;return e}}class Di{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){const t={},e=[];t.staffSystems=e;for(const i of this.staffSystems){const s={};s.visualBounds=this.boundsToJson(i.visualBounds),s.realBounds=this.boundsToJson(i.realBounds),s.bars=[];for(const r of i.bars){const a={};a.lineAlignedBounds=this.boundsToJson(r.lineAlignedBounds),a.visualBounds=this.boundsToJson(r.visualBounds),a.realBounds=this.boundsToJson(r.realBounds),a.index=r.index,a.bars=[];for(const o of r.bars){const l={};l.visualBounds=this.boundsToJson(o.visualBounds),l.realBounds=this.boundsToJson(o.realBounds),l.beats=[];for(const c of o.beats){const u={};u.visualBounds=this.boundsToJson(c.visualBounds),u.realBounds=this.boundsToJson(c.realBounds),u.onNotesX=c.onNotesX;const h=u;if(h.beatIndex=c.beat.index,h.voiceIndex=c.beat.voice.index,h.barIndex=c.beat.voice.bar.index,h.staffIndex=c.beat.voice.bar.staff.index,h.trackIndex=c.beat.voice.bar.staff.track.index,c.notes){const f=[];u.notes=f;for(const p of c.notes){const g={};g.index=p.note.index,g.noteHeadBounds=this.boundsToJson(p.noteHeadBounds),f.push(g)}}l.beats.push(u)}a.bars.push(l)}s.bars.push(a)}e.push(s)}return t}static fromJson(t,e){const i=new Di,s=t.staffSystems;for(const r of s){const a=new t_;a.visualBounds=Di.boundsFromJson(r.visualBounds),a.realBounds=Di.boundsFromJson(r.realBounds),i.addStaffSystem(a);for(const o of r.bars){const l=new e_;l.index=o.index,l.isFirstOfLine=o.isFirstOfLine,l.lineAlignedBounds=Di.boundsFromJson(o.lineAlignedBounds),l.visualBounds=Di.boundsFromJson(o.visualBounds),l.realBounds=Di.boundsFromJson(o.realBounds),a.addBar(l);for(const c of o.bars){const u=new KS;u.visualBounds=Di.boundsFromJson(c.visualBounds),u.realBounds=Di.boundsFromJson(c.realBounds),l.addBar(u);for(const h of c.beats){const f=new ZS;if(f.visualBounds=Di.boundsFromJson(h.visualBounds),f.realBounds=Di.boundsFromJson(h.realBounds),f.onNotesX=h.onNotesX,f.beat=e.tracks[h.trackIndex].staves[h.staffIndex].bars[h.barIndex].voices[h.voiceIndex].beats[h.beatIndex],h.notes){f.notes=[];for(const g of h.notes){const m=new Bc;m.note=f.beat.notes[g.index],m.noteHeadBounds=Di.boundsFromJson(g.noteHeadBounds),f.addNote(m)}}u.addBeat(f)}}}}return i}static boundsFromJson(t){const e=new kn;return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e}boundsToJson(t){const e={};return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e}finish(t=1){for(const e of this.staffSystems)e.finish(t);this.isFinished=!0}addStaffSystem(t){t.index=this.staffSystems.length,t.boundsLookup=this,this.staffSystems.push(t),this._currentStaffSystem=t}addMasterBar(t){t.staffSystemBounds?this._masterBarLookup.set(t.index,t):(t.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(t.index,t),this._currentStaffSystem.addBar(t))}addBeat(t){this._beatLookup.has(t.beat.id)||this._beatLookup.set(t.beat.id,[]),this._beatLookup.get(t.beat.id)?.push(t)}findMasterBarByIndex(t){return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findMasterBar(t){const e=t.index;return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findBeat(t){const e=this.findBeats(t);return e?e[0]:null}findBeats(t){const e=t.id;return this._beatLookup.has(e)?this._beatLookup.get(e):null}getBeatAtPos(t,e){let i=0,s=this.staffSystems.length-1,r=-1;for(;i<=s;){const l=(s+i)/2|0,c=this.staffSystems[l];if(e>=c.realBounds.y&&e<=c.realBounds.y+c.realBounds.h){r=l;break}e<c.realBounds.y?s=l-1:i=l+1}if(-1===r)return null;const o=this.staffSystems[r].findBarAtPos(t);return o?o.findBeatAtPos(t,e):null}getNoteAtPos(t,e,i){const s=this.findBeats(t);if(s)for(const r of s){const a=r.findNoteAtPos(e,i);if(a)return a}return null}}class n_{constructor(t){this._currentLayoutMode=Wa.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new qe,this.renderFinished=new qe,this.partialRenderFinished=new qe,this.partialLayoutFinished=new qe,this.postRenderFinished=new Cn,this.error=new qe,this.settings=t,this.recreateCanvas(),this.recreateLayout()}destroy(){this.score=null,this.canvas?.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){return this._currentRenderEngine!==this.settings.core.engine&&(this.canvas?.destroy(),this.canvas=N.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0)}recreateLayout(){return!(this.layout&&this._currentLayoutMode===this.settings.display.layoutMode||(this.layout=N.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,0))}renderScore(t,e){try{this.score=t;let i=null;if(null!=t&&null!=e){if(e){i=[];for(const s of e)s>=0&&s<t.tracks.length&&i.push(t.tracks[s])}else i=t.tracks.slice(0);0===i.length&&t.tracks.length>0&&i.push(t.tracks[0])}this.tracks=i,this.render()}catch(i){this.error.trigger(i)}}renderTracks(t){this.score=0===t.length?null:t[0].score,this.tracks=t,this.render()}updateSettings(t){this.settings=t}renderResult(t){try{const e=this.layout;e?(x.debug("Rendering",`Request render of lazy partial ${t}`),e.renderLazyPartial(t)):x.warning("Rendering",`Request render of lazy partial ${t} ignored, no layout exists`)}catch(e){this.error.trigger(e)}}render(){if(0!==this.width)if(this.boundsLookup=new Di,this.recreateCanvas(),this.canvas.lineWidth=1,this.canvas.settings=this.settings,this.tracks&&0!==this.tracks.length&&this.score){x.debug("Rendering",`Rendering ${this.tracks.length} tracks`);for(let t=0;t<this.tracks.length;t++)x.debug("Rendering",`Track ${t}: ${this.tracks[t].name}`);this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),x.debug("Rendering","Rendering finished")}else x.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),x.debug("Rendering","Clearing finished");else x.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null)}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(x.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(x.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new Di,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):x.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),x.debug("Rendering","Resize finished")}layoutAndRender(){x.debug("Rendering",`Rendering at scale ${this.settings.display.scale} with layout ${this.layout.name}`,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){this.boundsLookup?.finish(this.settings.display.scale);const t=new na;t.totalHeight=this.layout.height,t.totalWidth=this.layout.width,t.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(t)}}class i_{constructor(t){this._main=t,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){N.globalThis.alphaTabWebWorker=new i_(N.globalThis)}handleMessage(t){const e=t.data;switch(e?e.cmd:""){case"alphaTab.initialize":const s=on.jsObjectToSettings(e.settings);x.logLevel=s.core.logLevel,this._renderer=new n_(s),this._renderer.partialRenderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:a})}),this._renderer.partialLayoutFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:a})}),this._renderer.renderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:a})}),this._renderer.postRenderFinished.on(()=>{this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:this._renderer.boundsLookup?.toJson()??null})}),this._renderer.preRender.on(a=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:a})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(e.resultId);break;case"alphaTab.setWidth":this._renderer.width=e.width;break;case"alphaTab.renderScore":this.updateFontSizes(e.fontSizes);const r=null==e.score?null:on.jsObjectToScore(e.score,this._renderer.settings);this.renderMultiple(r,e.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(e.settings)}}updateFontSizes(t){if(!(t instanceof Map)){const e=t;t=new Map;for(const i in e)t.set(i,e[i])}if(t){ri.FontSizeLookupTables||(ri.FontSizeLookupTables=new Map);for(const[e,i]of t)ri.FontSizeLookupTables.set(e,i)}}updateSettings(t){ja.fromJson(this._renderer.settings,t)}renderMultiple(t,e){try{this._renderer.renderScore(t,e)}catch(i){this.error(i)}}error(t){x.error("Worker","An unexpected error occurred in worker",t),this._main.postMessage({cmd:"alphaTab.error",error:t})}}class V9{constructor(){this._canvas=null,this._color=new st(0,0,0,255),this._font=new ve("Arial",10,Tt.Plain),this._lineWidth=0;const t=document.createElement("span");t.classList.add("at"),document.body.appendChild(t);const e=window.getComputedStyle(t);let i=e.fontFamily;(i.startsWith('"')||i.startsWith("'"))&&(i=i.substr(1,i.length-2)),this._musicFont=new ve(i,Number.parseFloat(e.fontSize),Tt.Plain),this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(t,e){const i=this.settings.display.scale;this._canvas=document.createElement("canvas"),this._canvas.width=t*N.HighDpiFactor|0,this._canvas.height=e*N.HighDpiFactor|0,this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`,this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(N.HighDpiFactor*i,N.HighDpiFactor*i),this._context.lineWidth=this._lineWidth}endRender(){const t=this._canvas;return this._canvas=null,t}get color(){return this._color}set color(t){this._color.rgba!==t.rgba&&(this._color=t,this._context.strokeStyle=t.rgba,this._context.fillStyle=t.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._context&&(this._context.lineWidth=t)}fillRect(t,e,i,s){i>0&&this._context.fillRect(0|t,0|e,i,s)}strokeRect(t,e,i,s){const r=this.lineWidth%2==0?0:.5;this._context.strokeRect((0|t)+r,(0|e)+r,i,s)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(t,e){this._context.moveTo(t,e)}lineTo(t,e){this._context.lineTo(t,e)}quadraticCurveTo(t,e,i,s){this._context.quadraticCurveTo(t,e,i,s)}bezierCurveTo(t,e,i,s,r,a){this._context.bezierCurveTo(t,e,i,s,r,a)}fillCircle(t,e,i){this._context.beginPath(),this._context.arc(t,e,i,0,2*Math.PI,!0),this.fill()}strokeCircle(t,e,i){this._context.beginPath(),this._context.arc(t,e,i,0,2*Math.PI,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(t){this._font=t,this._context&&(this._context.font=t.toCssString(1)),this._measureContext.font=t.toCssString(1)}get textAlign(){switch(this._context.textAlign){case"left":default:return K.Left;case"center":return K.Center;case"right":return K.Right}}set textAlign(t){switch(t){case K.Left:this._context.textAlign="left";break;case K.Center:this._context.textAlign="center";break;case K.Right:this._context.textAlign="right"}}get textBaseline(){switch(this._context.textBaseline){case"hanging":default:return ge.Top;case"middle":return ge.Middle;case"bottom":return ge.Bottom}}set textBaseline(t){switch(t){case ge.Top:this._context.textBaseline="hanging";break;case ge.Middle:this._context.textBaseline="middle";break;case ge.Bottom:this._context.textBaseline="bottom"}}beginGroup(t){}endGroup(){}fillText(t,e,i){this._context.fillText(t,e,i)}measureText(t){const e=this._measureContext.measureText(t);return new Eh(e.width,e.actualBoundingBoxDescent+e.actualBoundingBoxAscent)}fillMusicFontSymbol(t,e,i,s,r=!1){s!==d.None&&this.fillMusicFontSymbolText(t,e,i,String.fromCharCode(s),r)}fillMusicFontSymbols(t,e,i,s,r=!1){let a="";for(const o of s)o!==d.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(t,e,i,a,r)}fillMusicFontSymbolText(t,e,i,s,r){const a=this._context.textAlign,o=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(i),this._context.textBaseline="middle",this._context.textAlign=r?"center":"left",this._context.fillText(s,t,e),this._context.textBaseline=o,this._context.font=l,this._context.textAlign=a}beginRotate(t,e,i){this._context.save(),this._context.translate(t,e),this._context.rotate(i*Math.PI/180)}endRotate(){this._context.restore()}}class Ks{constructor(t,e=!1){this._midiFile=t,this._smf1Mode=e}addTimeSignature(t,e,i){let s=0,r=i;for(;r>>=1,r>0;)s++;this._midiFile.addEvent(new PS(0,t,e,s,48,8))}addRest(t,e,i){this._smf1Mode||this._midiFile.addEvent(new MS(t,e,i))}addNote(t,e,i,s,r,a){this._midiFile.addEvent(new FS(t,e,a,Ks.fixValue(s),Ks.fixValue(r))),this._midiFile.addEvent(new LS(t,e+i,a,Ks.fixValue(s),Ks.fixValue(r)))}static fixValue(t){return t>127?127:t<0?0:t}addControlChange(t,e,i,s,r){this._midiFile.addEvent(new RS(t,e,i,s,Ks.fixValue(r)))}addProgramChange(t,e,i,s){this._midiFile.addEvent(new OS(t,e,i,s))}addTempo(t,e){this._midiFile.addEvent(new VS(t,6e7/e|0))}addBend(t,e,i,s){s=s>=he.MaxPitchWheel?he.MaxPitchWheel:Math.floor(s),this._midiFile.addEvent(new HS(t,e,i,s))}addNoteBend(t,e,i,s,r){this._smf1Mode?this.addBend(t,e,i,r):this._midiFile.addEvent(new WS(t,e,i,s,r=r*he.MaxPitchWheel20/he.MaxPitchWheel))}finishTrack(t,e){(this._midiFile.format===Cc.MultiTrack||0===t)&&this._midiFile.addEvent(new US(t,e))}}class H9{constructor(t,e){this.closingIndex=0,this.group=t,this.opening=e,t.closings=t.closings.sort((i,s)=>i.index-s.index),this.iterations=t.closings.map(i=>0)}}var Dn=function(n){return n[n.PlayingNormally=0]="PlayingNormally",n[n.DirectionJumped=1]="DirectionJumped",n[n.DirectionJumpedAlCoda=2]="DirectionJumpedAlCoda",n[n.DirectionJumpedAlDoubleCoda=3]="DirectionJumpedAlDoubleCoda",n[n.DirectionJumpedAlFine=4]="DirectionJumpedAlFine",n}(Dn||{});class W9{get finished(){return this.index>=this._score.masterBars.length}constructor(t){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this._state=Dn.PlayingNormally,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=t}processCurrent(){const t=this._score.masterBars[this.index];if(this._state===Dn.PlayingNormally){let e=t.alternateEndings;if(0===e&&(e=this._previousAlternateEndings),t===t.repeatGroup.opening&&t.repeatGroup.isClosed&&!this._groupsOnStack.has(t.repeatGroup)){const i=new H9(t.repeatGroup,t);this._repeatStack.push(i),this._groupsOnStack.add(t.repeatGroup),this._previousAlternateEndings=0,e=t.alternateEndings}if(0===this._repeatStack.length||0===e)this.shouldPlay=!0;else{const i=this._repeatStack[this._repeatStack.length-1],s=i.iterations[i.closingIndex];this._previousAlternateEndings=e,this.shouldPlay=!!(e&1<<s)}}else this.shouldPlay=!0;this.shouldPlay&&(this.currentTick+=t.calculateDuration())}moveNext(){this.moveNextWithDirections()||this.moveNextWithNormalRepeats()}resetRepeats(){this._groupsOnStack.clear(),this._previousAlternateEndings=0,this._repeatStack=[]}handleDaCapo(t,e,i){return!!t.has(e)&&(this.index=0,this._state=i,this.resetRepeats(),!0)}handleDalSegno(t,e,i,s){if(t.has(e)){const r=this.findJumpTarget(s,this.index,!0);return-1!==r&&(this.index=r,this._state=i,this.resetRepeats(),!0)}return!1}handleDaCoda(t,e,i){if(t.has(e)){const s=this.findJumpTarget(i,this.index,!1);return-1===s?(this.index++,!0):(this.index=s,this._state=Dn.PlayingNormally,!0)}return!1}moveNextWithDirections(){const t=this._score.masterBars[this.index],e=null!==t.directions&&t.directions.size>0;if(this._state===Dn.PlayingNormally&&!e)return!1;if(!e)return this.index++,!0;switch(this._state){case Dn.PlayingNormally:return!!(this.handleDaCapo(t.directions,A.JumpDaCapo,Dn.DirectionJumped)||this.handleDaCapo(t.directions,A.JumpDaCapoAlCoda,Dn.DirectionJumpedAlCoda)||this.handleDaCapo(t.directions,A.JumpDaCapoAlDoubleCoda,Dn.DirectionJumpedAlDoubleCoda)||this.handleDaCapo(t.directions,A.JumpDaCapoAlFine,Dn.DirectionJumpedAlFine)||this.handleDalSegno(t.directions,A.JumpDalSegno,Dn.DirectionJumped,A.TargetSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoAlCoda,Dn.DirectionJumpedAlCoda,A.TargetSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoAlDoubleCoda,Dn.DirectionJumpedAlDoubleCoda,A.TargetSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoAlFine,Dn.DirectionJumpedAlFine,A.TargetSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoSegno,Dn.DirectionJumped,A.TargetSegnoSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoSegnoAlCoda,Dn.DirectionJumpedAlCoda,A.TargetSegnoSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoSegnoAlDoubleCoda,Dn.DirectionJumpedAlDoubleCoda,A.TargetSegnoSegno)||this.handleDalSegno(t.directions,A.JumpDalSegnoSegnoAlFine,Dn.DirectionJumpedAlFine,A.TargetSegnoSegno));case Dn.DirectionJumped:return this.index++,!0;case Dn.DirectionJumpedAlCoda:return this.handleDaCoda(t.directions,A.JumpDaCoda,A.TargetCoda)||this.index++,!0;case Dn.DirectionJumpedAlDoubleCoda:return this.handleDaCoda(t.directions,A.JumpDaDoubleCoda,A.TargetDoubleCoda)||this.index++,!0;case Dn.DirectionJumpedAlFine:return t.directions.has(A.TargetFine)?(this.index=this._score.masterBars.length,!0):(this.index++,!0)}return!0}findJumpTarget(t,e,i){let s;return i?(s=this.findJumpTargetBackwards(t,e),-1===s&&(s=this.findJumpTargetForwards(t,e)),s):(s=this.findJumpTargetForwards(t,e),-1===s&&(s=this.findJumpTargetBackwards(t,e)),s)}findJumpTargetForwards(t,e){let i=e;for(;i<this._score.masterBars.length;){const s=this._score.masterBars[i].directions;if(s&&s.has(t))return i;i++}return-1}findJumpTargetBackwards(t,e){let i=e;for(;i>=0;){const s=this._score.masterBars[i].directions;if(s&&s.has(t))return i;i--}return-1}moveNextWithNormalRepeats(){const e=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&e>0){const i=this._repeatStack[this._repeatStack.length-1];if(i.iterations[i.closingIndex]<e){this.index=i.opening.index,i.iterations[i.closingIndex]++;for(let r=0;r<i.closingIndex;r++)i.iterations[r]=0;i.closingIndex=0,this._previousAlternateEndings=0}else i.closingIndex<i.group.closings.length-1?(i.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(i.group),this.index++)}else this.index++}}class UI{constructor(t,e){this.beat=t,this.playbackStart=e}}class ms{get duration(){return this.end-this.start}constructor(t,e){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=t,this.end=e}highlightBeat(t,e){t.isEmpty&&!t.voice.isEmpty||this._highlightedBeats.has(t.id)||(this._highlightedBeats.set(t.id,!0),this.highlightedBeats.push(new UI(t,e)))}getVisibleBeatAtStart(t){for(const e of this.highlightedBeats)if(e.playbackStart===this.start&&t.has(e.beat.voice.bar.staff.track.index))return e.beat;return null}}class Yh{constructor(t,e){this.tick=t,this.tempo=e}}class s_{constructor(){this.start=0,this.end=0,this.tempoChanges=[],this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}get tempo(){return this.tempoChanges[0].tempo}insertAfter(t,e){null==this.firstBeat||null==t||null==this.lastBeat?(this.firstBeat=e,this.lastBeat=e):(e.nextBeat=t.nextBeat,e.previousBeat=t,t.nextBeat&&(t.nextBeat.previousBeat=e),t.nextBeat=e,t===this.lastBeat&&(this.lastBeat=e))}insertBefore(t,e){null==this.firstBeat||null==t||null==this.lastBeat?(this.firstBeat=e,this.lastBeat=e):(e.previousBeat=t.previousBeat,e.nextBeat=t,t.previousBeat&&(t.previousBeat.nextBeat=e),t.previousBeat=e,t===this.firstBeat&&(this.firstBeat=e))}addBeat(t,e,i,s){const r=i+s;if(null==this.firstBeat){const a=new ms(i,r);a.highlightBeat(t,e),this.insertAfter(this.firstBeat,a)}else if(i>=this.lastBeat.end){const a=new ms(this.lastBeat.end,r);a.highlightBeat(t,e),this.insertAfter(this.lastBeat,a)}else{let a=null;if(i<this.firstBeat.start)a=this.firstBeat;else{let o=this.firstBeat;for(;null!=o;){if(i>=o.start&&i<o.end){a=o;break}o=o.nextBeat}if(null===a)throw new nt(it.General,"Error on building lookup, unknown variant")}if(i<a.start)if(r===a.start){const o=new ms(i,a.start);o.highlightBeat(t,e),this.insertBefore(this.firstBeat,o)}else if(r<a.end){const o=new ms(i,a.start);o.highlightBeat(t,e),this.insertBefore(a,o);const l=new ms(a.start,r);for(const c of a.highlightedBeats)l.highlightBeat(c.beat,c.playbackStart);l.highlightBeat(t,e),this.insertBefore(a,l),a.start=r}else if(r===a.end){const o=new ms(i,a.start);o.highlightBeat(t,e),a.highlightBeat(t,e),this.insertBefore(a,o)}else{const o=new ms(i,a.start);o.highlightBeat(t,e),a.highlightBeat(t,e),this.insertBefore(a,o),this.addBeat(t,e,a.end,r-a.end)}else if(i>a.start)if(r===a.end){const o=new ms(a.start,i);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=i,a.highlightBeat(t,e),this.insertBefore(a,o)}else if(r<a.end){const o=new ms(a.start,i);this.insertBefore(a,o);const l=new ms(i,r);this.insertBefore(a,l);for(const c of a.highlightedBeats)o.highlightBeat(c.beat,c.playbackStart),l.highlightBeat(c.beat,c.playbackStart);l.highlightBeat(t,e),a.start=r}else{const o=new ms(a.start,i);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=i,a.highlightBeat(t,e),this.insertBefore(a,o),this.addBeat(t,e,a.end,r-a.end)}else if(r===a.end)a.highlightBeat(t,e);else if(r<a.end){const o=new ms(a.start,r);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);o.highlightBeat(t,e),a.start=r,this.insertBefore(a,o)}else a.highlightBeat(t,e),this.addBeat(t,e,a.end,r-a.end)}}}var Ps=function(n){return n[n.Unknown=0]="Unknown",n[n.ToNextBext=1]="ToNextBext",n[n.ToEndOfBar=2]="ToEndOfBar",n}(Ps||{});class GI{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(t){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.cursorMode=Ps.Unknown,this.masterBar=t}calculateDuration(){if(1===this.masterBar.tempoChanges.length)this.duration=P.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let t=0,e=this.start,i=this.masterBar.tempoChanges[0].tempo;const s=this.end;for(const r of this.masterBar.tempoChanges)if(r.tick<e)i=r.tempo;else{if(r.tick>s)break;t+=P.ticksToMillis(r.tick-e,i),i=r.tempo,e=r.tick}s>e&&(t+=P.ticksToMillis(s-e,i)),this.duration=t}}}class zI{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[],this.multiBarRestInfo=null}findBeat(t,e,i=null){let s=null;return i&&(s=this.findBeatFast(t,i,e)),s||(s=this.findBeatSlow(t,i,e,!1)),s}findBeatFast(t,e,i){if(i>=e.start&&i<e.end)return e;if(e.nextBeat&&i>=e.nextBeat.start&&i<e.nextBeat.end){const s=e.nextBeat;return this.fillNextBeat(s,t),s}return null}fillNextBeatMultiBarRest(t,e){const i=this.multiBarRestInfo.get(t.masterBar.masterBar.index);let s=t.masterBar;for(let r=0;r<i.length&&s;r++)s=s.nextMasterBar;s?s.nextMasterBar?(t.nextBeat=this.firstBeatInMasterBar(e,s.nextMasterBar,s.nextMasterBar.start,!0),t.nextBeat?(t.tickDuration=t.nextBeat.start-t.start,t.cursorMode=Ps.ToNextBext,t.nextBeat.masterBar.masterBar.index!==s.masterBar.index+1&&(t.nextBeat.masterBar.masterBar.index!==s.masterBar.index||t.nextBeat.beat.playbackStart<=t.beat.playbackStart)&&(t.cursorMode=Ps.ToEndOfBar)):(t.tickDuration=s.nextMasterBar.end-t.start,t.cursorMode=Ps.ToEndOfBar)):(t.tickDuration=s.end-t.start,t.cursorMode=Ps.ToEndOfBar):(x.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain fill-next)"),t.tickDuration=(t.masterBar.end-t.masterBar.start)*(i.length+1),t.cursorMode=Ps.ToEndOfBar),t.calculateDuration()}fillNextBeat(t,e){this.isMultiBarRestResult(t)?this.fillNextBeatMultiBarRest(t,e):this.fillNextBeatDefault(t,e)}fillNextBeatDefault(t,e){t.nextBeat=this.findBeatInMasterBar(t.masterBar,t.beatLookup.nextBeat,t.end,e,!0),null==t.nextBeat&&(t.nextBeat=this.findBeatSlow(e,t,t.end,!0)),t.nextBeat?(t.tickDuration=t.nextBeat.start-t.start,t.cursorMode=Ps.ToNextBext,t.calculateDuration()):(t.tickDuration=t.masterBar.end-t.start,t.cursorMode=Ps.ToEndOfBar,t.calculateDuration()),t.nextBeat&&t.nextBeat.masterBar.masterBar.index!==t.masterBar.masterBar.index+1&&(t.nextBeat.masterBar.masterBar.index!==t.masterBar.masterBar.index||t.nextBeat.beat.playbackStart<=t.beat.playbackStart)&&(t.cursorMode=Ps.ToEndOfBar)}isMultiBarRestResult(t){return this.internalIsMultiBarRestResult(t.masterBar.masterBar.index,t.beat)}internalIsMultiBarRestResult(t,e){return this.multiBarRestInfo&&this.multiBarRestInfo.has(t)&&e.isRest&&e.voice.bar.isRestOnly}findBeatSlow(t,e,i,s){let r=null;return null!=e&&(e.masterBar.start<=i&&e.masterBar.end>i?r=e.masterBar:e.masterBar.nextMasterBar&&e.masterBar.nextMasterBar.start<=i&&e.masterBar.nextMasterBar.end>i&&(r=e.masterBar.nextMasterBar)),r||(r=this.findMasterBar(i)),r?this.firstBeatInMasterBar(t,r,i,s):null}firstBeatInMasterBar(t,e,i,s){let r=e;for(;r;){if(r.firstBeat){const a=this.findBeatInMasterBar(r,r.firstBeat,i,t,s);if(a)return a}r=r.nextMasterBar}return null}findBeatInMasterBar(t,e,i,s,r){if(!e)return null;let a=null,o=null;const l=i-t.start;for(;null!=e&&null==o;){if((e.start<=l||r&&l<0)&&l<e.end){if(a=e,o=e.getVisibleBeatAtStart(s),!o)if(r){let u=t;for(;null!=u&&null==o;){for(;null!=e;){if(o=e.getVisibleBeatAtStart(s),o){a=e,t=u;break}e=e.nextBeat}(!o||!a)&&(u=u.nextMasterBar,e=u?.firstBeat??null)}}else{let u=t;for(;null!=u&&null==o;){for(;null!=e;){if(o=e.getVisibleBeatAtStart(s),o){a=e,t=u;break}e=e.previousBeat}(!o||!a)&&(u=u.previousMasterBar,e=u?.firstBeat??null)}}}else if(e.end>l)break;e=e?.nextBeat??null}return null==o?null:this.createResult(t,a,o,r,s)}createResult(t,e,i,s,r){const a=new GI(t);if(a.beat=i,a.beatLookup=e,a.tickDuration=e.end-e.start,s){if(this.isMultiBarRestResult(a)){const o=this.multiBarRestInfo.get(t.masterBar.index);let l=t;for(let c=0;c<o.length&&l;c++)l=l.nextMasterBar;l?a.tickDuration=l.nextMasterBar?l.nextMasterBar.start-e.start:l.end-e.start:x.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain stretch-result)")}}else this.fillNextBeat(a,r);return a.calculateDuration(),a}findMasterBar(t){const e=this.masterBars;let i=0,s=e.length-1;for(;i<=s;){const r=(s+i)/2|0,a=e[r];if(t>=a.start&&t<a.end)return a;t<a.start?s=r-1:i=r+1}return null}getMasterBar(t){if(!this.masterBarLookup.has(t.index)){const e=new s_;return e.masterBar=t,e}return this.masterBarLookup.get(t.index)}getMasterBarStart(t){return this.masterBarLookup.has(t.index)?this.masterBarLookup.get(t.index).start:0}getBeatStart(t){return this.masterBarLookup.has(t.voice.bar.index)?this.masterBarLookup.get(t.voice.bar.index).start+t.playbackStart:0}addMasterBar(t){this.masterBars.push(t),this._currentMasterBar&&(t.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=t),this._currentMasterBar=t,this.masterBarLookup.has(t.masterBar.index)||this.masterBarLookup.set(t.masterBar.index,t)}addBeat(t,e,i){const s=this._currentMasterBar;if(s)if(e<0&&s.previousMasterBar){const r=s.previousMasterBar.end-s.previousMasterBar.start,a=r+e,o=a+i;s.previousMasterBar.addBeat(t,a,a,i),o>r&&s.addBeat(t,e,0,i+e)}else s.addBeat(t,e,e,i)}}class U9{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class G9{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class z9{constructor(){this.durations=[],this.brushInfos=[]}}class Ne{constructor(t,e,i){this._programsPerChannel=new Map,this._currentTime=0,this._calculatedBeatTimers=new Set,this.tickLookup=new zI,this.applyTranspositionPitches=!0,this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=t,this._settings=e||new qa,this._handler=i}generate(){this.transpositionPitches.clear(),this._calculatedBeatTimers.clear(),this._currentTime=0;for(const s of this._score.tracks)this.generateTrack(s);x.debug("Midi","Begin midi generation");const t=new W9(this._score);let e=null,i=this._score.tempo;for(;!t.finished;){const s=t.index,r=this._score.masterBars[s],a=t.currentTick;if(t.processCurrent(),t.shouldPlay){this.generateMasterBar(r,e,a,i),r.tempoAutomations.length>0&&(i=r.tempoAutomations[0].value);for(const o of this._score.tracks)for(const l of o.staves)s<l.bars.length&&this.generateBar(l.bars[s],a,i);r.tempoAutomations.length>0&&(i=r.tempoAutomations[r.tempoAutomations.length-1].value)}t.moveNext(),e=r}for(const s of this._score.tracks)this._handler.finishTrack(s.index,t.currentTick);x.debug("Midi","Midi generation done")}generateTrack(t){this.generateChannel(t,t.playbackInfo.primaryChannel,t.playbackInfo),t.playbackInfo.primaryChannel!==t.playbackInfo.secondaryChannel&&this.generateChannel(t,t.playbackInfo.secondaryChannel,t.playbackInfo)}addProgramChange(t,e,i,s){(!this._programsPerChannel.has(i)||this._programsPerChannel.get(i)!==s)&&(this._handler.addProgramChange(t.index,e,i,s),this._programsPerChannel.set(i,s))}static buildTranspositionPitches(t,e){const i=new Map;for(const s of t.tracks){const r=s.index<e.notation.transpositionPitches.length?e.notation.transpositionPitches[s.index]:-s.staves[0].transpositionPitch;i.set(s.playbackInfo.primaryChannel,r),i.set(s.playbackInfo.secondaryChannel,r)}return i}generateChannel(t,e,i){this.transpositionPitches.set(e,t.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[t.index]:-t.staves[0].transpositionPitch);const r=Ne.toChannelShort(i.volume),a=Ne.toChannelShort(i.balance);this._handler.addControlChange(t.index,0,e,bt.VolumeCoarse,r),this._handler.addControlChange(t.index,0,e,bt.PanCoarse,a),this._handler.addControlChange(t.index,0,e,bt.ExpressionControllerCoarse,127),this._handler.addControlChange(t.index,0,e,bt.RegisteredParameterFine,0),this._handler.addControlChange(t.index,0,e,bt.RegisteredParameterCourse,0),this._handler.addControlChange(t.index,0,e,bt.DataEntryFine,0),this._handler.addControlChange(t.index,0,e,bt.DataEntryCoarse,Ne.PitchBendRangeInSemitones),this.addProgramChange(t,0,e,i.program)}static toChannelShort(t){const e=Math.max(-32768,Math.min(32767,8*t-1));return Math.max(e,-1)+1}generateMasterBar(t,e,i,s){(!e||e.timeSignatureDenominator!==t.timeSignatureDenominator||e.timeSignatureNumerator!==t.timeSignatureNumerator)&&this._handler.addTimeSignature(i,t.timeSignatureNumerator,t.timeSignatureDenominator);const r=t.calculateDuration(),a=new s_;if(t.tempoAutomations.length>0){t.tempoAutomations[0].ratioPosition>0&&a.tempoChanges.push(new Yh(i,s));for(const o of t.tempoAutomations){const l=i+r*o.ratioPosition;this._handler.addTempo(l,o.value),a.tempoChanges.push(new Yh(l,o.value))}}else e?a.tempoChanges.push(new Yh(i,s)):(this._handler.addTempo(i,t.score.tempo),a.tempoChanges.push(new Yh(i,t.score.tempo)));a.masterBar=t,a.start=i,a.end=a.start+r,this.tickLookup.addMasterBar(a)}generateBar(t,e,i){const s=this.getPlaybackBar(t),r=this._currentTime;for(const c of s.voices)this._currentTime=r,this.generateVoice(c,e,t,i);const a=s.masterBar,o=a.calculateDuration(),l=a.tempoAutomations.slice();if(0===l.length)this._currentTime=r+P.ticksToMillis(o,i);else{this._currentTime=r;let c=e,u=i;const h=e+o;for(const p of l){const m=o*p.ratioPosition-c;m>0&&(this._currentTime+=P.ticksToMillis(m,u)),u=p.value,c+=m}const f=h-c;f>0&&(this._currentTime+=P.ticksToMillis(f,u))}s.id!==t.id&&this.tickLookup.addBeat(t.voices[0].beats[0],0,o)}getPlaybackBar(t){switch(t.simileMark){case $t.Simple:t.previousBar&&(t=this.getPlaybackBar(t.previousBar));break;case $t.FirstOfDouble:case $t.SecondOfDouble:t.previousBar&&t.previousBar.previousBar&&(t=this.getPlaybackBar(t.previousBar.previousBar))}return t}generateVoice(t,e,i,s){if(t.isEmpty&&(!t.bar.isEmpty||0!==t.index))return;const r=i.masterBar.tempoAutomations.slice();let a=s;const o=i.masterBar.calculateDuration();for(const l of t.beats){const c=l.playbackStart/o;for(;r.length>0&&r[0].ratioPosition<=c;)a=r.shift().value;this.generateBeat(l,e,i,a)}}generateBeat(t,e,i,s){let r=t.playbackStart,a=t.playbackDuration;const o=t.voice.bar.masterBar.calculateDuration();t.voice.bar.isEmpty?a=o:t.voice.bar.masterBar.tripletFeel!==_e.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(r-=this._currentTripletFeel.secondBeatStartOffset,a=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=Ne.calculateTripletFeelInfo(r,a,t),this._currentTripletFeel&&(a=this._currentTripletFeel.firstBeatDuration))),t.showTimer&&!this._calculatedBeatTimers.has(t.id)&&(t.timer=this._currentTime,this._calculatedBeatTimers.add(t.id)),this._currentTime+=P.ticksToMillis(a,s),i===t.voice.bar&&this.tickLookup.addBeat(t,r,a);const l=t.voice.bar.staff.track;for(const c of t.automations)this.generateNonTempoAutomation(t,c,e);if(t.isRest)this._handler.addRest(l.index,e+r,l.playbackInfo.primaryChannel);else if(t.deadSlapped)this.generateDeadSlap(t,e+r);else{const c=this.getBrushInfo(t),u=this.getRasgueadoInfo(t,a);for(const h of t.notes)this.generateNote(h,e+r,a,s,c,u)}if(t.fade!==un.None&&this.generateFade(t,e+r,a),t.vibrato!==Ie.None){let c=240,u=3;switch(t.vibrato){case Ie.Slight:c=this._settings.player.vibrato.beatSlightLength,u=this._settings.player.vibrato.beatSlightAmplitude;break;case Ie.Wide:c=this._settings.player.vibrato.beatWideLength,u=this._settings.player.vibrato.beatWideAmplitude}this.generateVibratorWithParams(e+r,t.playbackDuration,c,0,u,(h,f)=>{this._handler.addBend(t.voice.bar.staff.track.index,h,l.playbackInfo.secondaryChannel,f)})}}static calculateTripletFeelInfo(t,e,i){let s;switch(i.voice.bar.masterBar.tripletFeel){case _e.Triplet8th:case _e.Dotted8th:case _e.Scottish8th:s=w.Eighth;break;case _e.Triplet16th:case _e.Dotted16th:case _e.Scottish16th:s=w.Sixteenth;break;default:return null}const r=P.toTicks(s);if(e!==r||t%r!=0||!i.nextBeat||i.nextBeat.voice!==i.voice||i.playbackDuration!==r)return null;const a=new G9;switch(i.voice.bar.masterBar.tripletFeel){case _e.Triplet8th:a.firstBeatDuration=P.applyTuplet(P.toTicks(w.Quarter),3,2),a.secondBeatDuration=P.applyTuplet(P.toTicks(w.Eighth),3,2);break;case _e.Dotted8th:a.firstBeatDuration=P.applyDot(P.toTicks(w.Eighth),!1),a.secondBeatDuration=P.toTicks(w.Sixteenth);break;case _e.Scottish8th:a.firstBeatDuration=P.toTicks(w.Sixteenth),a.secondBeatDuration=P.applyDot(P.toTicks(w.Eighth),!1);break;case _e.Triplet16th:a.firstBeatDuration=P.applyTuplet(P.toTicks(w.Eighth),3,2),a.secondBeatDuration=P.applyTuplet(P.toTicks(w.Sixteenth),3,2);break;case _e.Dotted16th:a.firstBeatDuration=P.applyDot(P.toTicks(w.Sixteenth),!1),a.secondBeatDuration=P.toTicks(w.ThirtySecond);break;case _e.Scottish16th:a.firstBeatDuration=P.toTicks(w.ThirtySecond),a.secondBeatDuration=P.applyDot(P.toTicks(w.Sixteenth),!1)}return a.secondBeatStartOffset=e-a.firstBeatDuration,a}generateDeadSlap(t,e){const i=P.toTicks(w.SixtyFourth),s=t.voice.bar.staff;if(s.tuning.length>0)for(const r of s.tuning)this._handler.addNote(s.track.index,e,i,r,P.dynamicToVelocity(ie.F),s.track.playbackInfo.primaryChannel)}needsSecondaryChannel(t){return t.hasBend||t.beat.hasWhammyBar||t.beat.vibrato!==Ie.None}determineChannel(t,e){if(this.needsSecondaryChannel(e))return t.playbackInfo.secondaryChannel;let i=e;for(;i.isTieDestination;)if(i=i.tieOrigin,this.needsSecondaryChannel(i))return t.playbackInfo.secondaryChannel;for(i=e;i.isTieOrigin;)if(i=i.tieDestination,this.needsSecondaryChannel(i))return t.playbackInfo.secondaryChannel;return t.playbackInfo.primaryChannel}generateNote(t,e,i,s,r,a){const o=t.beat.voice.bar.staff.track,l=t.beat.voice.bar.staff;let c=t.calculateRealValue(this.applyTranspositionPitches,!0);if(t.isPercussion){const b=nn.getArticulation(t);b&&(c=b.outputMidiNumber)}const u=null==a&&t.isStringed&&t.string<=r.length?r[t.string-1]:0,h=e+u,f=this.getNoteDuration(t,i,s);f.untilTieOrSlideEnd-=u,f.noteOnly-=u,f.letRingEnd-=u;const p=Ne.getNoteVelocity(t),g=this.determineChannel(o,t);let m=0;const y=Math.max(f.untilTieOrSlideEnd,f.letRingEnd);m=t.hasBend?Ne.getPitchWheel(t.bendPoints[0].value):t.beat.hasWhammyBar?Ne.getPitchWheel(t.beat.whammyBarPoints[0].value):t.isTieDestination||t.slideOrigin&&t.slideOrigin.slideOutType===Se.Legato?-1:Ne.getPitchWheel(0),m>=0&&this._handler.addNoteBend(o.index,h,g,c,m),t.beat.hasRasgueado?this.generateRasgueado(o,t,h,c,p,g,a):t.ornament===Vt.None?!t.isTrill||l.isPercussion?t.beat.isTremolo?this.generateTremoloPicking(t,h,f,c,p,g):(t.hasBend?this.generateBend(t,h,f,c,g,s):t.beat.hasWhammyBar&&0===t.index?this.generateWhammy(t.beat,h,f,g,s):t.slideInType!==pn.None||t.slideOutType!==Se.None?this.generateSlide(t,h,f,c,g,s):(t.vibrato!==Ie.None||t.isTieDestination&&t.tieOrigin.vibrato!==Ie.None)&&this.generateVibrato(t,h,f,c,g),!t.isTieDestination&&(!t.slideOrigin||t.slideOrigin.slideOutType!==Se.Legato)&&this._handler.addNote(o.index,h,y,c,p,g)):this.generateTrill(t,h,f,c,p,g):this.generateOrnament(o,t,h,y,c,p,g)}generateOrnament(t,e,i,s,r,a,o){let l,c;const u=r%12,h=1/3;switch(e.ornament){case Vt.Turn:l=[r+Ne.OrnamentKeysUp[u],r,r+Ne.OrnamentKeysDown[u]],c=[P.toTicks(w.Sixteenth)*h,P.toTicks(w.Sixteenth)*h,P.toTicks(w.Sixteenth)*h];break;case Vt.InvertedTurn:l=[r+Ne.OrnamentKeysDown[u],r,r+Ne.OrnamentKeysUp[u]],c=[P.toTicks(w.Sixteenth)*h,P.toTicks(w.Sixteenth)*h,P.toTicks(w.Sixteenth)*h];break;case Vt.UpperMordent:l=[r,r+Ne.OrnamentKeysUp[u]],c=[P.toTicks(w.ThirtySecond),P.toTicks(w.ThirtySecond)];break;case Vt.LowerMordent:l=[r,r+Ne.OrnamentKeysDown[u]],c=[P.toTicks(w.ThirtySecond),P.toTicks(w.ThirtySecond)];break;default:return}let f=1;s<P.QuarterTime&&(f=s/P.QuarterTime),a-=P.VelocityIncrement;let p=0;for(let m=0;m<l.length;m++){const y=c[m]*f;this._handler.addNote(t.index,i,y,l[m],a,o),i+=y,p+=y}this._handler.addNote(t.index,i,s-p,r,a,o)}getNoteDuration(t,e,i){const s=new U9;if(s.noteOnly=e,s.untilTieOrSlideEnd=e,s.letRingEnd=e,t.isDead)return s.noteOnly=this.applyStaticDuration(Ne.DefaultDurationDead,e,i),s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(t.isPalmMute)return s.noteOnly=this.applyStaticDuration(Ne.DefaultDurationPalmMute,e,i),s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(t.isStaccato)return s.noteOnly=e/2|0,s.untilTieOrSlideEnd=s.noteOnly,s.letRingEnd=s.noteOnly,s;if(t.isTieOrigin){const r=t.tieDestination;if(r)if(t.isTieDestination){const a=this.getNoteDuration(r,r.beat.playbackDuration,i);s.untilTieOrSlideEnd=e+a.untilTieOrSlideEnd}else{const a=t.beat.absolutePlaybackStart,o=this.getNoteDuration(r,r.beat.playbackDuration,i);s.untilTieOrSlideEnd=r.beat.absolutePlaybackStart+o.untilTieOrSlideEnd-a}}else if(t.slideOutType===Se.Legato){const r=t.slideTarget;if(r){const a=t.beat.absolutePlaybackStart,o=this.getNoteDuration(r,r.beat.playbackDuration,i);s.untilTieOrSlideEnd=r.beat.absolutePlaybackStart+o.untilTieOrSlideEnd-a}}if(t.isLetRing&&this._settings.notation.notationMode===_n.GuitarPro){let r=t.beat,a=0;const o=t.beat.voice.bar.masterBar.calculateDuration();for(;r.nextBeat;){const l=r.nextBeat;if(l.isRest||t.isStringed&&l.hasNoteOnString(t.string))break;if(r=r.nextBeat,a=r.absolutePlaybackStart-t.beat.absolutePlaybackStart+r.playbackDuration,a>o){a=o;break}}s.letRingEnd=r===t.beat?e:a}else s.letRingEnd=s.untilTieOrSlideEnd;return s}applyStaticDuration(t,e,i){return Math.min(i*t/V.MaxPosition|0,e)}static getNoteVelocity(t){let e=0;switch(!t.beat.voice.bar.staff.isPercussion&&t.hammerPullOrigin&&e--,t.isGhost&&e--,t.accentuated){case Ot.Normal:e++;break;case Ot.Heavy:e+=2}return P.dynamicToVelocity(t.dynamics,e)}generateFade(t,e,i){const s=t.voice.bar.staff.track;switch(t.fade){case un.FadeIn:this.generateFadeSteps(s,e,i,0,Ne.toChannelShort(s.playbackInfo.volume));break;case un.FadeOut:this.generateFadeSteps(s,e,i,Ne.toChannelShort(s.playbackInfo.volume),0);break;case un.VolumeSwell:const r=i/2|0;this.generateFadeSteps(s,e,r,0,Ne.toChannelShort(s.playbackInfo.volume)),this.generateFadeSteps(s,e+r,r,Ne.toChannelShort(s.playbackInfo.volume),0)}}generateFadeSteps(t,e,i,s,r){const o=(r-s)/(i=.8*i|0),l=i/120+1|0,c=e+i;for(let u=0;u<l;u++){const h=u===l-1,f=h?c:e+120*u,p=h?r:Math.round(s+(f-e)*o);this._handler.addControlChange(t.index,f,t.playbackInfo.primaryChannel,bt.VolumeCoarse,p),this._handler.addControlChange(t.index,f,t.playbackInfo.secondaryChannel,bt.VolumeCoarse,p)}}generateVibrato(t,e,i,s,r){let a=0,o=0;switch(t.vibrato!==Ie.None?t.vibrato:t.isTieDestination?t.tieOrigin.vibrato:Ie.Slight){case Ie.Slight:a=this._settings.player.vibrato.noteSlightLength,o=this._settings.player.vibrato.noteSlightAmplitude;break;case Ie.Wide:a=this._settings.player.vibrato.noteWideLength,o=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const c=t.beat.voice.bar.staff.track;let u=0;if(t.isTieDestination&&t.tieOrigin.hasBend){const h=t.tieOrigin.bendPoints;u=h[h.length-1].value}this.generateVibratorWithParams(e,i.noteOnly,a,u,o,(h,f)=>{this._handler.addNoteBend(c.index,h,r,s,f)})}generateVibratorWithParams(t,e,i,s,r,a){const o=this.vibratoResolution,l=i/2|0,c=t+e;for(;t<c;){let u=0;const h=t+i<c?i:c-t;for(;u<h;){const f=s+r*Math.sin(u*Math.PI/l);a(t+u|0,Ne.getPitchWheel(f)),u+=o}t+=i}a(0|c,Ne.getPitchWheel(s))}static getPitchWheel(t){return he.DefaultPitchWheel+t/2*Ne.PitchValuePerSemitone}generateSlide(t,e,i,s,r,a){const o=t.slideOutType===Se.Legato?i.noteOnly:i.untilTieOrSlideEnd,l=[],c=t.beat.voice.bar.staff.track,u=this._settings.player.slide.simpleSlidePitchOffset,h=Math.floor(V.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),f=Math.floor(V.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(t.slideInType){case pn.IntoFromAbove:l.push(new V(0,u)),l.push(new V(h,0));break;case pn.IntoFromBelow:l.push(new V(0,-u)),l.push(new V(h,0))}switch(t.slideOutType){case Se.Legato:case Se.Shift:l.push(new V(f,0));const p=2*(t.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-t.calculateRealValue(this.applyTranspositionPitches,!0));l.push(new V(V.MaxPosition,p));break;case Se.OutDown:l.push(new V(V.MaxPosition-h,0)),l.push(new V(V.MaxPosition,-u));break;case Se.OutUp:l.push(new V(V.MaxPosition-h,0)),l.push(new V(V.MaxPosition,u))}this.generateWhammyOrBend(e,o,l,a,(p,g)=>{this._handler.addNoteBend(c.index,p,r,s,g)})}generateBend(t,e,i,s,r,a){const o=t.bendPoints,l=t.beat.voice.bar.staff.track,c=(g,m)=>{this._handler.addNoteBend(l.index,g,r,s,m)};let h,u=null;if(t.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let g=t;for(;g.isTieOrigin&&!g.tieDestination.hasBend&&g.tieDestination.vibrato===Ie.None;)g=g.tieDestination;h=g.beat.absolutePlaybackStart-t.beat.absolutePlaybackStart+this.getNoteDuration(g,g.beat.playbackDuration,a).noteOnly}else if(t.isTieOrigin&&t.beat.graceType!==re.None){switch(t.tieDestination.bendType){case J.Bend:case J.BendRelease:case J.PrebendBend:u=t.tieDestination.bendPoints[1].value;break;case J.Prebend:case J.PrebendRelease:u=t.tieDestination.bendPoints[0].value}h=Math.max(i.noteOnly,P.millisToTicks(this._settings.player.songBookBendDuration,a))}else h=i.noteOnly;o[0].value>0&&!t.isContinuedBend&&e>0&&e--;const f=Math.min(h,P.millisToTicks(this._settings.player.songBookBendDuration,a));let p=[];switch(t.bendType){case J.Custom:p=o;break;case J.Bend:case J.Release:switch(t.bendStyle){case ct.Default:p=o;break;case ct.Gradual:p.push(new V(0,t.bendPoints[0].value)),(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),p.push(new V(V.MaxPosition,u));break;case ct.Fast:return(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),void this.generateSongBookWhammyOrBend(e,h,t.beat.graceType===re.BendGrace,[t.bendPoints[0].value,u],f,a,c)}break;case J.BendRelease:switch(t.bendStyle){case ct.Default:p=o;break;case ct.Gradual:p.push(new V(0,t.bendPoints[0].value)),p.push(new V(V.MaxPosition/2|0,t.bendPoints[1].value)),p.push(new V(V.MaxPosition,t.bendPoints[2].value));break;case ct.Fast:return void this.generateSongBookWhammyOrBend(e,h,!1,[t.bendPoints[0].value,t.bendPoints[1].value,t.bendPoints[2].value],f,a,c)}break;case J.Hold:case J.Prebend:p=o;break;case J.PrebendBend:switch(t.bendStyle){case ct.Default:p=o;break;case ct.Gradual:p.push(new V(0,t.bendPoints[0].value)),p.push(new V(V.MaxPosition,t.bendPoints[1].value));break;case ct.Fast:return c(e,0|Ne.getPitchWheel(t.bendPoints[0].value)),(!u||u<t.bendPoints[1].value)&&(u=t.bendPoints[1].value),void this.generateSongBookWhammyOrBend(e,h,!1,[t.bendPoints[0].value,u],f,a,c)}break;case J.PrebendRelease:switch(t.bendStyle){case ct.Default:p=o;break;case ct.Gradual:p.push(new V(0,t.bendPoints[0].value)),p.push(new V(V.MaxPosition,t.bendPoints[1].value));break;case ct.Fast:return c(e,0|Ne.getPitchWheel(t.bendPoints[0].value)),void this.generateSongBookWhammyOrBend(e,h,!1,[t.bendPoints[0].value,t.bendPoints[1].value],f,a,c)}}this.generateWhammyOrBend(e,h,p,a,c)}generateSongBookWhammyOrBend(t,e,i,s,r,a,o){const l=i?t:t+e-r,c=r/(s.length-1);for(let u=0;u<s.length-1;u++){const h=Ne.getPitchWheel(s[u]),f=Ne.getPitchWheel(s[u+1]);this.generateBendValues(l+c*u,c,h,f,a,o)}}generateWhammy(t,e,i,s,r){const a=t.whammyBarPoints,o=t.voice.bar.staff.track,l=i.noteOnly;a[0].value>0&&!t.isContinuedWhammy&&e--;const c=(h,f)=>{this._handler.addBend(o.index,h,s,f)};let u=[];switch(t.whammyBarType){case Re.Custom:u=a;break;case Re.Dive:switch(t.whammyStyle){case ct.Default:u=a;break;case ct.Gradual:u.push(new V(0,a[0].value)),u.push(new V(V.MaxPosition,a[1].value));break;case ct.Fast:const h=Math.min(l,P.millisToTicks(this._settings.player.songBookBendDuration,r));return void this.generateSongBookWhammyOrBend(e,l,!1,[a[0].value,a[1].value],h,r,c)}break;case Re.Dip:switch(t.whammyStyle){case ct.Default:u=a;break;case ct.Gradual:u.push(new V(0,a[0].value)),u.push(new V(V.MaxPosition/2|0,a[1].value)),u.push(new V(V.MaxPosition,a[2].value));break;case ct.Fast:const h=Math.min(l,P.millisToTicks(this._settings.player.songBookDipDuration,r));return void this.generateSongBookWhammyOrBend(e,l,!0,[a[0].value,a[1].value,a[2].value],h,r,c)}break;case Re.Hold:case Re.Predive:u=a;break;case Re.PrediveDive:switch(t.whammyStyle){case ct.Default:u=a;break;case ct.Gradual:u.push(new V(0,a[0].value)),u.push(new V(V.MaxPosition/2|0,a[0].value)),u.push(new V(V.MaxPosition,a[1].value));break;case ct.Fast:const h=Ne.getPitchWheel(a[0].value);this._handler.addBend(o.index,e,s,0|h);const f=Math.min(l,P.millisToTicks(this._settings.player.songBookBendDuration,r));return void this.generateSongBookWhammyOrBend(e,l,!1,[a[0].value,a[1].value],f,r,c)}}this.generateWhammyOrBend(e,l,u,r,c)}generateWhammyOrBend(t,e,i,s,r){const a=e/V.MaxPosition;for(let o=0;o<i.length-1;o++){const l=i[o],c=i[o+1],u=Ne.getPitchWheel(l.value),h=Ne.getPitchWheel(c.value);this.generateBendValues(t+a*l.offset,a*(c.offset-l.offset),u,h,s,r)}}generateBendValues(t,e,i,s,r,a){const o=P.ticksToMillis(e,r),l=Math.abs(s-i)/Ne.PitchValuePerSemitone,c=Math.max(Ne.MinBreakpointsPerSemitone*l,o/Ne.MillisecondsPerBreakpoint),u=e/c,h=(s-i)/c,f=t+e;for(let p=0;p<c;p++)a(0|t,Math.round(i)),i+=h,t+=u;a(0|f,s)}generateRasgueado(t,e,i,s,r,a,o){let l=i;for(let c=0;c<o.durations.length;c++){const u=o.brushInfos[c],h=e.isStringed&&e.string<=u.length?u[e.string-1]:0,f=o.durations[c];this._handler.addNote(t.index,l+h,f-h,s,r,a),l+=f}}generateTrill(t,e,i,s,r,a){const o=t.beat.voice.bar.staff.track,l=t.stringTuning+t.trillFret;let c=P.toTicks(t.trillSpeed),u=!0,h=e;const f=e+i.untilTieOrSlideEnd;for(;h+10<f;)h+c>=f&&(c=f-h),this._handler.addNote(o.index,h,c,u?l:s,r,a),u=!u,h+=c}generateTremoloPicking(t,e,i,s,r,a){const o=t.beat.voice.bar.staff.track;let l=P.toTicks(t.beat.tremoloSpeed),c=e;const u=e+i.untilTieOrSlideEnd;for(;c+10<u;)c+l>=u&&(l=u-c),this._handler.addNote(o.index,c,l,s,r,a),c+=l}getRasgueadoInfo(t,e){if(!t.hasRasgueado)return null;const i=new z9,r=Ne.RasgueadoDurations.get(t.rasgueado).reduce((u,h)=>u+h,0);i.durations=Ne.RasgueadoDurations.get(t.rasgueado).map(u=>e*u/r),i.brushInfos=new Array(i.durations.length);const a=P.toTicks(w.Sixteenth);let o=0,l=0;for(const u of t.notes)u.isTieDestination||(o|=1<<u.string-1,l++);const c=Ne.RasgueadoDirections.get(t.rasgueado);for(let u=0;u<i.durations.length;u++){const h=i.durations[u]*a/P.QuarterTime,f=new Int32Array(t.voice.bar.staff.tuning.length);i.brushInfos[u]=f;const p=c[u];p!==Y.None&&this.fillBrushInfo(t,f,p===Y.ArpeggioDown||p===Y.BrushDown,o,l,h)}return i}getBrushInfo(t){const e=new Int32Array(t.voice.bar.staff.tuning.length);if(t.brushType){let i=0,s=0;for(const r of t.notes)r.isTieDestination||(i|=1<<r.string-1,s++);this.fillBrushInfo(t,e,t.brushType===Y.ArpeggioDown||t.brushType===Y.BrushDown,i,s,t.brushDuration)}return e}fillBrushInfo(t,e,i,s,r,a){if(t.notes.length>0){let o=0;const l=a/(r-1)|0;for(let c=0;c<t.voice.bar.staff.tuning.length;c++){const u=i?c:e.length-1-c;s&1<<u&&(e[u]=o,o+=l)}}return e}generateNonTempoAutomation(t,e,i){switch(e.type){case Bt.Instrument:this.addProgramChange(t.voice.bar.staff.track,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.primaryChannel,255&(0|e.value)),this.addProgramChange(t.voice.bar.staff.track,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.secondaryChannel,255&(0|e.value));break;case Bt.Balance:const s=Ne.toChannelShort(e.value);this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.primaryChannel,bt.PanCoarse,s),this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.secondaryChannel,bt.PanCoarse,s);break;case Bt.Volume:const r=Ne.toChannelShort(e.value);this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.primaryChannel,bt.VolumeCoarse,r),this._handler.addControlChange(t.voice.bar.staff.track.index,t.playbackStart+i,t.voice.bar.staff.track.playbackInfo.secondaryChannel,bt.VolumeCoarse,r)}}prepareSingleBeat(t){let e=-1,i=-1,s=t;for(;s&&(-1===e||-1===i);){for(const u of t.automations)switch(u.type){case Bt.Instrument:i=u.value;break;case Bt.Tempo:e=u.value}s=s.previousBeat}const r=t.voice.bar.staff.track,a=t.voice.bar.masterBar;-1===e&&(e=a.score.tempo);const o=t.playbackStart/a.calculateDuration();for(const u of a.tempoAutomations){if(!(u.ratioPosition<=o))break;e=u.value}-1===i&&(i=r.playbackInfo.program);const l=r.playbackInfo.volume;this.generateTrack(r),this._handler.addTimeSignature(0,a.timeSignatureNumerator,a.timeSignatureDenominator),this._handler.addTempo(0,e);const c=Ne.toChannelShort(l);return this._handler.addControlChange(0,0,r.playbackInfo.primaryChannel,bt.VolumeCoarse,c),this._handler.addControlChange(0,0,r.playbackInfo.secondaryChannel,bt.VolumeCoarse,c),e}generateSingleBeat(t){const e=this.prepareSingleBeat(t);this.generateBeat(t,-t.playbackStart,t.voice.bar,e)}generateSingleNote(t){const e=this.prepareSingleBeat(t.beat);this.generateNote(t,0,t.beat.playbackDuration,e,new Int32Array(t.beat.voice.bar.staff.tuning.length),null)}}Ne.DefaultDurationDead=30,Ne.DefaultDurationPalmMute=80,Ne.OrnamentKeysUp=[2,2,2,1,1,2,2,2,2,2,1,1],Ne.OrnamentKeysDown=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],Ne.PitchBendRangeInSemitones=16,Ne.PitchValuePerSemitone=he.DefaultPitchWheel/Ne.PitchBendRangeInSemitones,Ne.MinBreakpointsPerSemitone=6,Ne.MillisecondsPerBreakpoint=150,Ne.RasgueadoDirections=new Map([[X.Ii,[Y.BrushDown,Y.BrushUp]],[X.Mi,[Y.BrushDown,Y.BrushDown]],[X.MiiTriplet,[Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.MiiAnapaest,[Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.PmpTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PmpAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PeiTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PeiAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PaiTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PaiAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.AmiTriplet,[Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.AmiAnapaest,[Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.Ppp,[Y.None,Y.BrushDown,Y.BrushUp]],[X.Amii,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Amip,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Eami,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.Eamii,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Peami,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]]]),Ne.RasgueadoDurations=new Map([[X.Ii,[P.toTicks(w.Eighth),P.toTicks(w.Eighth)]],[X.Mi,[P.toTicks(w.Eighth),P.toTicks(w.Eighth)]],[X.MiiTriplet,[P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3]],[X.MiiAnapaest,[P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth),P.toTicks(w.Eighth)]],[X.PmpTriplet,[P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3]],[X.PmpAnapaest,[P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Eighth)/3]],[X.PeiTriplet,[P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3]],[X.PeiAnapaest,[P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth),P.toTicks(w.Eighth)]],[X.PaiTriplet,[P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3]],[X.PaiAnapaest,[P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth),P.toTicks(w.Eighth)]],[X.AmiTriplet,[P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3,P.toTicks(w.Eighth)/3]],[X.AmiAnapaest,[P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Eighth)/3]],[X.Ppp,[P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Eighth)/3]],[X.Amii,[P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Eighth)]],[X.Amip,[P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Sixteenth)/3,P.toTicks(w.Eighth)]],[X.Eami,[P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth),P.toTicks(w.Sixteenth)]],[X.Eamii,[P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5]],[X.Peami,[P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5,P.toTicks(w.Sixteenth)/5]]]);class $I{constructor(){this.startTick=0,this.endTick=0}}class Pt{constructor(t,e){this.width=0,this.height=0,this.x=t,this.y=e}doLayout(){}paint(t,e,i){}}class Gi extends Pt{constructor(t=0,e=0){super(t,e),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class Xe{}Xe.Widths=new Map([[d.Brace,3],[d.BracketTop,0],[d.BracketBottom,0],[d.SystemDivider,0],[d.GClef,28],[d.CClef,28],[d.FClef,28],[d.UnpitchedPercussionClef1,15],[d.SixStringTabClef,28],[d.FourStringTabClef,28],[d.TimeSig0,14],[d.TimeSig1,10],[d.TimeSig2,14],[d.TimeSig3,14],[d.TimeSig4,14],[d.TimeSig5,14],[d.TimeSig6,14],[d.TimeSig7,14],[d.TimeSig8,14],[d.TimeSig9,14],[d.TimeSigCommon,14],[d.TimeSigCutCommon,14],[d.NoteheadDoubleWholeSquare,14],[d.NoteheadDoubleWhole,14],[d.NoteheadWhole,14],[d.NoteheadHalf,9],[d.NoteheadBlack,9],[d.NoteheadNull,9],[d.NoteheadXOrnate,9],[d.NoteheadPlusDoubleWhole,16],[d.NoteheadPlusWhole,10],[d.NoteheadPlusHalf,10],[d.NoteheadPlusBlack,10],[d.NoteheadSquareWhite,11],[d.NoteheadSquareBlack,11],[d.NoteheadTriangleUpDoubleWhole,16],[d.NoteheadTriangleUpWhole,11],[d.NoteheadTriangleUpHalf,11],[d.NoteheadTriangleUpBlack,11],[d.NoteheadTriangleRightWhite,11],[d.NoteheadTriangleRightBlack,11],[d.NoteheadTriangleDownDoubleWhole,16],[d.NoteheadTriangleDownWhole,11],[d.NoteheadTriangleDownHalf,11],[d.NoteheadTriangleDownBlack,11],[d.NoteheadDiamondDoubleWhole,16],[d.NoteheadDiamondWhole,9],[d.NoteheadDiamondHalf,9],[d.NoteheadDiamondBlack,9],[d.NoteheadDiamondBlackWide,10],[d.NoteheadDiamondWhite,9],[d.NoteheadDiamondWhiteWide,9],[d.NoteheadCircleXDoubleWhole,16],[d.NoteheadCircleXWhole,9],[d.NoteheadCircleXHalf,9],[d.NoteheadCircleX,9],[d.NoteheadXDoubleWhole,16],[d.NoteheadXWhole,9],[d.NoteheadXHalf,9],[d.NoteheadXBlack,9],[d.NoteheadParenthesis,9],[d.NoteheadSlashedBlack1,9],[d.NoteheadSlashedBlack2,9],[d.NoteheadSlashedHalf1,9],[d.NoteheadSlashedHalf2,9],[d.NoteheadSlashedWhole1,9],[d.NoteheadSlashedWhole2,9],[d.NoteheadSlashedDoubleWhole1,16],[d.NoteheadSlashedDoubleWhole2,16],[d.NoteheadCircledBlack,9],[d.NoteheadCircledHalf,9],[d.NoteheadCircledWhole,9],[d.NoteheadCircledDoubleWhole,16],[d.NoteheadCircleSlash,9],[d.NoteheadHeavyX,13],[d.NoteheadHeavyXHat,13],[d.NoteheadSlashVerticalEnds,12],[d.NoteheadSlashWhiteWhole,32],[d.NoteheadSlashWhiteHalf,25],[d.NoteheadRoundWhiteWithDot,9],[d.NoteheadSquareBlackLarge,9],[d.NoteheadSquareBlackWhite,9],[d.NoteheadClusterDoubleWhole3rd,16],[d.NoteheadClusterWhole3rd,12],[d.NoteheadClusterHalf3rd,12],[d.NoteheadClusterQuarter3rd,12],[d.NoteShapeRoundWhite,9],[d.NoteShapeRoundBlack,9],[d.NoteShapeSquareWhite,12],[d.NoteShapeSquareBlack,12],[d.NoteShapeTriangleRightWhite,12],[d.NoteShapeTriangleRightBlack,12],[d.NoteShapeTriangleLeftWhite,12],[d.NoteShapeTriangleLeftBlack,12],[d.NoteShapeDiamondWhite,9],[d.NoteShapeDiamondBlack,9],[d.NoteShapeTriangleUpWhite,12],[d.NoteShapeTriangleUpBlack,12],[d.NoteShapeMoonWhite,12],[d.NoteShapeMoonBlack,12],[d.NoteShapeTriangleRoundWhite,12],[d.NoteShapeTriangleRoundBlack,12],[d.NoteQuarterUp,10],[d.NoteEighthUp,10],[d.TextBlackNoteLongStem,0],[d.TextBlackNoteFrac8thLongStem,0],[d.TextBlackNoteFrac16thLongStem,0],[d.TextBlackNoteFrac32ndLongStem,0],[d.TextCont8thBeamLongStem,0],[d.TextCont16thBeamLongStem,0],[d.TextCont32ndBeamLongStem,0],[d.TextAugmentationDot,0],[d.TextTupletBracketStartLongStem,0],[d.TextTuplet3LongStem,0],[d.TextTupletBracketEndLongStem,0],[d.Tremolo3,12],[d.Tremolo2,12],[d.Tremolo1,12],[d.FlagEighthUp,0],[d.FlagEighthDown,0],[d.FlagSixteenthUp,0],[d.FlagSixteenthDown,0],[d.FlagThirtySecondUp,0],[d.FlagThirtySecondDown,0],[d.FlagSixtyFourthUp,0],[d.FlagSixtyFourthDown,0],[d.FlagOneHundredTwentyEighthUp,0],[d.FlagOneHundredTwentyEighthDown,0],[d.FlagTwoHundredFiftySixthUp,0],[d.FlagTwoHundredFiftySixthDown,0],[d.AccidentalFlat,8],[d.AccidentalNatural,8],[d.AccidentalSharp,8],[d.AccidentalDoubleSharp,8],[d.AccidentalDoubleFlat,18],[d.AccidentalQuarterToneFlatArrowUp,8],[d.AccidentalQuarterToneSharpArrowUp,8],[d.AccidentalQuarterToneNaturalArrowUp,8],[d.Segno,0],[d.Coda,0],[d.ArticAccentAbove,9],[d.ArticAccentBelow,9],[d.ArticStaccatoAbove,9],[d.ArticStaccatoBelow,9],[d.ArticTenutoAbove,9],[d.ArticTenutoBelow,9],[d.ArticMarcatoAbove,9],[d.ArticMarcatoBelow,9],[d.FermataAbove,23],[d.FermataShortAbove,23],[d.FermataLongAbove,23],[d.RestLonga,9],[d.RestDoubleWhole,9],[d.RestWhole,9],[d.RestHalf,9],[d.RestQuarter,9],[d.RestEighth,9],[d.RestSixteenth,9],[d.RestThirtySecond,12],[d.RestSixtyFourth,14],[d.RestOneHundredTwentyEighth,14],[d.RestTwoHundredFiftySixth,14],[d.RestHBarLeft,0],[d.RestHBarMiddle,0],[d.RestHBarRight,0],[d.Repeat1Bar,0],[d.Repeat2Bars,0],[d.Ottava,0],[d.OttavaAlta,32],[d.OttavaBassaVb,29],[d.Quindicesima,23],[d.QuindicesimaAlta,46],[d.DynamicPPPPPP,0],[d.DynamicPPPPP,0],[d.DynamicPPPP,0],[d.DynamicPPP,0],[d.DynamicPP,0],[d.DynamicPiano,0],[d.DynamicMP,0],[d.DynamicMF,0],[d.DynamicPF,0],[d.DynamicForte,0],[d.DynamicFF,0],[d.DynamicFFF,0],[d.DynamicFFFF,0],[d.DynamicFFFFF,0],[d.DynamicFFFFFF,0],[d.DynamicFortePiano,0],[d.DynamicNiente,0],[d.DynamicSforzando1,0],[d.DynamicSforzandoPiano,0],[d.DynamicSforzandoPianissimo,0],[d.DynamicSforzato,0],[d.DynamicSforzatoPiano,0],[d.DynamicSforzatoFF,0],[d.DynamicRinforzando1,0],[d.DynamicRinforzando2,0],[d.DynamicForzando,0],[d.OrnamentTrill,20],[d.OrnamentTurn,26],[d.OrnamentTurnInverted,26],[d.OrnamentShortTrill,0],[d.OrnamentMordent,26],[d.StringsDownBow,9],[d.StringsUpBow,9],[d.KeyboardPedalPed,35],[d.KeyboardPedalUp,16],[d.PictEdgeOfCymbal,44],[d.GuitarString0,20],[d.GuitarString1,20],[d.GuitarString2,20],[d.GuitarString3,20],[d.GuitarString4,20],[d.GuitarString5,20],[d.GuitarString6,20],[d.GuitarString7,20],[d.GuitarString8,20],[d.GuitarString9,20],[d.GuitarOpenPedal,11],[d.GuitarClosePedal,11],[d.GuitarGolpe,13.4],[d.GuitarFadeIn,13],[d.GuitarFadeOut,13],[d.GuitarVolumeSwell,26],[d.FretboardX,0],[d.FretboardO,0],[d.WiggleTrill,9],[d.WiggleVibratoMediumFast,10],[d.OctaveBaselineM,13],[d.OctaveBaselineB,9]]),Xe.Heights=new Map([[d.Brace,34],[d.BracketTop,0],[d.BracketBottom,0],[d.SystemDivider,0],[d.GClef,0],[d.CClef,0],[d.FClef,0],[d.UnpitchedPercussionClef1,0],[d.SixStringTabClef,0],[d.FourStringTabClef,0],[d.TimeSig0,0],[d.TimeSig1,0],[d.TimeSig2,0],[d.TimeSig3,0],[d.TimeSig4,0],[d.TimeSig5,0],[d.TimeSig6,0],[d.TimeSig7,0],[d.TimeSig8,0],[d.TimeSig9,0],[d.TimeSigCommon,0],[d.TimeSigCutCommon,0],[d.NoteheadDoubleWholeSquare,8],[d.NoteheadDoubleWhole,8],[d.NoteheadWhole,8],[d.NoteheadHalf,8],[d.NoteheadBlack,8],[d.NoteheadNull,8],[d.NoteheadXOrnate,8],[d.NoteheadPlusDoubleWhole,8],[d.NoteheadPlusWhole,8],[d.NoteheadPlusHalf,8],[d.NoteheadPlusBlack,8],[d.NoteheadSquareWhite,8],[d.NoteheadSquareBlack,8],[d.NoteheadTriangleUpDoubleWhole,8],[d.NoteheadTriangleUpWhole,8],[d.NoteheadTriangleUpHalf,8],[d.NoteheadTriangleUpBlack,8],[d.NoteheadTriangleRightWhite,8],[d.NoteheadTriangleRightBlack,8],[d.NoteheadTriangleDownDoubleWhole,8],[d.NoteheadTriangleDownWhole,8],[d.NoteheadTriangleDownHalf,8],[d.NoteheadTriangleDownBlack,8],[d.NoteheadDiamondDoubleWhole,8],[d.NoteheadDiamondWhole,8],[d.NoteheadDiamondHalf,8],[d.NoteheadDiamondBlack,8],[d.NoteheadDiamondBlackWide,9],[d.NoteheadDiamondWhite,9],[d.NoteheadDiamondWhiteWide,9],[d.NoteheadCircleXDoubleWhole,8],[d.NoteheadCircleXWhole,8],[d.NoteheadCircleXHalf,8],[d.NoteheadCircleX,8],[d.NoteheadXDoubleWhole,8],[d.NoteheadXWhole,8],[d.NoteheadXHalf,8],[d.NoteheadXBlack,8],[d.NoteheadParenthesis,8],[d.NoteheadSlashedBlack1,8],[d.NoteheadSlashedBlack2,8],[d.NoteheadSlashedHalf1,8],[d.NoteheadSlashedHalf2,8],[d.NoteheadSlashedWhole1,8],[d.NoteheadSlashedWhole2,8],[d.NoteheadSlashedDoubleWhole1,8],[d.NoteheadSlashedDoubleWhole2,8],[d.NoteheadCircledBlack,8],[d.NoteheadCircledHalf,8],[d.NoteheadCircledWhole,8],[d.NoteheadCircledDoubleWhole,8],[d.NoteheadCircleSlash,8],[d.NoteheadHeavyX,8],[d.NoteheadHeavyXHat,8],[d.NoteheadSlashVerticalEnds,17],[d.NoteheadSlashWhiteWhole,17],[d.NoteheadSlashWhiteHalf,17],[d.NoteheadRoundWhiteWithDot,8],[d.NoteheadSquareBlackLarge,8],[d.NoteheadSquareBlackWhite,8],[d.NoteheadClusterDoubleWhole3rd,8],[d.NoteheadClusterWhole3rd,8],[d.NoteheadClusterHalf3rd,8],[d.NoteheadClusterQuarter3rd,8],[d.NoteShapeRoundWhite,8],[d.NoteShapeRoundBlack,8],[d.NoteShapeSquareWhite,8],[d.NoteShapeSquareBlack,8],[d.NoteShapeTriangleRightWhite,8],[d.NoteShapeTriangleRightBlack,8],[d.NoteShapeTriangleLeftWhite,8],[d.NoteShapeTriangleLeftBlack,8],[d.NoteShapeDiamondWhite,8],[d.NoteShapeDiamondBlack,8],[d.NoteShapeTriangleUpWhite,8],[d.NoteShapeTriangleUpBlack,8],[d.NoteShapeMoonWhite,8],[d.NoteShapeMoonBlack,8],[d.NoteShapeTriangleRoundWhite,8],[d.NoteShapeTriangleRoundBlack,8],[d.NoteQuarterUp,8],[d.NoteEighthUp,8],[d.TextBlackNoteLongStem,0],[d.TextBlackNoteFrac8thLongStem,0],[d.TextBlackNoteFrac16thLongStem,0],[d.TextBlackNoteFrac32ndLongStem,0],[d.TextCont8thBeamLongStem,0],[d.TextCont16thBeamLongStem,0],[d.TextCont32ndBeamLongStem,0],[d.TextAugmentationDot,0],[d.TextTupletBracketStartLongStem,0],[d.TextTuplet3LongStem,0],[d.TextTupletBracketEndLongStem,0],[d.Tremolo3,0],[d.Tremolo2,0],[d.Tremolo1,0],[d.FlagEighthUp,0],[d.FlagEighthDown,0],[d.FlagSixteenthUp,0],[d.FlagSixteenthDown,0],[d.FlagThirtySecondUp,0],[d.FlagThirtySecondDown,0],[d.FlagSixtyFourthUp,0],[d.FlagSixtyFourthDown,0],[d.FlagOneHundredTwentyEighthUp,0],[d.FlagOneHundredTwentyEighthDown,0],[d.FlagTwoHundredFiftySixthUp,0],[d.FlagTwoHundredFiftySixthDown,0],[d.AccidentalFlat,0],[d.AccidentalNatural,0],[d.AccidentalSharp,0],[d.AccidentalDoubleSharp,0],[d.AccidentalDoubleFlat,0],[d.AccidentalQuarterToneFlatArrowUp,0],[d.AccidentalQuarterToneSharpArrowUp,0],[d.AccidentalQuarterToneNaturalArrowUp,0],[d.Segno,0],[d.Coda,0],[d.ArticAccentAbove,9],[d.ArticAccentBelow,9],[d.ArticStaccatoAbove,9],[d.ArticStaccatoBelow,9],[d.ArticTenutoAbove,9],[d.ArticTenutoBelow,9],[d.ArticMarcatoAbove,9],[d.ArticMarcatoBelow,9],[d.FermataAbove,12],[d.FermataShortAbove,12],[d.FermataLongAbove,12],[d.RestLonga,0],[d.RestDoubleWhole,0],[d.RestWhole,0],[d.RestHalf,0],[d.RestQuarter,0],[d.RestEighth,0],[d.RestSixteenth,0],[d.RestThirtySecond,0],[d.RestSixtyFourth,0],[d.RestOneHundredTwentyEighth,0],[d.RestTwoHundredFiftySixth,0],[d.RestHBarLeft,0],[d.RestHBarMiddle,0],[d.RestHBarRight,0],[d.Repeat1Bar,0],[d.Repeat2Bars,0],[d.Ottava,13],[d.OttavaAlta,13],[d.OttavaBassaVb,13],[d.Quindicesima,13],[d.QuindicesimaAlta,13],[d.DynamicPPPPPP,28.4],[d.DynamicPPPPP,28.4],[d.DynamicPPPP,28.4],[d.DynamicPPP,28.4],[d.DynamicPP,28.4],[d.DynamicPiano,28.4],[d.DynamicMP,28.4],[d.DynamicMF,28.4],[d.DynamicPF,28.4],[d.DynamicForte,28.4],[d.DynamicFF,28.4],[d.DynamicFFF,28.4],[d.DynamicFFFF,28.4],[d.DynamicFFFFF,28.4],[d.DynamicFFFFFF,28.4],[d.DynamicFortePiano,28.4],[d.DynamicNiente,28.4],[d.DynamicSforzando1,28.4],[d.DynamicSforzandoPiano,28.4],[d.DynamicSforzandoPianissimo,28.4],[d.DynamicSforzato,28.4],[d.DynamicSforzatoPiano,28.4],[d.DynamicSforzatoFF,28.4],[d.DynamicRinforzando1,28.4],[d.DynamicRinforzando2,28.4],[d.DynamicForzando,28.4],[d.OrnamentTrill,24],[d.OrnamentTurn,18],[d.OrnamentTurnInverted,18],[d.OrnamentShortTrill,18],[d.OrnamentMordent,18],[d.StringsDownBow,13/.75],[d.StringsUpBow,13/.75],[d.KeyboardPedalPed,19],[d.KeyboardPedalUp,16],[d.PictEdgeOfCymbal,30],[d.GuitarString0,20],[d.GuitarString1,20],[d.GuitarString2,20],[d.GuitarString3,20],[d.GuitarString4,20],[d.GuitarString5,20],[d.GuitarString6,20],[d.GuitarString7,20],[d.GuitarString8,20],[d.GuitarString9,20],[d.GuitarOpenPedal,11],[d.GuitarClosePedal,11],[d.GuitarGolpe,13.4],[d.GuitarFadeIn,13],[d.GuitarFadeOut,13],[d.GuitarVolumeSwell,13],[d.FretboardX,0],[d.FretboardO,0],[d.WiggleTrill,6],[d.WiggleVibratoMediumFast,10],[d.OctaveBaselineM,0],[d.OctaveBaselineB,0]]);class sn extends Gi{constructor(t,e,i,s){super(t,e),this.glyphScale=0,this.center=!1,this.glyphScale=i,this.symbol=s}doLayout(){this.width=Xe.Widths.has(this.symbol)?Xe.Widths.get(this.symbol)*this.glyphScale:0,this.height=Xe.Heights.has(this.symbol)?Xe.Heights.get(this.symbol)*this.glyphScale:0}paint(t,e,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillMusicFontSymbol(t+this.x,e+this.y,this.glyphScale,this.symbol,this.center),i.color=s}}let gt=(()=>{class n extends sn{constructor(e,i,s,r){super(e,i,r?n.GraceScale:1,n.getSymbol(s)),this.centerOnStem=!1,this._isGrace=r}paint(e,i,s){const r=this._isGrace?1:0;this.centerOnStem&&(this.center=!0),super.paint(e,i+r,s)}static getSymbol(e){switch(e){case w.QuadrupleWhole:return d.NoteheadDoubleWholeSquare;case w.DoubleWhole:return d.NoteheadDoubleWhole;case w.Whole:return d.NoteheadWhole;case w.Half:return d.NoteheadHalf;default:return d.NoteheadBlack}}}return n.GraceScale=.75,n})(),Wg=(()=>{class n extends sn{constructor(e,i,s,r,a){super(e,i,a?gt.GraceScale:1,n.getSymbol(s,r,a))}static getSymbol(e,i,s){if(s&&(e=w.Eighth),i===B.Up)switch(e){case w.Eighth:return d.FlagEighthUp;case w.Sixteenth:return d.FlagSixteenthUp;case w.ThirtySecond:return d.FlagThirtySecondUp;case w.SixtyFourth:return d.FlagSixtyFourthUp;case w.OneHundredTwentyEighth:return d.FlagOneHundredTwentyEighthUp;case w.TwoHundredFiftySixth:return d.FlagTwoHundredFiftySixthUp;default:return d.FlagEighthUp}switch(e){case w.Eighth:return d.FlagEighthDown;case w.Sixteenth:return d.FlagSixteenthDown;case w.ThirtySecond:return d.FlagThirtySecondDown;case w.SixtyFourth:return d.FlagSixtyFourthDown;case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:return d.FlagOneHundredTwentyEighthDown;default:return d.FlagEighthDown}}}return n.FlagWidth=11,n})(),Zs=(()=>{class n extends Pt{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,i){super(0,0),this.ties=[],this.minWidth=0,this.beat=e,this.ties=[],this.voiceContainer=i}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){const i=this.preNotes.computedWidth+this.onNotes.centerX;let s=this.onNotes.computedWidth-this.onNotes.centerX;const r=this.renderer.helpers.getBeamingHelperForBeat(this.beat);this.beat.graceType!==re.None?s+=1===this.beat.graceGroup.beats.length?Wg.FlagWidth*gt.GraceScale:this.beat.graceIndex<this.beat.graceGroup.beats.length-1?7:n.GraceBeatPadding:r&&this.drawBeamHelperAsFlags(r)&&(s+=Wg.FlagWidth);for(const a of this.ties)s+=a.width;e.addBeatSpring(this.beat,i,s)}applyLayoutingInfo(e){this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(1===this.onNotes.beamingHelper.beats.length)this.beat.duration>=w.Eighth&&(this.minWidth+=20);else switch(this.beat.duration){case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:this.minWidth+=10}let e=0;for(const i of this.ties)i.width>e&&(e=i.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return`b${e.id}`}paint(e,i,s){if(this.preNotes.isEmpty&&this.onNotes.isEmpty&&0===this.ties.length)return;s.beginGroup(n.getGroupId(this.beat)),this.preNotes.paint(e+this.x,i+this.y,s),this.onNotes.paint(e+this.x,i+this.y,s);const a=e-this.voiceContainer.x-this.renderer.x,o=i-this.voiceContainer.y-this.renderer.y;for(let l=0,c=this.ties.length;l<c;l++){const u=this.ties[l];u.renderer=this.renderer,u.paint(a,o,s)}s.endGroup()}buildBoundingsLookup(e,i,s,r){const a=new ZS;if(a.beat=this.beat,this.beat.isEmpty)a.visualBounds=new kn,a.visualBounds.x=i+this.x,a.visualBounds.y=e.visualBounds.y,a.visualBounds.w=this.width,a.visualBounds.h=e.visualBounds.h,a.realBounds=new kn,a.realBounds.x=i+this.x,a.realBounds.y=e.realBounds.y,a.realBounds.w=this.width,a.realBounds.h=e.realBounds.h,a.onNotesX=i+this.x+this.onNotes.centerX;else{a.visualBounds=new kn,a.visualBounds.x=i+this.x,a.visualBounds.x=this.preNotes.isEmpty?this.onNotes.isEmpty?i+this.x:i+this.x+this.onNotes.x:i+this.x+this.preNotes.x;let o=0;o=this.onNotes.isEmpty?this.preNotes.isEmpty?i+this.x+this.width:i+this.x+this.preNotes.x+this.preNotes.width:i+this.x+this.onNotes.x+this.onNotes.width,a.visualBounds.w=o-a.visualBounds.x;const l=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(l&&this.drawBeamHelperAsFlags(l)||this.beat.graceType!==re.None)&&(a.visualBounds.w+=Wg.FlagWidth*(this.beat.graceType!==re.None?gt.GraceScale:1)),a.visualBounds.y=e.visualBounds.y,a.visualBounds.h=e.visualBounds.h,a.realBounds=new kn,a.realBounds.x=i+this.x,a.realBounds.y=e.realBounds.y,a.realBounds.w=this.width,a.realBounds.h=e.realBounds.h,a.onNotesX=i+this.x+this.onNotes.x+this.onNotes.centerX}e.addBeat(a),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(a,i+this.x,s+this.y)}}return n.GraceBeatPadding=3,n})();class jI{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new AM}causeIssue(){return this.settings=null,!0}}class qI{constructor(t){this.activeBeats=t}}class Ug{constructor(t){this.bounds=null,this.beat=t}}class $9{get score(){return this._score}get tracks(){return this._tracks}constructor(t,e){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this._score=null,this._tracks=[],this._tickCache=null,this.player=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=yn.Paused,this._currentBeat=null,this._currentBarBounds=null,this._previousStateForCursor=yn.Paused,this._previousCursorCache=null,this._lastScroll=0,this.playedBeatChanged=new qe,this.activeBeatsChanged=new qe,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new qe,this.beatMouseMove=new qe,this.beatMouseUp=new qe,this.noteMouseDown=new qe,this.noteMouseMove=new qe,this.noteMouseUp=new qe,this.scoreLoaded=new qe,this.resize=new qe,this.renderStarted=new qe,this.renderFinished=new qe,this.postRenderFinished=new Cn,this.error=new qe,this.playerReady=new Cn,this.playerFinished=new Cn,this.soundFontLoaded=new Cn,this.midiLoad=new qe,this.midiLoaded=new qe,this.playerStateChanged=new qe,this.playerPositionChanged=new qe,this.midiEventsPlayed=new qe,this.playbackRangeChanged=new qe,this.settingsUpdated=new Cn,this.uiFacade=t,this.container=t.rootContainer,t.initialize(this,e),x.logLevel=this.settings.core.logLevel,N.printEnvironmentInfo(!1),this.canvasElement=t.createCanvasElement(),this.container.appendChild(this.canvasElement),this.renderer=this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&N.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this.uiFacade.createWorkerRenderer():new n_(this.settings),this.container.resize.on(N.throttle(()=>{this._isDestroyed||this.container.width!==this.renderer.width&&this.triggerResize()},t.resizeThrottle));const i=new jI;i.oldWidth=this.renderer.width,i.newWidth=0|this.container.width,i.settings=this.settings,this.onResize(i),this.renderer.preRender.on(this.onRenderStarted.bind(this)),this.renderer.renderFinished.on(s=>{this.onRenderFinished(s)}),this.renderer.postRenderFinished.on(()=>{const s=Date.now()-this._startTime;x.debug("rendering",`Rendering completed in ${s}ms`),this.onPostRenderFinished()}),this.renderer.preRender.on(s=>{this._startTime=Date.now()}),this.renderer.partialLayoutFinished.on(this.appendRenderResult.bind(this)),this.renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this.renderer.renderFinished.on(s=>{this.appendRenderResult(s),this.appendRenderResult(null)}),this.renderer.error.on(this.onError.bind(this)),this.settings.player.enablePlayer&&this.setupPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}destroy(){this._isDestroyed=!0,this.player&&this.player.destroy(),this.uiFacade.destroy(),this.renderer.destroy()}updateSettings(){const t=this.score;t&&H.applyPitchOffsets(this.settings,t),this.renderer.updateSettings(this.settings),this.settings.player.enablePlayer?(this.setupPlayer(),t&&this.player?.applyTranspositionPitches(Ne.buildTranspositionPitches(t,this.settings))):this.destroyPlayer(),this.onSettingsUpdated()}load(t,e){try{return this.uiFacade.load(t,i=>{this.renderScore(i,e)},i=>{this.onError(i)})}catch(i){return this.onError(i),!1}}renderScore(t,e){const i=[];if(e)if(0===e.length)t.tracks.length>0&&i.push(t.tracks[0]);else if(1===e.length&&-1===e[0])for(const s of t.tracks)i.push(s);else for(const s of e)s>=0&&s<=t.tracks.length&&i.push(t.tracks[s]);else t.tracks.length>0&&i.push(t.tracks[0]);this.internalRenderTracks(t,i)}renderTracks(t){if(t.length>0){const e=t[0].score;for(const i of t)if(i.score!==e)return void this.onError(new nt(it.General,"All rendered tracks must belong to the same score."));this.internalRenderTracks(e,t)}}internalRenderTracks(t,e){if(H.applyPitchOffsets(this.settings,t),t!==this.score){this._score=t,this._tracks=e,this._tickCache=null,this._trackIndexes=[];for(const i of e)this._trackIndexes.push(i.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(t),this.loadMidiForScore(),this.render()}else{this._tracks=e;const i=H.computeFirstDisplayedBarIndex(t,this.settings),s=H.computeLastDisplayedBarIndex(t,this.settings,i);this._tickCache&&(this._tickCache.multiBarRestInfo=H.buildMultiBarRestInfo(this.tracks,i,s)),this._trackIndexes=[];for(const r of e)this._trackIndexes.push(r.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(this.container.isVisible){const t=new jI;t.oldWidth=this.renderer.width,t.newWidth=this.container.width,t.settings=this.settings,this.onResize(t),this.renderer.updateSettings(this.settings),this.renderer.width=this.container.width,this.renderer.resizeRender()}else x.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{x.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()})}appendRenderResult(t){t?(this.canvasElement.width=t.totalWidth,this.canvasElement.height=t.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=t.totalWidth,this._cursorWrapper.height=t.totalHeight),(t.width>0||t.height>0)&&this.uiFacade.beginAppendRenderResults(t)):this.uiFacade.beginAppendRenderResults(t)}updateRenderResult(t){t&&t.renderResult&&this.uiFacade.beginUpdateRenderResults(t)}tex(t,e){try{const i=new vI;i.logErrors=!0,i.initFromString(t,this.settings);const s=i.readScore();this.renderScore(s,e)}catch(i){this.onError(i)}}loadSoundFont(t,e=!1){return!!this.player&&this.uiFacade.loadSoundFont(t,e)}resetSoundFonts(){this.player&&this.player.resetSoundFonts()}render(){this.renderer&&(this.uiFacade.canRender?(this.renderer.width=this.container.width,this.renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render()))}get tickCache(){return this._tickCache}get boundsLookup(){return this.renderer.boundsLookup}get isReadyForPlayback(){return!!this.player&&this.player.isReadyForPlayback}get playerState(){return this.player?this.player.state:yn.Paused}get masterVolume(){return this.player?this.player.masterVolume:0}set masterVolume(t){this.player&&(this.player.masterVolume=t)}get metronomeVolume(){return this.player?this.player.metronomeVolume:0}set metronomeVolume(t){this.player&&(this.player.metronomeVolume=t)}get countInVolume(){return this.player?this.player.countInVolume:0}set countInVolume(t){this.player&&(this.player.countInVolume=t)}get midiEventsPlayedFilter(){return this.player?this.player.midiEventsPlayedFilter:[]}set midiEventsPlayedFilter(t){this.player&&(this.player.midiEventsPlayedFilter=t)}get tickPosition(){return this.player?this.player.tickPosition:0}set tickPosition(t){this.player&&(this.player.tickPosition=t)}get timePosition(){return this.player?this.player.timePosition:0}set timePosition(t){this.player&&(this.player.timePosition=t)}get playbackRange(){return this.player?this.player.playbackRange:null}set playbackRange(t){this.player&&(this.player.playbackRange=t,this.settings.player.enableCursor&&this.updateSelectionCursor(t))}get playbackSpeed(){return this.player?this.player.playbackSpeed:0}set playbackSpeed(t){this.player&&(this.player.playbackSpeed=t)}get isLooping(){return!!this.player&&this.player.isLooping}set isLooping(t){this.player&&(this.player.isLooping=t)}destroyPlayer(){this.player&&(this.player.destroy(),this.player=null,this._previousTick=0,this._playerState=yn.Paused,this.destroyCursors())}setupPlayer(){this.updateCursors(),!this.player&&(this.player=this.uiFacade.createWorkerPlayer(),this.player&&(this.player.ready.on(()=>{this.loadMidiForScore()}),this.player.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(const t of this.tracks){const e=t.playbackInfo.volume/16;this.player.setChannelVolume(t.playbackInfo.primaryChannel,e),this.player.setChannelVolume(t.playbackInfo.secondaryChannel,e)}}),this.player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this.player.soundFontLoadFailed.on(t=>{this.onError(t)}),this.player.midiLoaded.on(this.onMidiLoaded.bind(this)),this.player.midiLoadFailed.on(t=>{this.onError(t)}),this.player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this.player.positionChanged.on(this.onPlayerPositionChanged.bind(this)),this.player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this.player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this.player.finished.on(this.onPlayerFinished.bind(this)),this.setupPlayerEvents()))}loadMidiForScore(){if(!this.score)return;const t=this.score;x.debug("AlphaTab","Generating Midi");const e=new Kr,i=new Ks(e),s=new Ne(t,this.settings,i),r=H.computeFirstDisplayedBarIndex(t,this.settings),a=H.computeLastDisplayedBarIndex(t,this.settings,r);s.tickLookup.multiBarRestInfo=H.buildMultiBarRestInfo(this.tracks,r,a),s.applyTranspositionPitches=!1,s.generate(),this._tickCache=s.tickLookup,this.onMidiLoad(e);const o=this.player;o&&(o.loadMidiFile(e),o.applyTranspositionPitches(s.transpositionPitches))}changeTrackVolume(t,e){if(this.player)for(const i of t)this.player.setChannelVolume(i.playbackInfo.primaryChannel,e),this.player.setChannelVolume(i.playbackInfo.secondaryChannel,e)}changeTrackSolo(t,e){if(this.player)for(const i of t)this.player.setChannelSolo(i.playbackInfo.primaryChannel,e),this.player.setChannelSolo(i.playbackInfo.secondaryChannel,e)}changeTrackMute(t,e){if(this.player)for(const i of t)this.player.setChannelMute(i.playbackInfo.primaryChannel,e),this.player.setChannelMute(i.playbackInfo.secondaryChannel,e)}changeTrackTranspositionPitch(t,e){if(this.player)for(const i of t)this.player.setChannelTranspositionPitch(i.playbackInfo.primaryChannel,e),this.player.setChannelTranspositionPitch(i.playbackInfo.secondaryChannel,e)}play(){return!!this.player&&this.player.play()}pause(){this.player&&this.player.pause()}playPause(){this.player&&this.player.playPause()}stop(){this.player&&this.player.stop()}playBeat(t){if(!this.player)return;const e=new Kr,i=new Ks(e);new Ne(t.voice.bar.staff.track.score,this.settings,i).generateSingleBeat(t),this.player.playOneTimeMidiFile(e)}playNote(t){if(!this.player)return;const e=new Kr,i=new Ks(e);new Ne(t.beat.voice.bar.staff.track.score,this.settings,i).generateSingleNote(t),this.player.playOneTimeMidiFile(e)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){if(this.settings.player.enableCursor&&!this._cursorWrapper){const t=this.uiFacade.createCursors();t&&(this._cursorWrapper=t.cursorWrapper,this._barCursor=t.barCursor,this._beatCursor=t.beatCursor,this._selectionWrapper=t.selectionWrapper),null!==this._currentBeat&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,!0)}else!this.settings.player.enableCursor&&this._cursorWrapper&&this.destroyCursors()}setupPlayerEvents(){this._previousTick=0,this._playerState=yn.Paused,this.renderer.postRenderFinished.on(()=>{this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,this._previousTick>10)}),this.player&&(this.player.positionChanged.on(t=>{this._previousTick=t.currentTick,this.uiFacade.beginInvoke(()=>{this.cursorUpdateTick(t.currentTick,!1,!1,t.isSeek)})}),this.player.stateChanged.on(t=>{if(this._playerState=t.state,!t.stopped&&t.state===yn.Paused){const e=this._currentBeat,i=this._tickCache;e&&i&&(this.player.tickPosition=i.getBeatStart(e.beat))}}))}cursorUpdateTick(t,e,i=!1,s=!1){const r=this._tickCache;if(r){const a=this._trackIndexLookup;if(null!=a&&a.size>0){const o=r.findBeat(a,t,this._currentBeat);o&&this.cursorUpdateBeat(o,e,i,s||this.playerState===yn.Paused)}}}cursorUpdateBeat(t,e,i,s=!1){const r=t.beat,a=t.nextBeat?.beat??null,o=t.duration,l=t.beatLookup.highlightedBeats;if(!r)return;const c=this.renderer.boundsLookup;if(!c)return;const u=this._currentBeat,h=this._previousCursorCache,f=this._previousStateForCursor;if(!s&&r===u?.beat&&c===h&&f===this._playerState&&u?.start===t.start)return;const p=c.findBeat(r);p&&(this._currentBeat=t,this._previousCursorCache=c,this._previousStateForCursor=this._playerState,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(r,a,o,e,l,c,p,i,t.cursorMode)}))}scrollToCursor(){const t=this._currentBarBounds;t&&this.internalScrollToCursor(t)}internalScrollToCursor(t){const e=this.uiFacade.getScrollContainer(),i=N.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,s=this.settings.player.scrollMode;if(i){const r=t.realBounds.y+this.settings.player.scrollOffsetY;if(r!==this._lastScroll)switch(this._lastScroll=r,s){case $a.Continuous:const a=this.uiFacade.getOffset(e,this.container);this.uiFacade.scrollToY(e,a.y+r,this.settings.player.scrollSpeed);break;case $a.OffScreen:const o=e.scrollTop+this.uiFacade.getOffset(null,e).h;(t.visualBounds.y+t.visualBounds.h>=o||t.visualBounds.y<e.scrollTop)&&this.uiFacade.scrollToY(e,t.realBounds.y+this.settings.player.scrollOffsetY,this.settings.player.scrollSpeed)}}else{const r=t.visualBounds.x;if(r!==this._lastScroll)switch(this._lastScroll=r,s){case $a.Continuous:const a=t.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=t.visualBounds.x,this.uiFacade.scrollToX(e,a,this.settings.player.scrollSpeed);break;case $a.OffScreen:const o=e.scrollLeft+this.uiFacade.getOffset(null,e).w;if(t.visualBounds.x+t.visualBounds.w>=o||t.visualBounds.x<e.scrollLeft){const l=t.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=t.visualBounds.x,this.uiFacade.scrollToX(e,l,this.settings.player.scrollSpeed)}}}}internalCursorUpdateBeat(t,e,i,s,r,a,o,l,c){const u=this._barCursor,h=this._beatCursor,f=o.barBounds.masterBarBounds,p=f.visualBounds;this._currentBarBounds=f,u&&u.setBounds(p.x,p.y,p.w,p.h),h&&(this.settings.player.enableAnimatedBeatCursor&&h.stopAnimation(),h.setBounds(o.onNotesX,p.y,1,p.h)),this.settings.player.enableElementHighlighting&&this.uiFacade.removeHighlights();let g=!1;const m=this._playerState===yn.Playing&&!s;if(m){if(this.settings.player.enableElementHighlighting)for(const y of r){const b=Zs.getGroupId(y.beat);this.uiFacade.highlightElements(b,t.voice.bar.index)}l=!s,g=!0}if(this.settings.player.enableAnimatedBeatCursor&&h){let y=f.visualBounds.x+f.visualBounds.w;if(e&&c===Ps.ToNextBext){const b=a.findBeat(e);b&&b.barBounds.masterBarBounds.staffSystemBounds===f.staffSystemBounds&&(y=b.onNotesX)}m&&this.uiFacade.beginInvoke(()=>{h.transitionToX(i/this.playbackSpeed,y)})}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==$a.Off&&this.internalScrollToCursor(f),g&&(this.onPlayedBeatChanged(t),this.onActiveBeatsChanged(new qI(r.map(y=>y.beat))))}onPlayedBeatChanged(t){this._isDestroyed||(this.playedBeatChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",t))}onActiveBeatsChanged(t){this._isDestroyed||(this.activeBeatsChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",t))}onBeatMouseDown(t,e){this._isDestroyed||(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new Ug(e),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseDown",e,t))}onNoteMouseDown(t,e){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(e),this.uiFacade.triggerEvent(this.container,"noteMouseDown",e,t))}onBeatMouseMove(t,e){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==e)&&(this._selectionEnd=new Ug(e),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseMove",e,t))}onNoteMouseMove(t,e){this._isDestroyed||(this.noteMouseMove.trigger(e),this.uiFacade.triggerEvent(this.container,"noteMouseMove",e,t))}onBeatMouseUp(t,e){if(!this._isDestroyed){if(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){const i=this._tickCache?.getBeatStart(this._selectionStart.beat)??this._selectionStart.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(this._selectionEnd.beat)??this._selectionEnd.beat.absolutePlaybackStart)<i){const r=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=r}}if(this._selectionStart&&this._tickCache){const i=this._tickCache,s=i.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._playerState===yn.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1),this.tickPosition=s+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){const r=i.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),a=new $I;a.startTick=s+this._selectionStart.beat.playbackStart,a.endTick=r+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=a}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(e),this.uiFacade.triggerEvent(this.container,"beatMouseUp",e,t),this._beatMouseDown=!1}}onNoteMouseUp(t,e){this._isDestroyed||(this.noteMouseUp.trigger(e),this.uiFacade.triggerEvent(this.container,"noteMouseUp",e,t),this._noteMouseDown=!1)}updateSelectionCursor(t){if(this._tickCache)if(t){const e=this._tickCache.findBeat(this._trackIndexLookup,t.startTick),i=this._tickCache.findBeat(this._trackIndexLookup,t.endTick);if(e&&i){const s=new Ug(e.beat),r=new Ug(i.beat);this.cursorSelectRange(s,r)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(t=>{if(!t.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&t.preventDefault();const e=t.getX(this.canvasElement),i=t.getY(this.canvasElement),s=this.renderer.boundsLookup?.getBeatAtPos(e,i)??null;if(s&&(this.onBeatMouseDown(t,s),this.settings.core.includeNoteBounds)){const r=this.renderer.boundsLookup?.getNoteAtPos(s,e,i);r&&this.onNoteMouseDown(t,r)}}),this.canvasElement.mouseMove.on(t=>{if(!this._beatMouseDown)return;const e=t.getX(this.canvasElement),i=t.getY(this.canvasElement),s=this.renderer.boundsLookup?.getBeatAtPos(e,i)??null;if(s&&(this.onBeatMouseMove(t,s),this._noteMouseDown)){const r=this.renderer.boundsLookup?.getNoteAtPos(s,e,i);r&&this.onNoteMouseMove(t,r)}}),this.canvasElement.mouseUp.on(t=>{if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&t.preventDefault();const e=t.getX(this.canvasElement),i=t.getY(this.canvasElement),s=this.renderer.boundsLookup?.getBeatAtPos(e,i)??null;if(this.onBeatMouseUp(t,s),this._noteMouseDown)if(s){const r=this.renderer.boundsLookup?.getNoteAtPos(s,e,i)??null;this.onNoteMouseUp(t,r)}else this.onNoteMouseUp(t,null)}),this.renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.settings.player.enablePlayer||!this.settings.player.enableCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(t,e){const i=this.renderer.boundsLookup;if(!i)return;const s=this._selectionWrapper;if(!s||(s.clear(),!t||!e||t.beat===e.beat))return;t.bounds||(t.bounds=i.findBeat(t.beat)),e.bounds||(e.bounds=i.findBeat(e.beat));const r=this._tickCache?.getBeatStart(t.beat)??t.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(e.beat)??e.beat.absolutePlaybackStart)<r){const c=t;t=e,e=c}const o=t.bounds.realBounds.x;let l=e.bounds.realBounds.x+e.bounds.realBounds.w;if(e.beat.index===e.beat.voice.beats.length-1&&(l=e.bounds.barBounds.masterBarBounds.realBounds.x+e.bounds.barBounds.masterBarBounds.realBounds.w),t.bounds.barBounds.masterBarBounds.staffSystemBounds!==e.bounds.barBounds.masterBarBounds.staffSystemBounds){const c=t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,u=t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,h=this.uiFacade.createSelectionElement();h.setBounds(o,t.bounds.barBounds.masterBarBounds.visualBounds.y,u-o,t.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(h);const p=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let m=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1;m<p;m++){const y=i.staffSystems[m],b=this.uiFacade.createSelectionElement();b.setBounds(c,y.visualBounds.y,u-c,y.visualBounds.h),s.appendChild(b)}const g=this.uiFacade.createSelectionElement();g.setBounds(c,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-c,e.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(g)}else{const c=this.uiFacade.createSelectionElement();c.setBounds(o,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-o,t.bounds.barBounds.masterBarBounds.visualBounds.h),s.appendChild(c)}}onScoreLoaded(t){this._isDestroyed||(this.scoreLoaded.trigger(t),this.uiFacade.triggerEvent(this.container,"scoreLoaded",t))}onResize(t){this._isDestroyed||(this.resize.trigger(t),this.uiFacade.triggerEvent(this.container,"resize",t))}onRenderStarted(t){this._isDestroyed||(this.renderStarted.trigger(t),this.uiFacade.triggerEvent(this.container,"renderStarted",t))}onRenderFinished(t){this._isDestroyed||(this.renderFinished.trigger(t),this.uiFacade.triggerEvent(this.container,"renderFinished",t))}onPostRenderFinished(){this._isDestroyed||(this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(t){this._isDestroyed||(x.error("API","An unexpected error occurred",t),this.error.trigger(t),this.uiFacade.triggerEvent(this.container,"error",t))}onPlayerReady(){this._isDestroyed||(this.playerReady.trigger(),this.uiFacade.triggerEvent(this.container,"playerReady",null))}onPlayerFinished(){this._isDestroyed||(this.playerFinished.trigger(),this.uiFacade.triggerEvent(this.container,"playerFinished",null))}onSoundFontLoaded(){this._isDestroyed||(this.soundFontLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null))}onMidiLoad(t){this._isDestroyed||(this.midiLoad.trigger(t),this.uiFacade.triggerEvent(this.container,"midiLoad",t))}onMidiLoaded(t){this._isDestroyed||(this.midiLoaded.trigger(t),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",t))}onPlayerStateChanged(t){this._isDestroyed||(this.playerStateChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playerStateChanged",t))}onPlayerPositionChanged(t){this._isDestroyed||null!==this.score&&this.tracks.length>0&&(this.playerPositionChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",t))}onMidiEventsPlayed(t){this._isDestroyed||(this.midiEventsPlayed.trigger(t),this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",t))}onPlaybackRangeChanged(t){this._isDestroyed||(this.playbackRangeChanged.trigger(t),this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",t))}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}enumerateOutputDevices(){var t=this;return qi(function*(){return t.player?yield t.player.output.enumerateOutputDevices():[]})()}setOutputDevice(t){var e=this;return qi(function*(){e.player&&(yield e.player.output.setOutputDevice(t))})()}getOutputDevice(){var t=this;return qi(function*(){return t.player?yield t.player.output.getOutputDevice():null})()}}class ia extends nt{constructor(t,e){super(it.General,t),this.xhr=e,Object.setPrototypeOf(this,ia.prototype)}}class jo{static loadScoreAsync(t,e,i,s){const r=new XMLHttpRequest;r.open("GET",t,!0,null,null),r.responseType="arraybuffer",r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE)if(200===r.status||0===r.status&&r.response)try{const l=new Uint8Array(r.response),c=jo.loadScoreFromBytes(l,s);e(c)}catch(o){i(o)}else i(new ia(0===r.status?"You are offline!!\n Please Check Your Network.":404===r.status?"Requested URL not found.":500===r.status?"Internel Server Error.":"parsererror"===r.statusText?"Error.\nParsing JSON Request failed.":"timeout"===r.statusText?"Request Time out.":`Unknow Error: ${r.responseText}`,r))},r.send()}static loadScoreFromBytes(t,e){e||(e=new qa);const i=N.buildImporters();x.debug("ScoreLoader",`Loading score from ${t.length} bytes using ${i.length} importers`);let s=null;const r=Wt.fromBuffer(t);for(const a of i){r.reset();try{x.debug("ScoreLoader",`Importing using importer ${a.name}`),a.init(r,e),s=a.readScore(),x.debug("ScoreLoader",`Score imported using ${a.name}`);break}catch(o){if(!(o instanceof Ht))throw x.error("ScoreLoader","Score import failed due to unexpected error: ",o),o;x.debug("ScoreLoader",`${a.name} does not support the file`)}}if(s)return s;throw new Ht("No compatible importer found for file")}}class r_{get isLeftMouseButton(){return 0===this.mouseEvent.button}getX(t){const e=t.element,s=e.getBoundingClientRect().left+e.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-s}getY(t){const e=t.element,s=e.getBoundingClientRect().top+e.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-s}preventDefault(){this.mouseEvent.preventDefault()}constructor(t){this.mouseEvent=t}}class Br{get width(){return this.element.offsetWidth}set width(t){this.element.style.width=`${t}px`}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(t){this.element.scrollLeft=t}get scrollTop(){return this.element.scrollTop}set scrollTop(t){this.element.scrollTop=t}get height(){return this.element.offsetHeight}set height(t){this.element.style.height=t>=0?`${t}px`:"100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(t){this._resizeListeners=0,this.lastBounds=new kn,this.element=t,this.mouseDown={on:e=>{this.element.addEventListener("mousedown",i=>{e(new r_(i))},!0)},off:e=>{}},this.mouseUp={on:e=>{this.element.addEventListener("mouseup",i=>{e(new r_(i))},!0)},off:e=>{}},this.mouseMove={on:e=>{this.element.addEventListener("mousemove",i=>{e(new r_(i))},!0)},off:e=>{}},this.resize={on:e=>{0===this._resizeListeners&&Br.resizeObserver.value.observe(this.element),this.element.addEventListener("resize",e,!0),this._resizeListeners++},off:e=>{this.element.removeEventListener("resize",e,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,Br.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(t,e){this.element.style.transition=`transform ${t}ms linear`,this.setBounds(e,Number.NaN,Number.NaN,Number.NaN)}setBounds(t,e,i,s){Number.isNaN(t)&&(t=this.lastBounds.x),Number.isNaN(e)&&(e=this.lastBounds.y),Number.isNaN(i)&&(i=this.lastBounds.w),Number.isNaN(s)&&(s=this.lastBounds.h),this.element.style.transform=`translate(${t}px, ${e}px) scale(${i}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=t,this.lastBounds.y=e,this.lastBounds.w=i,this.lastBounds.h=s}appendChild(t){this.element.appendChild(t.element)}clear(){this.element.innerHTML=""}}Br.resizeObserver=new cg(()=>new ResizeObserver(n=>{for(const t of n){const e=new CustomEvent("resize",{detail:t});t.target.dispatchEvent(e)}}));class YI{constructor(t){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new qe,this._originalFamilies=t,this._families=t}checkForFontAvailability(){var t=this;if(N.isRunningInWorker)return void(this.isFontLoaded=!1);if(this._isStarted)return;this._isStarted=!0;let e=0;const i=window.setInterval(()=>{x.warning("Rendering",`Could not load font '${this._families[0]}' within ${5*(e+1)} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);x.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);const s=o=>{this._families.length>1?(x.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,o),this._families.shift(),window.setTimeout(()=>{a()},0)):(x.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,o),window.clearInterval(i))},r=o=>{x.debug("Font",`[${o}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(i),this.fontLoaded.trigger(this._families[0])},a=function(){var o=qi(function*(){for(const l of t._families)if(yield t.isFontAvailable(l,!1))return void r(l);try{yield document.fonts.load(`1em ${t._families[0]}`)}catch(l){s(l)}return x.debug("Font",`[${t._families[0]}] Font API signaled loaded`),(yield t.isFontAvailable(t._families[0],!0))?r(t._families[0]):s("Font not available"),!0});return function(){return o.apply(this,arguments)}}();document.fonts.ready.then(()=>{a()})}isFontAvailable(t,e){return new Promise(i=>{const s=`1em ${t}`;if(document.fonts.check(s))i(!0);else if(e){x.debug("Font",`Font ${t} not available, creating test element to trigger load`);const r=document.createElement("div");r.style.font=s,r.style.opacity="0",r.style.position="absolute",r.style.top="0",r.style.left="0",r.innerText=`Trigger ${t} load`,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r),document.fonts.check(s)?i(!0):i(!1)},200)}else i(!1)})}}class a_{constructor(t){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(t)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(t,e,i){let s=0;i>this._buffer.length-this.count&&(i=this._buffer.length-this.count);const r=Math.min(this._buffer.length-this._writePosition,i);return this._buffer.set(t.subarray(e,e+r),this._writePosition),this._writePosition+=r,this._writePosition%=this._buffer.length,s+=r,s<i&&(this._buffer.set(t.subarray(e+s,e+s+i-s),this._writePosition),this._writePosition+=i-s,s=i),this.count+=s,s}read(t,e,i){i>this.count&&(i=this.count);let s=0;const r=Math.min(this._buffer.length-this._readPosition,i);return t.set(this._buffer.subarray(this._readPosition,this._readPosition+r),e),s+=r,this._readPosition+=r,this._readPosition%=this._buffer.length,s<i&&(t.set(this._buffer.subarray(this._readPosition,this._readPosition+i-s),e+s),this._readPosition+=i-s,s=i),this.count-=s,s}}class j9{constructor(t){this.isDefault=!1,this.device=t}get deviceId(){return this.device.deviceId}get label(){return this.device.label}}let qo=(()=>{class n{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new Cn,this.samplesPlayed=new qe,this.sampleRequest=new Cn,this._knownDevices=[]}get sampleRate(){return this._context?this._context.sampleRate:n.PreferredSampleRate}activate(e){this._context||(this._context=this.createAudioContext()),("suspended"===this._context.state||"interrupted"===this._context.state)&&(x.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{x.debug("WebAudio",`Audio Context resume success: state=${this._context?.state}, sampleRate:${this._context?.sampleRate}`),e&&e()},i=>{x.warning("WebAudio",`Audio Context resume failed: state=${this._context?.state}, sampleRate:${this._context?.sampleRate}, reason=${i}`)}))}patchIosSampleRate(){const e=navigator.userAgent;if(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")){const i=this.createAudioContext(),s=i.createBuffer(1,1,n.PreferredSampleRate),r=i.createBufferSource();r.buffer=s,r.connect(i.destination),r.start(0),r.disconnect(0),i.close()}}createAudioContext(){if("AudioContext"in N.globalThis)return new AudioContext;if("webkitAudioContext"in N.globalThis)return new webkitAudioContext;throw new nt(it.General,"AudioContext not found")}open(e){this.patchIosSampleRate(),this._context=this.createAudioContext(),"suspended"===this._context.state&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){const e=this._context;this.activate(),this._buffer=e.createBuffer(2,n.BufferSize,e.sampleRate),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){this.pause(),this._context?.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}checkSinkIdSupport(){var e=this;return qi(function*(){return"setSinkId"in(e._context??e.createAudioContext())||(x.warning("WebAudio","Browser does not support changing the output device"),!1)})()}enumerateOutputDevices(){var e=this;return qi(function*(){try{if(!(yield e.checkSinkIdSupport()))return[];try{yield navigator.mediaDevices.getUserMedia({audio:!0})}catch(c){x.warning("WebAudio","Output device permission rejected",c)}const i=yield navigator.mediaDevices.enumerateDevices();let s="",r="";const a=new Map;for(const c of i)"audiooutput"===c.kind&&(a.set(c.groupId,new j9(c)),("default"===c.deviceId||""===c.deviceId)&&(s=c.groupId,r=c.deviceId));const o=Array.from(a.values());let l=o.find(c=>c.deviceId===r);return l||(l=o.find(c=>c.device.groupId===s)),!l&&o.length>0&&(l=o[0]),l&&(l.isDefault=!0),e._knownDevices=o,o}catch(i){return x.error("WebAudio","Failed to enumerate output devices",i),[]}})()}setOutputDevice(e){var i=this;return qi(function*(){(yield i.checkSinkIdSupport())&&(e?yield i._context.setSinkId(e.deviceId):yield i._context.setSinkId(""))})()}getOutputDevice(){var e=this;return qi(function*(){if(!(yield e.checkSinkIdSupport()))return null;const i=e._context.sinkId;if("string"!=typeof i||""===i||"default"===i)return null;let s=e._knownDevices.find(a=>a.deviceId===i);if(s)return s;const r=yield e.enumerateOutputDevices();return s=r.find(a=>a.deviceId===i),s||(x.warning("WebAudio","Could not find output device in device list",i,r),null)})()}}return n.BufferSize=4096,n.PreferredSampleRate=44100,n})();class XI extends qo{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(t){super.open(t),this._bufferCount=Math.floor(t*this.sampleRate/1e3/qo.BufferSize),this._circularBuffer=new a_(qo.BufferSize*this._bufferCount),this.onReady()}play(){super.play();const t=this._context;this._audioNode=t.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=t.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(t.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(t){this._circularBuffer.write(t,0,t.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const t=this._bufferCount/2|0;if(this._circularBuffer.count+this._requestedBufferCount*qo.BufferSize<t*qo.BufferSize){for(let s=0;s<t;s++)this.onSampleRequest();this._requestedBufferCount+=t}}generateSound(t){const e=t.outputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(1),s=e.length+i.length;let r=this._outputBuffer;r.length!==s&&(r=new Float32Array(s),this._outputBuffer=r);const a=this._circularBuffer.read(r,0,Math.min(r.length,this._circularBuffer.count));let o=0;const l=Math.min(e.length,a);for(let c=0;c<l;c++)e[c]=r[o++],i[c]=r[o++];if(a<e.length)for(let c=a;c<e.length;c++)e[c]=0,i[c]=0;this.onSamplesPlayed(a/he.AudioChannels),this.requestBuffers()}}class q9{constructor(t,e){this.loaded=t,this.total=e}}class o_{get output(){return this._output}get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return x.logLevel}set logLevel(t){x.logLevel=t,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:t})}get masterVolume(){return this._masterVolume}set masterVolume(t){t=Math.max(t,he.MinVolume),this._masterVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:t})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(t){t=Math.max(t,he.MinVolume),this._metronomeVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:t})}get countInVolume(){return this._countInVolume}set countInVolume(t){t=Math.max(t,he.MinVolume),this._countInVolume=t,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:t})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(t){this._midiEventsPlayedFilter=t,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:t})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(t){t=H.clamp(t,he.MinPlaybackSpeed,he.MaxPlaybackSpeed),this._playbackSpeed=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:t})}get tickPosition(){return this._tickPosition}set tickPosition(t){t<0&&(t=0),this._tickPosition=t,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:t})}get timePosition(){return this._timePosition}set timePosition(t){t<0&&(t=0),this._timePosition=t,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:t})}get isLooping(){return this._isLooping}set isLooping(t){this._isLooping=t,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:t})}get playbackRange(){return this._playbackRange}set playbackRange(t){t&&(t.startTick<0&&(t.startTick=0),t.endTick<0&&(t.endTick=0)),this._playbackRange=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:t})}constructor(t,e){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=yn.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this.ready=new Cn,this.readyForPlayback=new Cn,this.finished=new Cn,this.soundFontLoaded=new Cn,this.soundFontLoadFailed=new qe,this.midiLoaded=new qe,this.midiLoadFailed=new qe,this.stateChanged=new qe,this.positionChanged=new qe,this.midiEventsPlayed=new qe,this.playbackRangeChanged=new qe,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=yn.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=t,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(e.player.bufferTimeInMilliseconds);try{this._synth=N.createWebWorker(e)}catch(i){x.error("AlphaSynth",`Failed to create WebWorker: ${i}`)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:e.core.logLevel,bufferTimeInMilliseconds:e.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(t){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:on.midiFileToJsObject(t)})}loadSoundFont(t,e){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:t,append:e})}loadSoundFontFromUrl(t,e,i){x.debug("AlphaSynth",`Start loading Soundfont from url ${t}`);const s=new XMLHttpRequest;s.open("GET",t,!0,null,null),s.responseType="arraybuffer",s.onload=r=>{const a=new Uint8Array(s.response);this.loadSoundFont(a,e)},s.onerror=r=>{x.error("AlphaSynth",`Loading failed: ${r.message}`),this.soundFontLoadFailed.trigger(new ia(r.message,s))},s.onprogress=r=>{x.debug("AlphaSynth",`Soundfont downloading: ${r.loaded}/${r.total} bytes`),i(new q9(r.loaded,r.total))},s.send()}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(t){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:on.midiFileToJsObject(t)})}applyTranspositionPitches(t){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(t.entries()))})}setChannelTranspositionPitch(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:t,semitones:e})}setChannelMute(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:t,mute:e})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:t,solo:e})}setChannelVolume(t,e){e=Math.max(e,he.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:t,volume:e})}handleWorkerMessage(t){const e=t.data;switch(e.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=e.currentTime,this._tickPosition=e.currentTick,this.positionChanged.trigger(new Lh(e.currentTime,e.endTime,e.currentTick,e.endTick,e.isSeek));break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new YS(e.events.map(on.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=e.state,this.stateChanged.trigger(new Fh(e.state,e.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=e.playbackRange,this.playbackRangeChanged.trigger(new XS(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(e.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this.midiLoaded.trigger(new Lh(e.currentTime,e.endTime,e.currentTick,e.endTick,e.isSeek));break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(e.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(e.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples()}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(t){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:t})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}}class Y9{constructor(t,e){this._width=0,this.boundsLookup=null,this.preRender=new qe,this.partialRenderFinished=new qe,this.partialLayoutFinished=new qe,this.renderFinished=new qe,this.postRenderFinished=new Cn,this.error=new qe,this._api=t;try{this._worker=N.createWebWorker(e)}catch(i){return void x.error("Rendering",`Failed to create WebWorker: ${i}`)}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(e)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(t){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(t)})}serializeSettingsForWorker(t){const e=on.settingsToJsObject(t);return e.delete("player"),e}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(t){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:t})}get width(){return this._width}set width(t){this._width=t,this._worker.postMessage({cmd:"alphaTab.setWidth",width:t})}handleWorkerMessage(t){const e=t.data;switch(e.cmd){case"alphaTab.preRender":this.preRender.trigger(e.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(e.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(e.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(e.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=Di.fromJson(e.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(e.error)}}renderScore(t,e){const i=null==t?null:on.scoreToJsObject(t);this._worker.postMessage({cmd:"alphaTab.renderScore",score:i,trackIndexes:e,fontSizes:ri.FontSizeLookupTables})}}class JI{constructor(t,e,i,s){this.cursorWrapper=t,this.barCursor=e,this.beatCursor=i,this.selectionWrapper=s}}let X9=(()=>{class n{static init(){var e;n._isRegistered||(n._isRegistered=!0,registerProcessor("alphatab",((e=class extends AudioWorkletProcessor{constructor(s){super(s),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,this._isStopped=!1,x.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(s.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/e.BufferSize),this._circularBuffer=new a_(e.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(s){const r=s.data;switch(r.cmd){case kt.CmdOutputAddSamples:const o=r.samples;this._circularBuffer.write(o,0,o.length),this._requestedBufferCount--;break;case kt.CmdOutputResetSamples:this._circularBuffer.clear();break;case kt.CmdOutputStop:this._isStopped=!0}}process(s,r,a){if(1!==r.length&&2!==r[0].length)return!1;const o=r[0][0],l=r[0][1];if(!o||!l)return!0;const c=o.length+l.length;let u=this._outputBuffer;u.length!==c&&(u=new Float32Array(c),this._outputBuffer=u);const h=this._circularBuffer.read(u,0,Math.min(u.length,this._circularBuffer.count));let f=0;const p=Math.min(o.length,h);for(let g=0;g<p;g++)o[g]=u[f++],l[g]=u[f++];if(h<o.length)for(let g=h;g<o.length;g++)o[g]=0,l[g]=0;return this.port.postMessage({cmd:kt.CmdOutputSamplesPlayed,samples:h/he.AudioChannels}),this.requestBuffers(),this._circularBuffer.count>0||!this._isStopped}requestBuffers(){const s=this._bufferCount/2|0;if(this._circularBuffer.count+this._requestedBufferCount*e.BufferSize<s*e.BufferSize){for(let o=0;o<s;o++)this.port.postMessage({cmd:kt.CmdOutputSampleRequest});this._requestedBufferCount+=s}}}).BufferSize=4096,e)))}}return n._isRegistered=!1,n})();class QI extends qo{constructor(t){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=t}open(t){super.open(t),this._bufferTimeInMilliseconds=t,this.onReady()}play(){super.play();const t=this._context;N.createAudioWorklet(t,this._settings).then(()=>{this._worklet=new AudioWorkletNode(t,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(t.destination)},e=>{x.error("WebAudio",`Audio Worklet creation failed: reason=${e}`)})}handleMessage(t){const e=t.data;switch(e.cmd){case kt.CmdOutputSamplesPlayed:this.onSamplesPlayed(e.samples);break;case kt.CmdOutputSampleRequest:this.onSampleRequest()}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:kt.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(t){this._worklet?.port.postMessage({cmd:kt.CmdOutputAddSamples,samples:t})}resetSamples(){this._worklet?.port.postMessage({cmd:kt.CmdOutputResetSamples})}}class J9 extends Br{constructor(t,e,i){super(t),this._xscale=e,this._yscale=i}get width(){return this.element.offsetWidth/this._xscale}set width(t){this.element.style.width=t*this._xscale+"px"}get height(){return this.element.offsetHeight/this._yscale}set height(t){this.element.style.height=t>=0?t*this._yscale+"px":"100%"}setBounds(t,e,i,s){Number.isNaN(t)&&(t=this.lastBounds.x),Number.isNaN(e)&&(e=this.lastBounds.y),Number.isNaN(i)?i=this.lastBounds.w:i/=this._xscale,Number.isNaN(s)?s=this.lastBounds.h:s/=this._yscale,this.element.style.transform=`translate(${t}px, ${e}px) scale(${i}, ${s})`,this.element.style.transformOrigin="top left",this.lastBounds.x=t,this.lastBounds.y=e,this.lastBounds.w=i,this.lastBounds.h=s}}var sa=function(n){return n[n.LayoutDone=0]="LayoutDone",n[n.RenderRequested=1]="RenderRequested",n[n.RenderDone=2]="RenderDone",n[n.Detached=3]="Detached",n}(sa||{});class Q9{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){if(N.bravuraFontChecker.checkForFontAvailability(),!N.bravuraFontChecker.isFontLoaded)return!1;let t=!1;for(const e of this._fontCheckers.values())e.isFontLoaded||(t=!0);return!t&&(x.debug("Font",`All fonts loaded: ${this._fontCheckers.size}`),!0)}onFontLoaded(t){ri.generateFontLookup(t),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(t){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new Cn,this.canRenderChanged=new Cn,this._highlightedElements=[],this._scrollContainer=null,N.webPlatform!==Ui.Browser&&N.webPlatform!==Ui.BrowserModule)throw new nt(it.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");t.classList.add("alphaTab"),this.rootContainer=new Br(t),this.areWorkersSupported="Worker"in window,N.bravuraFontChecker.fontLoaded.on(this.onFontLoaded.bind(this)),this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(t)}onElementVisibilityChanged(t){for(const e of t){const i=e.target;if(i===this.rootContainer.element)e.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in i&&this._api.settings.core.enableLazyLoading){const s=i;e.isIntersecting?s.renderedResultId!==s.layoutResultId?this._resultIdToElementLookup.has(s.layoutResultId)?s.resultState!==sa.RenderRequested&&(s.resultState=sa.RenderRequested,this._api.renderer.renderResult(s.layoutResultId)):i.replaceChildren():s.resultState===sa.Detached&&(i.replaceChildren(...s.renderedResult),s.resultState=sa.RenderDone):s.resultState===sa.RenderDone&&(s.resultState=sa.Detached,s.replaceChildren())}}}createWorkerRenderer(){return new Y9(this._api,this._api.settings)}initialize(t,e){let i;this._api=t,i=e instanceof qa?e:on.jsObjectToSettings(e);const s=this.getDataAttributes();ja.fromJson(i,s),i.notation.notationMode===_n.SongBook&&i.setSongBookModeSettings(),t.settings=i,this.setupFontCheckers(i),this._initialTrackIndexes=this.parseTracks(i.core.tracks),this._contents="";const r=t.container;i.core.tex&&(this._contents=r.element.innerHTML,r.element.innerHTML=""),this.createStyleElement(i),this._file=i.core.file}setupFontCheckers(t){this.registerFontChecker(t.display.resources.copyrightFont),this.registerFontChecker(t.display.resources.effectFont),this.registerFontChecker(t.display.resources.fingeringFont),this.registerFontChecker(t.display.resources.graceFont),this.registerFontChecker(t.display.resources.markerFont),this.registerFontChecker(t.display.resources.tablatureFont),this.registerFontChecker(t.display.resources.titleFont),this.registerFontChecker(t.display.resources.wordsFont),this.registerFontChecker(t.display.resources.barNumberFont),this.registerFontChecker(t.display.resources.fretboardNumberFont),this.registerFontChecker(t.display.resources.subTitleFont)}registerFontChecker(t){if(!this._fontCheckers.has(t.families.join(", "))){const e=new YI(t.families);this._fontCheckers.set(t.families.join(", "),e),e.fontLoaded.on(this.onFontLoaded.bind(this)),e.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML=""}createCanvasElement(){const t=document.createElement("div");return t.className="at-surface",t.style.fontSize="0",t.style.overflow="hidden",t.style.lineHeight="0",t.style.position="relative",new Br(t)}triggerEvent(t,e,i=null,s){const r=t.element;e=`alphaTab.${e}`;const a=document.createEvent("CustomEvent"),o=s?s.mouseEvent:null;if(a.initCustomEvent(e,!1,!1,i),o&&(a.originalEvent=o),r.dispatchEvent(a),window&&"jQuery"in window){const l=window.jQuery,c=[];c.push(i),o&&c.push(o),l(r).trigger(e,c)}}load(t,e,i){if(t instanceof Dr)return e(t),!0;if(t instanceof ArrayBuffer){const s=new Uint8Array(t);return e(jo.loadScoreFromBytes(s,this._api.settings)),!0}return t instanceof Uint8Array?(e(jo.loadScoreFromBytes(t,this._api.settings)),!0):"string"==typeof t&&(jo.loadScoreAsync(t,e,i,this._api.settings),!0)}loadSoundFont(t,e){return!(!this._api.player||(t instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(t),e),0):t instanceof Uint8Array?(this._api.player.loadSoundFont(t,e),0):"string"!=typeof t||(this._api.loadSoundFontFromUrl(t,e),0)))}initialRender(){this._api.renderer.preRender.on(e=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const t=()=>{this._api.renderer.width=0|this.rootContainer.width,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&jo.loadScoreAsync(this._file,e=>{this._api.renderScore(e,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},e=>{this._api.onError(e)},this._api.settings)};this.rootContainer.isVisible?t():this.rootContainerBecameVisible.on(t)}createStyleElement(t){N.createStyleElement(this._api.container.element.ownerDocument,t.core.fontDirectory)}parseTracks(t){if(!t)return[];const e=[];if("string"==typeof t)try{if("all"===t)return[-1];t=JSON.parse(t)}catch{t=[0]}if("number"==typeof t)e.push(t);else if("length"in t){const i=t.length,s=t;for(let r=0;r<i;r++){const a=s[r];let o=0;o="number"==typeof a?a:"index"in a?a.index:Number.parseInt(a.toString()),(o>=0||-1===o)&&e.push(o)}}else"index"in t&&e.push(t.index);return e}getDataAttributes(){const t=new Map,e=this._api.container.element;if(e.dataset)for(const i of Object.keys(e.dataset)){let s=e.dataset[i];try{s=JSON.parse(s)}catch{""===s&&(s=null)}t.set(i,s)}else for(let i=0;i<e.attributes.length;i++){const s=e.attributes.item(i),r=s.nodeName;if(r.startsWith("data-")){const a=r.substr(5).split("-");let o=a[0];for(let c=1;c<a.length;c++)o+=a[c].substr(0,1).toUpperCase()+a[c].substr(1);let l=s.nodeValue;try{l=JSON.parse(l)}catch{""===l&&(l=null)}t.set(o,l)}}return t}beginUpdateRenderResults(t){if(!this._resultIdToElementLookup.has(t.id))return;const e=this._resultIdToElementLookup.get(t.id),i=t.renderResult;"string"==typeof i?e.innerHTML=i:"nodeType"in i&&e.replaceChildren(i),e.resultState=sa.RenderDone,e.renderedResultId=t.id,e.renderedResult=Array.from(e.children)}beginAppendRenderResults(t){const e=this._api.canvasElement.element;if(t){let i;this._totalResultCount<e.childElementCount?i=e.childNodes.item(this._totalResultCount):(i=document.createElement("div"),e.appendChild(i)),i.style.zIndex="1",i.style.position="absolute",i.style.left=`${t.x}px`,i.style.top=`${t.y}px`,i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.display="inline-block",i.layoutResultId=t.id,i.resultState=sa.LayoutDone,i.renderedResultId=void 0,i.renderedResult=void 0,this._resultIdToElementLookup.set(t.id,i);for(let s=t.firstMasterBarIndex;s<=t.lastMasterBarIndex;s++)s>=0&&this._barToElementLookup.set(s,i);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(i),this._intersectionObserver.observe(i)),this._totalResultCount++}else for(;e.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(e.lastChild),e.removeChild(e.lastElementChild)}createWorkerPlayer(){let t=null;const e="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===yg.WebAudioAudioWorklets?(x.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),t=new o_(new QI(this._api.settings),this._api.settings)):e&&(x.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),t=new o_(new XI,this._api.settings)),t?t.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):x.error("Player","Player requires webworkers and web audio api, browser unsupported",null),t}beginInvoke(t){window.requestAnimationFrame(()=>{t()})}highlightElements(t,e){const i=this._barToElementLookup.get(e);if(i){const s=i.getElementsByClassName(t);for(let r=0;r<s.length;r++)s.item(r).classList.add("at-highlight"),this._highlightedElements.push(s.item(r))}}removeHighlights(){const t=this._highlightedElements;if(t){for(const e of t)e.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){const t=this._api.container.element,e=t.querySelector(".at-cursors");t.removeChild(e)}createCursors(){const t=this._api.container.element,e=document.createElement("div");e.classList.add("at-cursors");const i=document.createElement("div");i.classList.add("at-selection");const s=this.createScalingElement(),r=this.createScalingElement(),a=s.element;a.classList.add("at-cursor-bar");const o=r.element;return o.classList.add("at-cursor-beat"),t.style.position="relative",t.style.textAlign="left",e.style.position="absolute",e.style.zIndex="1000",e.style.display="inline",e.style.pointerEvents="none",i.style.position="absolute",a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.willChange="transform",s.width=1,s.height=1,s.setBounds(0,0,1,1),o.style.position="absolute",o.style.transition="all 0s linear",o.style.left="0",o.style.top="0",o.style.willChange="transform",r.width=3,r.height=1,r.setBounds(0,0,1,1),t.insertBefore(e,t.firstChild),e.appendChild(i),e.appendChild(a),e.appendChild(o),new JI(new Br(e),s,r,new Br(i))}getOffset(t,e){const i=e.element,s=i.getBoundingClientRect();let r=s.top+i.ownerDocument.defaultView.pageYOffset,a=s.left+i.ownerDocument.defaultView.pageXOffset;if(t){const l=t.element,c=l.nodeName.toLowerCase();if("html"!==c&&"body"!==c){const u=this.getOffset(null,t);r=r+l.scrollTop-u.y,a=a+l.scrollLeft-u.x}}const o=new kn;return o.x=a,o.y=r,o.w=s.width,o.h=s.height,o}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let t="string"==typeof this._api.settings.player.scrollElement?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement;const e=t.nodeName.toLowerCase();return("html"===e||"body"===e)&&(t="scrollingElement"in document?document.scrollingElement:-1!==navigator.userAgent.indexOf("WebKit")?document.body:document.documentElement),this._scrollContainer=new Br(t),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const t=document.createElement("div");t.style.position="absolute";const e=new J9(t,100,100);return e.width=1,e.height=1,e.setBounds(0,0,1,1),e}scrollToY(t,e,i){this.internalScrollToY(t.element,e,i)}scrollToX(t,e,i){this.internalScrollToX(t.element,e,i)}internalScrollToY(t,e,i){if(this._api.settings.player.nativeBrowserSmoothScroll)t.scrollTo({top:e,behavior:"smooth"});else{const s=t.scrollTop,r=e-s;let a=0;const o=l=>{0===a&&(a=l);const c=l-a,u=Math.min(c/i,1);t.scrollTop=s+r*u|0,c<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}internalScrollToX(t,e,i){if(this._api.settings.player.nativeBrowserSmoothScroll)t.scrollTo({left:e,behavior:"smooth"});else{const s=t.scrollLeft,r=e-s;let a=0;const o=l=>{0===a&&(a=l);const c=l-a,u=Math.min(c/i,1);t.scrollLeft=s+r*u|0,c<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}}class Gg extends $9{constructor(t,e){super(new Q9(t),e),this.soundFontLoad=new qe}tex(t,e){super.tex(t,this.uiFacade.parseTracks(e))}print(t,e=null){const i=window.open("","","width=0,height=0"),s=i.document.createElement("div");s.style.width=t||(this.settings.display.layoutMode===Wa.Horizontal?"297mm":"210mm"),i.document.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <style>\n            .at-surface {\n                width: auto !important;\n                height: auto !important;\n            }\n            .at-surface > div {\n                position: relative!important;\n                left: auto !important;\n                top: auto !important;\n                break-inside: avoid;\n            }\n            </style>\n          </head>\n          <body></body>\n        </html>\n        ");const r=this.score;r&&(r.artist&&r.title?i.document.title=`${r.title} - ${r.artist}`:r.title&&(i.document.title=`${r.title}`)),i.document.body.appendChild(s);const a=typeof window.screenLeft<"u"?window.screenLeft:window.left,o=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,c="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,u=s.offsetWidth+50,h=window.innerHeight,f=(l/2|0)-(u/2|0)+a,p=(c/2|0)-(h/2|0)+o;i.resizeTo(u,h),i.moveTo(f,p),i.focus();const g=on.jsObjectToSettings(on.settingsToJsObject(this.settings));g.core.enableLazyLoading=!1,g.core.useWorkers=!0,g.core.file=null,g.core.tracks=null,g.player.enableCursor=!1,g.player.enablePlayer=!1,g.player.enableElementHighlighting=!1,g.player.enableUserInteraction=!1,g.player.soundFont=null,g.display.scale=.8,g.display.stretchForce=.8,ja.fromJson(g,e);const m=new Gg(s,g);i.onunload=()=>{m.destroy()},m.renderer.postRenderFinished.on(()=>{i.print()}),m.renderTracks(this.tracks)}downloadMidi(t=Cc.SingleTrackMultiChannel){if(!this.score)return;const e=new Kr;e.format=t;const i=new Ks(e,!0);new Ne(this.score,this.settings,i).generate();const r=e.toBinary(),a=this.score.title?`${this.score.title}.mid`:"File.mid",o=document.createElement("a");o.download=a;const l=new Blob([r],{type:"audio/midi"}),c=URL.createObjectURL(l);o.href=c,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}changeTrackMute(t,e){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));super.changeTrackMute(i,e)}changeTrackSolo(t,e){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));super.changeTrackSolo(i,e)}changeTrackVolume(t,e){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(t));super.changeTrackVolume(i,e)}trackIndexesToTracks(t){if(!this.score)return[];const e=[];if(1===t.length&&-1===t[0])for(const i of this.score.tracks)e.push(i);else for(const i of t)i>=0&&i<this.score.tracks.length&&e.push(this.score.tracks[i]);return e}loadSoundFontFromUrl(t,e){this.player&&this.player.loadSoundFontFromUrl(t,e,i=>{this.soundFontLoad.trigger(i),this.uiFacade.triggerEvent(this.container,"soundFontLoad",i)})}}class KI{constructor(){this._initListeners=[]}exec(t,e,i){if("string"!=typeof e&&(i=[e],e="init"),95===e.charCodeAt(0)||"exec"===e)return null;const s=new jQuery(t),r=s.data("alphaTab");if("destroy"===e&&!r)return null;if("init"!==e&&!r)throw new Error("alphaTab not initialized");const a=this[e];if(a){const o=[s,r].concat(i);return a.apply(this,o)}return x.error("Api",`Method '${e}' does not exist on jQuery.alphaTab`),null}init(t,e,i){if(!e){e=new Gg(t[0],i),t.data("alphaTab",e);for(const s of this._initListeners)s(t,e,i)}}destroy(t,e){t.removeData("alphaTab"),e.destroy()}print(t,e,i,s){e.print(i,s)}load(t,e,i,s){return e.load(i,s)}render(t,e){e.render()}renderScore(t,e,i,s){e.renderScore(i,s)}renderTracks(t,e,i){e.renderTracks(i)}invalidate(t,e){e.render()}tex(t,e,i,s){e.tex(i,s)}muteTrack(t,e,i,s){e.changeTrackMute(i,s)}soloTrack(t,e,i,s){e.changeTrackSolo(i,s)}trackVolume(t,e,i,s){e.changeTrackVolume(i,s)}loadSoundFont(t,e,i,s){e.loadSoundFont(i,s)}resetSoundFonts(t,e){e.resetSoundFonts()}pause(t,e){e.pause()}play(t,e){return e.play()}playPause(t,e){e.playPause()}stop(t,e){e.stop()}api(t,e){return e}player(t,e){return e.player}isReadyForPlayback(t,e){return e.isReadyForPlayback}playerState(t,e){return e.playerState}masterVolume(t,e,i){return"number"==typeof i&&(e.masterVolume=i),e.masterVolume}metronomeVolume(t,e,i){return"number"==typeof i&&(e.metronomeVolume=i),e.metronomeVolume}countInVolume(t,e,i){return"number"==typeof i&&(e.countInVolume=i),e.countInVolume}midiEventsPlayedFilter(t,e,i){return Array.isArray(i)&&(e.midiEventsPlayedFilter=i),e.midiEventsPlayedFilter}playbackSpeed(t,e,i){return"number"==typeof i&&(e.playbackSpeed=i),e.playbackSpeed}tickPosition(t,e,i){return"number"==typeof i&&(e.tickPosition=i),e.tickPosition}timePosition(t,e,i){return"number"==typeof i&&(e.timePosition=i),e.timePosition}loop(t,e,i){return"boolean"==typeof i&&(e.isLooping=i),e.isLooping}renderer(t,e){return e.renderer}score(t,e){return e.score}settings(t,e){return e.settings}tracks(t,e){return e.tracks}_oninit(t){this._initListeners.push(t)}static restore(t){new jQuery(t).empty().removeData("alphaTab")}}class zg{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.scale=1,this.color=new st(255,255,255,255),this.lineWidth=1,this.font=new ve("Arial",10,Tt.Plain),this.textAlign=K.Left,this.textBaseline=ge.Top}destroy(){}beginRender(t,e){this.scale=this.settings.display.scale,this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${0|t}px" height="${0|e}px" class="at-surface-svg">\n`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=ge.Top}beginGroup(t){this.buffer+=`<g class="${t}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(t,e,i,s){i>0&&(this.buffer+=`<rect x="${t*this.scale|0}" y="${e*this.scale|0}" width="${i*this.scale}" height="${s*this.scale}" fill="${this.color.rgba}" />\n`)}strokeRect(t,e,i,s){const r=this.lineWidth*this.scale%2==0?0:.5;this.buffer+=`<rect x="${(t*this.scale|0)+r}" y="${(e*this.scale|0)+r}" width="${i*this.scale}" height="${s*this.scale}" stroke="${this.color.rgba}"`,1!==this.lineWidth&&(this.buffer+=` stroke-width="${this.lineWidth*this.scale}"`),this.buffer+=' fill="transparent" />\n'}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(t,e){this._currentPath+=` M${t*this.scale},${e*this.scale}`}lineTo(t,e){this._currentPathIsEmpty=!1,this._currentPath+=` L${t*this.scale},${e*this.scale}`}quadraticCurveTo(t,e,i,s){this._currentPathIsEmpty=!1,this._currentPath+=` Q${t*this.scale},${e*this.scale},${i*this.scale},${s*this.scale}`}bezierCurveTo(t,e,i,s,r,a){this._currentPathIsEmpty=!1,this._currentPath+=` C${t*this.scale},${e*this.scale},${i*this.scale},${s*this.scale},${r*this.scale},${a*this.scale}`}fillCircle(t,e,i){this._currentPathIsEmpty=!1,this._currentPath+=` M${(t*=this.scale)-(i*=this.scale)},${e*=this.scale} A1,1 0 0,0 ${t+i},${e} A1,1 0 0,0 ${t-i},${e} z`,this.fill()}strokeCircle(t,e,i){this._currentPathIsEmpty=!1,this._currentPath+=` M${(t*=this.scale)-(i*=this.scale)},${e*=this.scale} A1,1 0 0,0 ${t+i},${e} A1,1 0 0,0 ${t-i},${e} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,"#000000"!==this.color.rgba&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let t=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;(1!==this.lineWidth||1!==this.scale)&&(t+=` stroke-width="${this.lineWidth*this.scale}"`),t+=' style="fill: none" />',this.buffer+=t}this._currentPath="",this._currentPathIsEmpty=!0}fillText(t,e,i){if(""===t)return;let s=`<text x="${e*this.scale|0}" y="${i*this.scale|0}" style='stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}'`;"#000000"!==this.color.rgba&&(s+=` fill="${this.color.rgba}"`),this.textAlign!==K.Left&&(s+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),s+=`>${zg.escapeText(t)}</text>`,this.buffer+=s}static escapeText(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(t){switch(t){case K.Left:return"start";case K.Center:return"middle";case K.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case ge.Top:return"dominant-baseline: hanging";case ge.Bottom:return"dominant-baseline: ideographic";default:return""}}measureText(t){return t?ri.measureString(t,this.font.families,this.font.size*this.scale,this.font.style,this.font.weight):new Eh(0,0)}onRenderFinished(){return null}beginRotate(t,e,i){this.buffer+=`<g transform="translate(${t*this.scale} ,${e*this.scale}) rotate( ${i})">`}endRotate(){this.buffer+="</g>"}}class ZI extends zg{fillMusicFontSymbol(t,e,i,s,r){s!==d.None&&this.fillMusicFontSymbolText(t,e,i,`&#${s};`,r)}fillMusicFontSymbols(t,e,i,s,r){let a="";for(const o of s)o!==d.None&&(a+=`&#${o};`);this.fillMusicFontSymbolText(t,e,i,a,r)}fillMusicFontSymbolText(t,e,i,s,r){this.buffer+=`<g transform="translate(${t*=this.scale} ${e*=this.scale})" class="at" ><text`;const a=this.scale*i;this.buffer+=1!==a?` style="font-size: ${100*a}%; stroke:none"`:' style="stroke:none"',"#000000"!==this.color.rgba&&(this.buffer+=` fill="${this.color.rgba}"`),r&&(this.buffer+=` text-anchor="${this.getSvgTextAlignment(K.Center)}"`),this.buffer+=`>${s}</text></g>`}}class Xh{constructor(){this.isInsideBracket=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(t,e){return!this.hideOnPercussionTrack||!e.isPercussion}}var xe=function(n){return n[n.PreNotes=0]="PreNotes",n[n.OnNotes=1]="OnNotes",n[n.MiddleNotes=2]="MiddleNotes",n[n.Stem=3]="Stem",n[n.PostNotes=4]="PostNotes",n[n.EndBeat=5]="EndBeat",n}(xe||{});class er extends Pt{constructor(){super(...arguments),this.glyphs=null}get isEmpty(){return!this.glyphs||0===this.glyphs.length}doLayout(){if(!this.glyphs||0===this.glyphs.length)return void(this.width=0);let t=0;for(let e=0,i=this.glyphs.length;e<i;e++){const s=this.glyphs[e];s.renderer=this.renderer,s.doLayout(),t=Math.max(t,s.width)}this.width=t}addGlyph(t){this.glyphs||(this.glyphs=[]),this.renderer&&(t.renderer=this.renderer),this.glyphs.push(t)}paint(t,e,i){const s=this.glyphs;if(s&&0!==s.length)for(const r of s)r.paint(t+this.x,e+this.y,i)}}class Yo extends er{constructor(){super(0,0),this.glyphs=[]}doLayout(){}addGlyph(t){t.x=this.width,t.renderer=this.renderer,t.doLayout(),this.width=t.x+t.width,super.addGlyph(t)}}class Ce{static score(t,e,i,s=!1){if(!i.style&&!s)return;const r=Ce.scoreDefaultColor(t.settings.display.resources,e);return new Pc(t,e,i.style,r)}static scoreColor(t,e,i){const s=Ce.scoreDefaultColor(t,e);if(i.style&&i.style.colors.has(e))return i.style.colors.get(e)??s}static scoreDefaultColor(t,e){return t.mainGlyphColor}static bar(t,e,i,s=!1){if(!i.style&&!s)return;let r=t.settings.display.resources.mainGlyphColor;switch(e){case Le.StandardNotationRepeats:case Le.GuitarTabsRepeats:case Le.SlashRepeats:case Le.NumberedRepeats:case Le.StandardNotationClef:case Le.GuitarTabsClef:case Le.StandardNotationKeySignature:case Le.NumberedKeySignature:case Le.StandardNotationTimeSignature:case Le.GuitarTabsTimeSignature:case Le.SlashTimeSignature:case Le.NumberedTimeSignature:break;case Le.StandardNotationBarLines:case Le.GuitarTabsBarLines:case Le.SlashBarLines:case Le.NumberedBarLines:r=t.settings.display.resources.barSeparatorColor;break;case Le.StandardNotationBarNumber:case Le.SlashBarNumber:case Le.NumberedBarNumber:case Le.GuitarTabsBarNumber:r=t.settings.display.resources.barNumberColor;break;case Le.StandardNotationStaffLine:case Le.GuitarTabsStaffLine:case Le.SlashStaffLine:case Le.NumberedStaffLine:r=t.settings.display.resources.staffLineColor}return new Pc(t,e,i.style,r)}static voice(t,e,i,s=!1){if(i.style||s)return new Pc(t,e,i.style,0===i.index?t.settings.display.resources.mainGlyphColor:t.settings.display.resources.secondaryGlyphColor)}static trackColor(t,e,i){const s=Ce.trackDefaultColor(t,e);if(i.style&&i.style.colors.has(e))return i.style.colors.get(e)??s}static trackDefaultColor(t,e){let i=t.mainGlyphColor;switch(e){case Nr.TrackName:case Nr.SystemSeparator:case Nr.StringTuning:break;case Nr.BracesAndBrackets:i=t.barSeparatorColor}return i}static track(t,e,i,s=!1){if(!i.style&&!s)return;const r=Ce.trackDefaultColor(t.settings.display.resources,e);return new Pc(t,e,i.style,r)}static beatColor(t,e,i){const s=Ce.beatDefaultColor(t,e,i);if(i.style&&i.style.colors.has(e))return i.style.colors.get(e)??s}static beatDefaultColor(t,e,i){return 0===i.voice.index?t.mainGlyphColor:t.secondaryGlyphColor}static beat(t,e,i,s=!1){if(!i.style&&!s)return;const r=Ce.beatDefaultColor(t.settings.display.resources,e,i);return new Pc(t,e,i.style,r)}static noteColor(t,e,i){const s=Ce.noteDefaultColor(t,e,i);if(i.style&&i.style.colors.has(e))return i.style.colors.get(e)??s}static noteDefaultColor(t,e,i){return 0===i.beat.voice.index?t.mainGlyphColor:t.secondaryGlyphColor}static note(t,e,i,s=!1){if(i.style||s)return new Pc(t,e,i.style,0===i.beat.voice.index?t.settings.display.resources.mainGlyphColor:t.settings.display.resources.secondaryGlyphColor)}}class Pc{constructor(t,e,i,s){this._canvas=t,i&&i.colors.has(e)?(this._previousColor=t.color,t.color=i.colors.get(e)??s):i||(this._previousColor=t.color,t.color=s)}[Symbol.dispose](){this._previousColor&&(this._canvas.color=this._previousColor)}}let K9=(()=>{class n extends er{constructor(e,i,s){super(e,i),this.voice=s,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const i=this.renderer.layoutingInfo.spaceToForce(e);this.scaleToForce(i)}scaleToForce(e){this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e);const i=this.renderer.layoutingInfo.buildOnTimePositions(e),s=this.beatGlyphs;for(let r=0,a=s.length;r<a;r++){const o=s[r];if(o.beat.graceType===re.None)o.x=i.get(o.beat.absoluteDisplayStart)-o.onTimeX;else{const l=o.beat.graceGroup.beats[0].absoluteDisplayStart,c=o.beat.graceGroup.id;if(o.beat.graceGroup.isComplete&&i.has(l)){o.x=i.get(l)-o.onTimeX;const u=this.renderer.layoutingInfo.allGraceRods.get(c),h=o.beat.graceGroup.beats[o.beat.graceGroup.beats.length-1].nextBeat,f=h?this.renderer.layoutingInfo.getPreBeatSize(h)+Zs.GraceBeatPadding:0;o.x-=f,o.x-=u[o.beat.graceIndex].postSpringWidth,o.x+=u[o.beat.graceIndex].graceBeatWidth,o.x-=u[o.beat.graceGroup.beats.length-1].graceBeatWidth}else{const u=this.renderer.layoutingInfo.incompleteGraceRods.get(c),h=u[o.beat.graceIndex].postSpringWidth-u[o.beat.graceIndex].preSpringWidth;o.x=r>0?0===o.beat.graceIndex?s[r-1].x+s[r-1].width:s[r-1].x+u[o.beat.graceIndex-1].postSpringWidth-u[o.beat.graceIndex-1].preSpringWidth-h:-h}}r>0&&s[r-1].scaleToWidth(o.x-s[r-1].x),r===a-1&&o.scaleToWidth(this.width-s[s.length-1].x)}}registerLayoutingInfo(e){const i=this.beatGlyphs;for(const s of i)s.registerLayoutingInfo(e)}applyLayoutingInfo(e){const i=this.beatGlyphs;for(const s of i)s.applyLayoutingInfo(e);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){const i=e;e.x=0===this.beatGlyphs.length?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(i),this.width=e.x+e.width,i.beat.hasTuplet&&i.beat.tupletGroup.beats[0].id===i.beat.id&&this.tupletGroups.push(i.beat.tupletGroup)}doLayout(){}paint(e,i,s){const r=Ce.voice(s,xh.Glyphs,this.voice,!0);try{for(let a=0,o=this.beatGlyphs.length;a<o;a++)this.beatGlyphs[a].paint(e+this.x,i+this.y,s)}finally{r?.[Symbol.dispose]?.()}}}return n.KeySizeBeat="Beat",n})();class Z9{constructor(){this.staffId="",this.up=0,this.down=0}}class ej{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(t){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(t-this.startX)+this.startY}}class tr{get isRestBeamHelper(){return 1===this.beats.length&&this.beats[0].isRest}hasLine(t,e){return t&&this.beatHasLine(e)||!t&&1===this.beats.length&&this.beatHasLine(e)}beatHasLine(t){return t.duration>w.Whole}hasFlag(t,e){return t&&this.beatHasFlag(e)||!t&&1===this.beats.length&&this.beatHasFlag(this.beats[0])}beatHasFlag(t){return!t.deadSlapped&&!t.isRest&&(t.duration>w.Quarter||t.graceType!==re.None)}constructor(t,e){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=w.QuadrupleWhole,this.hasTuplet=!1,this.slashBeats=[],this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=B.Up,this.drawingInfos=new Map,this._staff=t,this._renderer=e,this.beats=[]}getBeatLineX(t,e){return e=e??this.direction,this.hasBeatLineX(t)?e===B.Up?this._beatLineXPositions.get(t.index).up:this._beatLineXPositions.get(t.index).down:0}hasBeatLineX(t){return this._beatLineXPositions.has(t.index)}registerBeatLineX(t,e,i,s){const r=this.getOrCreateBeatPositions(e);r.staffId=t,r.up=i,r.down=s;for(const a of this.drawingInfos.values())a.startBeat===e?a.startX=this.getBeatLineX(e):a.endBeat===e&&(a.endX=this.getBeatLineX(e))}getOrCreateBeatPositions(t){return this._beatLineXPositions.has(t.index)||this._beatLineXPositions.set(t.index,new Z9),this._beatLineXPositions.get(t.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let t=null;if(this.voice?null!==this.preferredBeamDirection?t=this.preferredBeamDirection:this.voice.index>0?t=this.invert(B.Down):(this.voice.bar.isMultiVoice||this.beats[0].graceType!==re.None)&&(t=this.invert(B.Up)):t=B.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){const e=this._renderer.getNoteY(this.highestNoteInHelper,Z.Center),i=this._renderer.getNoteY(this.lowestNoteInHelper,Z.Center);null===t&&(t=this.invert(this._renderer.middleYPosition<(e+i)/2?B.Up:B.Down)),this._renderer.completeBeamingHelper(this)}else t=this.invert(B.Up),this._renderer.completeBeamingHelper(this);return t}static computeLineHeightsForRest(t){switch(t){case w.QuadrupleWhole:case w.DoubleWhole:return[2,2];case w.Whole:return[0,1];case w.Half:return[1,0];case w.Quarter:return[3,3];case w.Eighth:return[2,2];case w.Sixteenth:return[2,4];case w.ThirtySecond:return[4,4];case w.SixtyFourth:return[4,6];case w.OneHundredTwentyEighth:return[6,6];case w.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(t,e){if(this._lastNonRestBeat&&t.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&t.index<=this._firstNonRestBeat.index)return;let i=e,s=e;const r=tr.computeLineHeightsForRest(t.duration);i-=r[0],s+=r[1];const a=this.minRestLine,o=this.maxRestLine;(null===a||a>i)&&(this.minRestLine=i,this.beatOfMinRestLine=t),(null===o||o<s)&&(this.maxRestLine=s,this.beatOfMaxRestLine=t)}invert(t){return this.invertBeamDirection?t===B.Down?B.Up:B.Down:t}checkBeat(t){t.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=t.voice);let e=!1;if(0===this.beats.length)e=!0;else switch(this.beats[this.beats.length-1].beamingMode){case St.Auto:case St.ForceSplitOnSecondaryToNext:e=tr.canJoin(this.beats[this.beats.length-1],t);break;case St.ForceSplitToNext:e=!1;break;case St.ForceMergeWithNext:e=!0}return e&&(null==this.preferredBeamDirection&&null!==t.preferredBeamDirection&&(this.preferredBeamDirection=t.preferredBeamDirection),t.hasTuplet&&(this.hasTuplet=!0),t.graceType!==re.None&&(this.isGrace=!0),t.isRest?0===this.beats.length&&this.beats.push(t):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(t),this.checkNote(t.minNote),this.checkNote(t.maxNote),this.shortestDuration<t.duration&&(this.shortestDuration=t.duration),this._firstNonRestBeat||(this._firstNonRestBeat=t),this._lastNonRestBeat=t),t.slashed&&this.slashBeats.push(t)),e}checkNote(t){if(!t)return;let e,i;this.voice&&t.isPercussion?(e=-Js.getPercussionLine(this.voice.bar,Js.getNoteValue(t)),i=e):(e=Js.getNoteValue(t),i=e,t.harmonicType!==ae.None&&t.harmonicType!==ae.Natural&&(i=t.realValue-this._staff.displayTranspositionPitch)),1===this.beats.length&&this.beats[0]===t.beat&&((-1===this._firstBeatLowestNoteCompareValue||e<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=e),(-1===this._firstBeatHighestNoteCompareValue||i>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=i)),(-1===this._lastBeatLowestNoteCompareValue||e<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=e),(-1===this._lastBeatHighestNoteCompareValue||i>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=i),(!this.lowestNoteInHelper||e<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=t,this._lowestNoteCompareValueInHelper=e),(!this.highestNoteInHelper||i>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=t,this._highestNoteCompareValueInHelper=i)}static canJoin(t,e){if(!t||!e||t.graceType!==e.graceType||t.graceType===re.BendGrace||e.graceType===re.BendGrace||t.deadSlapped||e.deadSlapped)return!1;if(t.graceType!==re.None&&e.graceType!==re.None)return!0;const i=t.voice.bar;if(i!==e.voice.bar)return!1;const r=t.playbackStart,a=e.playbackStart;if(!tr.canJoinDuration(t.duration)||!tr.canJoinDuration(e.duration))return r===a;if(t.tupletGroup!==e.tupletGroup)return!1;if(t.hasTuplet&&e.hasTuplet&&t.tupletGroup===e.tupletGroup&&t.tupletGroup.isFull)return!0;let o=P.QuarterTime;return 8===i.masterBar.timeSignatureDenominator&&i.masterBar.timeSignatureNumerator%3==0&&(o+=P.QuarterTime/2|0),(0|(o+r)/o)==(0|(o+a)/o)}static canJoinDuration(t){switch(t){case w.Whole:case w.Half:case w.Quarter:return!1;default:return!0}}static isFullBarJoin(t,e,i){return H.getIndex(t.duration)-2-i>0&&H.getIndex(e.duration)-2-i>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(t,e){return!this._beatLineXPositions.has(e.index)||this._beatLineXPositions.get(e.index).staffId===t||!this._beatLineXPositions.get(e.index).staffId}}class tj{constructor(t,e){this.topY=0,this.bottomY=0,this.topY=t,this.bottomY=e}}class nj{constructor(t){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=t}addSlot(t,e){if(this.slots.push(new tj(t,e)),-1e3===this.topY)this.topY=t,this.bottomY=e;else{const i=Math.min(t,e),s=Math.max(t,e);i<this.topY&&(this.topY=i),s>this.bottomY&&(this.bottomY=s)}}}class ij{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let t=-1e3,e=-1e3;for(const i of this.reservedLayoutAreasByDisplayTime.values())-1e3===t?(t=i.topY,e=i.bottomY):(t>i.topY&&(t=i.topY),e<i.bottomY&&(e=i.bottomY));return-1e3===t?[0,0]:[t,e]}reserveBeatSlot(t,e,i){e!==i&&(this.reservedLayoutAreasByDisplayTime.has(t.displayStart)||this.reservedLayoutAreasByDisplayTime.set(t.displayStart,new nj(t)),this.reservedLayoutAreasByDisplayTime.get(t.displayStart).addSlot(e,i),t.isRest&&this.registerRest(t))}registerRest(t){this.restDurationsByDisplayTime.has(t.displayStart)||this.restDurationsByDisplayTime.set(t.displayStart,new Map),this.restDurationsByDisplayTime.get(t.displayStart).has(t.playbackDuration)||this.restDurationsByDisplayTime.get(t.displayStart).set(t.playbackDuration,t.id)}applyRestCollisionOffset(t,e,i){if(t.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(t.playbackStart)){const s=tr.computeLineHeightsForRest(t.duration).map(u=>u*i),r=e-s[0],a=e+s[1];let o=r;const l=this.reservedLayoutAreasByDisplayTime.get(t.playbackStart);let c=!1;for(const u of l.slots)if(r>=u.topY&&r<=u.bottomY||a>=u.topY&&a<=u.bottomY){c=!0;break}if(c){o=1===t.voice.index?l.topY-s[1]-s[0]:l.bottomY;const u=o+s[0]+s[1],h=2*i,f=Math.ceil(Math.abs(o-r)/h);return l.addSlot(o,u),o<r?f*-h:f*h}}return 0}}class sj{constructor(t){this.beamHelpers=[],this.beamHelperLookup=[],this.preferredBeamDirection=null,this._renderer=t,this.collisionHelper=new ij}initialize(){const t=this._renderer,e=this._renderer.bar;let i=null,s=null;for(let r=0,a=e.voices.length;r<a;r++){const o=e.voices[r];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,c=o.beats.length;l<c;l++){const u=o.beats[l];let h;u.graceType!==re.None?h=s:(h=i,s=null),(!h||!h.checkBeat(u))&&(h&&h.finish(),h=new tr(e.staff,t),h.preferredBeamDirection=this.preferredBeamDirection,h.checkBeat(u),u.graceType!==re.None?s=h:i=h,this.beamHelpers[o.index].push(h)),this.beamHelperLookup[o.index].set(u.index,h)}i&&i.finish(),s&&s.finish(),i=null,s=null}}getBeamingHelperForBeat(t){return this.beamHelperLookup[t.voice.index].get(t.index)}}let rj=(()=>{class n extends Gi{constructor(e,i,s){super(e,i),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=s}doLayout(){super.doLayout();const e=this.renderer.resources;this._textRow=1.5*e.effectFont.size,this._fretRow=1.5*e.effectFont.size,this._firstFretSpacing=this._chord.firstFret>1?n.FretSpacing:0,this.height=this._textRow+this._fretRow+n.Frets*n.FretSpacing+2*n.Padding[1],this.width=this._firstFretSpacing+(this._chord.strings.length-1)*n.StringSpacing+2*n.Padding[0]}paint(e,i,s){e+=this.x+n.Padding[0]+this._firstFretSpacing,i+=this.y;const r=n.StringSpacing,a=n.FretSpacing,o=this.renderer.resources,l=n.CircleRadius,c=this.width-2*n.Padding[0]-this._firstFretSpacing,u=s.textAlign,h=s.textBaseline;s.font=o.effectFont,s.textAlign=K.Center,s.textBaseline=ge.Top,this._chord.showName&&s.fillText(this._chord.name,e+c/2,i+o.effectFont.size/2),i+=this._textRow,s.font=o.fretboardNumberFont,s.textBaseline=ge.Middle;for(let p=0;p<this._chord.strings.length;p++){const g=e+p*r,m=i+this._fretRow/2;let y=this._chord.strings[this._chord.strings.length-p-1];y<0?s.fillMusicFontSymbol(g,m,1,d.FretboardX,!0):0===y?s.fillMusicFontSymbol(g,m,1,d.FretboardO,!0):(y-=this._chord.firstFret-1,s.fillText(y.toString(),g,m))}i+=this._fretRow;for(let p=0;p<this._chord.strings.length;p++)s.fillRect(e+p*r,i,1,a*n.Frets+1);this._chord.firstFret>1&&(s.textAlign=K.Left,s.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,i+a/2)),s.fillRect(e,i-1,c,2);for(let p=0;p<=n.Frets;p++)s.fillRect(e,i+p*a,c,1);const f=new Map;for(const p of this._chord.barreFrets)f.set(p-this._chord.firstFret,[-1,-1]);for(let p=0;p<this._chord.strings.length;p++){let g=this._chord.strings[p];if(g>0){if(g-=this._chord.firstFret,f.has(g)){const b=f.get(g);(-1===b[0]||p<b[0])&&(b[0]=p),(-1===b[1]||p>b[1])&&(b[1]=p)}s.fillCircle(e+(this._chord.strings.length-p-1)*r,i+g*a+a/2+.5,l)}}for(const[p,g]of f){const y=e+(this._chord.strings.length-g[1]-1)*r;s.fillRect(y,i+p*a+a/2+.5-l,e+(this._chord.strings.length-g[0]-1)*r-y,2*l)}s.textAlign=u,s.textBaseline=h}}return n.Padding=[5,2],n.Frets=5,n.CircleRadius=2.5,n.StringSpacing=10,n.FretSpacing=12,n})();class eM extends er{constructor(t,e,i=K.Center){super(t,e),this._glyphWidth=0,this.glyphs=[],this._align=i}doLayout(){let t=0;switch(this._align){case K.Left:t=0;break;case K.Center:t=(this.width-this._glyphWidth)/2;break;case K.Right:t=this.width-this._glyphWidth}for(const e of this.glyphs)e.x=t,t+=e.width}addGlyphToRow(t){this.glyphs.push(t),this._glyphWidth+=t.width,t.height>this.height&&(this.height=t.height)}}let tM=(()=>{class n extends er{constructor(e,i,s=K.Center){super(e,i),this._rows=[],this.height=0,this.glyphs=[],this._align=s}doLayout(){let e=0,i=0;const s=n.Padding;this._rows=[];let r=new eM(e,i,this._align);r.width=this.width;for(const a of this.glyphs)e+a.width<this.width?(r.addGlyphToRow(a),e+=a.width):(r.isEmpty||(r.doLayout(),this._rows.push(r),i+=r.height+s),e=0,r=new eM(e,i,this._align),r.width=this.width,r.addGlyphToRow(a),e+=a.width);r.isEmpty||(r.doLayout(),this._rows.push(r),i+=r.height+s),this.height=i}paint(e,i,s){for(const r of this._rows)r.paint(e+this.x,i+this.y,s)}}return n.Padding=3,n})();class aj extends tM{addChord(t){if(t.strings.length>0){const e=new rj(0,0,t);e.renderer=this.renderer,e.doLayout(),this.glyphs.push(e)}}paint(t,e,i){if(this.glyphs.length>0){const s=Ce.score(i,U.ChordDiagramList,this.renderer.scoreRenderer.score);try{super.paint(t,e,i)}finally{s?.[Symbol.dispose]?.()}}}}class zi extends Gi{constructor(t,e,i,s,r=K.Left,a=null,o){super(t,e),this._lineHeights=null,this._lines=i.split("\n"),this.font=s,this.textAlign=r,this.textBaseline=a,this.colorOverride=o}doLayout(){super.doLayout(),this._lineHeights=[];const t=this.renderer.scoreRenderer.canvas;for(const e of this._lines){t.font=this.font;const i=t.measureText(e),s=i.height;this._lineHeights.push(s),this.height+=s,this.width=Math.max(this.width,i.width)}}paint(t,e,i){const s=i.color;i.color=this.colorOverride??s,i.font=this.font;const r=i.textAlign,a=i.textBaseline;i.textAlign=this.textAlign,null!==this.textBaseline&&(i.textBaseline=this.textBaseline);let o=e+this.y;for(let l=0;l<this._lines.length;l++)i.fillText(this._lines[l],t+this.x,o),o+=this._lineHeights[l];i.textAlign=r,i.textBaseline=a,i.color=s}}class oj{get staffId(){return this._factory.staffId}get contentTop(){return this.y+this.staveTop+this.topSpacing+this.topOverflow}get contentBottom(){return this.y+this.topSpacing+this.topOverflow+this.staveBottom}constructor(t,e,i){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.isFirstInSystem=!1,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this._factory=i,this.trackIndex=t,this.modelStaff=e}getSharedLayoutData(t,e){return this._sharedLayoutData.has(t)?this._sharedLayoutData.get(t):e}setSharedLayoutData(t,e){this._sharedLayoutData.set(t,e)}get isInsideBracket(){return this._factory.isInsideBracket}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(t){this.staveTop=t}registerStaffBottom(t){this.staveBottom=t}addBarRenderer(t){t.staff=this,t.index=this.barRenderers.length,t.reLayout(),this.barRenderers.push(t),this.system.layout.registerBarRenderer(this.staffId,t)}addBar(t,e,i){const s=this._factory.create(this.system.layout.renderer,t);s.additionalMultiRestBars=i,s.staff=this,s.index=this.barRenderers.length,s.layoutingInfo=e,s.doLayout(),s.registerLayoutingInfo();const r=s.barDisplayWidth;r>0&&this.system.layout.systemsLayoutMode===ys.FromModelWithWidths&&(s.width=r),this.barRenderers.push(s),t&&this.system.layout.registerBarRenderer(this.staffId,s)}revertLastBar(){const t=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staffId,t);for(const e of this.barRenderers)e.applyLayoutingInfo();return t}scaleToWidth(t){this._sharedLayoutData=new Map;const e=this.topOverflow;let i=0;switch(this.system.layout.systemsLayoutMode){case ys.Automatic:const r=(t-this.system.computedWidth)/this.barRenderers.length;for(const o of this.barRenderers)o.x=i,o.y=this.topSpacing+e,o.scaleToWidth(o.computedWidth+r),i+=o.width;break;case ys.FromModelWithScale:t-=this.system.accoladeWidth;const a=this.system.totalBarDisplayScale;for(const o of this.barRenderers)o.x=i,o.y=this.topSpacing+e,o.scaleToWidth(o.barDisplayScale*t/a),i+=o.width;break;case ys.FromModelWithWidths:for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+e;const l=o.barDisplayWidth;o.scaleToWidth(l>0?l:o.computedWidth),i+=o.width}}}get topOverflow(){let t=0;for(let e=0,i=this.barRenderers.length;e<i;e++){const s=this.barRenderers[e];s.topOverflow>t&&(t=s.topOverflow)}return t}get bottomOverflow(){let t=0;for(let e=0,i=this.barRenderers.length;e<i;e++){const s=this.barRenderers[e];s.bottomOverflow>t&&(t=s.bottomOverflow)}return t}calculateHeightForAccolade(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=this.barRenderers.length>0?this.barRenderers[0].height:0,this.height>0&&(this.height+=this.topSpacing+this.topOverflow+this.bottomOverflow+this.bottomSpacing)}finalizeStaff(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=0;let t=!1,e=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+e,this.height=Math.max(this.height,this.barRenderers[i].height),this.barRenderers[i].finalizeRenderer()&&(t=!0);if(t){e=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+e;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+e+this.bottomOverflow+this.bottomSpacing)}paint(t,e,i,s,r){if(0!==this.height&&0!==r)for(let a=s,o=Math.min(s+r,this.barRenderers.length);a<o;a++)this.barRenderers[a].paint(t+this.x,e+this.y,i)}}class nM{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}let lj=(()=>{class n{constructor(){this._timeSortedSprings=[],this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this._minDuration=n.MinDuration,this.version=0,this.preBeatSize=0,this.postBeatSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}getPreBeatSize(e){if(e.graceType!==re.None)return this.allGraceRods.get(e.graceGroup.id)[e.graceIndex].preBeatWidth;const i=e.absoluteDisplayStart;return this.springs.has(i)?this.springs.get(i).preBeatWidth:0}getPostBeatSize(e){if(e.graceType!==re.None)return this.allGraceRods.get(e.graceGroup.id)[e.graceIndex].postSpringWidth;const i=e.absoluteDisplayStart;return this.springs.has(i)?this.springs.get(i).postSpringWidth:0}addSpring(e,i,s,r,a){let o;if(this.version++,this.springs.has(e))o=this.springs.get(e),o.postSpringWidth<a&&(o.postSpringWidth=a),o.graceBeatWidth<s&&(o.graceBeatWidth=s),o.preBeatWidth<r&&(o.preBeatWidth=r),i<o.smallestDuration&&(o.smallestDuration=i),i>o.longestDuration&&(o.longestDuration=i),o.allDurations.add(i);else{if(o=new nM,o.timePosition=e,o.allDurations.add(i),this._timeSortedSprings.length>0){const u=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const h of u.allDurations);i<this._minDuration&&(this._minDuration=i)}o.longestDuration=i,o.postSpringWidth=a,o.graceBeatWidth=s,o.preBeatWidth=r,this.springs.set(e,o);const l=this._timeSortedSprings;let c=l.length-1;for(;c>0&&l[c].timePosition>e;)c--;this._timeSortedSprings.splice(c+1,0,o)}return(-1===this._minTime||this._minTime>e)&&(this._minTime=e),o}addBeatSpring(e,i,s){const r=e.absoluteDisplayStart;if(e.graceType!==re.None){const a=e.graceGroup.id;this.allGraceRods.has(a)||this.allGraceRods.set(a,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(a)&&this.incompleteGraceRods.set(a,new Array(e.graceGroup.beats.length));const o=this.allGraceRods.get(a)[e.graceIndex];if(o)o.postSpringWidth<s&&(o.postSpringWidth=s),o.preBeatWidth<i&&(o.preBeatWidth=i);else{const l=new nM;l.timePosition=r,l.postSpringWidth=s,l.preBeatWidth=i,e.graceGroup.isComplete||(this.incompleteGraceRods.get(a)[e.graceIndex]=l),this.allGraceRods.get(a)[e.graceIndex]=l}}else{let a=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const o of this.allGraceRods.get(e.graceGroup.id))a+=o.springWidth;this.addSpring(r,e.displayDuration,a,i,s)}}finish(){for(const[e,i]of this.allGraceRods){let s=0;for(const r of i)s+=r.preBeatWidth,r.graceBeatWidth=s,s+=r.postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const i of e)this._incompleteGraceRodsWidth+=i.preBeatWidth+i.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){let e=0;const i=this._timeSortedSprings;if(0===i.length)return this.totalSpringConstant=-1,void(this.minStretchForce=-1);for(let s=0;s<i.length;s++){const r=i[s];let a=0;a=s===i.length-1?r.longestDuration:Math.abs(i[s+1].timePosition-r.timePosition),r.springConstant=this.calculateSpringConstant(r,a),e+=1/r.springConstant}this.totalSpringConstant=1/e,this.minStretchForce=0;for(let s=0;s<i.length;s++){const r=i[s];let a=0;a=s===i.length-1?r.postSpringWidth:r.postSpringWidth+i[s+1].preSpringWidth,0===s&&(a+=r.preSpringWidth),this.updateMinStretchForce(a*r.springConstant)}}paint(e,i,s){}calculateSpringConstant(e,i){i<=0&&(i=P.toTicks(w.TwoHundredFiftySixth)),0===e.smallestDuration&&(e.smallestDuration=i);const a=n.MinDurationWidth;return e.smallestDuration/i*(1/((1+.85*Math.log2(i/this._minDuration))*a))}spaceToForce(e){return-1!==this.totalSpringConstant?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let i=0;return-1!==this.totalSpringConstant&&(i=this.calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(i+=this._timeSortedSprings[0].preSpringWidth),i+=this._incompleteGraceRodsWidth,i}calculateWidth(e,i){return e/i}buildOnTimePositions(e){if(-1===this.totalSpringConstant)return new Map;if(H.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;const i=new Map;this._onTimePositions=i;const s=this._timeSortedSprings;if(0===s.length)return i;let r=s[0].preSpringWidth;for(let a=0;a<s.length;a++)i.set(s[a].timePosition,r),r+=this.calculateWidth(e,s[a].springConstant);return i}}return n.MinDuration=30,n.MinDurationWidth=7,n})();class cj{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.additionalMultiBarRestIndexes=null,this.renderers=[]}get lastMasterBarIndex(){return this.additionalMultiBarRestIndexes?this.additionalMultiBarRestIndexes[this.additionalMultiBarRestIndexes.length-1]:this.masterBar.index}}class uj{constructor(t,e){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.bracket=null,this.staffSystem=t,this.track=e}addStaff(t){this.staves.push(t),t.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(t)}}class hj{constructor(){this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.drawAsBrace=!1,this.braceScale=1,this.width=0,this.index=0}finalizeBracket(){if(this.firstStaffInBracket===this.lastStaffInBracket)return void(this.width=0);const t=Xe.Heights.get(d.Brace),e=Xe.Widths.get(d.Brace);this.width=e,this.drawAsBrace&&this.firstStaffInBracket&&this.lastStaffInBracket&&(this.braceScale=(this.lastStaffInBracket.contentBottom-this.firstStaffInBracket.contentTop)/t,this.width=e*this.braceScale)}}class $g extends hj{constructor(t){super(),this.track=t,this.drawAsBrace=$g.isTrackDrawAsBrace(t)}includesStaff(t){return t.modelStaff.track===this.track}static isTrackDrawAsBrace(t){return t.staves.filter(e=>e.showStandardNotation).length>1}}class dj extends $g{includesStaff(t){return t.modelStaff.track===this.track||!this.drawAsBrace&&this.track.playbackInfo.program===t.modelStaff.track.playbackInfo.program}}let fj=(()=>{class n{constructor(e){this._allStaves=[],this._firstStaffInBrackets=null,this._lastStaffInBrackets=null,this._accoladeSpacingCalculated=!1,this._brackets=[],this._hasSystemSeparator=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].masterBar.index}addMasterBarRenderers(e,i){if(0===e.length)return null;this.masterBarsRenderers.push(i),i.layoutingInfo.preBeatSize=0;let s=0;for(let r=0,a=this.staves.length;r<a;r++){const o=this.staves[r];for(let l=0,c=o.staves.length;l<c;l++){const h=i.renderers[s++];o.staves[l].addBarRenderer(h)}}return this.calculateAccoladeSpacing(e),this.updateWidthFromLastBar(),i}addBars(e,i,s){const r=new cj;r.additionalMultiBarRestIndexes=s,r.layoutingInfo=new lj,r.masterBar=e[0].score.masterBars[i],this.masterBarsRenderers.push(r);const a=r.layoutingInfo;for(const o of this.staves)for(const l of o.staves){const c=o.track.staves[l.modelStaff.index].bars[i],u=null==s?null:s.map(f=>o.track.staves[l.modelStaff.index].bars[f]);l.addBar(c,a,u);const h=l.barRenderers[l.barRenderers.length-1];r.renderers.push(h),h.isLinkedToPrevious&&(r.isLinkedToPrevious=!0),h.canWrap||(r.canWrap=!1)}return this.calculateAccoladeSpacing(e),a.finish(),r.width=this.updateWidthFromLastBar(),r}revertLastBar(){if(this.masterBarsRenderers.length>1){const e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let i=0,s=0;for(let r=0,a=this._allStaves.length;r<a;r++){const l=this._allStaves[r].revertLastBar(),c=l.computedWidth;c>i&&(i=c);const u=l.barDisplayScale;u>s&&(s=u)}return this.width-=i,this.computedWidth-=i,this.totalBarDisplayScale-=s,e}return null}updateWidthFromLastBar(){let e=0,i=0;for(let s=0,r=this._allStaves.length;s<r;s++){const a=this._allStaves[s],o=a.barRenderers[a.barRenderers.length-1];o.applyLayoutingInfo(),o.computedWidth>e&&(e=o.computedWidth);const l=o.barDisplayScale;l>i&&(i=l)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=i,e}calculateAccoladeSpacing(e){const i=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){this._accoladeSpacingCalculated=!0,this.accoladeWidth=0;const s=this.layout.renderer.score.stylesheet;if(this.layout.renderer.settings.notation.isNotationElementVisible(Te.TrackNames)){const c=0===this.index?s.firstSystemTrackNameMode:s.otherSystemsTrackNameMode,u=0===this.index?s.firstSystemTrackNameOrientation:s.otherSystemsTrackNameOrientation;let h=!1;switch(1===this.layout.renderer.tracks.length?s.singleTrackTrackNamePolicy:s.multiTrackTrackNamePolicy){case Et.Hidden:break;case Et.FirstSystem:h=0===this.index;break;case Et.AllSystems:h=!0}let f=!1;if(h){const p=this.layout.renderer.canvas;p.font=i.display.resources.effectFont;for(const m of e){let y="";switch(c){case zn.FullName:y=m.name;break;case zn.ShortName:y=m.shortName}if(y.length>0){f=!0;const b=p.measureText(y);switch(u){case $n.Horizontal:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,b.width));break;case $n.Vertical:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,b.height))}}}f&&(this.accoladeWidth+=i.display.systemLabelPaddingLeft,this.accoladeWidth+=i.display.systemLabelPaddingRight)}}let a=0;for(const l of this._allStaves)l.y=a,l.calculateHeightForAccolade(),a+=l.height;let o=0;for(const l of this._brackets)l.finalizeBracket(),o=Math.max(o,l.width);this.accoladeWidth+=o,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(e){for(let i=0,s=this.staves.length;i<s;i++){const r=this.staves[i];if(r.track===e)return r}return null}addStaff(e,i){let s=this.getStaffTrackGroup(e);if(s||(s=new uj(this,e),this.staves.push(s)),i.staffTrackGroup=s,i.system=this,i.index=this._allStaves.length,this._allStaves.push(i),s.addStaff(i),i.isInsideBracket){this._firstStaffInBrackets||(this._firstStaffInBrackets=i,i.isFirstInSystem=!0),s.firstStaffInBracket||(s.firstStaffInBracket=i),this._lastStaffInBrackets=i,s.lastStaffInBracket=i;let r=this._brackets.find(a=>a.includesStaff(i));if(!r)switch(e.score.stylesheet.bracketExtendMode){case Ys.NoBrackets:break;case Ys.GroupStaves:r=new $g(e),r.index=this._brackets.length,this._brackets.push(r);break;case Ys.GroupSimilarInstruments:r=new dj(e),r.index=this._brackets.length,this._brackets.push(r)}r&&(r.firstStaffInBracket||(r.firstStaffInBracket=i),r.lastStaffInBracket=i,s.bracket=r)}}get height(){return 0===this._allStaves.length?0:this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(e){for(let i=0,s=this._allStaves.length;i<s;i++)this._allStaves[i].scaleToWidth(e);this.width=e}paint(e,i,s){if(this.paintPartial(e+this.x,(i+=this.topPadding)+this.y,s,0,this.masterBarsRenderers.length),this._hasSystemSeparator){const r=Ce.track(s,Nr.SystemSeparator,this._allStaves[0].modelStaff.track);try{s.fillMusicFontSymbol(e+this.x,i+this.y+this.height-10,1,d.SystemDivider,!1),s.fillMusicFontSymbol(e+this.x+this.width-n.SystemSignSeparatorWidth,i+this.y+this.height-n.SystemSignSeparatorPadding,1,d.SystemDivider,!1)}finally{r?.[Symbol.dispose]?.()}}}paintPartial(e,i,s,r,a){for(let l=0,c=this._allStaves.length;l<c;l++)this._allStaves[l].paint(e,i,s,r,a);const o=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&0===r){s.color=o.barSeparatorColor;const l=this.layout.renderer.settings,c=this.layout.renderer.settings.notation.isNotationElementVisible(Te.TrackNames);if(s.font=o.effectFont,c){const u=this.layout.renderer.score.stylesheet,f=0===this.index?u.firstSystemTrackNameMode:u.otherSystemsTrackNameMode,p=0===this.index?u.firstSystemTrackNameOrientation:u.otherSystemsTrackNameOrientation;let g=!1;switch(1===this.layout.renderer.tracks.length?u.singleTrackTrackNamePolicy:u.multiTrackTrackNamePolicy){case Et.Hidden:break;case Et.FirstSystem:g=0===this.index;break;case Et.AllSystems:g=!0}if(g){const m=s.textBaseline,y=s.textAlign;for(const b of this.staves)if(b.firstStaffInBracket&&b.lastStaffInBracket){const _=i+b.firstStaffInBracket.contentTop,v=i+b.lastStaffInBracket.contentBottom;let k="";switch(f){case zn.FullName:k=b.track.name;break;case zn.ShortName:k=b.track.shortName}const F=Ce.track(s,Nr.TrackName,b.track);try{if(k.length>0){const D=e+b.firstStaffInBracket.x-l.display.accoladeBarPaddingRight-(b.bracket?.width??0)-l.display.systemLabelPaddingRight;switch(p){case $n.Horizontal:s.textBaseline=ge.Middle,s.textAlign=K.Right,s.fillText(k,D,(_+v)/2);break;case $n.Vertical:s.textBaseline=ge.Bottom,s.textAlign=K.Center,s.beginRotate(D,(_+v)/2,-90.1),s.fillText(k,0,0),s.endRotate()}}}finally{F?.[Symbol.dispose]?.()}}s.textBaseline=m,s.textAlign=y}}if(this._allStaves.length>0){let u=null;for(const h of this._allStaves)if(h.isInsideBracket){if(null!==u){const f=u.contentBottom,p=h.contentTop,g=e+u.x,m=u.barRenderers[0],y=Ce.bar(s,m.staffLineBarSubElement,m.bar);try{const b=Math.ceil(p-f);s.fillRect(g,i+f,1,b)}finally{y?.[Symbol.dispose]?.()}}u=h}}for(const u of this._brackets)if(u.firstStaffInBracket&&u.lastStaffInBracket){const h=e+u.firstStaffInBracket.x,f=u.width,p=l.display.accoladeBarPaddingRight;let y=i+u.firstStaffInBracket.contentTop,b=i+u.lastStaffInBracket.contentBottom;if(u.drawAsBrace)s.fillMusicFontSymbol(h-p-f,b,u.braceScale,d.Brace);else if(u.firstStaffInBracket!==u.lastStaffInBracket){const _=f/2;y-=_,b+=2*_,s.fillRect(h-p-f,y,f,Math.ceil(b-y));const v=h-p-f-.5;s.fillMusicFontSymbol(v,y,1,d.BracketTop),s.fillMusicFontSymbol(v,Math.floor(b),1,d.BracketBottom)}}}}finalizeSystem(){const e=this.layout.renderer.settings;0===this.index&&(this.topPadding=e.display.firstSystemPaddingTop),this.isLast?this.bottomPadding=e.display.lastSystemPaddingBottom:this.layout.renderer.score.stylesheet.useSystemSignSeparator&&this.layout.renderer.tracks.length>1&&(this.bottomPadding+=n.SystemSignSeparatorHeight,this._hasSystemSeparator=!0);let i=0;for(const s of this._allStaves)s.x=this.accoladeWidth,s.y=i,s.finalizeStaff(),i+=s.height;for(const s of this._brackets)s.finalizeBracket()}buildBoundingsLookup(e,i){if(this.layout.renderer.boundsLookup.isFinished)return;const s=this._firstStaffInBrackets,r=this._lastStaffInBrackets;if(!s||!r)return;const a=this._allStaves[this._allStaves.length-1],o=(i+=this.topPadding)+this.y+s.y,c=i+this.y+this._allStaves[0].y,h=i+this.y+s.y+s.topSpacing+s.topOverflow+(s.barRenderers.length>0?s.barRenderers[0].topPadding:0),p=i+this.y+r.y+r.height-o,g=i+this.y+a.y+a.height-a.bottomSpacing-a.bottomOverflow-(a.barRenderers.length>0?a.barRenderers[0].bottomPadding:0)-h,m=i+this.y+a.y+a.height-c,y=this.x+s.x,b=new t_;b.visualBounds=new kn,b.visualBounds.x=e+this.x,b.visualBounds.y=i+this.y,b.visualBounds.w=this.width,b.visualBounds.h=this.height-this.topPadding-this.bottomPadding,b.realBounds=new kn,b.realBounds.x=e+this.x,b.realBounds.y=i+this.y,b.realBounds.w=this.width,b.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(b);const _=new Map;for(let v=0;v<this.staves.length;v++)for(const k of this.staves[v].stavesRelevantForBoundsLookup)for(const F of k.barRenderers){let D;_.has(F.bar.masterBar.index)?D=_.get(F.bar.masterBar.index):(D=new e_,D.index=F.bar.masterBar.index,D.isFirstOfLine=F.isFirstOfLine,D.realBounds=new kn,D.realBounds.x=y+F.x,D.realBounds.y=c,D.realBounds.w=F.width,D.realBounds.h=m,D.visualBounds=new kn,D.visualBounds.x=y+F.x,D.visualBounds.y=o,D.visualBounds.w=F.width,D.visualBounds.h=p,D.lineAlignedBounds=new kn,D.lineAlignedBounds.x=y+F.x,D.lineAlignedBounds.y=h,D.lineAlignedBounds.w=F.width,D.lineAlignedBounds.h=g,this.layout.renderer.boundsLookup.addMasterBar(D),_.set(D.index,D)),F.buildBoundingsLookup(D,y,i+this.y+k.y)}}getBarX(e){return this._firstStaffInBrackets&&0!==this.layout.renderer.tracks.length?this.layout.getRendererForBar(this._firstStaffInBrackets.staffId,this.layout.renderer.tracks[0].staves[0].bars[e]).x:0}}return n.SystemSignSeparatorHeight=40,n.SystemSignSeparatorPadding=10,n.SystemSignSeparatorWidth=36,n})();class pj extends tM{constructor(t,e){super(t,e,K.Left)}}let jg=(()=>{class n extends er{constructor(e,i,s,r){super(e,i),this._tuning=s,this._trackLabel=r,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,i,s){s.textBaseline=ge.Middle;const r=s.color;this.colorOverride&&(s.color=this.colorOverride),super.paint(e,i,s),s.color=r}createGlyphs(e){const i=this.renderer.resources;if(this.height=0,this._trackLabel.length>0){this.height+=1;const l=new zi(0,this.height,this._trackLabel,i.effectFont,K.Left);l.renderer=this.renderer,l.doLayout(),this.height+=l.height+1,l.y+=l.height/2,this.addGlyph(l)}const a=new zi(0,this.height,e.name,i.effectFont,K.Left);if(a.renderer=this.renderer,a.doLayout(),this.height+=a.height,a.y+=a.height/2,this.addGlyph(a),this.renderer.scoreRenderer.canvas.font=i.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width,128)),!e.isStandard){this.height+=15;const l=n.CircleNumberScale,c=Xe.Heights.get(d.GuitarString0)*l,u=0|Math.ceil(e.tunings.length/2);let h=0,f=this.height;for(let p=0,g=e.tunings.length;p<g;p++){this.addGlyph(new sn(h,f+c/2.5,l,d.GuitarString0+(p+1)));const y=`= ${I.getTextForTuning(e.tunings[p],!1)}`;this.addGlyph(new zi(h+c+1,f,y,i.effectFont,K.Left)),f+=15,p===u-1&&(f=this.height,h+=64)}this.height+=15*u}this.width+=15}}return n.CircleNumberScale=.7,n})();class gj{constructor(t,e){this.args=t,this.renderCallback=e}}var ys=function(n){return n[n.Automatic=0]="Automatic",n[n.FromModelWithScale=1]="FromModelWithScale",n[n.FromModelWithWidths=2]="FromModelWithWidths",n}(ys||{});class ra{get scaledWidth(){return Math.round(this.width/this.renderer.settings.display.scale)}constructor(t){this._barRendererLookup=new Map,this.pagePadding=null,this.width=0,this.height=0,this.multiBarRestInfo=null,this.headerGlyphs=new Map,this.footerGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=ys.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=t}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();const t=this.renderer.score;this.firstBarIndex=H.computeFirstDisplayedBarIndex(t,this.renderer.settings),this.lastBarIndex=H.computeLastDisplayedBarIndex(t,this.renderer.settings,this.firstBarIndex),this.multiBarRestInfo=H.buildMultiBarRestInfo(this.renderer.tracks,this.firstBarIndex,this.lastBarIndex),this.pagePadding=this.renderer.settings.display.padding.map(e=>e/this.renderer.settings.display.scale),this.pagePadding||(this.pagePadding=[0,0,0,0]),1===this.pagePadding.length?this.pagePadding=[this.pagePadding[0],this.pagePadding[0],this.pagePadding[0],this.pagePadding[0]]:2===this.pagePadding.length&&(this.pagePadding=[this.pagePadding[0],this.pagePadding[1],this.pagePadding[0],this.pagePadding[1]]),this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(t,e){if(0===t.height)return;const i=this.renderer.settings.display.scale;t.x*=i,t.y*=i,t.width*=i,t.height*=i,t.totalWidth*=i,t.totalHeight*=i,this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(t.id,new gj(t,e)),this.renderer.partialLayoutFinished.trigger(t)):(this.renderer.partialLayoutFinished.trigger(t),this.internalRenderLazyPartial(t,e))}internalRenderLazyPartial(t,e){const i=this.renderer.canvas;i.beginRender(t.width,t.height),e(i),t.renderResult=i.endRender(),this.renderer.partialRenderFinished.trigger(t)}renderLazyPartial(t){if(this._lazyPartials.has(t)){const e=this._lazyPartials.get(t);this.internalRenderLazyPartial(e.args,e.renderCallback)}}createHeaderFooterGlyph(t,e,i,s){switch(i){case U.WordsAndMusic:if(e.words!==e.music)return;break;case U.Words:case U.Music:if(e.words===e.music)return;break;case U.CopyrightSecondLine:if(!this.headerGlyphs.has(U.Copyright))return}const r=t.display.resources,a=t.notation,l=e.style&&e.style.headerAndFooter.has(i)?e.style.headerAndFooter.get(i):Vo.defaultHeaderAndFooter.get(i);let c=void 0===l.isVisible||l.isVisible;if(void 0!==s&&(c=a.isNotationElementVisible(s)),!c)return;const u=l.buildText(e);return u?new zi(0,0,u,r.getFontForElement(i),l.textAlign,void 0,Ce.scoreColor(r,i,e)):void 0}createScoreInfoGlyphs(){x.debug("ScoreLayout","Creating score info glyphs");const t=this.renderer.settings,e=this.renderer.score;this.headerGlyphs=new Map,this.footerGlyphs=new Map;const i=new Ct(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[a,o]of ra.HeaderElements.value){const l=this.createHeaderFooterGlyph(t,e,a,o);l&&(l.renderer=i,l.doLayout(),this.headerGlyphs.set(a,l))}for(const[a,o]of ra.FooterElements.value){const l=this.createHeaderFooterGlyph(t,e,a,o);l&&(l.renderer=i,l.doLayout(),this.footerGlyphs.set(a,l))}const s=t.notation,r=t.display.resources;if(s.isNotationElementVisible(Te.GuitarTuning)){const a=[];for(const o of this.renderer.tracks)for(const l of o.staves){let c=!l.isPercussion&&l.isStringed&&l.tuning.length>0&&l.showTablature;if(e.stylesheet.perTrackDisplayTuning&&e.stylesheet.perTrackDisplayTuning.has(o.index)&&!1===e.stylesheet.perTrackDisplayTuning.get(o.index)&&(c=!1),c){a.push(l);break}}if(a.length>0&&e.stylesheet.globalDisplayTuning){this.tuningGlyph=new pj(0,0),this.tuningGlyph.renderer=i;for(const o of a)if(o.stringTuning.tunings.length>0){const c=new jg(0,0,o.stringTuning,a.length>1?o.track.name:"");c.colorOverride=Ce.trackColor(r,Nr.StringTuning,o.track),c.renderer=i,c.doLayout(),this.tuningGlyph.addGlyph(c)}}}if(s.isNotationElementVisible(Te.ChordDiagrams)){this.chordDiagrams=new aj(0,0),this.chordDiagrams.renderer=i;const a=new Set;for(const o of this.renderer.tracks)if(e.stylesheet.globalDisplayChordDiagramsOnTop&&(null==e.stylesheet.perTrackChordDiagramsOnTop||!e.stylesheet.perTrackChordDiagramsOnTop.has(o.index)||e.stylesheet.perTrackChordDiagramsOnTop.get(o.index)))for(const c of o.staves){const u=c.chords;if(u)for(const[,h]of u)a.has(h.uniqueId)||h.showDiagram&&(a.add(h.uniqueId),this.chordDiagrams.addChord(h))}}}createEmptyStaffSystem(){const t=new fj(this);for(let e=0;e<this.renderer.tracks.length;e++){const i=this.renderer.tracks[e];for(let s=0;s<i.staves.length;s++){const r=i.staves[s],a=N.staveProfiles.get(this.renderer.settings.display.staveProfile);for(const o of a)o.canCreate(i,r)&&t.addStaff(i,new oj(e,r,o))}}return t}registerBarRenderer(t,e){if(this._barRendererLookup.has(t)||this._barRendererLookup.set(t,new Map),this._barRendererLookup.get(t).set(e.bar.id,e),e.additionalMultiRestBars)for(const i of e.additionalMultiRestBars)this._barRendererLookup.get(t).set(i.id,e)}unregisterBarRenderer(t,e){if(this._barRendererLookup.has(t)){const i=this._barRendererLookup.get(t);if(i.delete(e.bar.id),e.additionalMultiRestBars)for(const s of e.additionalMultiRestBars)i.delete(s.id)}}getRendererForBar(t,e){const i=e.id;return this._barRendererLookup.has(t)&&this._barRendererLookup.get(t).has(i)?this._barRendererLookup.get(t).get(i):null}layoutAndRenderBottomScoreInfo(t){t=Math.round(t);const e=new na;e.x=0,e.y=t;let i=0;const s=this.renderer.settings.display.resources,r=[];let a=0;for(const[o,l]of ra.FooterElements.value)if(this.footerGlyphs.has(o)){const c=this.footerGlyphs.get(o);c.y=i,this.alignScoreInfoGlyph(c),i+=1.2*c.font.size,r.push(c),a=Math.max(a,Math.round(c.x+c.width))}return i=Math.round(i),r.length>0&&(e.width=a,e.height=i,e.totalWidth=this.scaledWidth,e.totalHeight=t+e.height,this.registerPartial(e,o=>{o.color=s.scoreInfoColor,o.textAlign=K.Left,o.textBaseline=ge.Top;for(const l of r)l.paint(0,0,o)})),t+i}alignScoreInfoGlyph(t){if(N.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical)switch(t.textAlign){case K.Left:t.x=this.pagePadding[0];break;case K.Center:t.x=this.scaledWidth/2;break;case K.Right:t.x=this.scaledWidth-this.pagePadding[2]}else t.x=this.firstBarX,t.textAlign=K.Left}layoutAndRenderAnnotation(t){const i=this.renderer.settings.display.resources,r=ve.withFamilyList(i.copyrightFont.families,12,Tt.Plain,Wi.Bold),a=new Ct(this.renderer,this.renderer.tracks[0].staves[0].bars[0]),o=new zi(0,0,"rendered by alphaTab",r,K.Center,void 0,i.mainGlyphColor);o.renderer=a,o.doLayout(),this.alignScoreInfoGlyph(o);const l=new na;return l.width=o.x+o.width,l.x=0,l.height=12,l.y=t,l.totalWidth=this.scaledWidth,l.totalHeight=t+12,l.firstMasterBarIndex=-1,l.lastMasterBarIndex=-1,this.registerPartial(l,c=>{c.color=i.mainGlyphColor,c.font=r,c.textAlign=K.Left,c.textBaseline=ge.Top,o.paint(0,0,c)}),t+12}}ra.HeaderElements=new cg(()=>new Map([[U.Title,Te.ScoreTitle],[U.SubTitle,Te.ScoreSubTitle],[U.Artist,Te.ScoreArtist],[U.Album,Te.ScoreAlbum],[U.Words,Te.ScoreWords],[U.Music,Te.ScoreMusic],[U.WordsAndMusic,Te.ScoreWordsAndMusic],[U.Transcriber,void 0]])),ra.FooterElements=new cg(()=>new Map([[U.Copyright,Te.ScoreCopyright],[U.CopyrightSecondLine,void 0]]));class Ya extends er{constructor(){super(0,0),this._effectGlyphs=[],this._normalGlyphs=[],this.computedWidth=0}doLayout(){let t=0;if(this.glyphs)for(let e=0,i=this.glyphs.length;e<i;e++){const s=this.glyphs[e];s.x=t,s.renderer=this.renderer,s.doLayout(),t+=s.width}this.width=t,this.computedWidth=t}noteLoop(t){for(let e=this.container.beat.notes.length-1;e>=0;e--)t(this.container.beat.notes[e])}addEffect(t){super.addGlyph(t),this._effectGlyphs.push(t)}addNormal(t){super.addGlyph(t),this._normalGlyphs.push(t)}get effectElement(){}paint(t,e,i){this.paintEffects(t,e,i),this.paintNormal(t,e,i)}paintNormal(t,e,i){for(const s of this._normalGlyphs)s.paint(t+this.x,e+this.y,i)}paintEffects(t,e,i){const s=this.effectElement?Ce.beat(i,this.effectElement,this.container.beat):void 0;try{for(const r of this._effectGlyphs)r.paint(t+this.x,e+this.y,i)}finally{s?.[Symbol.dispose]?.()}}}class Xa extends Ya{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(t,e,i){}getNoteX(t,e){return 0}getNoteY(t,e){return 0}}let qg=(()=>{class n extends Pt{constructor(e,i,s,r=1){super(e,i),this._scale=0,this._symbols=[],this._symbols=n.getSymbols(s),this._scale=r}static getSymbols(e){const i=[];for(;e>0;)i.unshift(n.getSymbol(e%10)),e=e/10|0;return i}static getSymbol(e){switch(e){case 0:return d.TimeSig0;case 1:return d.TimeSig1;case 2:return d.TimeSig2;case 3:return d.TimeSig3;case 4:return d.TimeSig4;case 5:return d.TimeSig5;case 6:return d.TimeSig6;case 7:return d.TimeSig7;case 8:return d.TimeSig8;case 9:return d.TimeSig9;default:return d.None}}doLayout(){let e=0;for(const i of this._symbols)e+=Xe.Widths.get(i);this.width=e}paint(e,i,s){s.fillMusicFontSymbols(e+this.x,i+this.y,this._scale,this._symbols)}}return n.numberHeight=18,n})(),mj=(()=>{class n extends Pt{constructor(){super(0,0),this._numberGlyph=[]}doLayout(){this.width=70,this.renderer.registerOverflowTop(this.renderer.getLineHeight(1)),this._numberGlyph=qg.getSymbols(this.renderer.additionalMultiRestBars.length+1)}paint(e,i,s){s.fillMusicFontSymbols(e+this.x,i+this.y+this.renderer.height/2,1,[d.RestHBarLeft,d.RestHBarMiddle,d.RestHBarMiddle,d.RestHBarMiddle,d.RestHBarRight]);const r=this.renderer.getLineY(-1.5);s.fillMusicFontSymbols(e+this.x+n.BarWidth/2,i+this.y+r|0,1,this._numberGlyph,!0)}}return n.BarWidth=60,n})();class Yg extends Zs{constructor(t){super(Yg.getOrCreatePlaceholderBeat(t),t),this.preNotes=new Ya,this.onNotes=new Xa}doLayout(){this.renderer.showMultiBarRest&&this.onNotes.addNormal(new mj),super.doLayout()}static getOrCreatePlaceholderBeat(t){if(t.voice.beats.length>1)return t.voice.beats[0];const e=new Vn;return e.voice=t.voice,e}}var Z=function(n){return n[n.TopWithStem=0]="TopWithStem",n[n.Top=1]="Top",n[n.Center=2]="Center",n[n.Bottom=3]="Bottom",n[n.BottomWithStem=4]="BottomWithStem",n}(Z||{}),wt=function(n){return n[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right",n}(wt||{});class Ct{get nextRenderer(){return this.bar&&this.bar.nextBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.nextBar):null}get previousRenderer(){return this.bar&&this.bar.previousBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.previousBar):null}get lastBar(){return this.additionalMultiRestBars?this.additionalMultiRestBars[this.additionalMultiRestBars.length-1]:this.bar}get showMultiBarRest(){return!1}constructor(t,e){this._preBeatGlyphs=new Yo,this._voiceContainers=new Map,this._postBeatGlyphs=new Yo,this._ties=[],this.additionalMultiRestBars=null,this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=t,this.bar=e,e&&(this.helpers=new sj(this))}registerTies(t){this._ties.push(...t)}get middleYPosition(){return 0}registerOverflowTop(t){return t>this.topOverflow&&(this.topOverflow=t,!0)}registerOverflowBottom(t){return t>this.bottomOverflow&&(this.bottomOverflow=t,!0)}scaleToWidth(t){const e=t-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const i of this._voiceContainers.values())i.scaleToWidth(e);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+e,this.width=t}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return 0===this.index}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){const t=this.layoutingInfo,e=this._preBeatGlyphs.width;t.preBeatSize<e&&(t.preBeatSize=e);for(const s of this._voiceContainers.values())s.registerLayoutingInfo(t);const i=this._postBeatGlyphs.width;t.postBeatSize<i&&(t.postBeatSize=i)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let t=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const i of this._voiceContainers.values()){i.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,i.applyLayoutingInfo(this.layoutingInfo);const s=i.x+i.width;t<s&&(t=s)}this._postBeatGlyphs.x=Math.floor(t),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const e=this.barDisplayWidth;return e>0&&this.scoreRenderer.layout.systemsLayoutMode===ys.FromModelWithWidths&&(this.width=e,this.computedWidth=e),!0}finalizeRenderer(){this.isFinalized=!0;let t=!1;const e=this.y-this.staff.topSpacing,i=this.y+this.height+this.staff.bottomSpacing;for(const s of this._ties)if(s.doLayout(),s.height>0){const r=s.y+s.height-i;r>0&&this.registerOverflowBottom(r)&&(t=!0);const a=s.y-e;a<0&&this.registerOverflowTop(-1*a)&&(t=!0)}return t}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new Yo,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new Yo,this._postBeatGlyphs.renderer=this;for(let t=0;t<this.bar.voices.length;t++){const e=this.bar.voices[t];if(this.hasVoiceContainer(e)){const i=new K9(0,0,e);i.renderer=this,this._voiceContainers.set(this.bar.voices[t].index,i)}}if(this.bar.simileMark===$t.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.additionalMultiRestBars){const t=new Yg(this.getVoiceContainer(this.bar.voices[0]));this.addBeatGlyph(t)}else this.createBeatGlyphs();this.createPostBeatGlyphs(),this.updateSizes();for(const t of this.helpers.beamHelpers)for(const e of t)e.finish();this.computedWidth=this.width}}hasVoiceContainer(t){return!(!this.additionalMultiRestBars&&0!==t.index&&t.isEmpty)}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);const t=this._voiceContainers,e=this.beatGlyphsStart;let i=e;for(const s of t.values()){s.x=e,s.doLayout();const r=s.x+s.width;i<r&&(i=r)}this._postBeatGlyphs.x=Math.floor(i),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height}addPreBeatGlyph(t){t.renderer=this,this._preBeatGlyphs.addGlyph(t)}addBeatGlyph(t){t.renderer=this,t.preNotes.renderer=this,t.onNotes.renderer=this,t.onNotes.beamingHelper=this.helpers.beamHelperLookup[t.beat.voice.index].get(t.beat.index),this.getVoiceContainer(t.beat.voice).addGlyph(t)}getVoiceContainer(t){return this._voiceContainers.has(t.index)?this._voiceContainers.get(t.index):void 0}getBeatContainer(t){return this.getVoiceContainer(t.voice)?.beatGlyphs?.[t.index]}getPreNotesGlyphForBeat(t){return this.getBeatContainer(t)?.preNotes}getOnNotesGlyphForBeat(t){return this.getBeatContainer(t)?.onNotes}paint(t,e,i){this.paintBackground(t,e,i),i.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(t+this.x,e+this.y,i);for(const s of this._voiceContainers.values())s.paint(t+this.x,e+this.y,i);i.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(t+this.x,e+this.y,i)}paintBackground(t,e,i){this.layoutingInfo.paint(t+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,e+this.y+this.height,i)}buildBoundingsLookup(t,e,i){const s=new KS;s.bar=this.bar,s.visualBounds=new kn,s.visualBounds.x=e+this.x,s.visualBounds.y=i+this.y+this.topPadding,s.visualBounds.w=this.width,s.visualBounds.h=this.height-this.topPadding-this.bottomPadding,s.realBounds=new kn,s.realBounds.x=e+this.x,s.realBounds.y=i+this.y,s.realBounds.w=this.width,s.realBounds.h=this.height,t.addBar(s);for(const[r,a]of this._voiceContainers){const o=this.bar.isEmpty&&0===r;if(!a.voice.isEmpty||o)for(let l=0,c=a.beatGlyphs.length;l<c;l++)a.beatGlyphs[l].buildBoundingsLookup(s,e+this.x+a.x,i+this.y+a.y,o)}}addPostBeatGlyph(t){this._postBeatGlyphs.addGlyph(t)}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const t of this.bar.voices)this.hasVoiceContainer(t)&&this.createVoiceGlyphs(t)}createVoiceGlyphs(t){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(t,e=xe.PreNotes){const i=this.getBeatContainer(t);if(i)switch(e){case xe.PreNotes:return i.voiceContainer.x+i.x;case xe.OnNotes:return i.voiceContainer.x+i.x+i.onNotes.x;case xe.MiddleNotes:return i.voiceContainer.x+i.x+i.onTimeX;case xe.Stem:const s=i.onNotes.beamingHelper?i.onNotes.beamingHelper.getBeatLineX(t):i.onNotes.x+i.onNotes.width/2;return i.voiceContainer.x+s;case xe.PostNotes:return i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.width;case xe.EndBeat:return i.voiceContainer.x+i.x+i.width}return 0}getRatioPositionX(t){const e=this.bar.isEmpty?this.beatGlyphsStart:this.getBeatX(this.bar.voices[0].beats[0],xe.OnNotes);return e+(this.postBeatGlyphsStart-e)*t}getNoteX(t,e){const i=this.getBeatContainer(t.beat);return i?i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.getNoteX(t,e):0}getNoteY(t,e){const i=this.getOnNotesGlyphForBeat(t.beat);return i?i.getNoteY(t,e):Number.NaN}reLayout(){(this.wasFirstOfLine&&!this.isFirstOfLine||!this.wasFirstOfLine&&this.isFirstOfLine)&&this.recreatePreBeatGlyphs(),this.updateSizes(),this.registerLayoutingInfo()}recreatePreBeatGlyphs(){this._preBeatGlyphs=new Yo,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()}paintSimileMark(t,e,i){const s=Ce.voice(i,xh.Glyphs,this.bar.voices[0],!0);try{switch(this.bar.simileMark){case $t.Simple:i.beginGroup(Zs.getGroupId(this.bar.voices[0].beats[0])),i.fillMusicFontSymbol(t+this.x+(this.width-20)/2,e+this.y+this.height/2,1,d.Repeat1Bar,!1),i.endGroup();break;case $t.SecondOfDouble:i.beginGroup(Zs.getGroupId(this.bar.voices[0].beats[0])),i.beginGroup(Zs.getGroupId(this.bar.previousBar.voices[0].beats[0])),i.fillMusicFontSymbol(t+this.x-14,e+this.y+this.height/2,1,d.Repeat2Bars,!1),i.endGroup(),i.endGroup()}}finally{s?.[Symbol.dispose]?.()}}completeBeamingHelper(t){}getBeatDirection(t){return this.helpers.getBeamingHelperForBeat(t).direction}}Ct.RawLineSpacing=8,Ct.StemWidth=.12*Ct.RawLineSpacing,Ct.StaffLineThickness=.13*Ct.RawLineSpacing,Ct.BeamThickness=.5*Ct.RawLineSpacing,Ct.BeamSpacing=.25*Ct.RawLineSpacing;var Pe=function(n){return n[n.SinglePreBeat=0]="SinglePreBeat",n[n.SingleOnBeat=1]="SingleOnBeat",n[n.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",n[n.GroupedOnBeat=3]="GroupedOnBeat",n[n.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",n[n.FullBar=5]="FullBar",n}(Pe||{});class yj extends Pt{constructor(t,e){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.originalHeight=0,this.slot=null,this.voice=t,this.info=e}doLayout(){super.doLayout();for(let t=0;t<this.renderer.bar.voices.length;t++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(t){if(t.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,t)&&(!this.info.hideOnMultiTrack||0===this.renderer.staff.trackIndex)){if(this.isEmpty=!1,(!this.firstBeat||t.isBefore(this.firstBeat))&&(this.firstBeat=t),!this.lastBeat||t.isAfter(this.lastBeat))switch(this.lastBeat=t,this.info.sizingMode){case Pe.SingleOnBeatToEnd:case Pe.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat)}const e=this.createOrResizeGlyph(this.info.sizingMode,t);e.height>this.height&&(this.height=e.height,this.originalHeight=e.height)}}resetHeight(){this.height=this.originalHeight}createOrResizeGlyph(t,e){let i;switch(t){case Pe.FullBar:case Pe.SinglePreBeat:case Pe.SingleOnBeat:case Pe.SingleOnBeatToEnd:return i=this.info.createNewGlyph(this.renderer,e),i.renderer=this.renderer,i.beat=e,i.doLayout(),this._effectGlyphs[e.voice.index].set(e.index,i),this._uniqueEffectGlyphs[e.voice.index].push(i),i;case Pe.GroupedOnBeat:case Pe.GroupedOnBeatToEnd:const s=t===Pe.GroupedOnBeat?Pe.SingleOnBeat:Pe.SingleOnBeatToEnd;if(e.index>0||this.renderer.index>0){const r=e.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,r)){let a=null;if(e.index>0&&this._effectGlyphs[e.voice.index].has(r.index))a=this._effectGlyphs[e.voice.index].get(r.index);else if(this.renderer.index>0){const c=this.renderer.previousRenderer.getBand(r.voice,this.info.effectId);if(c){const u=c._effectGlyphs[r.voice.index];u.has(r.index)&&(a=u.get(r.index))}}const o=this.createOrResizeGlyph(s,e);return a&&this.info.canExpand(r,e)&&(a.nextGlyph=o,o.previousGlyph=a,this.isLinkedToPrevious=!0),o}return this.createOrResizeGlyph(s,e)}return this.createOrResizeGlyph(s,e);default:return this.createOrResizeGlyph(Pe.SingleOnBeat,e)}}paint(t,e,i){super.paint(t,e,i);for(let s=0,r=this._uniqueEffectGlyphs.length;s<r;s++){const a=this._uniqueEffectGlyphs[s];for(let o=0,l=a.length;o<l;o++){const c=a[o],u=Ce.beat(i,ht.Effects,c.beat,!1);try{c.paint(t+this.x,e+this.y,i)}finally{u?.[Symbol.dispose]?.()}}}}alignGlyphs(){for(let t=0;t<this._effectGlyphs.length;t++)for(const e of this._effectGlyphs[t].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[t].beats[e])}alignGlyph(t,e){const i=this._effectGlyphs[e.voice.index].get(e.index),s=this.renderer.getBeatContainer(e);switch(t){case Pe.SinglePreBeat:const r=this.renderer.layoutingInfo.getPreBeatSize(e);i.x=this.renderer.beatGlyphsStart+s.x-r;break;case Pe.SingleOnBeat:case Pe.GroupedOnBeat:i.x=this.renderer.beatGlyphsStart+s.x;break;case Pe.SingleOnBeatToEnd:case Pe.GroupedOnBeatToEnd:if(i.x=this.renderer.beatGlyphsStart+s.x,s.beat.isLastOfVoice)i.width=this.renderer.width-i.x;else{const a=this.renderer.layoutingInfo.getPostBeatSize(e);i.width=a}break;case Pe.FullBar:i.width=this.renderer.width}}}class bj{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class wj{constructor(){this.bands=[],this.shared=new bj}update(t){t.info.canShareBand||(this.shared.uniqueEffectId=t.info.effectId),t.slot=this,this.bands.push(t),t.height>this.shared.height&&(this.shared.height=t.height),(!this.shared.firstBeat||t.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=t.firstBeat),(!this.shared.lastBeat||t.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=t.lastBeat)}canBeUsed(t){return(!this.shared.uniqueEffectId&&t.info.canShareBand||t.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(t.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class Sj{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(t){if(this._effectSlot.has(t.info.effectId)){const i=this._effectSlot.get(t.info.effectId);if(i.canBeUsed(t))return i}for(const i of this.slots)if(i.canBeUsed(t))return i;const e=new wj;return this.slots.push(e),e}register(t){const e=this.getOrCreateSlot(t);e.update(t),this._effectSlot.set(t.info.effectId,e)}}class _j extends Ct{constructor(t,e,i){super(t,e),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=i}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let t=super.finalizeRenderer();return this.updateHeight()&&(t=!0),t}updateHeight(){if(!this.sizingInfo)return!1;let t=0;for(const e of this.sizingInfo.slots){e.shared.y=t;for(const i of e.bands)i.y=t,i.height=e.shared.height;t+=e.shared.height}return t!==this.height&&(this.height=t,!0)}applyLayoutingInfo(){const t=!super.applyLayoutingInfo();this.sizingInfo=this.index>0?this.previousRenderer.sizingInfo:new Sj;for(const e of this._bands)e.resetHeight(),e.alignGlyphs(),e.isEmpty||this.sizingInfo.register(e);return this.updateHeight(),t}scaleToWidth(t){super.scaleToWidth(t);for(const e of this._bands)e.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(const t of this.bar.voices)if(this.hasVoiceContainer(t))for(const e of this._infos){const i=new yj(t,e);i.renderer=this,i.doLayout(),this._bands.push(i),this._bandLookup.set(`${t.index}.${e.effectId}`,i)}super.createBeatGlyphs();for(const t of this._bands)t.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(t){for(const e of t.beats){const i=new Zs(e,this.getVoiceContainer(t));i.preNotes=new Ya,i.onNotes=new Xa,this.addBeatGlyph(i);for(const s of this._bands)s.createGlyph(e)}}paint(t,e,i){this.paintBackground(t,e,i);for(const s of this._bands)i.color=0===s.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isEmpty||s.paint(t+this.x,e+this.y,i)}getBand(t,e){const i=`${t.index}.${e}`;return this._bandLookup.has(i)?this._bandLookup.get(i):null}}class Xo extends Xh{get staffId(){return this._staffId}getStaffPaddingTop(t){return t.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(t){return t.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(t,e,i=null){super(),this.infos=e,this._staffId=t,this.isInsideBracket=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=i}canCreate(t,e){const i=this.shouldShow;return super.canCreate(t,e)&&(!i||i(t,e))}create(t,e){return new _j(t,e,this.infos.filter(i=>t.settings.notation.isNotationElementVisible(i.notationElement)))}}let vj=(()=>{class n extends Gi{constructor(e,i,s,r,a){super(e,i),this._endingsString="",this._endings=H.getAlternateEndingsList(s),this._openLine=r,this._closeLine=a}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+(n.Padding+2);let e="";for(let i=0,s=this._endings.length;i<s;i++)e+=this._endings[i]+1,e+=". ";this._endingsString=e}paint(e,i,s){const r=this._closeLine?this.width-4:this.width;if(e=.5+(0|e),i=.5+(0|i),this._openLine?(s.moveTo(e+this.x,i+this.y+this.height),s.lineTo(e+this.x,i+this.y)):s.moveTo(e+this.x,i+this.y),s.lineTo(e+this.x+r,i+this.y),this._closeLine&&s.lineTo(e+this.x+r,i+this.y+this.height),s.stroke(),this._openLine){const a=s.textBaseline;s.textBaseline=ge.Top,s.font=this.renderer.resources.wordsFont,s.fillText(this._endingsString,e+this.x+n.Padding,i+this.y),s.textBaseline=a}}}return n.Padding=3,n})();class Mt{get effectId(){return this.notationElement.toString()}}class Tj extends Mt{get notationElement(){return Te.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Pe.FullBar}shouldCreateGlyph(t,e){return 0===e.voice.index&&0===e.index&&0!==e.voice.bar.masterBar.alternateEndings}createNewGlyph(t,e){const i=e.voice.bar.masterBar,s=null===i.previousMasterBar||i.alternateEndings!==i.previousMasterBar.alternateEndings;let r=i.isRepeatEnd||null===i.nextMasterBar||i.alternateEndings!==i.nextMasterBar.alternateEndings;return i.repeatGroup.closings.some(a=>a.index>=i.index)||(r=!1),new vj(0,0,i.alternateEndings,s,r)}canExpand(t,e){return!0}}class kj extends Mt{get notationElement(){return Te.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return 0===e.index&&0===e.voice.bar.index&&0!==e.voice.bar.staff.capo}createNewGlyph(t,e){return new zi(0,0,`Capo. fret ${e.voice.bar.staff.capo}`,t.resources.effectFont,K.Left)}canExpand(t,e){return!1}}class Cj extends Mt{get notationElement(){return Te.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.hasChord}createNewGlyph(t,e){return new zi(0,0,e.chord.name,t.resources.effectFont,K.Center)}canExpand(t,e){return!1}}class Ic extends Gi{constructor(t){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=t}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(t,e,i){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering)return void this.paintNonGrouped(t,e,i);let s;if(!this.isLinkedWithNext&&this.forceGroupedRendering)s=this;else for(s=this.nextGlyph;s.isLinkedWithNext;)s=s.nextGlyph;const c=this.calculateEndX(s.renderer,s.beat,t-this.renderer.x,this.endPosition);this.paintGrouped(t,e,c,i)}calculateEndX(t,e,i,s){return e?i+t.x+t.getBeatX(e,s):i+t.x+this.x+this.width}paintNonGrouped(t,e,i){const r=this.calculateEndX(this.renderer,this.beat,t-this.renderer.x,this.endPosition);this.paintGrouped(t,e,r,i)}}class Dj extends Ic{constructor(t,e,i){super(xe.EndBeat),this._crescendo=ii.None,this._crescendo=i,this.x=t,this.y=e}doLayout(){super.doLayout(),this.height=17}paintGrouped(t,e,i,s){const r=t+this.x,a=this.height,o=Xe.Widths.get(d.NoteheadBlack)/2;s.beginPath(),this._crescendo===ii.Crescendo?(s.moveTo(i-=o,e+this.y),s.lineTo(r,e+this.y+a/2),s.lineTo(i,e+this.y+a)):(i-=o,s.moveTo(r,e+this.y),s.lineTo(i,e+this.y+a/2),s.lineTo(r,e+this.y+a)),s.stroke()}}class Nj extends Mt{get notationElement(){return Te.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.GroupedOnBeatToEnd}shouldCreateGlyph(t,e){return e.crescendo!==ii.None}createNewGlyph(t,e){return new Dj(0,0,e.crescendo)}canExpand(t,e){return t.crescendo===e.crescendo}}class l_ extends sn{constructor(t,e,i){super(t,e,.6,l_.getSymbol(i)),this.center=!0}doLayout(){super.doLayout(),this.y+=this.height/2}static getSymbol(t){switch(t){case ie.PPP:return d.DynamicPPP;case ie.PP:return d.DynamicPP;case ie.P:return d.DynamicPiano;case ie.MP:return d.DynamicMP;case ie.MF:return d.DynamicMF;case ie.F:return d.DynamicForte;case ie.FF:return d.DynamicFF;case ie.FFF:return d.DynamicFFF;case ie.PPPP:return d.DynamicPPPP;case ie.PPPPP:case ie.PPPPPP:return d.DynamicPPPPP;case ie.FFFF:return d.DynamicFFFF;case ie.FFFFF:return d.DynamicFFFFF;case ie.FFFFFF:return d.DynamicFFFFFF;case ie.SF:return d.DynamicSforzando1;case ie.SFP:return d.DynamicSforzandoPiano;case ie.SFPP:return d.DynamicSforzandoPianissimo;case ie.FP:return d.DynamicFortePiano;case ie.RF:return d.DynamicRinforzando1;case ie.RFZ:return d.DynamicRinforzando2;case ie.SFZ:return d.DynamicSforzato;case ie.SFFZ:return d.DynamicSforzatoFF;case ie.FZ:return d.DynamicForzando;case ie.N:return d.DynamicNiente;case ie.PF:return d.DynamicPF;case ie.SFZP:return d.DynamicSforzatoPiano;default:return d.None}}}class xj extends Mt{get notationElement(){return Te.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return this.internalShouldCreateGlyph(e)}internalShouldCreateGlyph(t){if(t.voice.bar.staff.track.score.stylesheet.hideDynamics||t.isEmpty||t.voice.isEmpty||t.isRest)return!1;const e=this.getPreviousDynamicsBeat(t);let i=0===t.voice.index&&!e||t.dynamics!==e?.dynamics;if(i&&t.voice.index>0)for(const s of t.voice.bar.voices)if(s.index<t.voice.index){const r=s.getBeatAtPlaybackStart(t.playbackStart);r&&t.dynamics===r.dynamics&&this.internalShouldCreateGlyph(r)&&(i=!1)}return i}getPreviousDynamicsBeat(t){let e=t.previousBeat;for(;null!=e;){if(!e.isRest)return e;e=e.previousBeat}return null}createNewGlyph(t,e){return new l_(0,0,e.dynamics)}canExpand(t,e){return!0}}class c_ extends sn{constructor(t){super(0,0,1,c_.getSymbol(t)),this.center=!0}static getSymbol(t){switch(t){case un.FadeIn:return d.GuitarFadeIn;case un.FadeOut:return d.GuitarFadeOut;case un.VolumeSwell:return d.GuitarVolumeSwell}return d.None}paint(t,e,i){super.paint(t,e+this.height,i)}}class Ej extends Mt{get notationElement(){return Te.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.fade!==un.None}createNewGlyph(t,e){return new c_(e.fade)}canExpand(t,e){return!0}}class u_ extends sn{constructor(t,e,i){super(t,e,1,u_.getSymbol(i))}static getSymbol(t){switch(t){case jn.Short:return d.FermataShortAbove;case jn.Medium:return d.FermataAbove;case jn.Long:return d.FermataLongAbove;default:return d.None}}paint(t,e,i){super.paint(t-this.width/2,e+this.height,i)}}class Bj extends Mt{get notationElement(){return Te.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return 0===e.voice.index&&!!e.fermata}createNewGlyph(t,e){return new u_(0,0,e.fermata.type)}canExpand(t,e){return!0}}class Pj extends Mt{get notationElement(){return Te.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return!(0!==e.voice.index||e.isRest||t.notation.fingeringMode!==Tr.SingleNoteEffectBand&&t.notation.fingeringMode!==Tr.SingleNoteEffectBandForcePiano||1!==e.notes.length)&&e.notes[0].isFingering}createNewGlyph(t,e){let i=se.Unknown,s=!1;const r=e.notes[0];r.leftHandFinger!==se.Unknown?(i=r.leftHandFinger,s=!0):r.rightHandFinger!==se.Unknown&&(i=r.rightHandFinger);const a=H.fingerToString(t.settings,e,i,s)??"";return new zi(0,0,a,t.resources.fingeringFont,K.Left)}canExpand(t,e){return!0}}class Jo extends Mt{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(t,e){this.lastCreateInfo=[];for(let i=0,s=e.notes.length;i<s;i++){const r=e.notes[i];this.shouldCreateGlyphForNote(r)&&this.lastCreateInfo.push(r)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(t,e){return!0}}let Qo=(()=>{class n extends Ic{constructor(e,i=!0){super(xe.OnNotes),this._label=e,this._dashed=i}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=xe.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(e,i,s){s.font=this.renderer.resources.effectFont;const a=s.textAlign;s.textAlign=K.Center,s.fillText(this._label,e+this.x,i+this.y),s.textAlign=a}paintGrouped(e,i,s,r){this.paintNonGrouped(e,i,r);const o=r.measureText(this._label).width,l=e+this.x+o/2+3,c=i+this.y+4;if(this._dashed){if(s>l){let h=l;for(;h<s;)r.beginPath(),r.moveTo(h,0|c),r.lineTo(Math.min(h+8,s),0|c),h+=11,r.stroke();r.beginPath(),r.moveTo(s,c-5|0),r.lineTo(s,c+5|0),r.stroke()}}else r.beginPath(),r.moveTo(l,0|c),r.lineTo(s,0|c),r.lineTo(s,c+5|0),r.stroke()}}return n.LineSpacing=3,n.LineTopPadding=4,n.LineTopOffset=5,n.LineSize=8,n})();class Ja extends Jo{get effectId(){return this._effectId}get notationElement(){return Te.EffectHarmonics}constructor(t){switch(super(),this._beat=null,this._harmonicType=t,t){case ae.None:this._effectId="harmonics-none";break;case ae.Natural:this._effectId="harmonics-natural";break;case ae.Artificial:this._effectId="harmonics-artificial";break;case ae.Pinch:this._effectId="harmonics-pinch";break;case ae.Tap:this._effectId="harmonics-tap";break;case ae.Semi:this._effectId="harmonics-semi";break;case ae.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId=""}}shouldCreateGlyphForNote(t){return!(!t.isHarmonic||t.harmonicType!==this._harmonicType||(t.beat!==this._beat&&(this._beat=t.beat),0))}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){return new Qo(Ja.harmonicToString(this._harmonicType))}static harmonicToString(t){switch(t){case ae.Natural:return"N.H.";case ae.Artificial:return"A.H.";case ae.Pinch:return"P.H.";case ae.Tap:return"T.H.";case ae.Semi:return"S.H.";case ae.Feedback:return"Fdbk."}return""}}class Ij extends Mt{get notationElement(){return Te.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(t,e){return e.isLetRing}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){return new Qo("LetRing")}canExpand(t,e){return!0}}class Mj extends Gi{constructor(t,e,i,s,r=K.Center){super(t,e),this._lines=i,this.font=s,this.textAlign=r}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(t,e,i){i.font=this.font;const s=i.textAlign;i.textAlign=this.textAlign;for(let r=0;r<this._lines.length;r++)this._lines[r]&&i.fillText(this._lines[r],t+this.x,e+this.y+r*this.font.size);i.textAlign=s}}class Aj extends Mt{get notationElement(){return Te.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return!!e.lyrics}createNewGlyph(t,e){return new Mj(0,0,e.lyrics,t.resources.effectFont,K.Center)}canExpand(t,e){return!0}}class Fj extends Mt{get notationElement(){return Te.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Pe.SinglePreBeat}shouldCreateGlyph(t,e){return 0===e.voice.bar.staff.index&&0===e.voice.index&&0===e.index&&e.voice.bar.masterBar.isSectionStart}createNewGlyph(t,e){return new zi(0,0,e.voice.bar.masterBar.section.marker?`[${e.voice.bar.masterBar.section.marker}] ${e.voice.bar.masterBar.section.text}`:e.voice.bar.masterBar.section.text,t.resources.markerFont,K.Left)}canExpand(t,e){return!0}}class Lj extends Ic{constructor(t,e){super(xe.PostNotes),this._ottava=t,this._aboveStaff=e}doLayout(){super.doLayout(),this.height=Xe.Heights.get(d.QuindicesimaAlta)}paintNonGrouped(t,e,i){this.paintOttava(t,e,i)}paintOttava(t,e,i){let s=0;switch(this._ottava){case we._15ma:s=.8*Xe.Widths.get(d.QuindicesimaAlta),i.fillMusicFontSymbol(t+this.x-s/2,e+this.y+this.height,.8,d.QuindicesimaAlta,!1);break;case we._8va:s=.8*Xe.Widths.get(d.OttavaAlta),i.fillMusicFontSymbol(t+this.x-s/2,e+this.y+this.height,.8,d.OttavaAlta,!1);break;case we._8vb:s=.8*Xe.Widths.get(d.OttavaBassaVb),i.fillMusicFontSymbol(t+this.x-s/2,e+this.y+this.height,.8,d.OttavaBassaVb,!1);break;case we._15mb:s=.8*(Xe.Widths.get(d.Quindicesima)+Xe.Widths.get(d.OctaveBaselineM)+Xe.Widths.get(d.OctaveBaselineB)),i.fillMusicFontSymbols(t+this.x-s/2,e+this.y+this.height,.8,[d.Quindicesima,d.OctaveBaselineM,d.OctaveBaselineB],!1)}return s/2}paintGrouped(t,e,i,s){const r=this.paintOttava(t,e,s),o=t+this.x+r+3;let l=e+this.y;if(l+=this._aboveStaff?2:this.height-2,i>o){let u=o;for(;u<i;)s.beginPath(),s.moveTo(u,0|l),s.lineTo(Math.min(u+8,i),0|l),u+=11,s.stroke();s.beginPath(),this._aboveStaff?(s.moveTo(i,l),s.lineTo(i,e+this.y+this.height)):(s.moveTo(i,l),s.lineTo(i,e+this.y)),s.stroke()}}}class iM extends Mt{get effectId(){return"ottavia-"+(this._aboveStaff?"above":"below")}get notationElement(){return Te.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.GroupedOnBeat}constructor(t){super(),this._aboveStaff=t}shouldCreateGlyph(t,e){switch(e.ottava){case we._15ma:case we._8va:return this._aboveStaff;case we._8vb:case we._15mb:return!this._aboveStaff}return!1}createNewGlyph(t,e){return new Lj(e.ottava,this._aboveStaff)}canExpand(t,e){return t.ottava===e.ottava}}class Rj extends Jo{get notationElement(){return Te.EffectPalmMute}shouldCreateGlyphForNote(t){return t.isPalmMute}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){return new Qo("P.M.")}}class Oj extends Jo{get notationElement(){return Te.EffectPickSlide}shouldCreateGlyphForNote(t){return t.slideOutType===Se.PickSlideDown||t.slideOutType===Se.PickSlideUp}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){return new Qo("P.S.")}}class Jh extends sn{constructor(t,e,i){super(t,e,gt.GraceScale,Jh.getSymbol(i))}paint(t,e,i){super.paint(t,e+this.height,i)}static getSymbol(t){switch(t){case vn.Up:return d.StringsUpBow;case vn.Down:return d.StringsDownBow;default:return d.None}}}class Vj extends Mt{get notationElement(){return Te.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.pickStroke!==vn.None}createNewGlyph(t,e){return new Jh(0,0,e.pickStroke)}canExpand(t,e){return!0}}class sM extends Ic{constructor(t){super(xe.EndBeat),this._stepSize=0,this._type=t}doLayout(){switch(super.doLayout(),this._type){case Ie.Slight:this._stepSize=12;break;case Ie.Wide:this._stepSize=23}this.height=18}paintGrouped(t,e,i,s){let r=t+this.x;const o=Math.max(1,(i-r)/this._stepSize);s.beginPath(),s.moveTo(r,e+this.y);for(let l=0;l<o;l++)s.lineTo(r+this._stepSize/2,e+this.y+this.height),s.lineTo(r+this._stepSize,e+this.y),r+=this._stepSize;s.stroke()}}class rM extends Mt{get notationElement(){return Te.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.GroupedOnBeatToEnd}shouldCreateGlyph(t,e){return e.vibrato===Ie.Slight}createNewGlyph(t,e){return new sM(Ie.Slight)}canExpand(t,e){return!0}}class Qa extends Ic{constructor(t,e,i,s=1.2,r=!1){super(xe.EndBeat),this._scale=0,this._symbol=d.None,this._symbolSize=0,this._type=i,this._scale=s,this.x=t,this.y=e,this._partialWaves=r}doLayout(){switch(super.doLayout(),this._type){case Ie.Slight:this._symbol=d.WiggleTrill;break;case Ie.Wide:this._symbol=d.WiggleVibratoMediumFast}this._symbolSize=Xe.Widths.get(this._symbol)*this._scale,this.height=Xe.Heights.get(this._symbol)*this._scale}paintGrouped(t,e,i,s){const o=this._symbolSize;let l=(i-(t+this.x))/o;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let c=0;for(let u=0;u<l;u++)s.fillMusicFontSymbol(t+this.x+c,e+this.y+2*this.height,this._scale,this._symbol,!1),c+=o}}class aM extends Jo{get notationElement(){return Te.EffectSlightNoteVibrato}shouldCreateGlyphForNote(t){let e=t.vibrato===Ie.Slight||t.isTieDestination&&t.tieOrigin.vibrato===Ie.Slight;return this._hideOnTiedBend&&e&&t.isTieDestination&&t.tieOrigin.hasBend&&(e=!1),e}get sizingMode(){return Pe.GroupedOnBeatToEnd}createNewGlyph(t,e){return new Qa(0,0,Ie.Slight,1.2)}constructor(t){super(),this._hideOnTiedBend=t}}class Hj extends Mt{get notationElement(){return Te.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.slap||e.pop||e.tap}createNewGlyph(t,e){return new zi(0,0,e.slap?"S":e.pop?"P":"T",t.resources.effectFont,K.Left)}canExpand(t,e){return!0}}class Wj extends Gi{constructor(t){super(0,0),this.tempoAutomations=t}doLayout(){super.doLayout(),this.height=25}paint(t,e,i){for(const s of this.tempoAutomations){let r=t+this.renderer.getRatioPositionX(s.ratioPosition);if(i.font=this.renderer.resources.markerFont,i.textBaseline=ge.Top,s.text){const o=i.measureText(s.text);i.fillText(s.text,r,e+this.y+i.font.size/2),r+=o.width+.7*i.font.size}i.fillMusicFontSymbol(r,e+this.y+.8*this.height,.5,d.NoteQuarterUp,!0),i.fillText(`= ${s.value.toString()}`,r+.5*Xe.Widths.get(d.NoteQuarterUp)+3,e+this.y+i.font.size/2)}}}class Uj extends Mt{get notationElement(){return Te.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Pe.SinglePreBeat}shouldCreateGlyph(t,e){return 0===e.voice.bar.staff.index&&0===e.voice.index&&0===e.index&&e.voice.bar.masterBar.tempoAutomations.length>0}createNewGlyph(t,e){return new Wj(e.voice.bar.masterBar.tempoAutomations)}canExpand(t,e){return!0}}class Gj extends Mt{get notationElement(){return Te.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return!!e.text}createNewGlyph(t,e){return new zi(0,0,e.text,t.resources.effectFont,K.Left)}canExpand(t,e){return!0}}class zj extends Ic{constructor(t,e){super(xe.EndBeat),this.x=t,this.y=e}doLayout(){super.doLayout(),this.height=Xe.Heights.get(d.OrnamentTrill)/2}paintGrouped(t,e,i,s){let r=t+this.x;s.fillMusicFontSymbol(r,e+this.y+this.height,1,d.OrnamentTrill,!0),r+=Xe.Widths.get(d.OrnamentTrill)/2;const o=1.2*Xe.Widths.get(d.WiggleTrill),l=Math.floor((i-r)/o),c=e+this.y+1.37*this.height;let u=r;for(let h=0;h<l;h++)s.fillMusicFontSymbol(u,c,1.2,d.WiggleTrill,!1),u+=o}}class oM extends Jo{get notationElement(){return Te.EffectTrill}shouldCreateGlyphForNote(t){return t.isTrill}get sizingMode(){return Pe.GroupedOnBeatToEnd}createNewGlyph(t,e){return new zj(0,0)}}let jj=(()=>{class n extends Gi{constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout(),this.height=25}paint(e,i,s){e+=this.x;const r=(i+=this.y)+this.height*gt.GraceScale,a=r+8;s.font=this.renderer.resources.effectFont,s.fillText("(",e,i+.3*this.height);const o=e+10,l=e+40;let c=[],u=[],h=[],f=[];switch(this._tripletFeel){case _e.NoTripletFeel:c=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem],h=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem];break;case _e.Triplet8th:c=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem],h=[d.TextBlackNoteLongStem,d.Space,d.NoteEighthUp],f=[d.TextTupletBracketStartLongStem,d.TextTuplet3LongStem,d.TextTupletBracketEndLongStem];break;case _e.Triplet16th:c=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem],h=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac16thLongStem],f=[d.TextTupletBracketStartLongStem,d.TextTuplet3LongStem,d.TextTupletBracketEndLongStem];break;case _e.Dotted8th:c=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem],u=[d.TextAugmentationDot],h=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac16thLongStem];break;case _e.Dotted16th:c=[d.TextBlackNoteLongStem,d.TextCont16thBeamLongStem,d.TextBlackNoteFrac16thLongStem],u=[d.TextAugmentationDot],h=[d.TextBlackNoteLongStem,d.TextCont16thBeamLongStem,d.TextBlackNoteFrac32ndLongStem],s.fillCircle(l+9,r,1);break;case _e.Scottish8th:c=[d.TextBlackNoteLongStem,d.TextCont8thBeamLongStem,d.TextBlackNoteFrac8thLongStem],h=[d.TextBlackNoteLongStem,d.TextCont16thBeamLongStem,d.TextBlackNoteFrac8thLongStem,d.TextAugmentationDot];break;case _e.Scottish16th:c=[d.TextBlackNoteLongStem,d.TextCont16thBeamLongStem,d.TextBlackNoteFrac16thLongStem],h=[d.TextBlackNoteLongStem,d.TextCont32ndBeamLongStem,d.TextBlackNoteFrac16thLongStem,d.TextAugmentationDot]}s.fillMusicFontSymbols(o,r,n.NoteScale,c,!1),s.fillText("=",e+32,i+5),s.fillMusicFontSymbols(l,r,n.NoteScale,h,!1),u.length>0&&s.fillMusicFontSymbols(l+7,r,n.NoteScale,u,!1),f.length>0&&s.fillMusicFontSymbols(l,a,n.TupletScale,f,!1),s.fillText(")",e+65,i+.3*this.height)}}return n.NoteScale=.5,n.TupletScale=.7,n})();class qj extends Mt{get notationElement(){return Te.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Pe.SinglePreBeat}shouldCreateGlyph(t,e){return 0===e.index&&(0===e.voice.bar.masterBar.index&&e.voice.bar.masterBar.tripletFeel!==_e.NoTripletFeel||e.voice.bar.masterBar.index>0&&e.voice.bar.masterBar.tripletFeel!==e.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(t,e){return new jj(e.voice.bar.masterBar.tripletFeel)}canExpand(t,e){return!0}}class Yj extends Mt{get notationElement(){return Te.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.GroupedOnBeat}shouldCreateGlyph(t,e){return e.hasWhammyBar}createNewGlyph(t,e){return new Qo("w/bar")}canExpand(t,e){return!0}}class lM extends Mt{get notationElement(){return Te.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.GroupedOnBeatToEnd}shouldCreateGlyph(t,e){return e.vibrato===Ie.Wide}createNewGlyph(t,e){return new sM(Ie.Wide)}canExpand(t,e){return!0}}class cM extends Jo{get notationElement(){return Te.EffectWideNoteVibrato}shouldCreateGlyphForNote(t){return t.vibrato===Ie.Wide||t.isTieDestination&&t.tieOrigin.vibrato===Ie.Wide}get sizingMode(){return Pe.GroupedOnBeatToEnd}createNewGlyph(t,e){return new Qa(0,0,Ie.Wide,1.2)}}class uM{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class Xj extends ra{constructor(){super(...arguments),this._system=null}get name(){return"HorizontalScreen"}get supportsResize(){return!1}get firstBarX(){let t=this.pagePadding[0];return this._system&&(t+=this._system.accoladeWidth),t}doResize(){}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case $o.Automatic:this.systemsLayoutMode=ys.Automatic;break;case $o.UseModelLayout:this.systemsLayoutMode=ys.FromModelWithWidths}const t=this.renderer.score;let e=this.renderer.settings.display.startBar;e--,e=Math.min(t.masterBars.length-1,Math.max(0,e));let i=e,s=this.renderer.settings.display.barCount;s<=0&&(s=t.masterBars.length),s=e+s-1,s=Math.min(t.masterBars.length-1,Math.max(0,s)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this.pagePadding[0],this._system.y=this.pagePadding[1];const r=this.renderer.settings.display.barCountPerPartial,a=[];let o=new uM,l=0;for(;i<=s;){const h=this.multiBarRestInfo,f=null!==h&&h.has(i)?h.get(i):null,p=this._system.addBars(this.renderer.tracks,i,f);if(0===o.masterBars.length&&p.isLinkedToPrevious&&a.length>0){const g=a[a.length-1];g.masterBars.push(t.masterBars[i]),g.width+=p.width,l+=p.width,o.x+=l}else o.masterBars.push(t.masterBars[i]),o.width+=p.width,o.masterBars.length>=r&&(0===a.length&&(o.width+=this._system.accoladeWidth+this.pagePadding[0]),l+=o.width,a.push(o),x.debug(this.name,`Finished partial from bar ${o.masterBars[0].index} to ${o.masterBars[o.masterBars.length-1].index}`,null),o=new uM,o.x=l);i++}o.masterBars.length>0&&(0===a.length&&(o.width+=this._system.accoladeWidth+this.pagePadding[0]),a.push(o),x.debug(this.name,`Finished partial from bar ${o.masterBars[0].index} to ${o.masterBars[o.masterBars.length-1].index}`,null)),this.finalizeStaffSystem();const c=this.renderer.settings.display.scale;this.height=Math.floor(this._system.y+this._system.height)*c,this.width=(this._system.x+this._system.width+this.pagePadding[2])*c,i=0;let u=0;for(let h=0;h<a.length;h++){const f=a[h],p=new na;p.x=u,p.y=0,p.totalWidth=this.width/c,p.totalHeight=this.height/c,p.width=f.width,p.height=this.height/c,p.firstMasterBarIndex=f.masterBars[0].index,p.lastMasterBarIndex=f.masterBars[f.masterBars.length-1].index,u+=f.width;const g=i,m=h;this._system.buildBoundingsLookup(0,0),this.registerPartial(p,y=>{let b=this._system.getBarX(f.masterBars[0].index)+this._system.accoladeWidth;0===m&&(b-=this._system.x+this._system.accoladeWidth),y.color=this.renderer.settings.display.resources.mainGlyphColor,y.textAlign=K.Left,x.debug(this.name,`Rendering partial from bar ${f.masterBars[0].index} to ${f.masterBars[f.masterBars.length-1].index}`,null),this._system.paintPartial(-b,this._system.y,y,g,f.masterBars.length)}),i+=f.masterBars.length}this.height=this.layoutAndRenderBottomScoreInfo(this.height),this.height=this.layoutAndRenderAnnotation(this.height),this.height+=this.pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class Jj extends ra{constructor(){super(...arguments),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[]}get name(){return"PageView"}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case $o.Automatic:this.systemsLayoutMode=ys.Automatic;break;case $o.UseModelLayout:this.systemsLayoutMode=ys.FromModelWithScale}let t=this.pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],t=this.layoutAndRenderScoreInfo(t,-1),t=this.layoutAndRenderTunings(t,-1),t=this.layoutAndRenderChordDiagrams(t,-1),t=this.layoutAndRenderScore(t),t=this.layoutAndRenderBottomScoreInfo(t),t=this.layoutAndRenderAnnotation(t),this.height=(t+this.pagePadding[3])*this.renderer.settings.display.scale}get supportsResize(){return!0}get firstBarX(){let t=this.pagePadding[0];return this._systems.length>0&&(t+=this._systems[0].accoladeWidth),t}doResize(){let t=this.pagePadding[1];this.width=this.renderer.width;const e=this.height;t=this.layoutAndRenderScoreInfo(t,e),t=this.layoutAndRenderTunings(t,e),t=this.layoutAndRenderChordDiagrams(t,e),t=this.resizeAndRenderScore(t,e),t=this.layoutAndRenderBottomScoreInfo(t),t=this.layoutAndRenderAnnotation(t),this.height=(t+this.pagePadding[3])*this.renderer.settings.display.scale}layoutAndRenderTunings(t,e=-1){if(!this.tuningGlyph)return t;const i=this.renderer.settings.display.resources;this.tuningGlyph.x=this.pagePadding[0],this.tuningGlyph.width=this.scaledWidth,this.tuningGlyph.doLayout();const s=Math.round(this.tuningGlyph.height),r=new na;return r.x=0,r.y=t,r.width=this.scaledWidth,r.height=s,r.totalWidth=this.scaledWidth,r.totalHeight=e<0?t+r.height:e,this.registerPartial(r,a=>{a.color=i.scoreInfoColor,a.textAlign=K.Center,this.tuningGlyph.paint(0,0,a)}),t+s}layoutAndRenderChordDiagrams(t,e=-1){if(!this.chordDiagrams)return t;const i=this.renderer.settings.display.resources;this.chordDiagrams.width=this.scaledWidth,this.chordDiagrams.doLayout();const s=Math.round(this.chordDiagrams.height),r=new na;return r.x=0,r.y=t,r.width=this.scaledWidth,r.height=s,r.totalWidth=this.scaledWidth,r.totalHeight=e<0?t+s:e,this.registerPartial(r,a=>{a.color=i.scoreInfoColor,a.textAlign=K.Center,this.chordDiagrams.paint(0,0,a)}),t+s}layoutAndRenderScoreInfo(t,e=-1){x.debug(this.name,"Layouting score info");const i=new na;i.x=0,i.y=t;let s=0;const r=this.renderer.settings.display.resources,a=[];for(const[o,l]of ra.HeaderElements.value)if(this.headerGlyphs.has(o)){const c=this.headerGlyphs.get(o);c.y=s,this.alignScoreInfoGlyph(c);let u=c.font.size;o===U.Words&&this.headerGlyphs.has(U.Music)&&this.headerGlyphs.get(U.Music).textAlign!==c.textAlign&&(u=0),s+=u,a.push(c)}return a.length>0&&(s=Math.floor(s+17),i.width=this.scaledWidth,i.height=s,i.totalWidth=this.scaledWidth,i.totalHeight=e<0?t+i.height:e,this.registerPartial(i,o=>{o.color=r.scoreInfoColor,o.textAlign=K.Center;for(const l of a)l.paint(0,0,o)})),t+s}resizeAndRenderScore(t,e){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode===ys.FromModelWithScale)for(let s=0;s<this._systems.length;s++){const r=this._systems[s];this.fitSystem(r),t+=this.paintSystem(r,e)}else{this._systems=[];let s=0;const r=this.maxWidth;let a=this.createEmptyStaffSystem();for(a.index=this._systems.length,a.x=this.pagePadding[0],a.y=t;s<this._allMasterBarRenderers.length;){let o=this._allMasterBarRenderers[s];if(a.width+o.width<=r||0===a.masterBarsRenderers.length)a.addMasterBarRenderers(this.renderer.tracks,o),s++;else{for(;o&&!o.canWrap&&a.masterBarsRenderers.length>1;)o=a.revertLastBar(),s--;a.isFull=!0,a.isLast=this.lastBarIndex===a.lastBarIndex,this._systems.push(a),this.fitSystem(a),t+=this.paintSystem(a,e),a=this.createEmptyStaffSystem(),a.index=this._systems.length,a.x=this.pagePadding[0],a.y=t}}a.isLast=this.lastBarIndex===a.lastBarIndex,this.fitSystem(a),t+=this.paintSystem(a,e)}return t}layoutAndRenderScore(t){let i=this.firstBarIndex;const s=this.lastBarIndex;for(this._systems=[];i<=s;){const r=this.createStaffSystem(i,s);this._systems.push(r),r.x=this.pagePadding[0],r.y=t,i=r.lastBarIndex+1,this.fitSystem(r),x.debug(this.name,`Rendering partial from bar ${r.firstBarIndex} to ${r.lastBarIndex}`,null),t+=this.paintSystem(r,t)}return t}paintSystem(t,e){const i=Math.floor(t.height),s=new na;return s.x=0,s.y=t.y,s.totalWidth=this.scaledWidth,s.totalHeight=e,s.width=this.scaledWidth,s.height=i,s.firstMasterBarIndex=t.firstBarIndex,s.lastMasterBarIndex=t.lastBarIndex,t.buildBoundingsLookup(0,0),this.registerPartial(s,r=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=K.Left,t.paint(0,-s.y/this.renderer.settings.display.scale,r)}),i}fitSystem(t){t.scaleToWidth(t.isFull||t.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?this.maxWidth:t.width),t.finalizeSystem()}getBarsPerSystem(t){let e=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode===ys.FromModelWithScale){let i,s;this.renderer.tracks.length>1?(i=this.renderer.score.defaultSystemsLayout,s=this.renderer.score.systemsLayout):(i=this.renderer.tracks[0].defaultSystemsLayout,s=this.renderer.tracks[0].systemsLayout),e=t<s.length?s[t]:i}return e}createStaffSystem(t,e){const i=this.createEmptyStaffSystem();i.index=this._systems.length;const s=this.getBarsPerSystem(i.index),r=this.maxWidth,a=e+1;let o=t;for(;o<a;){if(this._barsFromPreviousSystem.length>0)for(const h of this._barsFromPreviousSystem)i.addMasterBarRenderers(this.renderer.tracks,h),o=h.lastMasterBarIndex;else{const h=this.multiBarRestInfo,f=null!==h&&h.has(o)?h.get(o):null,p=i.addBars(this.renderer.tracks,o,f);this._allMasterBarRenderers.push(p),o=p.lastMasterBarIndex}this._barsFromPreviousSystem=[];let l=!1;if((-1===s&&i.width>=r&&0!==i.masterBarsRenderers.length||i.masterBarsRenderers.length===s+1)&&(l=!0),l){let h=i.revertLastBar();if(h)for(this._barsFromPreviousSystem.push(h);h&&!h.canWrap&&i.masterBarsRenderers.length>1;)h=i.revertLastBar(),h&&this._barsFromPreviousSystem.push(h);return i.isFull=!0,i.isLast=!1,this._barsFromPreviousSystem.reverse(),i}let c=!1,u=!0;for(const h of this.renderer.tracks)h.lineBreaks&&h.lineBreaks.has(o+1)?c=!0:u=!1;if(c&&u)return i.isFull=!0,i.isLast=!1,i;i.x=0,o++}return i.isLast=e===i.lastBarIndex,i}get maxWidth(){return this.scaledWidth-this.pagePadding[0]-this.pagePadding[2]}}class Pr extends sn{constructor(t,e,i,s){super(t,e,s,Pr.getMusicSymbol(i))}static getMusicSymbol(t){switch(t){case le.Natural:return d.AccidentalNatural;case le.Sharp:return d.AccidentalSharp;case le.Flat:return d.AccidentalFlat;case le.NaturalQuarterNoteUp:return d.AccidentalQuarterToneNaturalArrowUp;case le.SharpQuarterNoteUp:return d.AccidentalQuarterToneSharpArrowUp;case le.FlatQuarterNoteUp:return d.AccidentalQuarterToneFlatArrowUp;case le.DoubleSharp:return d.AccidentalDoubleSharp;case le.DoubleFlat:return d.AccidentalDoubleFlat}return d.None}}class h_ extends sn{constructor(t,e,i,s){super(t,e,1,h_.getSymbol(i)),this._clef=i,this._clefOttava=s}static getSymbol(t){switch(t){case Be.Neutral:return d.UnpitchedPercussionClef1;case Be.C3:case Be.C4:return d.CClef;case Be.F4:return d.FClef;case Be.G2:return d.GClef;default:return d.None}}paint(t,e,i){const s=Ce.bar(i,Le.StandardNotationClef,this.renderer.bar);try{super.paint(t,e,i);let r,a=!1;switch(this._clefOttava){case we._15ma:r=new sn(-4,0,.5,d.Quindicesima),a=!0;break;case we._8va:r=new sn(-2,0,.5,d.Ottava),a=!0;break;case we._8vb:r=new sn(-6,0,.5,d.Ottava);break;case we._15mb:r=new sn(-8,0,.5,d.Quindicesima);break;default:return}let o=0,l=0;switch(this._clef){case Be.Neutral:o=a?-12:15,l=0;break;case Be.C3:case Be.C4:o=a?-19:27,l=0;break;case Be.F4:o=a?-9:27,l=-4;break;case Be.G2:o=a?-37:30,l=0;break;default:return}r.renderer=this.renderer,r.doLayout(),r.paint(t+this.x+this.width/2+l,e+this.y+o,i)}finally{s?.[Symbol.dispose]?.()}}}class Qh extends Gi{constructor(t,e,i){super(t,e),this._note=i}static getSymbol(t,e){switch(t){case Ot.None:return d.None;case Ot.Normal:return e?d.ArticAccentAbove:d.ArticAccentBelow;case Ot.Heavy:return e?d.ArticMarcatoAbove:d.ArticMarcatoBelow;case Ot.Tenuto:return e?d.ArticTenutoAbove:d.ArticTenutoBelow;default:return d.None}}doLayout(){this.width=Xe.Widths.get(d.ArticAccentAbove),this.height=Xe.Heights.get(d.ArticAccentAbove)}paint(t,e,i){const s=this.renderer.getBeatDirection(this._note.beat),r=Qh.getSymbol(this._note.accentuated,s===B.Down);i.fillMusicFontSymbol(t+this.x-2,s===B.Up?e+this.y:e+this.y+this.height-2,1,r,!1)}}class Kh extends Pt{constructor(t,e,i){super(t,e),this._size=0,this._size=i}doLayout(){this.width=this._size+3}paint(t,e,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillCircle(t+this.x,e+this.y,this._size),i.color=s}}class Qj extends sn{constructor(t,e,i){super(t,e,i?gt.GraceScale:1,d.NoteheadXOrnate)}}class Xg extends sn{constructor(t,e,i,s){super(t,e,s?gt.GraceScale:1,Xg.getSymbol(i))}static getSymbol(t){switch(t){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:case w.Half:return d.NoteheadDiamondWhiteWide;default:return d.NoteheadDiamondBlackWide}}}let bs=(()=>{class n extends Pt{constructor(e,i,s){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=B.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=e,this.endBeat=i,this.forEnd=s}doLayout(){if(this.width=0,!this.endBeat)return void(this._shouldDraw=!1);const e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar);this.startNoteRenderer=e;const i=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.endBeat.voice.bar);if(this.endNoteRenderer=i,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,i),!this.forEnd&&e?(e!==i?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,i&&e.staff===i.staff?(this._endX=i.x+this.getEndX(),this._endY=i.y+this.getEndY()+this.yOffset):(this._endX=e.x+e.width,this._endY=this._startY)):(this._startX=e.x+this.getStartX(),this._endX=i.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=i.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==i.staff)&&(this._startX=i.x,this._endX=i.x+this.getEndX(),this._startY=i.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw)if(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur())this._tieHeight=0;else{this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY);const s=n.calculateActualTieHeight(1,this._startX,this._startY,this._endX,this._endY,this.tieDirection===B.Down,this._tieHeight,4);if(this.height=s.h,this.tieDirection===B.Up){const r=this.y-s.y;r>0&&(this.y-=r)}}}paint(e,i,s){this._shouldDraw&&(this.shouldDrawBendSlur()?n.drawBendSlur(s,e+this._startX,i+this._startY,e+this._endX,i+this._endY,this.tieDirection===B.Down,1):n.paintTie(s,1,e+this._startX,i+this._startY,e+this._endX,i+this._endY,this.tieDirection===B.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(e,i,s,r){return 22}getBeamDirection(e,i){return B.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,i,s,r,a,o,l,c){const u=n.computeBezierControlPoints(e,i,s,r,a,o,l,c),h=u[2],f=u[3],g=n.calculateExtrema(i=u[0],s=u[1],h,f,r=u[6],a=u[7],(i-h)/(i-2*h+r)),m=g.length>0?Math.min(i,r,g[0]):Math.min(i,r),y=g.length>0?Math.max(i,r,g[0]):Math.max(i,r),_=n.calculateExtrema(i,s,h,f,r,a,(s-f)/(s-2*f+a)),v=_.length>0?Math.min(s,a,_[1]):Math.min(s,a),k=_.length>0?Math.max(s,a,_[1]):Math.max(s,a),F=new kn;return F.x=m,F.y=v,F.w=y-m,F.h=k-v,F}static calculateExtrema(e,i,s,r,a,o,l){if(l<=0||1<=l)return[];const c=e+(s-e)*l,u=i+(r-i)*l;return[c+(s+(a-s)*l-c)*l,u+(r+(o-r)*l-u)*l]}static computeBezierControlPoints(e,i,s,r,a,o,l,c){if(i===r&&s===a)return[];if(r<i){let v=i;i=r,r=v,v=s,s=a,a=v}l*=e,c*=e;let u=a-s,h=r-i;const f=Math.sqrt(u*u+h*h);o?u*=-1:h*=-1,u/=f,h/=f;const p=(r+i)/2,g=(a+s)/2;return[i,s,p+l*u,g+l*h,p+(l-c)*u,g+(l-c)*h,r,a]}static paintTie(e,i,s,r,a,o,l=!1,c=22,u=4){const h=n.computeBezierControlPoints(i,s,r,a,o,l,c,u);e.beginPath(),e.moveTo(h[0],h[1]),e.quadraticCurveTo(h[2],h[3],h[6],h[7]),e.quadraticCurveTo(h[4],h[5],h[0],h[1]),e.closePath(),e.fill()}static drawBendSlur(e,i,s,r,a,o,l,c){let u=a-s,h=r-i;const f=Math.sqrt(u*u+h*h);o?u*=-1:h*=-1,u/=f,h/=f;let m=n.BendSlurHeight*l;r-i<20&&(m/=2);const y=(r+i)/2+m*u,b=(a+s)/2+m*h;if(e.beginPath(),e.moveTo(i,s),e.lineTo(y,b),e.lineTo(r,a),e.stroke(),c){const _=e.measureText(c).width;e.fillText(c,y-_/2,b+(o?0:-e.font.size))}}}return n.BendSlurHeight=11,n})(),d_=(()=>{class n extends Pt{constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=n.Size}paint(e,i,s){const r=s.color;this.colorOverride&&(s.color=this.colorOverride),this._isOpen?bs.paintTie(s,1,e+this.x+this.width,i+this.y+this.height,e+this.x+this.width,i+this.y,!1,6,3):bs.paintTie(s,1,e+this.x,i+this.y,e+this.x,i+this.y+this.height,!1,6,3),s.color=r}}return n.Size=6,n})();class hM{constructor(t,e,i){this.line=0,this.line=t,this.isGhost=e,this.color=i}}class Jg extends Pt{constructor(t){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=t}addParenthesis(t){const e=this.renderer,i=e.getNoteLine(t),s=t.isGhost||this.isTiedBend(t)&&e.settings.notation.isNotationElementVisible(Te.ParenthesisOnTiedBends),r=Ce.noteColor(e.resources,si.Effects,t);this.add(new hM(i,s,r))}addParenthesisOnLine(t,e){const i=new hM(t,e,void 0);this.add(i)}add(t){this._infos.push(t),t.isGhost&&(this.isEmpty=!1)}isTiedBend(t){return!!t.isTieDestination&&(!!t.tieOrigin.hasBend||this.isTiedBend(t.tieOrigin))}doLayout(){const t=this.renderer;this._infos.sort((s,r)=>s.line-r.line);let e=null;const i=t.getScoreHeight(1);for(let s=0,r=this._infos.length;s<r;s++){let a;if(this._infos[s].isGhost)if(e){const o=t.getScoreY(this._infos[s].line)+i;e.height=o-e.y}else a=new d_(this._isOpen),a.colorOverride=this._infos[s].color,a.renderer=this.renderer,a.y=t.getScoreY(this._infos[s].line)-i,a.height=2*i,a.doLayout(),this._glyphs.push(a),e=a;else e=null}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(t,e,i){super.paint(t,e,i);for(const s of this._glyphs)s.paint(t+this.x,e+this.y,i)}}class Kj{constructor(t,e){this.steps=0,this.glyph=t,this.steps=e}}class dM extends Pt{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new Cn,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(t,e){const i=new Kj(t,e);this._infos.push(i),(!this.minNote||this.minNote.steps>i.steps)&&(this.minNote=i),(!this.maxNote||this.maxNote.steps<i.steps)&&(this.maxNote=i)}doLayout(){this._infos.sort((o,l)=>l.steps-o.steps);let t=0,e=!1,i=0,s=!1;const r=this.direction;let a=0;for(let o=0,l=this._infos.length;o<l;o++){const c=this._infos[o].glyph;c.renderer=this.renderer,c.doLayout();let u=!1;0===o?t=c.width:Math.abs(i-this._infos[o].steps)<=1?e?e=!1:(u=!0,c.x=t,s=!0,e=!0):e=!1,c.x=r===B.Down?u?0:t:u?t:0,c.x+=this.noteStartX,i=this._infos[o].steps,a=Math.max(a,c.x+c.width),c instanceof gt&&c.centerOnStem&&(c.x=t)}s?(this._noteHeadPadding=0,this.upLineX=t,this.downLineX=t):(this._noteHeadPadding=r===B.Down?-t:0,a+=this._noteHeadPadding,this.upLineX=a,this.downLineX=0),this.displacedX=t,this.width=a}paint(t,e,i){this.paintLedgerLines(t+=this.x,e+=this.y,i);const s=this._infos,r=t+this._noteHeadPadding;for(const a of s)a.glyph.renderer=this.renderer,a.glyph.paint(r,e,i)}paintLedgerLines(t,e,i){if(!this.minNote)return;const s=this.renderer,r=Ce.bar(i,Le.StandardNotationStaffLine,s.bar,!0);try{const o=this.width-this.noteStartX+6,l=s.getLineHeight(1),c=s.getLineY(-1),u=s.getLineY(s.drawnLineCount),h=s.getLineY(this.minNote.steps/2),f=s.getLineY(this.maxNote.steps/2);let p=c;for(;p>=h;)i.fillRect(t-3+this.noteStartX,e+p|0,o,Ct.StaffLineThickness),p-=l;for(p=u;p<=f;)i.fillRect(t-3+this.noteStartX,e+p|0,o,Ct.StaffLineThickness),p+=l}finally{r?.[Symbol.dispose]?.()}}}class Qg extends sn{constructor(t,e,i){super(t,e,1,Qg.getSymbol(i))}static getSymbol(t){switch(t){case w.ThirtySecond:return d.Tremolo3;case w.Sixteenth:return d.Tremolo2;case w.Eighth:return d.Tremolo1;default:return d.None}}}class Kg extends Pt{constructor(){super(0,0)}doLayout(){this.width=26}paint(t,e,i){const s=this.renderer,r=s.getLineHeight(s.heightLineCount-1),l=s.getLineY(0)+s.getLineHeight(s.drawnLineCount-1)/2-r/2,c=i.lineWidth;i.lineWidth=2,i.moveTo(t+this.x,e+l),i.lineTo(t+this.x+this.width,e+l+r),i.moveTo(t+this.x,e+l+r),i.lineTo(t+this.x+this.width,e+l),i.stroke(),i.lineWidth=c}}class Zj extends dM{constructor(){super(...arguments),this._noteGlyphLookup=new Map,this._notes=[],this._deadSlapped=null,this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(t,e){if(this._noteGlyphLookup.has(t.id)){const i=this._noteGlyphLookup.get(t.id);let s=this.x+i.x+this._noteHeadPadding;switch(e){case wt.Left:break;case wt.Center:s+=i.width/2;break;case wt.Right:s+=i.width}return s}return 0}getNoteY(t,e){if(this._noteGlyphLookup.has(t.id)){const i=this._noteGlyphLookup.get(t.id);let s=this.y+i.y;switch(e){case Z.TopWithStem:s-=this.renderer.getStemSize(this.beamingHelper);break;case Z.Top:s-=i.height/2;break;case Z.Center:break;case Z.Bottom:s+=i.height/2;break;case Z.BottomWithStem:s+=this.renderer.getStemSize(this.beamingHelper)}return s}return 0}addNoteGlyph(t,e,i){super.add(t,i),this._noteGlyphLookup.set(e.id,t),this._notes.push(e)}updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,t+this.x+this.upLineX,t+this.x+this.downLineX)}doLayout(){super.doLayout();const t=this.renderer;this.beat.deadSlapped&&(this._deadSlapped=new Kg,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),this.width=this._deadSlapped.width);const e=this.direction;let i=0,s=0,r=1,a=-r,o=!1,l=!1;this.beat.deadSlapped?(s=t.getScoreY(0),i=t.getScoreY(t.heightLineCount)):this.direction===B.Up?(o=!1,l=!0,s=t.getScoreY(this.maxNote.steps+2),i=t.getScoreY(this.minNote.steps)-t.getStemSize(this.beamingHelper,!0)):(o=!0,l=!1,s=t.getScoreY(this.minNote.steps-1),r*=-1,a*=-1,i=t.getScoreY(this.maxNote.steps)+t.getStemSize(this.beamingHelper,!0));let c=null,u=null;for(const h of this.aboveBeatEffects.values())h.renderer=this.renderer,h.doLayout(),l&&(i+=a*h.height),h.y=i,(null===c||c>i)&&(c=i),(null===u||u<i)&&(u=i),l||(i+=a*h.height);for(const h of this.belowBeatEffects.values())h.renderer=this.renderer,h.doLayout(),o&&(s+=r*h.height),h.y=s,(null===c||c>s)&&(c=s),(null===u||u<s)&&(u=s),o||(s+=r*h.height);if(null!==c&&t.registerBeatEffectOverflows(c,u??0),this.beat.isTremolo&&!this.beat.deadSlapped){let h=0;const f=e===B.Up?this.minNote:this.maxNote;let p=e===B.Up?this.upLineX:this.downLineX;const g=this.beat.tremoloSpeed;switch(g){case w.ThirtySecond:h=e===B.Up?-15:15;break;case w.Sixteenth:h=e===B.Up?-12:15;break;case w.Eighth:h=e===B.Up?-10:10;break;default:h=e===B.Up?-10:15}this.beat.duration<w.Half&&(p=this.width/2),this._tremoloPicking=new Qg(p,f.glyph.y+h,g),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(t,e,i){for(const s of this._notes)if(this._noteGlyphLookup.has(s.id)){const r=this._noteGlyphLookup.get(s.id),a=new Bc;a.note=s,a.noteHeadBounds=new kn,a.noteHeadBounds.x=e+this.x+this._noteHeadPadding+r.x,a.noteHeadBounds.y=i+this.y+r.y-r.height/2,a.noteHeadBounds.w=r.width,a.noteHeadBounds.h=r.height,t.addNote(a)}}paint(t,e,i){this.paintEffects(t,e,i),super.paint(t,e,i)}paintEffects(t,e,i){const s=Ce.beat(i,ht.StandardNotationEffects,this.beat);try{for(const r of this.aboveBeatEffects.values())r.paint(t+this.x+2,e+this.y,i);for(const r of this.belowBeatEffects.values())r.paint(t+this.x+2,e+this.y,i);this._tremoloPicking&&this._tremoloPicking.paint(t,e,i),this._deadSlapped&&this._deadSlapped.paint(t,e,i)}finally{s?.[Symbol.dispose]?.()}}}class Zh extends sn{constructor(t,e,i){super(t,e,1,Zh.getSymbol(i))}static getSymbol(t){switch(t){case w.QuadrupleWhole:return d.RestLonga;case w.DoubleWhole:return d.RestDoubleWhole;case w.Whole:return d.RestWhole;case w.Half:return d.RestHalf;case w.Quarter:return d.RestQuarter;case w.Eighth:return d.RestEighth;case w.Sixteenth:return d.RestSixteenth;case w.ThirtySecond:return d.RestThirtySecond;case w.SixtyFourth:return d.RestSixtyFourth;case w.OneHundredTwentyEighth:return d.RestOneHundredTwentyEighth;case w.TwoHundredFiftySixth:return d.RestTwoHundredFiftySixth;default:return d.None}}updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,t+this.x+this.width/2,t+this.x+this.width/2)}paint(t,e,i){this.internalPaint(t,e,i,ht.StandardNotationRests)}internalPaint(t,e,i,s){const r=Ce.beat(i,s,this.beat);try{super.paint(t,e,i)}finally{r?.[Symbol.dispose]?.()}}}class fM{constructor(){this.x=0,this.y=-3e3,this.width=0}}class f_ extends er{constructor(){super(0,0)}doLayout(){if(!this.glyphs||0===this.glyphs.length)return void(this.width=0);this.glyphs.sort((i,s)=>i.y<s.y?-1:i.y>s.y?1:0);const t=[];t.push(new fM);for(let i=0,s=this.glyphs.length;i<s;i++){const r=this.glyphs[i];r.renderer=this.renderer,r.doLayout();let a=0;for(;t[a].y>r.y;)a++,a===t.length&&t.push(new fM);r.x=a,t[a].y=r.y+21,t[a].width<r.width&&(t[a].width=r.width)}this.width=0;for(const i of t)this.width+=i.width,i.x=this.width;for(let i=0,s=this.glyphs.length;i<s;i++){const r=this.glyphs[i];r.x=this.width-t[r.x].x}}}let Ka=(()=>{class n extends dM{get direction(){return B.Up}constructor(e,i=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new f_,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=e,this._showParenthesis=i,i&&(this._preNoteParenthesis=new Jg(!0),this._postNoteParenthesis=new Jg(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,i,s){const r=this.renderer,a=new gt(0,0,w.Quarter,!0),o=r.accidentalHelper.applyAccidentalForValue(this._beat,e,i,!0),l=r.accidentalHelper.getNoteLineForValue(e,!1);if(a.y=r.getScoreY(l),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(l,!0),this._postNoteParenthesis.addParenthesisOnLine(l,!0)),o!==le.None){const c=new Pr(0,a.y,o,gt.GraceScale);c.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(c)}this._noteValueLookup.set(e,a),this.add(a,l),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+n.ElementPadding),this._accidentals.isEmpty||(e+=this._accidentals.width+n.ElementPadding,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+n.ElementPadding),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+n.ElementPadding,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+n.ElementPadding)}paint(e,i,s){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,i+this.y,s),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,i+this.y,s),this._postNoteParenthesis.paint(e+this.x,i+this.y,s)),super.paint(e,i,s)}}return n.ElementPadding=2,n})(),pM=(()=>{class n extends Pt{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(e,i,s,r,a,o,l,c){bs.drawBendSlur(e,i,s,r,a,o,l,c)}doLayout(){super.doLayout(),this.width=0;for(const e of this.BendNoteHeads)e.doLayout(),this.width+=e.width+10}getTieDirection(e,i){return i.getBeatDirection(e)===B.Up?B.Down:B.Up}}return n.EndPadding=8,n})();class Za extends V{constructor(t=0,e=0){super(t,e),this.lineValue=0,this.lineValue=e}}let gM=(()=>{class n extends Pt{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(e){this._notes.push(e);const i=this.createRenderingPoints(e);this._renderPoints.set(e.id,i),(-1===this._maxBendValue||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let s=0;switch(e.bendType){case J.Bend:s=i[1].value,e.isTieOrigin?(-1===this._bendEndContinuedMinValue||s<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=s):(-1===this._bendEndMinValue||s<this._bendEndMinValue)&&(this._bendEndMinValue=s);break;case J.Release:s=i[1].value,e.isTieOrigin?(-1===this._releaseContinuedMinValue||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(-1===this._releaseMinValue||s<this._releaseMinValue)&&(this._releaseMinValue=s);break;case J.BendRelease:s=i[1].value,(-1===this._bendMiddleMinValue||s<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=s),s=i[2].value,e.isTieOrigin?(-1===this._releaseContinuedMinValue||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(-1===this._releaseMinValue||s<this._releaseMinValue)&&(this._releaseMinValue=s);break;case J.Prebend:s=i[0].value,(-1===this._preBendMinValue||s<this._preBendMinValue)&&(this._preBendMinValue=s);break;case J.PrebendBend:s=i[0].value,(-1===this._preBendMinValue||s<this._preBendMinValue)&&(this._preBendMinValue=s),s=i[1].value,e.isTieOrigin?(-1===this._bendEndContinuedMinValue||s<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=s):(-1===this._bendEndMinValue||s<this._bendEndMinValue)&&(this._bendEndMinValue=s);break;case J.PrebendRelease:s=i[0].value,(-1===this._preBendMinValue||s<this._preBendMinValue)&&(this._preBendMinValue=s),s=i[1].value,e.isTieOrigin?(-1===this._releaseContinuedMinValue||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(-1===this._releaseMinValue||s<this._releaseMinValue)&&(this._releaseMinValue=s)}}doLayout(){super.doLayout(),this.renderer.registerOverflowTop(this._maxBendValue*n.BendValueHeight);let i=0;for(const s of this._notes){const r=this._renderPoints.get(s.id);switch(s.bendType){case J.Bend:r[1].lineValue=s.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case J.Release:i=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,i>=0&&(r[1].lineValue=i);break;case J.BendRelease:r[1].lineValue=this._bendMiddleMinValue,i=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,i>=0&&(r[2].lineValue=i);break;case J.Prebend:r[0].lineValue=this._preBendMinValue;break;case J.PrebendBend:r[0].lineValue=this._preBendMinValue,r[1].lineValue=s.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case J.PrebendRelease:r[0].lineValue=this._preBendMinValue,i=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,i>=0&&(r[1].lineValue=i)}}this.width=0,this._notes.sort((s,r)=>s.isStringed?s.string-r.string:s.realValue-r.realValue)}createRenderingPoints(e){const i=[];switch(e.bendType){case J.Custom:for(const s of e.bendPoints)i.push(new Za(s.offset,s.value));break;case J.BendRelease:i.push(new Za(0,e.bendPoints[0].value)),i.push(new Za(V.MaxPosition/2|0,e.bendPoints[1].value)),i.push(new Za(V.MaxPosition,e.bendPoints[3].value));break;case J.Bend:case J.Hold:case J.Prebend:case J.PrebendBend:case J.PrebendRelease:case J.Release:i.push(new Za(0,e.bendPoints[0].value)),i.push(new Za(V.MaxPosition,e.bendPoints[1].value))}return i}paint(e,i,s){const r=s.color;this._notes.length>1&&(s.color=this.renderer.resources.secondaryGlyphColor);for(const a of this._notes){const o=this._renderPoints.get(a.id),l=this.renderer;let c=a,u=!1,h=null,f=!1;const p=a.bendStyle===ct.Gradual?"grad.":"";let g=null;for(;c.isTieOrigin;){const k=c.tieDestination;if(h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,k.beat.voice.bar),!h||l.staff!==h.staff)break;if(c=k,u=!0,c.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes||c.vibrato!==Ie.None){f=!0;break}}g=c.beat,h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,g.voice.bar),g.isLastOfVoice&&!c.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(g=null);let m=0,y=0;const b=i+l.y;m=e+l.x,m+=o[0].value>0||a.isContinuedBend?l.getBeatX(a.beat,xe.MiddleNotes):l.getNoteX(a,wt.Right),y=!g||g.isLastOfVoice&&!f?e+h.x+h.postBeatGlyphsStart:f||!g.nextBeat?e+h.x+h.getBeatX(g,xe.MiddleNotes):a.bendType===J.Hold?e+h.x+h.getBeatX(g.nextBeat,xe.OnNotes):e+h.x+h.getBeatX(g.nextBeat,xe.PreNotes),u||(y-=n.ArrowSize);const v=(y-m)/V.MaxPosition;s.beginPath();for(let k=0,F=o.length-1;k<F;k++){const D=o[k];let C=o[k+1];0===k&&0!==D.value&&!a.isTieDestination&&this.paintBend(a,new Za(0,0),D,m,b,v,p,s),a.bendType!==J.Prebend?(0===k&&(m+=2),this.paintBend(a,D,C,m,b,v,p,s)):a.isTieOrigin&&a.tieDestination.hasBend&&(C=new Za(V.MaxPosition,D.value),C.lineValue=D.lineValue,this.paintBend(a,D,C,m,b,v,p,s))}if(c.vibrato!==Ie.None){const D=new Qa(y-e+n.ArrowSize-h.x,b-i-n.BendValueHeight*o[o.length-1].lineValue,c.vibrato,1.2);D.beat=c.beat,D.renderer=h,D.doLayout(),D.paint(e+h.x,i,s)}s.color=r}}paintBend(e,i,s,r,a,o,l,c){const u=this.renderer,h=this.renderer.resources,f=u.lineOffset/2,p=r+o*i.offset,g=n.BendValueHeight;let m=a-g*i.lineValue;m+=0===i.value?s.offset===i.offset?u.getNoteY(e.beat.maxStringNote,Z.Top):u.getNoteY(e,Z.Center):f;const y=r+o*s.offset;let b=a-g*s.lineValue;b+=0===s.lineValue?u.getNoteY(e,Z.Center):f;let _=0;const v=n.ArrowSize;if(s.value>i.value?(b+v>m&&(b=m-v),c.beginPath(),c.moveTo(y,b),c.lineTo(y-.5*v,b+v),c.lineTo(y+.5*v,b+v),c.closePath(),c.fill(),_=v):s.value!==i.value&&(b<m&&(b=m+v),c.beginPath(),c.moveTo(y,b),c.lineTo(y-.5*v,b-v),c.lineTo(y+.5*v,b-v),c.closePath(),c.fill(),_=-v),c.beginPath(),i.value===s.value){if(i.lineValue>0){let k=y;const F=n.DashSize,D=p+F;if((k-p)/(2*F)<1)c.moveTo(k,m),c.lineTo(p,m);else for(;k>D;)c.moveTo(k,m),c.lineTo(k-F,m),k-=2*F;c.stroke()}}else y>p?(c.moveTo(p,m),c.bezierCurveTo((p+y)/2,m,y,m,y,b+_),c.stroke()):(c.moveTo(p,m),c.lineTo(y,b),c.stroke());if(l&&i.offset<s.offset){c.font=h.graceFont;const k=c.measureText(l).width;let F=0,D=0;if(m>b){const C=Math.abs(m-b);F=C>1.3*c.font.size?m-C/2:m,D=(p+y-k)/2}else F=m,D=y-k;c.fillText(l,D,F)}if(0!==s.value&&i.value!==s.value){let k=s.value;const F=s.value>i.value;k=Math.abs(k);let D="";if(4===k)D="full",k-=4;else if(k>=4||k<=-4){const C=k/4|0;D+=C,k-=4*C}if(k>0&&(D+=n.getFractionSign(k)),""!==D){b=a-g*s.value;let C=b;F||(C=m+1*Math.abs(b-m)/3),c.font=h.tablatureFont;const oe=c.measureText(D).width;c.fillText(D,y-oe/2,C-.5*h.tablatureFont.size-2)}}}static getFractionSign(e){switch(e){case 1:return"\xbc";case 2:return"\xbd";case 3:return"\xbe";default:return`${e}/ 4`}}}return n.ArrowSize=6,n.DashSize=3,n.BendValueHeight=6,n})(),mM=(()=>{class n extends Pt{constructor(e){super(0,0),this._isSimpleDip=!1,this._beat=e,this._renderPoints=this.createRenderingPoints(e)}createRenderingPoints(e){if(e.whammyBarType===Re.Custom)return e.whammyBarPoints;const i=[];switch(e.whammyBarType){case Re.Dive:case Re.Hold:case Re.PrediveDive:case Re.Predive:i.push(new V(0,e.whammyBarPoints[0].value)),i.push(new V(V.MaxPosition,e.whammyBarPoints[1].value));break;case Re.Dip:i.push(new V(0,e.whammyBarPoints[0].value)),i.push(new V(V.MaxPosition/2|0,e.whammyBarPoints[1].value)),i.push(new V(V.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value))}return i}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===_n.SongBook&&this._beat.whammyBarType===Re.Dip;let e=null,i=null,s=this._beat;for(;s&&s.hasWhammyBar;)(!e||e.value>s.minWhammyPoint.value)&&(e=s.minWhammyPoint),(!i||i.value<s.maxWhammyPoint.value)&&(i=s.maxWhammyPoint),s=s.nextBeat;let r=i.value>0?Math.abs(this.getOffset(i.value)):0;(r>0||0!==this._beat.whammyBarPoints[0].value||this.renderer.settings.notation.isNotationElementVisible(Te.ZerosOnDiveWhammys))&&(r+=2*this.renderer.resources.tablatureFont.size);const a=e.value<0?Math.abs(this.getOffset(e.value)):0;this.renderer.registerOverflowTop(r+a),r>this.renderer.staff.getSharedLayoutData(n.TopOffsetSharedDataKey,-1)&&this.renderer.staff.setSharedLayoutData(n.TopOffsetSharedDataKey,r)}getOffset(e){if(0===e)return 0;let i=n.PerHalfSize+Math.log2(Math.abs(e)/2)*n.PerHalfSize;return e<0&&(i=-i),i}paint(e,i,s){const r=Ce.beat(s,ht.StandardNotationEffects,this._beat);try{const a=this.renderer;let o=this._beat.nextBeat,l=null,c=xe.PreNotes;o&&(l=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,o.voice.bar),!l||l.staff!==a.staff||l!==a&&!o.hasWhammyBar?(o=null,l=null):c=!o.hasWhammyBar||a.settings.notation.notationMode===_n.SongBook&&o.whammyBarType===Re.Dip?xe.PreNotes:xe.MiddleNotes);let u=0,h=0;this._isSimpleDip?(u=e+a.x+a.getBeatX(this._beat,xe.OnNotes)-2,h=e+a.x+a.getBeatX(this._beat,xe.PostNotes)+2):(u=e+a.x+a.getBeatX(this._beat,xe.MiddleNotes),h=l?e+l.x+l.getBeatX(o,c):e+a.x+a.width-2);const f=s.textAlign;if(s.textAlign=K.Center,this._renderPoints.length>=2){const p=(h-u)/V.MaxPosition;s.beginPath();const g=i+this.renderer.staff.getSharedLayoutData(n.TopOffsetSharedDataKey,0);let m=this._beat.whammyStyle===ct.Gradual?"grad.":"";for(let y=0,b=this._renderPoints.length-1;y<b;y++){const _=this._renderPoints[y],v=this._renderPoints[y+1],k=y<b-2?this._renderPoints[y+2]:null;let F=0===y;0===y&&0!==_.value&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new V(0,0),_,v,u,g,p,s),F=!1),this.paintWhammy(F,_,v,k,u,g,p,s,m),m=""}s.stroke()}s.textAlign=f}finally{r?.[Symbol.dispose]?.()}}paintWhammy(e,i,s,r,a,o,l,c,u){const h=a+l*i.offset,f=a+l*s.offset,p=o-this.getOffset(i.value),g=o-this.getOffset(s.value);if(i.offset===s.offset){const b=n.DashSize;if(Math.abs(g-p)/(2*b)<1)c.moveTo(h,p),c.lineTo(f,g);else{const v=Math.max(p,g);let k=Math.min(p,g);for(;v>k;)c.moveTo(h,k),c.lineTo(h,k+b),k+=2*b}c.stroke()}else if(i.value===s.value){const b=n.DashSize;if(Math.abs(f-h)/(2*b)<1)c.moveTo(h,p),c.lineTo(f,g);else{let v=Math.max(h,f);const k=Math.min(h,f);for(;v>k;)c.moveTo(v,p),c.lineTo(v-b,p),v-=2*b}c.stroke()}else c.moveTo(h,p),c.lineTo(f,g);const m=this.renderer.resources;if(e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let b=p;b-=m.tablatureFont.size+2,this.renderer.settings.notation.isNotationElementVisible(Te.ZerosOnDiveWhammys)&&c.fillText("0",h,b),u&&(b-=m.tablatureFont.size+2,c.fillText(u,h,b))}let y=Math.abs(s.value);if((0!==y||this.renderer.settings.notation.isNotationElementVisible(Te.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&i.value!==s.value){let b="";if(s.value<0&&(b+="-"),y>=4){const k=y/4|0;b+=k,y-=4*k}else 0===y&&(b+="0");y>0&&(b+=gM.getFractionSign(y));let _=0;this._isSimpleDip?_=Math.min(p,g)-m.tablatureFont.size-2:(_=i.offset===s.offset?Math.min(p,g):g,_-=m.tablatureFont.size+2,r&&r.value>s.value&&(_-=2)),c.fillText(b,f,_)}}}return n.TopOffsetSharedDataKey="tab.whammy.topoffset",n.PerHalfSize=6,n.DashSize=3,n})();class Ko extends pM{constructor(t){super(0,0),this._beat=t}doLayout(){const t=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case Re.None:case Re.Custom:case Re.Hold:return;case Re.Dive:case Re.PrediveDive:{const e=new Ka(this._beat,!1);e.renderer=this.renderer;const i=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const s of this._beat.notes)s.isTieOrigin||e.addGlyph(this.getBendNoteValue(s,i),i.value%2!=0,void 0);e.doLayout(),this.BendNoteHeads.push(e)}break;case Re.Dip:if(t===_n.SongBook)this.renderer.simpleWhammyOverflow=1.5*this.renderer.resources.tablatureFont.size+Ko.SimpleDipHeight+Ko.SimpleDipPadding;else{const e=new Ka(this._beat,!1);if(e.renderer=this.renderer,this.renderer.settings.notation.notationMode===_n.GuitarPro){const s=this._beat.whammyBarPoints[1];for(const r of this._beat.notes)e.addGlyph(this.getBendNoteValue(r,this._beat.whammyBarPoints[1]),s.value%2!=0,void 0)}e.doLayout(),this.BendNoteHeads.push(e);const i=new Ka(this._beat,!1);if(i.renderer=this.renderer,this.renderer.settings.notation.notationMode===_n.GuitarPro){const s=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const r of this._beat.notes)i.addGlyph(this.getBendNoteValue(r,s),s.value%2!=0,void 0)}i.doLayout(),this.BendNoteHeads.push(i)}}super.doLayout()}paint(t,e,i){const s=this._beat;switch(s.whammyBarType){case Re.None:case Re.Custom:return}const r=this.renderer.settings.notation.notationMode,a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,s.voice.bar),o=Ce.beat(i,ht.StandardNotationEffects,s);try{const l=t+a.x+a.getBeatX(s,xe.MiddleNotes),c=this.getTieDirection(s,a);let u=1===this._beat.notes.length?c:B.Up;const h=i.textAlign,f=Xe.Heights.get(d.NoteheadBlack);for(let p=0;p<s.notes.length;p++){const g=s.notes[p],m=Ce.note(i,si.StandardNotationEffects,g);try{let y=e+a.y;p>0&&p>=(this._beat.notes.length/2|0)&&(u=B.Down),y+=a.getNoteY(g,u===B.Down?Z.Bottom:Z.Top);let b=t+a.x;b+=s.isLastOfVoice?a.width:a.getBeatX(s,xe.EndBeat),b-=8;const _=s.whammyStyle===ct.Gradual&&0===p?"grad.":"";let v=null;g.isTieOrigin&&(v=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,g.tieDestination.beat.voice.bar),v&&v.staff===a.staff?b=t+v.x+v.getBeatX(g.tieDestination.beat,xe.MiddleNotes):v=null);let k=f*gt.GraceScale*.5;u===B.Up&&(k=-k);const F=s.whammyBarPoints.length>0?this.getBendNoteValue(g,s.whammyBarPoints[s.whammyBarPoints.length-1]):0;let D=0,C=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(F)?(D=this.BendNoteHeads[0].getNoteValueY(F)+k,C=!0):v&&(g.isTieOrigin&&g.tieDestination.beat.hasWhammyBar||g.beat.isContinuedWhammy)?(D=e+v.y+v.getNoteY(g.tieDestination,Z.Top),C=!0,u===B.Down&&(D+=f)):g.isTieOrigin&&(D=v?e+v.y+v.getNoteY(g.tieDestination,Z.Top):y,u===B.Down&&(D+=f)),s.whammyBarType){case Re.Hold:g.isTieOrigin&&bs.paintTie(i,1,l,y,b,D,c===B.Down,22,4);break;case Re.Dive:if(0===p){this.BendNoteHeads[0].x=b-this.BendNoteHeads[0].noteHeadOffset;const Fe=this.BendNoteHeads[0].y;this.BendNoteHeads[0].y=e+a.y,this.BendNoteHeads[0].paint(0,0,i),this.BendNoteHeads[0].containsNoteValue(F)&&(D-=Fe,D+=this.BendNoteHeads[0].y)}C?this.drawBendSlur(i,l,y,b,D,u===B.Down,1,_):g.isTieOrigin&&bs.paintTie(i,1,l,y,b,D,c===B.Down,22,4);break;case Re.Dip:if(r===_n.SongBook){if(0===p){const Fe=t+a.x+a.getBeatX(this._beat,xe.OnNotes)-2,ne=t+a.x+a.getBeatX(this._beat,xe.PostNotes)+2,ot=(Fe+ne)/2,Nn=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();i.font=this.renderer.resources.tablatureFont,i.fillText(Nn,ot,e+this.y);const ci=e+this.y+i.font.size+2,ji=ci+Ko.SimpleDipHeight;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(i.moveTo(Fe,ji),i.lineTo(ot,ci),i.lineTo(ne,ji)):(i.moveTo(Fe,ci),i.lineTo(ot,ji),i.lineTo(ne,ci)),i.stroke()}g.isTieOrigin&&bs.paintTie(i,1,l,y,b,D,c===B.Down,22,4)}else{const Fe=(l+b)/2;this.BendNoteHeads[0].x=Fe-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=e+a.y,this.BendNoteHeads[0].paint(0,0,i);const ne=this.getBendNoteValue(g,s.whammyBarPoints[1]),ot=this.BendNoteHeads[0].getNoteValueY(ne)+k;this.drawBendSlur(i,l,y,Fe,ot,u===B.Down,1,_),this.BendNoteHeads[1].x=b-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=e+a.y,this.BendNoteHeads[1].paint(0,0,i),D=this.BendNoteHeads[1].getNoteValueY(F)+k,this.drawBendSlur(i,Fe,ot,b,D,u===B.Down,1,_)}break;case Re.PrediveDive:case Re.Predive:let oe=t+a.x+a.getBeatX(g.beat,xe.PreNotes);oe+=a.getPreNotesGlyphForBeat(g.beat).prebendNoteHeadOffset;const at=e+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(g.displayValue-(g.beat.whammyBarPoints[0].value/2|0),!1))+k;this.drawBendSlur(i,oe,at,l,y,u===B.Down,1,_),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=b-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=e+a.y,this.BendNoteHeads[0].paint(0,0,i),this.drawBendSlur(i,l,y,b,D,u===B.Down,1,_))}}finally{m?.[Symbol.dispose]?.()}}i.textAlign=h}finally{o?.[Symbol.dispose]?.()}}getBendNoteValue(t,e){return t.displayValueWithoutBend+(e.value/2|0)}}Ko.SimpleDipHeight=2*mM.PerHalfSize,Ko.SimpleDipPadding=2;class Hn extends Pt{constructor(t,e,i){super(t,e),this.width=i}}class eq extends sn{constructor(t,e,i,s,r){super(t,e,r?gt.GraceScale:1,i.getSymbol(s)),this._isGrace=r,this._articulation=i}paint(t,e,i){const s=i.color;this.colorOverride&&(i.color=this.colorOverride);const r=this._isGrace?1:0;i.fillMusicFontSymbol(t+this.x,e+this.y+r,this.glyphScale,this.symbol,!1),this._articulation.techniqueSymbol!==d.None&&this._articulation.techniqueSymbolPlacement===ge.Middle&&i.fillMusicFontSymbol(t+this.x,e+this.y+r,this.glyphScale,this._articulation.techniqueSymbol,!1),i.color=s}doLayout(){super.doLayout(),0===this.width&&(this.height=Xe.Widths.get(d.NoteheadBlack)),0===this.height&&(this.height=Xe.Heights.get(d.NoteheadBlack))}}class yM extends sn{constructor(t,e){super(t,e,gt.GraceScale,d.ArticStaccatoAbove)}paint(t,e,i){super.paint(t+3,e+5,i)}}class tq extends sn{constructor(t,e){super(t,e,.5,d.PictEdgeOfCymbal)}paint(t,e,i){super.paint(t-3,e+this.height,i)}}class bM extends sn{constructor(t,e,i=!1){super(t,e,gt.GraceScale,d.GuitarGolpe),this.center=i}paint(t,e,i){super.paint(t,e+this.height,i)}}class nq extends Gi{constructor(){super(...arguments),this._strings=new Set}addString(t){this._strings.add(t)}doLayout(){const t=Xe.Widths.get(d.GuitarString0)*jg.CircleNumberScale;this.height=(t+3)*this._strings.size,this.width=t}paint(t,e,i){const s=this.renderer.bar.staff.tuning.length;let r=0;const a=Xe.Widths.get(d.GuitarString0)*jg.CircleNumberScale,o=Xe.Heights.get(d.NoteheadBlack);for(const l of this._strings)i.fillMusicFontSymbol(t+this.x+o/2,e+this.y+a+r,jg.CircleNumberScale,d.GuitarString1+(s-l),!0),r+=a+3}}class ed extends Gi{constructor(t,e,i,s,r){super(t,e),this.beatEffects=new Map,this.noteHeadElement=si.SlashNoteHead,this.effectElement=ht.SlashEffects,this._isGrace=s,this._symbol=ed.getSymbol(i),this.beat=r}paint(t,e,i){const s=0===this.beat.notes.length?void 0:Ce.note(i,this.noteHeadElement,this.beat.notes[0]);try{i.fillMusicFontSymbol(t+this.x,e+this.y+(this._isGrace?1:0),this._isGrace?gt.GraceScale:1,this._symbol,!1),this.paintEffects(t,e,i)}finally{s?.[Symbol.dispose]?.()}}paintEffects(t,e,i){const s=Ce.beat(i,this.effectElement,this.beat);try{for(const r of this.beatEffects.values())r.paint(t+this.x,e+this.y,i)}finally{s?.[Symbol.dispose]?.()}}doLayout(){const t=this._isGrace?gt.GraceScale:1;this.width=Xe.Widths.get(this._symbol)*t,this.height=Xe.Heights.get(this._symbol)*t;let i=Xe.Heights.get(this._symbol);for(const s of this.beatEffects.values())s.y+=i,s.x+=this.width/2,s.renderer=this.renderer,i+=7,s.doLayout()}static getSymbol(t){switch(t){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:return d.NoteheadSlashWhiteWhole;case w.Half:return d.NoteheadSlashWhiteHalf;default:return d.NoteheadSlashVerticalEnds}}updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,t+this.x+this.width,t+this.x)}}class iq extends Xa{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.slash=null,this.noteHeads=null,this.restGlyph=null}get effectElement(){return ht.StandardNotationEffects}getNoteX(t,e){return this.noteHeads?this.noteHeads.getNoteX(t,e):0}buildBoundingsLookup(t,e,i){this.noteHeads&&this.noteHeads.buildBoundingsLookup(t,e+this.x,i+this.y)}getNoteY(t,e){return this.noteHeads?this.noteHeads.getNoteY(t,e):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph){if(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&-1e3===this._collisionOffset){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const t=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;t.has(this.container.beat.playbackStart)&&t.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&t.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}else this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}paint(t,e,i){this._skipPaint||super.paint(t,e,i)}doLayout(){const t=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let e=2*Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2);this.container.beat.duration===w.Whole&&1!==this.renderer.bar.staff.standardNotationLineCount&&3!==this.renderer.bar.staff.standardNotationLineCount&&(e-=2);const i=new Zh(0,t.getScoreY(e),this.container.beat.duration);if(this.restGlyph=i,i.beat=this.container.beat,i.beamingHelper=this.beamingHelper,this.addNormal(i),this.renderer.bar.isMultiVoice)if(0===this.container.beat.voice.index){const s=tr.computeLineHeightsForRest(this.container.beat.duration),r=i.y-t.getScoreHeight(s[0]),a=i.y+t.getScoreHeight(s[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,r,a)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,e),this.container.beat.dots>0){this.addNormal(new Hn(0,0,5));for(let s=0;s<this.container.beat.dots;s++){const r=new er(0,0);r.renderer=this.renderer,this.createBeatDot(e,r),this.addEffect(r)}}}else{if(this.container.beat.slashed){const e=this.container.beat.graceType!==re.None,s=t.getLineY((t.heightLineCount-1)/2),r=new ed(0,s,this.container.beat.duration,e,this.container.beat);r.noteHeadElement=si.StandardNotationNoteHead,r.effectElement=ht.StandardNotationEffects,this.slash=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r)}else{const e=new Zj;this.noteHeads=e,e.beat=this.container.beat,e.beamingHelper=this.beamingHelper;const i=new Jg(!1);i.renderer=this.renderer;for(const s of this.container.beat.notes)s.isVisible&&(this.createNoteGlyph(s),i.addParenthesis(s));this.addNormal(e),i.isEmpty||(this.addNormal(new Hn(0,0,4*(this.container.beat.graceType!==re.None?gt.GraceScale:1))),this.addEffect(i))}if(this.container.beat.hasWhammyBar){const e=new Ko(this.container.beat);e.renderer=this.renderer,e.doLayout(),this.container.ties.push(e)}if(this.container.beat.dots>0){this.addNormal(new Hn(0,0,5));for(let e=0;e<this.container.beat.dots;e++){const i=new er(0,0);i.renderer=this.renderer;for(const s of this.container.beat.notes)this.createBeatDot(t.getNoteLine(s),i).colorOverride=Ce.noteColor(t.resources,si.StandardNotationEffects,s);this.addEffect(i)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}createBeatDot(t,e){const s=new Kh(0,this.renderer.getScoreY(t),1.5);return e.addGlyph(s),s}createNoteHeadGlyph(t){const e=this.container.beat.graceType!==re.None,i=t.style;if(void 0!==i?.noteHead){const s=new gt(0,0,t.beat.duration,e);return s.symbol=i.noteHead,i.noteHeadCenterOnStem&&(s.centerOnStem=!0),s}if(t.beat.voice.bar.staff.isPercussion){const s=nn.getArticulation(t);if(s)return new eq(0,0,s,t.beat.duration,e);x.warning("Rendering",`No articulation found for percussion instrument ${t.percussionArticulation}`)}return t.isDead?new Qj(0,0,e):t.beat.graceType===re.BendGrace?new gt(0,0,w.Quarter,!0):t.harmonicType===ae.Natural?new Xg(0,0,t.beat.duration,e):new gt(0,0,t.beat.duration,e)}createNoteGlyph(t){if(t.beat.graceType===re.BendGrace&&!t.hasBend)return;const e=this.renderer,i=this.createNoteHeadGlyph(t);i.colorOverride=Ce.noteColor(e.resources,si.StandardNotationNoteHead,t);let s=e.getNoteLine(t);if(i.y=e.getScoreY(s),this.noteHeads.addNoteGlyph(i,t,s),t.harmonicType!==ae.None&&t.harmonicType!==ae.Natural){const o=t.displayValue+t.harmonicPitch,l=new Xg(0,0,t.beat.duration,this.container.beat.graceType!==re.None);l.colorOverride=i.colorOverride,s=e.accidentalHelper.getNoteLineForValue(o,!1),l.y=e.getScoreY(s),this.noteHeads.addNoteGlyph(l,t,s)}const r=this.noteHeads.belowBeatEffects,a=this.noteHeads.aboveBeatEffects;if(t.isStaccato&&!r.has("Staccato")&&r.set("Staccato",new yM(0,0)),t.accentuated===Ot.Normal&&!r.has("Accent")&&r.set("Accent",new Qh(0,0,t)),t.accentuated===Ot.Heavy&&!r.has("HAccent")&&r.set("HAccent",new Qh(0,0,t)),t.accentuated===Ot.Tenuto&&!r.has("Tenuto")&&r.set("Tenuto",new Qh(0,0,t)),t.showStringNumber&&t.isStringed){let o;a.has("StringNumber")?o=a.get("StringNumber"):(o=new nq(0,0),a.set("StringNumber",o)),o.addString(t.string)}if(t.isPercussion){const o=nn.getArticulation(t);if(o&&o.techniqueSymbolPlacement!==ge.Middle){const l=o.techniqueSymbolPlacement===ge.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(o.techniqueSymbol){case d.PictEdgeOfCymbal:l.set("PictEdgeOfCymbal",new tq(0,0));break;case d.ArticStaccatoAbove:l.set("ArticStaccatoAbove",new yM(0,0));break;case d.StringsUpBow:l.set("StringsUpBow",new Jh(0,0,vn.Up));break;case d.StringsDownBow:l.set("StringsDownBow",new Jh(0,0,vn.Down));break;case d.GuitarGolpe:l.set("GuitarGolpe",new bM(0,0))}}}}}class sq extends Pt{constructor(t){super(0,0),this._beat=t}doLayout(){this.width=this._beat.brushType===Y.ArpeggioUp||this._beat.brushType===Y.ArpeggioDown?10:0}paint(t,e,i){if(this._beat.brushType===Y.ArpeggioUp||this._beat.brushType===Y.ArpeggioDown){const s=this.renderer,r=s.lineOffset,a=e+this.y+(s.getNoteY(this._beat.maxNote,Z.Bottom)-r),o=e+this.y+s.getNoteY(this._beat.minNote,Z.Top)+r,l=t+this.x+this.width/2,c=8,u=new Qa(0,0,Ie.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();const h=-u.height/2;if(this._beat.brushType===Y.ArpeggioUp){const p=o-c;u.width=Math.abs(p-(a+c)),i.beginRotate(t+this.x+5,p,-90),u.paint(0,h,i),i.endRotate(),i.beginPath(),i.moveTo(l,o),i.lineTo(l+c/2,o-c),i.lineTo(l-c/2,o-c),i.closePath(),i.fill()}else if(this._beat.brushType===Y.ArpeggioDown){const f=a+c;u.width=Math.abs(o-f),i.beginRotate(t+this.x+5,f,90),u.paint(0,h,i),i.endRotate(),i.beginPath(),i.moveTo(l,a),i.lineTo(l+c/2,a+c),i.lineTo(l-c/2,a+c),i.closePath(),i.fill()}}}}class rq{constructor(t,e){this.line=0,this.line=t,this.text=e}}class aq extends er{constructor(){super(0,0),this._infos=new Map}get isEmpty(){return 0===this._infos.size}addFingers(t){const e=this.renderer.settings;if(e.notation.fingeringMode!==Tr.ScoreDefault&&e.notation.fingeringMode!==Tr.ScoreForcePiano)return;const i=H.fingerToString(this.renderer.settings,t.beat,t.leftHandFinger,!0);i&&this.addFinger(t,i);const s=H.fingerToString(this.renderer.settings,t.beat,t.rightHandFinger,!1);s&&this.addFinger(t,s)}addFinger(t,e){const i=this.renderer,s=i.getNoteLine(t);if(this._infos.has(s))this._infos.get(s).text+=e;else{const r=new rq(s,e);r.color=Ce.noteColor(i.resources,si.StandardNotationEffects,t),this._infos.set(s,r)}}doLayout(){const t=this.renderer;for(const[e,i]of this._infos){const s=new zi(0,0,i.text,t.resources.inlineFingeringFont,K.Left,ge.Middle);s.colorOverride=i.color,s.renderer=t,s.y=t.getScoreY(i.line),s.doLayout(),this.addGlyph(s),this.width=Math.max(this.width,s.width)}}}class oq extends Ya{constructor(){super(...arguments),this._prebends=null,this.accidentals=null}get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}get effectElement(){return ht.StandardNotationEffects}doLayout(){if(!this.container.beat.isRest){const t=new f_;t.renderer=this.renderer;const e=new aq;e.renderer=this.renderer;const i=new Jg(!0);i.renderer=this.renderer;const s=new Ka(this.container.beat,!0);this._prebends=s,s.renderer=this.renderer;for(const r of this.container.beat.notes){const a=Ce.noteColor(this.renderer.resources,si.StandardNotationEffects,r);if(r.isVisible){if(r.hasBend)switch(r.bendType){case J.PrebendBend:case J.Prebend:case J.PrebendRelease:s.addGlyph(r.displayValue-(r.bendPoints[0].value/2|0),!1,a)}else if(r.beat.hasWhammyBar)switch(r.beat.whammyBarType){case Re.PrediveDive:case Re.Predive:this._prebends.addGlyph(r.displayValue-(r.beat.whammyBarPoints[0].value/2|0),!1,a)}this.createAccidentalGlyph(r,t),i.addParenthesis(r),e.addFingers(r)}}s.isEmpty||(this.addEffect(s),this.addNormal(new Hn(0,0,4*(this.container.beat.graceType!==re.None?gt.GraceScale:1)))),this.container.beat.brushType!==Y.None&&(this.addEffect(new sq(this.container.beat)),this.addNormal(new Hn(0,0,4))),e.isEmpty||(this.isEmpty||this.addNormal(new Hn(0,0,2*(this.container.beat.graceType!==re.None?gt.GraceScale:1))),this.addEffect(e),this.addNormal(new Hn(0,0,2*(this.container.beat.graceType!==re.None?gt.GraceScale:1)))),i.isEmpty||(this.addEffect(i),this.addNormal(new Hn(0,0,4*(this.container.beat.graceType!==re.None?gt.GraceScale:1)))),t.isEmpty||(this.accidentals=t,this.isEmpty||this.addNormal(new Hn(0,0,2*(this.container.beat.graceType!==re.None?gt.GraceScale:1))),this.addNormal(t),this.addNormal(new Hn(0,0,2*(this.container.beat.graceType!==re.None?gt.GraceScale:1))))}super.doLayout()}createAccidentalGlyph(t,e){const i=this.renderer;let s=i.accidentalHelper.applyAccidental(t),r=i.getNoteLine(t);const a=this.container.beat.graceType!==re.None,o=Ce.noteColor(i.resources,si.StandardNotationAccidentals,t),l=a?gt.GraceScale:1;if(s!==le.None){const c=new Pr(0,i.getScoreY(r),s,l);c.colorOverride=o,c.renderer=this.renderer,e.addGlyph(c)}if(t.harmonicType!==ae.None&&t.harmonicType!==ae.Natural){const c=t.displayValue+t.harmonicPitch;s=i.accidentalHelper.applyAccidentalForValue(t.beat,c,a,!1),r=i.accidentalHelper.getNoteLineForValue(c,!1);const u=new Pr(0,i.getScoreY(r),s,l);u.colorOverride=o,u.renderer=this.renderer,e.addGlyph(u)}}}class wM extends er{constructor(t,e,i,s,r,a){super(t,e),this._numerator=0,this._denominator=0,this.barSubElement=Le.StandardNotationTimeSignature,this._numerator=i,this._denominator=s,this._isCommon=r,this._isFreeTime=a}paint(t,e,i){const s=Ce.bar(i,this.barSubElement,this.renderer.bar);try{super.paint(t,e,i)}finally{s?.[Symbol.dispose]?.()}}doLayout(){let t=0;const e=qg.numberHeight;if(this._isFreeTime){const i=new d_(!0);i.renderer=this.renderer,i.y=-e,i.height=2*e,i.doLayout(),this.addGlyph(i),t+=i.width+10}if(this._isCommon&&2===this._numerator&&2===this._denominator){const i=new sn(t,0,this.commonScale,d.TimeSigCutCommon);this.addGlyph(i),super.doLayout()}else if(this._isCommon&&4===this._numerator&&4===this._denominator){const i=new sn(t,0,this.commonScale,d.TimeSigCommon);this.addGlyph(i),super.doLayout()}else{const i=new qg(t,-e/2,this._numerator,this.numberScale),s=new qg(t,e/2,this._denominator,this.numberScale);this.addGlyph(i),this.addGlyph(s),super.doLayout();const r=this.width-t;i.x=t+(r-i.width)/2,s.x=t+(r-s.width)/2}if(this._isFreeTime){const i=new d_(!1);i.renderer=this.renderer,i.x=this.width+13,i.y=-e,i.height=2*e,i.doLayout(),this.addGlyph(i),this.width=i.x+i.width}}}class p_ extends wM{get commonScale(){return 1}get numberScale(){return 1}}class lq extends pM{constructor(t){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=t}addBends(t){if(this._notes.push(t),t.isTieOrigin)return;const e=Ce.noteColor(this.renderer.resources,si.StandardNotationEffects,t);switch(t.bendType){case J.Bend:case J.PrebendRelease:case J.PrebendBend:{let i=this._endNoteGlyph;i||(i=new Ka(t.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.BendNoteHeads.push(i));const s=t.bendPoints[t.bendPoints.length-1];i.addGlyph(this.getBendNoteValue(t,s),s.value%2!=0,e)}break;case J.Release:if(!t.isTieOrigin){let i=this._endNoteGlyph;i||(i=new Ka(t.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.BendNoteHeads.push(i));const s=t.bendPoints[t.bendPoints.length-1];i.addGlyph(this.getBendNoteValue(t,s),s.value%2!=0,e)}break;case J.BendRelease:{let i=this._middleNoteGlyph;i||(i=new Ka(t.beat,!1),this._middleNoteGlyph=i,i.renderer=this.renderer,this.BendNoteHeads.push(i));const s=t.bendPoints[1];i.addGlyph(this.getBendNoteValue(t,t.bendPoints[1]),s.value%2!=0,e);let r=this._endNoteGlyph;r||(r=new Ka(t.beat,!1),r.renderer=this.renderer,this._endNoteGlyph=r,this.BendNoteHeads.push(r));const a=t.bendPoints[t.bendPoints.length-1];r.addGlyph(this.getBendNoteValue(t,a),a.value%2!=0,e)}}}paint(t,e,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._beat.voice.bar),r=t+s.x+s.getBeatX(this._beat,xe.MiddleNotes);let a=t+s.x;a+=this._beat.isLastOfVoice?s.postBeatGlyphsStart:s.getBeatX(this._beat.nextBeat,xe.PreNotes),a-=8;const o=(r+a)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=e+s.y,this._middleNoteGlyph.paint(0,0,i)),this._endNoteGlyph&&(this._endNoteGlyph.x=a-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=e+s.y,this._endNoteGlyph.paint(0,0,i)),this._notes.sort((h,f)=>f.displayValue-h.displayValue);let c=1===this._notes.length?this.getTieDirection(this._beat.graceType===re.BendGrace?this._beat.nextBeat:this._beat,s):B.Up;const u=Xe.Heights.get(d.NoteheadBlack);for(let h=0;h<this._notes.length;h++){const f=this._notes[h],p=Ce.note(i,si.StandardNotationEffects,f);try{h>0&&h>=(this._notes.length/2|0)&&(c=B.Down);let g=e+s.y+s.getNoteY(f,Z.Top),m=u*gt.GraceScale*.5;c===B.Down&&(g+=u);const y=f.bendStyle===ct.Gradual?"grad.":"";if(f.isTieOrigin){const b=f.tieDestination,_=b?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,b.beat.voice.bar):null;if(_&&_.staff===s.staff){const v=t+_.x+_.getBeatX(b.beat,xe.MiddleNotes);let k=e+_.y+_.getNoteY(b,Z.Top);c===B.Down&&(k+=u),f.bendType===J.Hold||f.bendType===J.Prebend?bs.paintTie(i,1,r,g,v,k,c===B.Down,22,4):this.drawBendSlur(i,r,g,v,k,c===B.Down,1,y)}else{const v=t+s.x+s.width,k=f.tieDestination.realValue;s.accidentalHelper.applyAccidentalForValue(f.beat,k,!1,!0);const F=e+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(k,!1));f.bendType===J.Hold||f.bendType===J.Prebend?bs.paintTie(i,1,r,g,v,F,c===B.Down,22,4):this.drawBendSlur(i,r,g,v,F,c===B.Down,1,y)}switch(f.bendType){case J.Prebend:case J.PrebendBend:case J.PrebendRelease:let v=t+s.x+s.getBeatX(f.beat,xe.PreNotes);v+=s.getPreNotesGlyphForBeat(f.beat).prebendNoteHeadOffset;const k=e+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(f.displayValue-(f.bendPoints[0].value/2|0),!1))+m;this.drawBendSlur(i,v,k,r,g,c===B.Down,1)}}else{c===B.Up&&(m=-m);let b=0,_=0;switch(f.bendType){case J.Bend:b=this.getBendNoteValue(f,f.bendPoints[f.bendPoints.length-1]),_=this._endNoteGlyph.getNoteValueY(b)+m,this.drawBendSlur(i,r,g,a,_,c===B.Down,1,y);break;case J.BendRelease:const v=this.getBendNoteValue(f,f.bendPoints[1]),k=this._middleNoteGlyph.getNoteValueY(v)+m;this.drawBendSlur(i,r,g,o,k,c===B.Down,1,y),b=this.getBendNoteValue(f,f.bendPoints[f.bendPoints.length-1]),_=this._endNoteGlyph.getNoteValueY(b)+m,this.drawBendSlur(i,o,k,a,_,c===B.Down,1,y);break;case J.Release:this.BendNoteHeads.length>0&&(b=this.getBendNoteValue(f,f.bendPoints[f.bendPoints.length-1]),_=this.BendNoteHeads[0].getNoteValueY(b)+m,this.drawBendSlur(i,r,g,a,_,c===B.Down,1,y));break;case J.Prebend:case J.PrebendBend:case J.PrebendRelease:let F=t+s.x+s.getBeatX(f.beat,xe.PreNotes);F+=s.getPreNotesGlyphForBeat(f.beat).prebendNoteHeadOffset;const D=e+s.y+s.getScoreY(s.accidentalHelper.getNoteLineForValue(f.displayValue-(f.bendPoints[0].value/2|0),!1))+m;this.drawBendSlur(i,F,D,r,g,c===B.Down,1),this.BendNoteHeads.length>0&&(b=this.getBendNoteValue(f,f.bendPoints[f.bendPoints.length-1]),_=this.BendNoteHeads[0].getNoteValueY(b)+m,this.drawBendSlur(i,r,g,a,_,c===B.Down,1,y))}}}finally{p?.[Symbol.dispose]?.()}}}getBendNoteValue(t,e){return t.displayValueWithoutBend+(e.value/2|0)}}class g_ extends bs{constructor(t,e,i=!1){super(t,e,i)}doLayout(){super.doLayout()}getBeamDirection(t,e){return t.isRest?B.Up:e.getBeatDirection(t)===B.Up?B.Down:B.Up}getStartY(){return this.startBeat.isRest?this.startNoteRenderer.getScoreY(9):this.tieDirection===B.Up?this.startNoteRenderer.getNoteY(this.startBeat.maxNote,Z.Top):this.startNoteRenderer.getNoteY(this.startBeat.minNote,Z.Bottom)}getEndY(){const t=this.endNoteRenderer;if(this.endBeat.isRest)return t.getScoreY(this.tieDirection===B.Up?9:0);const e=this.startNoteRenderer.getBeatDirection(this.startBeat),i=t.getBeatDirection(this.endBeat);return e!==i&&this.startBeat.graceType===re.None?i===this.tieDirection?this.tieDirection===B.Up?t.getNoteY(this.endBeat.maxNote,Z.TopWithStem):t.getNoteY(this.endBeat.minNote,Z.BottomWithStem):this.tieDirection===B.Up?t.getNoteY(this.endBeat.maxNote,Z.BottomWithStem):t.getNoteY(this.endBeat.minNote,Z.TopWithStem):this.tieDirection===B.Up?t.getNoteY(this.endBeat.maxNote,Z.Top):t.getNoteY(this.endBeat.minNote,Z.Bottom)}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,xe.MiddleNotes)}getEndX(){const t=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>w.Whole&&t===this.tieDirection?xe.Stem:xe.MiddleNotes)}}class cq extends Pt{constructor(t,e,i,s){super(0,0),this._outType=e,this._inType=t,this._startNote=i,this._parent=s}doLayout(){this.width=0}paint(t,e,i){this.paintSlideIn(t,e,i),this.drawSlideOut(t,e,i)}paintSlideIn(t,e,i){const s=this.renderer;let a=t+s.x+s.getNoteX(this._startNote,wt.Left)-2;const o=e+s.y+s.getNoteY(this._startNote,Z.Center);let l=a-12,c=e+s.y;switch(this._inType){case pn.IntoFromBelow:c+=s.getNoteY(this._startNote,Z.Bottom);break;case pn.IntoFromAbove:c+=s.getNoteY(this._startNote,Z.Top);break;default:return}const u=this.getAccidentalsWidth(s,this._startNote.beat);l-=u,a-=u,this.paintSlideLine(i,!1,l,a,c,o)}getAccidentalsWidth(t,e){const i=t.getPreNotesGlyphForBeat(e);return i&&i.accidentals?i.accidentals.width:0}drawSlideOut(t,e,i){const s=this.renderer;let l=0,c=0,u=0,h=0,f=!1;switch(this._outType){case Se.Shift:case Se.Legato:if(l=t+s.x+s.getBeatX(this._startNote.beat,xe.PostNotes)+2,c=e+s.y+s.getNoteY(this._startNote,Z.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);p&&p.staff===s.staff?(u=t+p.x+p.getBeatX(this._startNote.slideTarget.beat,xe.PreNotes)-2,h=e+p.y+p.getNoteY(this._startNote.slideTarget,Z.Center)):(u=t+s.x+s.width,h=c),this._startNote.slideTarget.realValue>this._startNote.realValue?(c+=2,h-=2):(c-=2,h+=2)}else u=t+s.x+this._parent.x,h=c;break;case Se.OutUp:l=t+s.x+s.getNoteX(this._startNote,wt.Right)+2,c=e+s.y+s.getNoteY(this._startNote,Z.Center),u=l+12,h=e+s.y+s.getNoteY(this._startNote,Z.Top);break;case Se.OutDown:l=t+s.x+s.getNoteX(this._startNote,wt.Right)+2,c=e+s.y+s.getNoteY(this._startNote,Z.Center),u=l+12,h=e+s.y+s.getNoteY(this._startNote,Z.Bottom);break;case Se.PickSlideUp:l=t+s.x+s.getNoteX(this._startNote,wt.Right)+4,c=e+s.y+s.getNoteY(this._startNote,Z.Center),h=e+s.y+s.getNoteY(this._startNote,Z.Top),u=t+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=t+s.x+s.getBeatX(this._startNote.beat.nextBeat,xe.PreNotes)),f=!0;break;case Se.PickSlideDown:l=t+s.x+s.getNoteX(this._startNote,wt.Right)+4,c=e+s.y+s.getNoteY(this._startNote,Z.Center),h=e+s.y+s.getNoteY(this._startNote,Z.Bottom),u=t+s.x+s.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=t+s.x+s.getBeatX(this._startNote.beat.nextBeat,xe.PreNotes)),f=!0;break;default:return}this.paintSlideLine(i,f,l,u,c,h)}paintSlideLine(t,e,i,s,r,a){if(e){const o=new Qa(0,0,Ie.Slight,1.2);o.renderer=this.renderer,o.doLayout();const l=s-i,c=(a-=o.height/2)-(r-=o.height/2),u=Math.sqrt(Math.pow(c,2)+Math.pow(l,2));o.width=l;const h=Math.asin(c/u)*(180/Math.PI);t.beginRotate(i,r,h),o.paint(0,0,t),t.endRotate()}else t.beginPath(),t.moveTo(i,r),t.lineTo(s,a),t.stroke()}}class Zg extends g_{constructor(t,e,i=!1){super(t.beat,e.beat,i),this._startNote=t,this._endNote=e}getTieHeight(t,e,i,s){return Math.log2(i-t+1)*this.renderer.settings.notation.slurHeight}getStartY(){return this.isStartCentered()?this.startNoteRenderer.getNoteY(this._startNote,this.tieDirection===B.Up?Z.Top:Z.Bottom):this.startNoteRenderer.getNoteY(this._startNote,Z.Center)}getEndY(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getNoteY(this._endNote,this.tieDirection===B.Up?Z.TopWithStem:Z.BottomWithStem):this.endNoteRenderer.getNoteY(this._endNote,this.tieDirection===B.Up?Z.Top:Z.Bottom):this.endNoteRenderer.getNoteY(this._endNote,Z.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===B.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===B.Down}isEndCentered(){return this._startNote.beat.graceType===re.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===B.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===B.Down)}isEndOnStem(){const t=this.endNoteRenderer;return this.startNoteRenderer.getBeatDirection(this.startBeat)!==t.getBeatDirection(this.endBeat)&&this.startBeat.graceType===re.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,xe.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,wt.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,xe.Stem):this.endNoteRenderer.getNoteX(this._endNote,wt.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,xe.PreNotes)}}class SM extends bs{constructor(t,e,i=!1){super(t?t.beat:null,e?e.beat:null,i),this.startNote=t,this.endNote=e}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(t,e){return e.getBeatDirection(t)===B.Up?B.Down:B.Up}getStartY(){return this.startBeat.isRest?this.startNoteRenderer.getScoreY(9):this.startNoteRenderer.getNoteY(this.startNote,this.tieDirection===B.Up?Z.Top:Z.Bottom)}getEndY(){const t=this.endNoteRenderer;return this.endBeat.isRest?t.getScoreY(this.tieDirection===B.Up?9:0):t.getNoteY(this.endNote,this.tieDirection===B.Up?Z.Top:Z.Bottom)}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,xe.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,xe.PreNotes)}}class uq extends Zs{constructor(){super(...arguments),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(t){if(t.isVisible){if(t.isTieOrigin&&!t.hasBend&&!t.beat.hasWhammyBar&&t.beat.graceType!==re.BendGrace&&t.tieDestination&&t.tieDestination.isVisible){const e=new SM(t,t.tieDestination,!1);this.addTie(e)}if(t.isTieDestination&&!t.tieOrigin.hasBend&&!t.beat.hasWhammyBar){const e=new SM(t.tieOrigin,t,!0);this.addTie(e)}if(t.slideInType!==pn.None||t.slideOutType!==Se.None){const e=new cq(t.slideInType,t.slideOutType,t,this);this.addTie(e)}if(t.isSlurOrigin&&t.slurDestination&&t.slurDestination.isVisible){const e=new Zg(t,t.slurDestination,!1);this.addTie(e)}if(t.isSlurDestination){const e=new Zg(t.slurOrigin,t,!0);this.addTie(e)}if(!this._effectSlur&&t.isEffectSlurOrigin&&t.effectSlurDestination){const e=new Zg(t,t.effectSlurDestination,!1);this._effectSlur=e,this.addTie(e)}if(!this._effectEndSlur&&t.beat.isEffectSlurDestination&&t.beat.effectSlurOrigin){const e=this.onNotes.beamingHelper.direction,r=new Zg(e===B.Up?t.beat.effectSlurOrigin.minNote:t.beat.effectSlurOrigin.maxNote,e===B.Up?t.beat.minNote:t.beat.maxNote,!0);this._effectEndSlur=r,this.addTie(r)}if(t.hasBend){if(!this._bend){const e=new lq(t.beat);this._bend=e,e.renderer=this.renderer,this.addTie(e)}this._bend.addBends(t)}if(this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let e=this.beat.nextBeat;for(;e.nextBeat&&e.nextBeat.isLegatoDestination;)e=e.nextBeat;this.addTie(new g_(this.beat,e,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let e=this.beat.previousBeat;for(;e.previousBeat&&e.previousBeat.isLegatoOrigin;)e=e.previousBeat;this.addTie(new g_(e,this.beat,!0))}}}}class Zo extends Pt{doLayout(){this.width=1}paint(t,e,i){const r=e+this.y+this.renderer.topPadding;this.paintInternal(t+this.x,r,e+this.y+this.renderer.height-this.renderer.bottomPadding-r,i)}}class td extends Zo{paintInternal(t,e,i,s){s.fillRect(t,e,1,i)}}class hq extends Zo{paintInternal(t,e,i,s){const a=t,o=this.renderer.getLineHeight(1);let l=e+.5*o+1;const c=e+i;for(;l<c;)s.fillCircle(a,l,1),l+=o}}let dq=(()=>{class n extends Zo{paintInternal(e,i,s,r){const a=n.DashSize,o=e+.5,l=Math.ceil(s/2/a),c=i+s;if(r.beginPath(),l<1)r.moveTo(o,i),r.lineTo(o,c);else{let u=i;const f=(s-l*a)/(l-1);for(;u<c;)r.moveTo(o,u),r.lineTo(o,u+a),u+=a+f}r.stroke()}}return n.DashSize=4,n})();class nd extends Zo{doLayout(){this.width=4}paintInternal(t,e,i,s){s.fillRect(t,e,this.width,i)}}class _M extends Zo{paintInternal(t,e,i,s){const o=(e+(e+i))/2;s.fillCircle(t,o-4.5,1.5),s.fillCircle(t,o+4.5,1.5)}}class fq extends Zo{paintInternal(t,e,i,s){const r=this.renderer,o=r.drawnLineCount-1;if(o<=2)return;const l=r.getLineHeight(1),c=2*l;s.fillRect(t,e+(o/2*l-c/2),1,c)}}class pq extends Zo{paintInternal(t,e,i,s){const a=this.renderer.getLineHeight(1);s.fillRect(t,e+(-a/2+1),1,a)}}class m_ extends Yo{constructor(t){super(),this._isRight=t}doLayout(){const t=this.renderer.bar,e=t.masterBar,i=this._isRight?t.getActualBarLineRight():t.getActualBarLineLeft(0===this.renderer.index);let s=pe.Automatic;if(!this._isRight){const a=this.renderer.previousRenderer;if(a&&a.staff===this.renderer.staff&&(s=a.bar.getActualBarLineRight(),i===s))return}switch(this._isRight&&e.isRepeatEnd&&(this.addGlyph(new _M(0,0)),this.width+=3),i){case pe.Dashed:this.addGlyph(new dq(0,0));break;case pe.Dotted:this.addGlyph(new hq(0,0));break;case pe.Heavy:s!==pe.LightHeavy&&s!==pe.HeavyHeavy&&this.addGlyph(new nd(0,0));break;case pe.HeavyHeavy:s!==pe.LightHeavy&&s!==pe.Heavy&&this.addGlyph(new nd(0,0)),this.width+=3,this.addGlyph(new nd(0,0));break;case pe.HeavyLight:s!==pe.LightHeavy&&s!==pe.Heavy&&s!==pe.HeavyHeavy&&this.addGlyph(new nd(0,0)),this.width+=3,this.addGlyph(new td(0,0));break;case pe.LightHeavy:s!==pe.HeavyLight&&s!==pe.Regular&&s!==pe.LightLight&&this.addGlyph(new td(0,0)),this.width+=3,this.addGlyph(new nd(0,0));break;case pe.LightLight:s!==pe.HeavyLight&&s!==pe.Regular&&this.addGlyph(new td(0,0)),this.width+=3,this.addGlyph(new td(0,0));break;case pe.None:break;case pe.Regular:s!==pe.HeavyLight&&s!==pe.LightLight&&this.addGlyph(new td(0,0));break;case pe.Short:this.addGlyph(new fq(0,0));break;case pe.Tick:this.addGlyph(new pq(0,0))}this._isRight||e.isRepeatStart&&(this.width+=3,this.addGlyph(new _M(0,0)))}paint(t,e,i){const r=Ce.bar(i,this.renderer.barLineBarSubElement,this.renderer.bar,!0);try{super.paint(t,e,i)}finally{r?.[Symbol.dispose]?.()}}}class gq extends Pt{constructor(t,e,i){super(t,e),this._count=0,this._count=0,this._count=i}doLayout(){this.width=0}paint(t,e,i){const s=Ce.bar(i,this.renderer.repeatsBarSubElement,this.renderer.bar);try{const a=i.textAlign;i.font=this.renderer.resources.barNumberFont,i.textAlign=K.Right;const o=`x${this._count}`,l=i.measureText(o).width/1.5;i.fillText(o,t+this.x-l,e+this.y),i.textAlign=a}finally{s?.[Symbol.dispose]?.()}}}class vM extends Pt{constructor(t,e,i){super(t,e),this._number=0,this._number=i}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5}paint(t,e,i){if(!this.renderer.staff.isFirstInSystem)return;const s=Ce.bar(i,this.renderer.barNumberBarSubElement,this.renderer.bar,!0);try{const r=this.renderer.resources,a=i.textBaseline;i.textBaseline=ge.Top,i.font=r.barNumberFont,i.fillText(this._number.toString(),t+this.x,e+this.y),i.textBaseline=a}finally{s?.[Symbol.dispose]?.()}}}class Ir extends Ct{constructor(){super(...arguments),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return this.lineSpacing+1}get tupletOffset(){return 10}get topGlyphOverflow(){const t=this.resources;return t.tablatureFont.size/2+.2*t.tablatureFont.size}get bottomGlyphOverflow(){const t=this.resources;return t.tablatureFont.size/2+.2*t.tablatureFont.size}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){this.firstLineY=this.topPadding+(this.lineOffset*(this.heightLineCount-1)-(this.drawnLineCount-1)*this.lineOffset)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15+.3*this.resources.effectFont.size,super.doLayout()}getLineY(t){return this.firstLineY+this.getLineHeight(t)}getLineHeight(t){return this.lineOffset*t}paintBackground(t,e,i){super.paintBackground(t,e,i),this.paintStaffLines(t,e,i),this.paintSimileMark(t,e,i)}paintStaffLines(t,e,i){const s=Ce.bar(i,this.staffLineBarSubElement,this.bar,!0);try{const r=[];for(let o=0,l=this.drawnLineCount;o<l;o++)r.push([]);this.additionalMultiRestBars||this.collectSpaces(r);for(const o of r)o.sort((l,c)=>l[0]>c[0]?1:l[0]<c[0]?-1:0);const a=Math.ceil(this.width);for(let o=0;o<this.drawnLineCount;o++){const l=this.getLineY(o);let c=0;for(const u of r[o])i.fillRect(t+this.x+c,e+this.y+l|0,u[0]-c,Ct.StaffLineThickness),c=u[0]+u[1];i.fillRect(t+this.x+c,e+this.y+l|0,a-c,Ct.StaffLineThickness)}}finally{s?.[Symbol.dispose]?.()}}collectSpaces(t){}createStartSpacing(){this._startSpacing||(this.addPreBeatGlyph(new Hn(0,0,0===this.index?this.settings.display.firstStaffPaddingLeft:this.settings.display.staffPaddingLeft)),this._startSpacing=!0)}paintTuplets(t,e,i,s,r=!1){for(const a of this.bar.voices)if(this.hasVoiceContainer(a)){const o=this.getVoiceContainer(a);for(const l of o.tupletGroups)this.paintTupletHelper(t+this.beatGlyphsStart,e,i,l,s,r)}}getTupletBeamDirection(t){return this.getBeamDirection(t)}paintTupletHelper(t,e,i,s,r,a){const o=this.resources,l=i.textAlign,c=i.textBaseline;let u;i.color=0===s.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=K.Center,i.textBaseline=ge.Middle;const h=s.beats[0].tupletNumerator,f=s.beats[0].tupletDenominator;u=2===h&&3===f?"2":3===h&&2===f?"3":4===h&&6===f?"4":5===h&&4===f?"5":6===h&&4===f?"6":7===h&&4===f?"7":9===h&&8===f?"9":10===h&&8===f?"10":11===h&&8===f?"11":12===h&&8===f?"12":13===h&&8===f?"13":`${h}:${f}`;let p=this.tupletOffset,g=5;const m=Ce.beat(i,r,s.beats[0]);try{if(1!==s.beats.length&&s.isFull){const y=s.beats[0],b=s.beats[s.beats.length-1];let _=null,v=null;for(let wn=0;wn<s.beats.length;wn++)if(!s.beats[wn].isRest){_=s.beats[wn];break}for(let wn=s.beats.length-1;wn>=0;wn--)if(!s.beats[wn].isRest){v=s.beats[wn];break}let k=!1;_||(_=y,k=!0),v||(v=b);const F=this.helpers.beamHelperLookup[s.voice.index].get(y.index),D=this.helpers.beamHelperLookup[s.voice.index].get(b.index),C=F.getBeatLineX(y),oe=D.getBeatLineX(b),at=this.helpers.beamHelperLookup[s.voice.index].get(_.index),Fe=this.helpers.beamHelperLookup[s.voice.index].get(v.index),ne=this.getTupletBeamDirection(F);let ot=this.calculateBeamYWithDirection(at,C,ne),Nn=this.calculateBeamYWithDirection(Fe,oe,ne);k&&(ot=Math.max(ot,Nn),Nn=ot),i.font=o.effectFont;const ci=i.measureText(u).width,ji=3,xn=(C+oe)/2,mi=xn-ci/2-ji,to=xn+ci/2+ji,ua=(Nn-ot)/(oe-C),Is=ot-ua*C,Wn=ua*mi+Is,el=ua*xn+Is,nr=ua*to+Is;ne===B.Down&&(p*=-1,g*=-1),i.beginPath(),i.moveTo(t+this.x+C,e+this.y+ot-p|0),a?i.quadraticCurveTo(t+this.x+(mi+C)/2,e+this.y+Wn-p-g|0,t+this.x+mi,e+this.y+Wn-p-g|0):(i.lineTo(t+this.x+C,e+this.y+ot-p-g|0),i.lineTo(t+this.x+mi,e+this.y+Wn-p-g|0)),i.stroke(),i.beginPath(),i.moveTo(t+this.x+to,e+this.y+nr-p-g|0),a?i.quadraticCurveTo(t+this.x+(oe+to)/2,e+this.y+nr-p-g|0,t+this.x+oe,e+this.y+Nn-p|0):(i.lineTo(t+this.x+oe,e+this.y+Nn-p-g|0),i.lineTo(t+this.x+oe,e+this.y+Nn-p|0)),i.stroke(),i.fillText(u,t+this.x+xn,e+this.y+el-p-g)}else for(const y of s.beats){const b=this.helpers.beamHelperLookup[s.voice.index].get(y.index);if(!b)continue;const _=this.getTupletBeamDirection(b),v=b.getBeatLineX(y);let k=this.calculateBeamYWithDirection(b,v,_);_===B.Down?k+=p+g:k-=p+g,i.font=o.effectFont,i.fillText(u,t+this.x+v,e+this.y+k)}i.textAlign=l,i.textBaseline=c}finally{m?.[Symbol.dispose]?.()}}paintBeams(t,e,i,s,r){for(const a of this.helpers.beamHelpers)for(const o of a)this.paintBeamHelper(t+this.beatGlyphsStart,e,i,o,s,r)}drawBeamHelperAsFlags(t){return 1===t.beats.length}paintBeamHelper(t,e,i,s,r,a){i.color=0===s.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.isRestBeamHelper||(this.drawBeamHelperAsFlags(s)?this.paintFlag(t,e,i,s,r):this.paintBar(t,e,i,s,a))}shouldPaintFlag(t,e){return!(t.graceType===re.BendGrace||t.deadSlapped||!e.hasBeatLineX(t)||t.graceType!==re.None&&this.settings.notation.notationMode===_n.SongBook||t.duration===w.Whole||t.duration===w.DoubleWhole||t.duration===w.QuadrupleWhole)}paintFlag(t,e,i,s,r){for(const a of s.beats){if(!this.shouldPaintFlag(a,s))continue;const o=a.graceType!==re.None,l=o?gt.GraceScale:1,c=this.getFlagStemSize(s.shortestDuration),u=s.getBeatLineX(a),h=this.getBeamDirection(s);let f=this.getFlagTopY(a,h),p=this.getFlagBottomY(a,h),g=0;if(h===B.Down?(p+=c*l,g=p):(f-=c*l,g=f),!s.hasLine(!0,a))continue;this.paintBeamingStem(a,e+this.y,t+this.x+u,e+this.y+f,e+this.y+p,i);const m=Ce.beat(i,r,a);try{if(a.graceType===re.BeforeBeat&&(i.beginPath(),h===B.Down?(i.moveTo(t+this.x+u-6,e+this.y+p-15),i.lineTo(t+this.x+u+6,e+this.y+p)):(i.moveTo(t+this.x+u-6,e+this.y+f+15),i.lineTo(t+this.x+u+6,e+this.y+f)),i.stroke()),s.hasFlag(!0,a)){const y=new Wg(u-.5,g,a.duration,h,o);y.renderer=this,y.doLayout(),y.paint(t+this.x,e+this.y,i)}}finally{m?.[Symbol.dispose]?.()}}}getFlagStemSize(t,e=!1){let i=0;switch(t){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:case w.ThirtySecond:case w.SixtyFourth:case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:i=3;break;default:i=e?3:0}return this.getLineHeight(i)}recreatePreBeatGlyphs(){this._startSpacing=!1,super.recreatePreBeatGlyphs()}calculateBeamY(t,e){return this.calculateBeamYWithDirection(t,e,this.getBeamDirection(t))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.addPreBeatGlyph(new m_(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new vM(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs();const t=this.lastBar;this.addPostBeatGlyph(new m_(!0)),t.masterBar.isRepeatEnd&&t.masterBar.repeatCount>2&&this.addPostBeatGlyph(new gq(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))}paintBar(t,e,i,s,r){for(let a=0,o=s.beats.length;a<o;a++){const l=s.beats[a];if(!s.hasBeatLineX(l)||l.deadSlapped)continue;const u=l.graceType!==re.None?gt.GraceScale:1,h=s.getBeatLineX(l),f=this.getBeamDirection(s),p=e+this.y+this.getBarLineStart(l,f),g=e+this.y+this.calculateBeamY(s,h);this.paintBeamingStem(l,e+this.y,t+this.x+h,p,g,i);const m=Ce.beat(i,r,l);try{let y=g;f===B.Down?y+=2*i.font.size:0!==a&&(y-=1.5*i.font.size);const b=6*u;let _=(Ct.BeamSpacing+Ct.BeamThickness)*u,v=Ct.BeamThickness*u;const k=H.getIndex(l.duration)-2,F=e+this.y;f===B.Down&&(_=-_,v=-v);for(let D=0;D<k;D++){let C=0,oe=0,at=0,Fe=0;const ne=F+D*_;if(a<s.beats.length-1){const ot=tr.isFullBarJoin(l,s.beats[a+1],D);if(D===k-1&&ot&&l.beamingMode===St.ForceSplitOnSecondaryToNext)C=h,oe=C+b,at=ne+this.calculateBeamY(s,C),Fe=ne+this.calculateBeamY(s,oe),Ir.paintSingleBar(i,t+this.x+C,at,t+this.x+oe,Fe,v),oe=s.getBeatLineX(s.beats[a+1]),C=oe-b,at=ne+this.calculateBeamY(s,C),Fe=ne+this.calculateBeamY(s,oe),Ir.paintSingleBar(i,t+this.x+C,at,t+this.x+oe,Fe,v);else{if(ot)C=h,oe=s.getBeatLineX(s.beats[a+1]);else{if(0!==a&&tr.isFullBarJoin(s.beats[a-1],l,D))continue;C=h,oe=C+b}at=ne+this.calculateBeamY(s,C),Fe=ne+this.calculateBeamY(s,oe),Ir.paintSingleBar(i,t+this.x+C,at,t+this.x+oe,Fe,v)}}else a>0&&!tr.isFullBarJoin(l,s.beats[a-1],D)&&(C=h-b,oe=h,at=ne+this.calculateBeamY(s,C),Fe=ne+this.calculateBeamY(s,oe),Ir.paintSingleBar(i,t+this.x+C,at,t+this.x+oe,Fe,v))}}finally{m?.[Symbol.dispose]?.()}}}static paintSingleBar(t,e,i,s,r,a){t.beginPath(),t.moveTo(e,i),t.lineTo(s,r),t.lineTo(s,r+a),t.lineTo(e,i+a),t.closePath(),t.fill()}}class mq extends Yo{paint(t,e,i){const s=Ce.bar(i,Le.StandardNotationKeySignature,this.renderer.bar);try{super.paint(t,e,i)}finally{s?.[Symbol.dispose]?.()}}}let y_=(()=>{class n extends Ir{constructor(e,i){super(e,i),this.simpleWhammyOverflow=0,this.beatEffectsMinY=null,this.beatEffectsMaxY=null,this.accidentalHelper=new Js(this)}get repeatsBarSubElement(){return Le.StandardNotationRepeats}get barNumberBarSubElement(){return Le.StandardNotationBarNumber}get barLineBarSubElement(){return Le.StandardNotationBarLines}get staffLineBarSubElement(){return Le.StandardNotationStaffLine}get showMultiBarRest(){return!0}get lineSpacing(){return Ct.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(e,i){const s=this.beatEffectsMinY;(null==s||e<s)&&(this.beatEffectsMinY=e);const r=this.beatEffectsMaxY;(null==r||i>r)&&(this.beatEffectsMaxY=i)}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){const e=this.getScoreY(-2),i=this.getScoreY(10),s=this.simpleWhammyOverflow,r=this.beatEffectsMinY;if(null!==r){const h=e-r;h>0&&this.registerOverflowTop(h)}const a=this.beatEffectsMaxY;if(null!==a){const h=a-i;h>0&&this.registerOverflowBottom(h)}this.registerOverflowTop(s);let o=this.getScoreY(this.accidentalHelper.maxLine);const l=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);l.direction===B.Up&&(o-=this.getStemSize(l),l.hasTuplet&&(o-=this.tupletSize)),o<e&&this.registerOverflowTop(Math.abs(o)+s);let c=this.getScoreY(this.accidentalHelper.minLine);const u=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);u.direction===B.Down&&(c+=this.getStemSize(u),u.hasTuplet&&(c+=this.tupletSize)),c>i&&this.registerOverflowBottom(Math.abs(c)-i)}}paint(e,i,s){super.paint(e,i,s),this.paintBeams(e,i,s,ht.StandardNotationFlags,ht.StandardNotationBeams),this.paintTuplets(e,i,s,ht.StandardNotationTuplet)}getSlashFlagY(e,i){let s=(this.heightLineCount-1)/2,r=0;switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:r+=2;break;default:r+=1}return i===B.Down?s+=r:s-=r,this.getLineY(s)}getFlagTopY(e,i){return e.slashed?this.getSlashFlagY(e.duration,i):this.getScoreY(this.accidentalHelper.getMinLine(e))}getFlagBottomY(e,i){return e.slashed?this.getSlashFlagY(e.duration,i):this.getScoreY(this.accidentalHelper.getMaxLine(e))}getBeamDirection(e){return e.direction}getStemSize(e,i=!1){let s=1===e.beats.length?this.getFlagStemSize(e.shortestDuration,i):this.getBarStemSize(e.shortestDuration);return e.isGrace&&(s*=gt.GraceScale),s}getBarStemSize(e){let i=0;switch(e){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:i=6;break;case w.ThirtySecond:i=8;break;case w.SixtyFourth:case w.OneHundredTwentyEighth:i=9;break;case w.TwoHundredFiftySixth:i=10;break;default:i=0}return this.getScoreHeight(i)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,i){if(e.beat.slashed)return this.getLineY((this.heightLineCount-1)/2);let s=super.getNoteY(e,i);if(Number.isNaN(s)){const r=Js.computeLineWithoutAccidentals(this.bar,e);s=this.getScoreY(r)}return s}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){const i=this.getScoreY(-2),s=this.getScoreY(10),r=this.helpers.collisionHelper.getBeatMinMaxY();r[0]<i&&this.registerOverflowTop(Math.abs(r[0])),r[1]>s&&this.registerOverflowBottom(Math.abs(r[1])-s)}return e}calculateBeamYWithDirection(e,i,s){const r=this.getStemSize(e);if(!e.drawingInfos.has(s)){const a=new ej;e.drawingInfos.set(s,a);const o=e.beats[0],l=e.beats[e.beats.length-1],c=e.isRestBeamHelper;a.startBeat=o,a.startX=e.getBeatLineX(o),a.startY=c?this.getScoreY(s===B.Up?e.minRestLine:e.maxRestLine):s===B.Up?this.getFlagTopY(o,s)-r:this.getFlagBottomY(o,s)+r,a.endBeat=l,a.endX=e.getBeatLineX(l),a.endY=c?this.getScoreY(s===B.Up?e.minRestLine:e.maxRestLine):s===B.Up?this.getFlagTopY(l,s)-r:this.getFlagBottomY(l,s)+r;const u=10;if(s===B.Down&&a.startY>a.endY&&a.startY-a.endY>u&&(a.endY=a.startY-u),s===B.Down&&a.endY>a.startY&&a.endY-a.startY>u&&(a.startY=a.endY-u),s===B.Up&&a.startY<a.endY&&a.endY-a.startY>u&&(a.endY=a.startY+u),s===B.Up&&a.endY<a.startY&&a.startY-a.endY>u&&(a.startY=a.endY+u),e.beats.length>1){if(s===B.Up){const h=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-r,p=a.calcY(e.getBeatLineX(e.beatOfHighestNote))-h;p>0&&(a.startY-=p,a.endY-=p)}else{const p=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+r-a.calcY(e.getBeatLineX(e.beatOfLowestNote));p>0&&(a.startY+=p,a.endY+=p)}if(null!==e.minRestLine||null!==e.maxRestLine){let p=(H.getIndex(e.shortestDuration)-2)*(Ct.BeamSpacing+Ct.BeamThickness)*(e.isGrace?gt.GraceScale:1);if(p+=Ct.BeamSpacing,s===B.Up&&null!==e.minRestLine){const g=this.getScoreY(e.minRestLine)-p,y=a.calcY(e.getBeatLineX(e.beatOfMinRestLine))-g;y>0&&(a.startY-=y,a.endY-=y)}else if(s===B.Down&&null!==e.maxRestLine){const y=this.getScoreY(e.maxRestLine)+p-a.calcY(e.getBeatLineX(e.beatOfMaxRestLine));y>0&&(a.startY+=y,a.endY+=y)}}if(e.slashBeats.length>0)for(const h of e.slashBeats){const f=a.calcY(e.getBeatLineX(h));let p=this.getSlashFlagY(h.duration,s);s===B.Up?p-=r:s===B.Down&&(p+=r);const g=p-f;g>0&&(a.startY+=g,a.endY+=g)}}}return e.drawingInfos.get(s).calcY(i)}getBarLineStart(e,i){return e.slashed?this.getSlashFlagY(e.duration,i):this.getScoreY(i===B.Up?this.accidentalHelper.getMaxLine(e):this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){let e=!1;if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let i=0;switch(this.bar.clef){case Be.Neutral:i=this.bar.staff.standardNotationLineCount-1;break;case Be.F4:i=2;break;case Be.C3:i=4;break;case Be.C4:i=2;break;case Be.G2:i=6}this.createStartSpacing(),this.addPreBeatGlyph(new h_(0,this.getScoreY(i)+.5*Ct.StaffLineThickness,this.bar.clef,this.bar.clefOttava)),e=!0}(e||0===this.index&&this.bar.keySignature!==De.C||this.bar.previousBar&&this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let e=0;const i=this.bar.keySignature,s=this.bar.previousBar?this.bar.previousBar.keySignature:0;switch(this.bar.clef){case Be.Neutral:e=0;break;case Be.G2:e=1;break;case Be.F4:e=3;break;case Be.C3:e=2;break;case Be.C4:e=0}const r=new mq;r.renderer=this;const a=new Map,o=[];if(H.keySignatureIsSharp(i))for(let l=0;l<Math.abs(i);l++){const c=n.SharpKsSteps[l]+e;o.push(new Pr(0,this.getScoreY(c),le.Sharp,1)),a.set(c,!0)}else for(let l=0;l<Math.abs(i);l++){const c=n.FlatKsSteps[l]+e;o.push(new Pr(0,this.getScoreY(c),le.Flat,1)),a.set(c,!0)}if(this.bar.keySignature===De.C){const l=Math.abs(s),c=H.keySignatureIsSharp(s)?n.SharpKsSteps:n.FlatKsSteps;for(let u=0;u<l;u++)a.has(c[u]+e)||r.addGlyph(new Pr(0,this.getScoreY(c[u]+e),le.Natural,1))}for(const l of o)r.addGlyph(l);this.addPreBeatGlyph(r)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Hn(0,0,5)),this.addPreBeatGlyph(new p_(0,this.getScoreY(this.bar.staff.standardNotationLineCount-1),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const i of e.beats){const s=new uq(i,this.getVoiceContainer(e));s.preNotes=new oq,s.onNotes=new iq,this.addBeatGlyph(s)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let i=this.getNoteY(e.highestNoteInHelper,Z.Center),s=this.getNoteY(e.lowestNoteInHelper,Z.Center),r=this.getStemSize(e);e.hasTuplet&&(r+=2*this.resources.effectFont.size),e.direction===B.Up?i-=r:s+=r;for(const a of e.beats)this.helpers.collisionHelper.reserveBeatSlot(a,i,s)}}paintBeamingStem(e,i,s,r,a,o){const l=Ce.beat(o,ht.StandardNotationStem,e);try{o.lineWidth=Ct.StemWidth,o.beginPath(),o.moveTo(s,r),o.lineTo(s,a),o.stroke(),o.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return n.StaffId="score",n.SharpKsSteps=[-1,2,-2,1,4,0,3],n.FlatKsSteps=[3,0,4,1,5,2,6],n})();class yq extends Xh{get staffId(){return y_.StaffId}getStaffPaddingTop(t){return t.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(t){return t.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(t,e){return new y_(t,e)}canCreate(t,e){return super.canCreate(t,e)&&e.showStandardNotation}}class bq extends Pt{constructor(t,e,i,s){super(0,0),this._inType=t,this._outType=e,this._startNote=i,this._parent=s}doLayout(){this.width=0}paint(t,e,i){this.paintSlideIn(t,e,i),this.paintSlideOut(t,e,i)}paintSlideIn(t,e,i){const s=this.renderer;let o=0,l=0,c=0,u=0;switch(this._inType){case pn.IntoFromBelow:c=t+s.x+s.getNoteX(this._startNote,wt.Left)-2,u=e+s.y+s.getNoteY(this._startNote,Z.Center),o=c-12,l=e+s.y+s.getNoteY(this._startNote,Z.Center)+3;break;case pn.IntoFromAbove:c=t+s.x+s.getNoteX(this._startNote,wt.Left)-2,u=e+s.y+s.getNoteY(this._startNote,Z.Center),o=c-12,l=e+s.y+s.getNoteY(this._startNote,Z.Center)-3;break;default:return}this.paintSlideLine(i,!1,o,c,l,u)}paintSlideOut(t,e,i){const s=this.renderer;let o=0,l=0,c=0,u=0,h=!1;switch(this._outType){case Se.Shift:case Se.Legato:if(o=t+s.x+s.getBeatX(this._startNote.beat,xe.PostNotes)+2,l=e+s.y+s.getNoteY(this._startNote,Z.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);p&&p.staff===s.staff?(c=t+p.x+p.getBeatX(this._startNote.slideTarget.beat,xe.OnNotes)-2,u=e+p.y+p.getNoteY(this._startNote.slideTarget,Z.Center)):(c=t+s.x+s.width,u=l),this._startNote.slideTarget.fret>this._startNote.fret?(l+=3,u-=3):(l-=3,u+=3)}else c=t+s.x+this._parent.x,u=l;break;case Se.OutUp:o=t+s.x+s.getNoteX(this._startNote,wt.Right)+2,l=e+s.y+s.getNoteY(this._startNote,Z.Center),c=o+12,u=e+s.y+s.getNoteY(this._startNote,Z.Center)-3;break;case Se.OutDown:o=t+s.x+s.getNoteX(this._startNote,wt.Right)+2,l=e+s.y+s.getNoteY(this._startNote,Z.Center),c=o+12,u=e+s.y+s.getNoteY(this._startNote,Z.Center)+3;break;case Se.PickSlideDown:o=t+s.x+s.getNoteX(this._startNote,wt.Right)+4,l=e+s.y+s.getNoteY(this._startNote,Z.Center),c=t+s.x+s.width,u=l+9,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=t+s.x+s.getBeatX(this._startNote.beat.nextBeat,xe.PreNotes)),h=!0;break;case Se.PickSlideUp:o=t+s.x+s.getNoteX(this._startNote,wt.Right)+4,l=e+s.y+s.getNoteY(this._startNote,Z.Center),c=t+s.x+s.width,u=l-9,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=t+s.x+s.getBeatX(this._startNote.beat.nextBeat,xe.PreNotes)),h=!0;break;default:return}this.paintSlideLine(i,h,o,c,l,u)}paintSlideLine(t,e,i,s,r,a){if(e){const o=new Qa(0,0,Ie.Slight,1.2);o.renderer=this.renderer,o.doLayout();const l=s-i,c=(a-=o.height/2)-(r-=o.height/2),u=Math.sqrt(Math.pow(c,2)+Math.pow(l,2));o.width=l;const h=Math.asin(c/u)*(180/Math.PI);t.beginRotate(i,r,h),o.paint(0,0,t),t.endRotate()}else t.beginPath(),t.moveTo(i,r),t.lineTo(s,a),t.stroke()}}class aa extends bs{constructor(t,e,i=!1){super(t.beat,e.beat,i),this.startNote=t,this.endNote=e}getTieHeight(t,e,i,s){return this.startNote===this.endNote?15:super.getTieHeight(t,e,i,s)}getBeamDirection(t,e){return this.startNote===this.endNote?B.Up:aa.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(t){return t.string>3?B.Up:B.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,this.startNote===this.endNote?Z.Center:this.tieDirection===B.Up?Z.Top:Z.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,wt.Center)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,this.startNote===this.endNote?wt.Left:wt.Center)}}class TM extends aa{constructor(t,e,i,s=!1){super(t,e,s),this._direction=aa.getBeamDirectionForNote(t),this._forSlide=i}getTieHeight(t,e,i,s){return Math.log(i-t+1)*this.renderer.settings.notation.slurHeight}tryExpand(t,e,i,s){if(this._forSlide!==i||this.forEnd!==s||this.startNote.beat.id!==t.beat.id||this.endNote.beat.id!==e.beat.id||this._direction!==aa.getBeamDirectionForNote(t))return!1;switch(this._direction){case B.Up:t.realValue>this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue>this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat);break;case B.Down:t.realValue<this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue<this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat)}return!0}paint(t,e,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),r=this.getBeamDirection(this.startBeat,s),a=`tab.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${r}`,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(t,e,i))}}class wq extends Zs{constructor(){super(...arguments),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(t){return t.hasFlag(this.renderer.drawBeamHelperAsFlags(t),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(t){if(!t.isVisible)return;const e=this.renderer;if(t.isTieOrigin&&e.showTiedNotes&&t.tieDestination.isVisible){const i=new aa(t,t.tieDestination,!1);this.addTie(i)}if(t.isTieDestination&&e.showTiedNotes){const i=new aa(t.tieOrigin,t,!0);this.addTie(i)}if(t.isLeftHandTapped&&!t.isHammerPullDestination){const i=new aa(t,t,!1);this.addTie(i)}if(t.isEffectSlurOrigin&&t.effectSlurDestination){let i=!1;for(const s of this._effectSlurs)if(s.tryExpand(t,t.effectSlurDestination,!1,!1)){i=!0;break}if(!i){const s=new TM(t,t.effectSlurDestination,!1,!1);this._effectSlurs.push(s),this.addTie(s)}}if(t.isEffectSlurDestination&&t.effectSlurOrigin){let i=!1;for(const s of this._effectSlurs)if(s.tryExpand(t.effectSlurOrigin,t,!1,!0)){i=!0;break}if(!i){const s=new TM(t.effectSlurOrigin,t,!1,!0);this._effectSlurs.push(s),this.addTie(s)}}if(t.slideInType!==pn.None||t.slideOutType!==Se.None){const i=new bq(t.slideInType,t.slideOutType,t,this);this.addTie(i)}if(t.hasBend){if(!this._bend){const i=new gM;this._bend=i,i.renderer=this.renderer,this.addTie(i)}this._bend.addBends(t)}}}class Sq extends Pt{constructor(t,e,i){super(t,e),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=i}doLayout(){const t=this._note;let e=t.fret-t.beat.voice.bar.staff.transpositionPitch;if(t.harmonicType===ae.Natural&&0!==t.harmonicValue&&(e=t.harmonicValue-t.beat.voice.bar.staff.transpositionPitch),t.isTieDestination)this._noteString=0===t.beat.index&&this.renderer.settings.notation.notationMode===_n.GuitarPro||(t.bendType===J.Bend||t.bendType===J.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(Te.TabNotesOnTiedBends)?`(${(t.tieOrigin.fret-t.beat.voice.bar.staff.transpositionPitch).toString()})`:"";else if(this._noteString=t.isDead?"x":e.toString(),t.isGhost)this._noteString=`(${this._noteString})`;else if(t.harmonicType===ae.Natural){const i=this._noteString.indexOf(".");i>=0&&(this._noteString=this._noteString.substr(0,i+2)),this._noteString=`<${this._noteString}>`}if(t.isTrill)this._trillNoteString=`(${(t.trillFret-t.beat.voice.bar.staff.transpositionPitch).toString()})`;else if(H.isAlmostEqualTo(t.harmonicValue,0))this._trillNoteString="";else switch(t.harmonicType){case ae.Artificial:case ae.Pinch:case ae.Tap:case ae.Semi:case ae.Feedback:let i=(e+t.harmonicValue).toString();const s=i.indexOf(".");s>=0&&(i=i.substr(0,s+2)),this._trillNoteString=`<${i}>`;break;default:this._trillNoteString=""}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(t,e,i){if(this.isEmpty)return;const r=t+this.x+(this.width-(this.noteStringWidth+this._trillNoteStringWidth))/2;this.paintTrill(r,e,i);const a=Ce.note(i,si.GuitarTabFretNumber,this._note);try{i.fillText(this._noteString,r,e+this.y)}finally{a?.[Symbol.dispose]?.()}}paintTrill(t,e,i){const s=Ce.note(i,si.GuitarTabFretNumber,this._note);try{const r=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,i.fillText(this._trillNoteString,t+this.noteStringWidth+3,e+this.y),this.renderer.scoreRenderer.canvas.font=r}finally{s?.[Symbol.dispose]?.()}}buildBoundingsLookup(t,e,i){const s=new Bc;s.note=this._note,s.noteHeadBounds=new kn,s.noteHeadBounds.x=e+this.x,s.noteHeadBounds.y=i+this.y-this.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,t.addNote(s)}}class _q extends Pt{constructor(t,e,i){super(t,e),this._notes=[],this._deadSlapped=null,this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=i}buildBoundingsLookup(t,e,i){for(const s of this._notes)s.buildBoundingsLookup(t,e+this.x,i+this.y)}getNoteX(t,e){if(this.notesPerString.has(t.string)){const i=this.notesPerString.get(t.string);let s=this.x+i.x;switch(e){case wt.Left:break;case wt.Center:s+=i.noteStringWidth/2;break;case wt.Right:s+=i.width}return s}return 0}getNoteY(t,e){if(this.notesPerString.has(t.string)){const i=this.notesPerString.get(t.string);let s=this.y+i.y;switch(e){case Z.Top:case Z.TopWithStem:s-=i.height/2+2;break;case Z.Center:break;case Z.Bottom:case Z.BottomWithStem:s+=i.height/2}return s}return 0}doLayout(){let t=0;if(this.beat.deadSlapped)this._deadSlapped=new Kg,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),t=this._deadSlapped.width,this.noteStringWidth=t;else{let e=0;for(let a=0,o=this._notes.length;a<o;a++){const l=this._notes[a];l.renderer=this.renderer,l.doLayout(),l.width>t&&(t=l.width),l.noteStringWidth>e&&(e=l.noteStringWidth)}this.noteStringWidth=e;const i=this.renderer.resources.tablatureFont.size;let s=this.getNoteY(this.minStringNote,Z.Center)+i/2;const r=7;for(const a of this.beatEffects.values())a.y+=s,a.x+=this.width/2,a.renderer=this.renderer,s+=r,a.doLayout()}this.width=t}addNoteGlyph(t,e){this._notes.push(t),this.notesPerString.set(e.string,t),(!this.minStringNote||e.string<this.minStringNote.string)&&(this.minStringNote=e)}paint(t,e,i){if(t+=this.x,e+=this.y,this.beat.deadSlapped)this._deadSlapped?.paint(t,e,i);else{const s=this.renderer.resources,r=i.textBaseline;i.textBaseline=ge.Middle,i.font=this._isGrace?s.graceFont:s.tablatureFont;const a=this._notes,o=this.width;for(const c of a)c.renderer=this.renderer,c.width=o,c.paint(t,e,i);i.textBaseline=r;const l=Ce.beat(i,ht.GuitarTabEffects,this.beat);try{for(const c of this.beatEffects.values())c.paint(t,e,i)}finally{l?.[Symbol.dispose]?.()}}}updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,t+this.x+this.width/2,t+this.x+this.width/2)}}class vq extends sn{constructor(t,e,i,s){super(t,e,1,Zh.getSymbol(s)),this._isVisibleRest=i}doLayout(){super.doLayout(),this._isVisibleRest||(this.width=10)}updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,t+this.x+this.width/2,t+this.x+this.width/2)}paint(t,e,i){if(this._isVisibleRest){const s=Ce.beat(i,ht.GuitarTabRests,this.beat);try{super.paint(t,e,i)}finally{s?.[Symbol.dispose]?.()}}}}class Tq extends Xa{constructor(){super(...arguments),this.slash=null,this.noteNumbers=null,this.restGlyph=null}get effectElement(){return ht.GuitarTabEffects}getNoteX(t,e){return this.noteNumbers?this.noteNumbers.getNoteX(t,e):0}getNoteY(t,e){return this.noteNumbers?this.noteNumbers.getNoteY(t,e):0}buildBoundingsLookup(t,e,i){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(t,e+this.x,i+this.y)}doLayout(){const t=this.renderer;if(this.container.beat.isRest){const i=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),s=t.getTabY(i),r=new vq(0,s,t.showRests,this.container.beat.duration);if(this.restGlyph=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r),this.container.beat.dots>0&&t.showRests){this.addNormal(new Hn(0,0,5));for(let a=0;a<this.container.beat.dots;a++)this.addEffect(new Kh(0,s,1.5))}}else{const i=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==re.None;let s;if(this.container.beat.slashed&&!this.container.beat.notes.some(r=>r.isTieDestination)){const r=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),a=t.getLineY(r),o=new ed(0,a,this.container.beat.duration,i,this.container.beat);o.noteHeadElement=si.GuitarTabFretNumber,o.effectElement=ht.GuitarTabEffects,this.slash=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper,this.addNormal(o),s=o.beatEffects}else{const r=new _q(0,0,i);this.noteNumbers=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper;for(const a of this.container.beat.notes)a.isVisible&&this.createNoteGlyph(a);this.addNormal(r),s=r.beatEffects}if(this.container.beat.hasWhammyBar){const r=new mM(this.container.beat);r.renderer=this.renderer,r.doLayout(),this.container.ties.push(r)}if(this.container.beat.isTremolo&&!s.has("tremolo")){let r=0;const a=this.container.beat.tremoloSpeed;let o=5;switch(a){case w.ThirtySecond:r=10;break;case w.Sixteenth:r=5;break;case w.Eighth:r=0}this.container.beat.duration<w.Half&&(o=0),s.set("tremolo",new Qg(o,r,a))}if(this.container.beat.dots>0&&t.rhythmMode!==Xs.Hidden){this.addNormal(new Hn(0,0,5));for(let r=0;r<this.container.beat.dots;r++)this.addEffect(new Kh(0,t.lineOffset*t.bar.staff.tuning.length+t.settings.notation.rhythmHeight,1.5))}}if(this.isEmpty)return;let e=0;for(let i=0,s=this.glyphs.length;i<s;i++){const r=this.glyphs[i];r.x=e,r.renderer=this.renderer,r.doLayout(),e+=r.width}this.width=e,this.computedWidth=e,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(t){const e=this.renderer,i=new Sq(0,0,t);i.y=e.getTabY(t.beat.voice.bar.staff.tuning.length-t.string),i.renderer=this.renderer,i.doLayout(),this.noteNumbers.addNoteGlyph(i,t);const r=i.y-i.height/2;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,r,r+i.height)}}class kq extends Pt{constructor(t){super(0,0),this._beat=t}doLayout(){this.width=10}paint(t,e,i){const s=this.renderer,r=e+this.x+s.getNoteY(this._beat.maxStringNote,Z.Top),a=e+this.y+s.getNoteY(this._beat.minStringNote,Z.Bottom),o=t+this.x+this.width/2|0;if(this._beat.brushType!==Y.None){if(this._beat.brushType===Y.BrushUp||this._beat.brushType===Y.BrushDown)i.beginPath(),i.moveTo(o,r),i.lineTo(o,a),i.stroke();else if(this._beat.brushType===Y.ArpeggioUp){const c=new Qa(0,0,Ie.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();const h=a-8;c.width=Math.abs(h-r),i.beginRotate(t+this.x+4,h,-90),c.paint(0,-c.height/2,i),i.endRotate()}else if(this._beat.brushType===Y.ArpeggioDown){const c=new Qa(0,0,Ie.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();const u=r+8;c.width=Math.abs(a-u),i.beginRotate(t+this.x+4,u,90),c.paint(0,-c.height/2,i),i.endRotate()}this._beat.brushType===Y.BrushUp||this._beat.brushType===Y.ArpeggioUp?(i.beginPath(),i.moveTo(o,a),i.lineTo(o+4,a-8),i.lineTo(o-4,a-8),i.closePath(),i.fill()):(i.beginPath(),i.moveTo(o,r),i.lineTo(o+4,r+8),i.lineTo(o-4,r+8),i.closePath(),i.fill())}}}class Cq extends Ya{doLayout(){this.container.beat.brushType!==Y.None&&!this.container.beat.isRest&&(this.addEffect(new kq(this.container.beat)),this.addNormal(new Hn(0,0,4))),super.doLayout()}get effectElement(){return ht.GuitarTabEffects}}class Dq extends Pt{doLayout(){this.width=Xe.Widths.get(d.SixStringTabClef)}paint(t,e,i){const s=Ce.bar(i,Le.GuitarTabsClef,this.renderer.bar);try{const r=this.renderer.bar.staff.tuning.length;i.fillMusicFontSymbol(t+this.x+5,e+this.y,r<=4?r/4.5:r/6.5,r<=4?d.FourStringTabClef:d.SixStringTabClef,!1)}finally{s?.[Symbol.dispose]?.()}}}class Nq extends wM{doLayout(){this.barSubElement=Le.GuitarTabsTimeSignature,super.doLayout()}get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?gt.GraceScale:1}}let b_=(()=>{class n extends Ir{get showMultiBarRest(){return this._showMultiBarRest}get repeatsBarSubElement(){return Le.GuitarTabsRepeats}get barNumberBarSubElement(){return Le.GuitarTabsBarNumber}get barLineBarSubElement(){return Le.GuitarTabsBarLines}get staffLineBarSubElement(){return Le.GuitarTabsStaffLine}constructor(e,i){super(e,i),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1,this._showMultiBarRest=!1,i.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0,this._showMultiBarRest=!0)}get lineSpacing(){return n.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}get rhythmMode(){let e=this.settings.notation.rhythmMode;return e===Xs.Automatic&&(e=this.bar.staff.showStandardNotation?Xs.Hidden:Xs.ShowWithBars),e}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){for(const s of this.bar.voices)if(this.hasVoiceContainer(s)){const r=this.getVoiceContainer(s);for(const a of r.beatGlyphs){const o=a.onNotes,l=o.noteNumbers;if(l)for(const[c,u]of l.notesPerString)u.isEmpty||e[this.bar.staff.tuning.length-c].push(new Float32Array([r.x+a.x+o.x+l.x,l.width+1]))}}}adjustSizes(){this.rhythmMode!==Xs.Hidden&&(this.height+=this.settings.notation.rhythmHeight,this.bottomPadding+=this.settings.notation.rhythmHeight)}doLayout(){if(super.doLayout(),this.rhythmMode!==Xs.Hidden){this._hasTuplets=!1;for(const e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){this.isFirstOfLine&&this.addPreBeatGlyph(new Dq(5,this.getTabY((this.bar.staff.tuning.length-1)/2))),this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Hn(0,0,5)),this.addPreBeatGlyph(new Nq(0,this.getTabY((this.bar.staff.tuning.length+1)/2-1),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){if(this.additionalMultiRestBars){const i=new Yg(this.getVoiceContainer(e));this.addBeatGlyph(i)}else for(const i of e.beats){const s=new wq(i,this.getVoiceContainer(e));s.preNotes=new Cq,s.onNotes=new Tq,this.addBeatGlyph(s)}}paint(e,i,s){super.paint(e,i,s),this.rhythmMode!==Xs.Hidden&&(this.paintBeams(e,i,s,ht.GuitarTabFlags,ht.GuitarTabBeams),this.paintTuplets(e,i,s,ht.GuitarTabTuplet))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.rhythmMode===Xs.ShowWithBeams}getFlagTopY(e,i){const s=this.getOnNotesGlyphForBeat(e);return s.noteNumbers&&e.duration!==w.Half?s.noteNumbers.getNoteY(s.noteNumbers.minStringNote,Z.Bottom):this.height-this.settings.notation.rhythmHeight-this.tupletSize}getFlagBottomY(e,i){return this.getFlagAndBarPos()}getFlagStemSize(e,i=!1){return 0}getBarLineStart(e,i){const s=this.getOnNotesGlyphForBeat(e);return s.noteNumbers&&e.duration!==w.Half?s.noteNumbers.getNoteY(s.noteNumbers.minStringNote,Z.Bottom)+this.lineOffset/2:this.height-this.settings.notation.rhythmHeight-this.tupletSize}getBeamDirection(e){return B.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,i,s){return this.getFlagAndBarPos()}shouldPaintFlag(e,i){return!(!super.shouldPaintFlag(e,i)||e.graceType!==re.None)&&this.drawBeamHelperAsFlags(i)}paintBeamingStem(e,i,s,r,a,o){if(a<r){const c=a;a=r,r=c}const l=Ce.beat(o,ht.GuitarTabStem,e);try{o.lineWidth=Ct.StemWidth,o.beginPath();let c=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(c=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),c.sort((h,f)=>h.topY-f.topY));let u=a;for(;u>r;){o.moveTo(s,u);let h=r;if(!(c.length>0&&c[c.length-1].bottomY>h)){o.lineTo(s,h);break}{const f=c.pop();h=i+f.bottomY,o.lineTo(s,h),u=i+f.topY}}o.stroke(),o.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return n.StaffId="tab",n.TabLineSpacing=10,n})();class w_ extends Xh{get staffId(){return b_.StaffId}getStaffPaddingTop(t){return t.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(t){return t.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.showTimeSignature=null,this.showRests=null,this.showTiedNotes=null,this.hideOnPercussionTrack=!0}canCreate(t,e){return e.showTablature&&e.tuning.length>0&&super.canCreate(t,e)}create(t,e){const i=new b_(t,e);return null!==this.showRests&&(i.showRests=this.showRests),null!==this.showTimeSignature&&(i.showTimeSignature=this.showTimeSignature),null!==this.showTiedNotes&&(i.showTiedNotes=this.showTiedNotes),i}}let xq=(()=>{class n extends Gi{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=this.renderer.resources.effectFont.size+n.Padding}paint(e,i,s){s.font=this.renderer.resources.effectFont;const a=s.textAlign;s.textAlign=K.Center,s.fillText("T",e+this.x,i+this.y+s.font.size/2),s.textAlign=a,s.strokeCircle(e+this.x,i+this.y+s.font.size/2+(n.Padding-1),s.font.size/1.6)}}return n.Padding=4,n})();class kM extends Jo{get notationElement(){return Te.EffectTap}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyphForNote(t){return t.isLeftHandTapped}createNewGlyph(t,e){return new xq}}class oa{constructor(){this.noteRange=1,this.x=0,this.y=0}}var Mc=function(n){return n[n.None=0]="None",n[n.Rectangle=1]="Rectangle",n[n.Ellipse=2]="Ellipse",n[n.Circle=3]="Circle",n}(Mc||{});class S_ extends oa{constructor(){super(...arguments),this.align=K.Left,this.frame=Mc.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class CM extends oa{constructor(){super(...arguments),this.chord=new Qr}}class DM extends oa{}class NM extends oa{}class Eq extends oa{constructor(){super(...arguments),this.number=0}}class xM extends oa{constructor(){super(...arguments),this.decrescendo=!1}}class __ extends oa{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class Bq extends oa{constructor(){super(...arguments),this.octave=1}}class Pq extends oa{}class Iq{constructor(){this.defaultClef=Be.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class Mq{constructor(){this.from=0,this.to=0,this.curly=!1}}class Aq{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class em{constructor(){this._trackChannel=0,this._beamingMode=St.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new Cr,this._voiceStates=new Map}parseXml(t,e){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;const i=new Ph;try{i.parse(t)}catch(s){throw new Ht("Could not parse XML",s)}this.parseDom(i),this.consolidate(),this.score.finish(e)}consolidate(){H.consolidate(this.score),em.applyEffectRange(this._slurs,(t,e)=>{e.isLegatoOrigin=!0}),em.applyEffectRange(this._crescendo,(t,e)=>{e.crescendo=t.decrescendo?ii.Decrescendo:ii.Crescendo})}static applyEffectRange(t,e){for(const[i,s]of t){const r=s.noteRange;let a=i;for(let o=0;o<r;o++)if(e(s,a),a.index+1<a.voice.beats.length)a=a.voice.beats[a.index+1];else{if(!(a.voice.bar.index+1<a.voice.bar.staff.bars.length))break;a=a.voice.bar.staff.bars[a.voice.bar.index+1].voices[a.voice.index].beats[0]}}}parseDom(t){const e=t.firstElement;if(!e)throw new Ht("No valid XML");if("score"!==e.localName)throw new Ht('Root node of XML was not "score"');this.score=new Dr,this.score.tempo=120;for(const i of e.childElements())switch(i.localName){case"info":this.parseInfo(i);break;case"layout":this.parseLayout(i);break;case"gallery":this.parseGallery(i);break;case"pageObjects":this.parsePageObjects(i);break;case"systems":this.parseSystems(i)}}parseLayout(t){for(const r of t.childElements())switch(r.localName){case"staves":this.parseLayoutStaves(r);break;case"brackets":this.parseBrackets(r)}const e=this._brackets.filter(r=>!!r.curly);e.sort((r,a)=>r.from-a.from);let i=0,s=null;for(let r=0;r<this._staffLayouts.length;r++){const a=this._staffLayouts[r];for(;i<e.length&&r>e[i].to;)i++;s&&i<e.length&&r>e[i].from&&r<=e[i].to?s.ensureStaveCount(s.staves.length+1):(s=new Wo,s.ensureStaveCount(1),s.name=a.description,s.playbackInfo.volume=Math.floor(a.volume/128*16),s.playbackInfo.program=a.instrument,a.percussion?(s.playbackInfo.primaryChannel=9,s.playbackInfo.secondaryChannel=9):(s.playbackInfo.primaryChannel=this._trackChannel++,s.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(s));const o=s.staves[s.staves.length-1];o.isPercussion=a.percussion,o.transpositionPitch=a.transpose,o.displayTranspositionPitch=0,o.showTablature=!1,this._staffLookup.set(a.index,o)}}parseBrackets(t){for(const e of t.childElements())"bracket"===e.localName&&this.parseBracket(e)}parseBracket(t){const e=new Mq;e.from=Number.parseInt(t.getAttribute("from")),e.to=Number.parseInt(t.getAttribute("to")),t.attributes.has("curly")&&(e.curly="true"===t.attributes.get("curly")),this._brackets.push(e)}parseLayoutStaves(t){for(const e of t.childElements())"staffLayout"===e.localName&&this.parseStaffLayout(e)}parseStaffLayout(t){const e=new Iq;e.description=t.getAttribute("description");for(const i of t.childElements())switch(i.localName){case"notation":i.attributes.has("defaultClef")&&(e.defaultClef=this.parseClef(i.attributes.get("defaultClef")));break;case"sound":i.attributes.has("percussion")&&(e.percussion="true"===i.attributes.get("percussion")),i.attributes.has("instr")&&(e.instrument=Number.parseInt(i.attributes.get("instr"))),i.attributes.has("volume")&&(e.volume=Number.parseInt(i.attributes.get("volume"))),i.attributes.has("transpose")&&(e.transpose=Number.parseInt(i.attributes.get("transpose")))}this._staffLayoutLookup.set(e.description,e),e.index=this._staffLayouts.length,this._staffLayouts.push(e)}parseClef(t){switch(t){case"treble":return Be.G2;case"bass":return Be.F4;case"alto":case"tenor":return Be.C4}return Be.G2}parseClefOttava(t){return t.endsWith("-")?we._8vb:t.endsWith("+")?we._8va:we.Regular}parseSystems(t){for(const e of t.childElements())"system"===e.localName&&this.parseSystem(e)}parseSystem(t){t.attributes.has("tempo")&&0===this.score.masterBars.length&&(this.score.tempo=Number.parseInt(t.attributes.get("tempo"))),"0"===t.getAttribute("beamGrouping")&&(this._beamingMode=St.ForceSplitToNext);for(const e of t.childElements())"staves"===e.localName&&this.parseStaves(t,e);this._isFirstSystem=!1}parseStaves(t,e){const i=this.score.masterBars.length;for(const s of e.childElements())"staff"===s.localName&&this.parseStaff(t,i,s)}parseStaff(t,e,i){const s=i.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(s),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(i.getAttribute("defaultTime"));const r=this._staffLookup.get(this._currentStaffLayout.index);for(;r.bars.length<e;)this.addNewBar(r);for(const a of i.childElements())"voices"===a.localName&&this.parseVoices(s,r,t,e,a)}parseTime(t){switch(t){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(t.indexOf("/")>0){const e=t.split("/");this._timeSignature.timeSignatureNumerator=Number.parseInt(e[0]),this._timeSignature.timeSignatureDenominator=Number.parseInt(e[1]),this._timeSignature.timeSignatureCommon=!1}}}parseVoices(t,e,i,s,r){let a=0;for(const o of r.childElements())"voice"===o.localName&&(this.parseVoice(t,e,i,a,s,o),a++)}getOrCreateBar(t,e){return e<t.bars.length?t.bars[e]:this.addNewBar(t)}addNewBar(t){const e=new vr;if(t.bars.length>0?(e.clef=t.bars[t.bars.length-1].clef,e.clefOttava=t.bars[t.bars.length-1].clefOttava,e.keySignature=t.bars[t.bars.length-1].keySignature,e.keySignatureType=t.bars[t.bars.length-1].keySignatureType):e.clef=this._currentStaffLayout.defaultClef,t.addBar(e),t.bars.length>this.score.masterBars.length){const i=new Cr;this.score.addMasterBar(i),i.index>0&&(i.tripletFeel=i.previousMasterBar.tripletFeel),i.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,i.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,i.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return e}newBar(t,e){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(t,e)}parseVoice(t,e,i,s,r,a){const o=`${t}_${s}`;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this.ensureVoice(e,s)):(this._currentVoiceState=new Aq,this._currentVoiceState.currentBarIndex=r-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(e,s)),a.attributes.has("stemDir"))switch(a.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=B.Up;break;case"down":this._currentVoiceState.voiceStemDir=B.Down;break;default:this._currentVoiceState.voiceStemDir=null}else this._currentVoiceState.voiceStemDir=null;const l=a.findChildElement("noteObjects");if(i.attributes.has("tempo")){const c=new Xt;c.isLinear=!0,c.type=Bt.Tempo,c.value=Number.parseInt(i.attributes.get("tempo")),c.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(c)}if(l)for(const c of l.childElements())switch(this._currentVoiceState.currentBarComplete&&"barline"!==c.localName&&this.newBar(e,s),c.localName){case"clefSign":this._currentBar.clef=this.parseClef(c.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(c.getAttribute("clef"));break;case"keySign":this._currentBar.keySignature=Number.parseInt(c.getAttribute("fifths"));break;case"timeSign":this.parseTime(c.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(c.getAttribute("type")){case"double":this._currentBar.barLineRight=pe.LightLight,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(c),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(e,s),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(c),this.newBar(e,s),this._currentBar.masterBar.isRepeatStart=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0}break;case"chord":const u=new Vn;this.initFromPreviousBeat(u,this._currentVoice),u.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(u.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,u,c.findChildElement("duration")),u.updateDurations(),this._currentVoiceState.currentPosition+=u.playbackDuration,this._currentVoice.addBeat(u),this.parseChord(u,c),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const h=this.parseRestDurations(this._currentBar,c.findChildElement("duration"));h&&(this.initFromPreviousBeat(h,this._currentVoice),h.updateDurations(),this._currentVoiceState.currentPosition+=h.playbackDuration,this._currentVoice.addBeat(h),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0))}}initFromPreviousBeat(t,e){const i=this.getLastBeat(e);i&&(t.dynamics=i.dynamics)}getLastBeat(t){if(t.beats.length>0)return t.beats[t.beats.length-1];if(t.bar.index>0){const e=t.bar.staff.bars[t.bar.index-1];if(t.index<e.voices.length)return this.getLastBeat(e.voices[t.index])}return null}ensureVoice(t,e){for(;this._currentBar.voices.length<e+1;)this._currentBar.addVoice(new Fi);(!this._voiceCounts.has(t.track.index)||this._voiceCounts.get(t.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(t.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[e]}parseChord(t,e){const i=new is;for(const s of e.childElements())switch(s.localName){case"stem":switch(s.getAttribute("dir")){case"up":t.preferredBeamDirection=B.Up;break;case"down":t.preferredBeamDirection=B.Down}break;case"articulation":switch(s.getAttribute("type")){case"staccato":i.isStaccato=!0;break;case"normalAccent":i.accentuated=Ot.Normal;break;case"strongAccent":i.accentuated=Ot.Heavy}break;case"lyric":this.parseLyric(t,s);break;case"drawObjects":this.parseBeatDrawObject(t,s);break;case"heads":this.parseHeads(t,i,s);break;case"beam":switch(s.getAttribute("group")){case"force":t.beamingMode=St.ForceMergeWithNext;break;case"divide":t.beamingMode=St.ForceSplitToNext}}}parseHeads(t,e,i){for(const s of i.childElements())"head"===s.localName&&this.parseHead(t,e,s)}parseHead(t,e,i){const s=new is,r=H.parseTuning(i.getAttribute("pitch"));s.octave=r.octave-1,s.tone=r.tone.noteValue,s.isStaccato=e.isStaccato,s.accentuated=e.accentuated,t.addNote(s);for(const a of i.childElements())switch(a.localName){case"alter":a.attributes.has("step")&&(s.tone+=Number.parseInt(a.attributes.get("step")));break;case"tie":a.attributes.has("begin")?this._tieStartIds.has(s.id)||(this._tieStartIds.set(s.id,!0),this._tieStarts.push(s)):a.attributes.has("end")&&this._tieStarts.length>0&&!s.isTieDestination&&(s.isTieDestination=!0,s.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(s.id))}}parseBeatDrawObject(t,e){for(const i of e.childElements())if("drawObj"===i.localName){const s=this.parseDrawObj(i);s&&(s instanceof S_?s.fontFace.startsWith("capella")?"u"===s.text?(t.fermata=new kc,t.fermata.type=jn.Medium):"f"===s.text?t.dynamics=ie.F:"j"===s.text&&(t.dynamics=ie.MF):this._isFirstSystem&&""===this.score.title&&s.align===K.Center&&s.height>16&&s.weight>400?this.score.title=s.text:this._isFirstSystem&&""===this.score.artist&&s.align===K.Center&&s.y<0?this.score.artist=s.text:this._isFirstSystem&&""===this.score.music&&s.align===K.Right&&s.y<0?this.score.music=s.text:s.text.startsWith("by capella")||(t.text=s.text):s instanceof CM||(s instanceof NM?t.vibrato=Ie.Slight:s instanceof xM?(t.crescendo=s.decrescendo?ii.Decrescendo:ii.Crescendo,s.noteRange++,this._crescendo.set(t,s)):s instanceof DM?this._slurs.set(t,s):s instanceof __&&this.applyVolta(s)))}}parseBarDrawObject(t){for(const e of t.childElements())if("drawObj"===e.localName){const i=this.parseDrawObj(e);i&&i instanceof __&&this.applyVolta(i)}}applyVolta(t){if(t.lastNumber>0?(this._currentVoiceState.repeatCount=t.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):t.firstNumber>0&&(this._currentVoiceState.repeatCount=t.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),t.lastNumber>0&&t.firstNumber>0){let e=0;for(let i=t.firstNumber;i<=t.lastNumber;i++)e|=1<<i-1;this._currentBar.masterBar.alternateEndings=e}else t.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<t.lastNumber-1:t.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<t.firstNumber-1)}parseLyric(t,e){for(const i of e.childElements())if("verse"===i.localName){t.lyrics||(t.lyrics=[]);let s=i.innerText;"true"===i.getAttribute("hyphen")&&(s+="-"),t.lyrics.push(s)}}parseRestDurations(t,e){const i=e.getAttribute("base");if(-1!==i.indexOf("/")){const r=new Vn;return r.beamingMode=this._beamingMode,this.parseDuration(t,r,e),r}if(1===Number.parseInt(i)){const r=new Vn;return r.beamingMode=this._beamingMode,r.duration=w.Whole,r}return x.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(t){switch(t){case"2/1":return w.DoubleWhole;case"1/1":return w.Whole;case"1/2":return w.Half;case"1/4":return w.Quarter;case"1/8":return w.Eighth;case"1/16":return w.Sixteenth;case"1/32":return w.ThirtySecond;case"1/64":return w.SixtyFourth;case"1/128":return w.OneHundredTwentyEighth;default:return x.warning("Importer","Unsupported duration"),w.Quarter}}parseDuration(t,e,i){const s=i.getAttribute("base");e.duration=this.parseDurationValue(s),i.attributes.has("dots")&&(e.dots=Number.parseInt(i.attributes.get("dots")));const r=i.findChildElement("tuplet");if(r){e.tupletNumerator=Number.parseInt(r.getAttribute("count"));const a="true"===r.getAttribute("tripartite")?3:1,o="true"===r.getAttribute("prolong")?0:1;let l=0;for(;a*Math.pow(2,l+o)<e.tupletNumerator;)l++;e.tupletDenominator=a*Math.pow(2,l)}}parsePageObjects(t){for(const e of t.childElements())if("drawObj"===e.localName){const i=this.parseDrawObj(e);if(i&&i instanceof S_)switch(i.align){case K.Center:this.score.title?this.score.subTitle||(this.score.subTitle=e.innerText):this.score.title=e.innerText;break;case K.Right:this.score.artist||(this.score.artist=e.innerText)}}}parseGallery(t){for(const e of t.childElements())if("drawObj"===e.localName){const i=this.parseDrawObj(e);i&&this._galleryObjects.set(e.getAttribute("name"),i)}}parseDrawObj(t){let e=null,i=1;for(const s of t.childElements())switch(s.localName){case"text":e=this.parseText(s);break;case"guitar":e=this.parseGuitar(s);break;case"slur":e=this.parseSlur(s);break;case"wavyLine":e=this.parseWavyLine(s);break;case"bracket":e=this.parseTupletBracket(s);break;case"wedge":e=this.parseWedge(s);break;case"volta":e=this.parseVolta(s);break;case"octaveClef":e=this.parseOctaveClef(s);break;case"trill":e=this.parseTrill(s);break;case"basic":s.attributes.has("noteRange")&&(i=Number.parseInt(s.attributes.get("noteRange")))}return e&&(e.noteRange=i),e}parseTrill(t){return new Pq}parseOctaveClef(t){const e=new Bq;return t.attributes.has("octave")&&(e.octave=Number.parseInt(t.attributes.get("octave"))),e}parseVolta(t){const e=new __;return e.allNumbers="true"===t.attributes.get("allNumbers"),t.attributes.has("firstNumber")&&(e.firstNumber=Number.parseInt(t.attributes.get("firstNumber"))),t.attributes.has("lastNumber")&&(e.lastNumber=Number.parseInt(t.attributes.get("lastNumber"))),e}parseWedge(t){const e=new xM;return e.decrescendo="true"===t.attributes.get("decrescendo"),e}parseTupletBracket(t){const e=new Eq;return t.attributes.has("number")&&(e.number=Number.parseInt(t.attributes.get("number"))),e}parseWavyLine(t){return new NM}parseSlur(t){return new DM}parseGuitar(t){const e=new CM,i=t.innerText.trim();for(let s=0;s<i.length;s++)"/"===i.charAt(s)?e.chord.strings.push(0):e.chord.strings.push(Number.parseInt(i.charAt(s)));return e}parseText(t){const e=new S_;switch(t.attributes.has("x")&&(e.x=Number.parseFloat(t.attributes.get("x"))),t.attributes.has("x")&&(e.y=Number.parseFloat(t.attributes.get("y"))),t.getAttribute("align")){case"left":e.align=K.Left;break;case"center":e.align=K.Center;break;case"right":e.align=K.Right}switch(t.getAttribute("frame")){case"rectangle":e.frame=Mc.Rectangle;break;case"ellipse":e.frame=Mc.Ellipse;break;case"circle":e.frame=Mc.Circle;break;case"none":e.frame=Mc.None}if(t.firstElement)for(const i of t.childElements())switch(i.localName){case"font":e.fontFace=i.getAttribute("face"),i.attributes.has("weight")&&(e.weight=Number.parseInt(i.attributes.get("weight"))),i.attributes.has("height")&&(e.height=Number.parseInt(i.attributes.get("height")));break;case"content":e.text=i.innerText}else e.text=t.innerText;return e}parseInfo(t){for(const e of t.childElements())switch(e.localName){case"author":this.score.tab=e.firstChild.innerText;break;case"comment":this.score.notices=e.firstChild.innerText}}}class Fq extends Ho{get name(){return"Capella"}readScore(){x.debug(this.name,"Loading ZIP entries");let e,i=null;if(e=new xS(this.data).read(),x.debug(this.name,"Zip entries loaded"),e.length>0)for(const s of e)"score.xml"===s.fileName&&(i=T.toString(s.data,this.settings.importer.encoding));else this.data.reset(),i=T.toString(this.data.readAll(),this.settings.importer.encoding);if(!i)throw new Ht("No valid capella file");x.debug(this.name,"Start Parsing score.xml");try{const s=new em;return s.parseXml(i,this.settings),x.debug(this.name,"score.xml parsed"),s.score}catch(s){throw new Ht("Failed to parse CapXML",s)}}}class Lq{constructor(t){this._targets=new Set,this._callback=t,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(t){this._targets.add(t)}unobserve(t){this._targets.delete(t)}disconnect(){this._targets.clear()}onWindowResize(){const t=[];for(const e of this._targets)t.push({target:e,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(t,this)}}class Rq{constructor(t){this._elements=[];let e=null;const i=this.check.bind(this);this.check=()=>{e||(e=setTimeout(()=>{i(),e=null},100))},this._callback=t,window.addEventListener("resize",this.check,!0),document.addEventListener("scroll",this.check,!0)}observe(t){this._elements.indexOf(t)>=0||(this._elements.push(t),this.check())}unobserve(t){this._elements=this._elements.filter(e=>e!==t)}check(){const t=[];for(const e of this._elements){const i=e.getBoundingClientRect();i.top+i.height>=0&&i.top<=window.innerHeight&&i.left+i.width>=0&&i.left<=window.innerWidth&&t.push({target:e,isIntersecting:!0})}t.length&&this._callback(t,this)}}var Vq="function"==typeof SuppressedError?SuppressedError:function(n,t,e){var i=new Error(e);return i.name="SuppressedError",i.error=n,i.suppressed=t,i};let v_=(()=>{class n{static enable(e,i){n.alphaSkia=i,n.initializeMusicFont(n.alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){n.musicTextStyle=new n.alphaSkia.AlphaSkiaTextStyle([e.familyName],e.weight,e.isItalic)}static registerFont(e,i){const s=n.alphaSkia.AlphaSkiaTypeface.register(e.buffer);return i||(i=ve.withFamilyList([s.familyName],12,s.isItalic?Tt.Italic:Tt.Plain,s.weight>400?Wi.Bold:Wi.Regular)),i}get font(){return this._font}set font(e){if(this._font===e)return;this._font=e;const i=this.textStyleKey(e);if(this._textStyles.has(i))this._textStyle=this._textStyles.get(i);else{const s=new n.alphaSkia.AlphaSkiaTextStyle(e.families,e.weight===Wi.Bold?700:400,e.isItalic);this._textStyles.set(i,s),this._textStyle=s}}textStyleKey(e){return[...e.families,e.weight.toString(),e.isItalic?"italic":"upright"].join("_")}constructor(){this._color=new st(0,0,0,0),this._lineWidth=0,this._textStyle=null,this._scale=1,this._textStyles=new Map,this._font=new ve("Arial",10,Tt.Plain),this.textAlign=K.Left,this.textBaseline=ge.Top,this._canvas=new n.alphaSkia.AlphaSkiaCanvas,this.color=new st(0,0,0,255)}destroy(){this._canvas[Symbol.dispose]();for(const e of this._textStyles.values())e[Symbol.dispose]()}onRenderFinished(){return null}beginRender(e,i){this._scale=this.settings.display.scale,this._canvas.beginRender(e,i,N.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=n.alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,i,s,r){s>0&&this._canvas.fillRect(e*this._scale|0,i*this._scale|0,s*this._scale,r*this._scale)}strokeRect(e,i,s,r){const a=this.lineWidth%2==0?0:.5;this._canvas.strokeRect((e*this._scale|0)+a,(i*this._scale|0)+a,s*this._scale,r*this._scale)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,i){this._canvas.moveTo(e*this._scale,i*this._scale)}lineTo(e,i){this._canvas.lineTo(e*this._scale,i*this._scale)}quadraticCurveTo(e,i,s,r){this._canvas.quadraticCurveTo(e*this._scale,i*this._scale,s*this._scale,r*this._scale)}bezierCurveTo(e,i,s,r,a,o){this._canvas.bezierCurveTo(e*this._scale,i*this._scale,s*this._scale,r*this._scale,a*this._scale,o*this._scale)}fillCircle(e,i,s){this._canvas.fillCircle(e*this._scale,i*this._scale,s*this._scale)}strokeCircle(e,i,s){this._canvas.strokeCircle(e*this._scale,i*this._scale,s*this._scale)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(e){}endGroup(){}fillText(e,i,s){if(0===e.length)return;let r=n.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case K.Left:r=n.alphaSkia.AlphaSkiaTextAlign.Left;break;case K.Center:r=n.alphaSkia.AlphaSkiaTextAlign.Center;break;case K.Right:r=n.alphaSkia.AlphaSkiaTextAlign.Right}let a=n.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case ge.Top:a=n.alphaSkia.AlphaSkiaTextBaseline.Top;break;case ge.Middle:a=n.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case ge.Bottom:a=n.alphaSkia.AlphaSkiaTextBaseline.Bottom}this._canvas.fillText(e,this._textStyle,this._font.size*this._scale,i*this._scale|0,s*this._scale|0,r,a)}measureText(e){const i={stack:[],error:void 0,hasError:!1};try{const s=function Oq(n,t,e){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var i,s;if(e){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=t[Symbol.asyncDispose]}if(void 0===i){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=t[Symbol.dispose],e&&(s=i)}if("function"!=typeof i)throw new TypeError("Object not disposable.");s&&(i=function(){try{s.call(this)}catch(r){return Promise.reject(r)}}),n.stack.push({value:t,dispose:i,async:e})}else e&&n.stack.push({async:!0});return t}(i,this._canvas.measureText(e,this._textStyle,this._font.size,n.alphaSkia.AlphaSkiaTextAlign.Left,n.alphaSkia.AlphaSkiaTextBaseline.Alphabetic),!1);return new Eh(s.width,s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}catch(s){i.error=s,i.hasError=!0}finally{!function Hq(n){function t(r){n.error=n.hasError?new Vq(r,n.error,"An error was suppressed during disposal."):r,n.hasError=!0}var e,i=0;(function s(){for(;e=n.stack.pop();)try{if(!e.async&&1===i)return i=0,n.stack.push(e),Promise.resolve().then(s);if(e.dispose){var r=e.dispose.call(e.value);if(e.async)return i|=2,Promise.resolve(r).then(s,function(a){return t(a),s()})}else i|=1}catch(a){t(a)}if(1===i)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error})()}(i)}}fillMusicFontSymbol(e,i,s,r,a){r!==d.None&&this.fillMusicFontSymbolText(e,i,s,String.fromCharCode(r),a)}fillMusicFontSymbols(e,i,s,r,a){let o="";for(const l of r)l!==d.None&&(o+=String.fromCharCode(l));this.fillMusicFontSymbolText(e,i,s,o,a)}fillMusicFontSymbolText(e,i,s,r,a){this._canvas.fillText(r,n.musicTextStyle,N.MusicFontSize*this._scale*s,e*this._scale,i*this._scale,a?n.alphaSkia.AlphaSkiaTextAlign.Center:n.alphaSkia.AlphaSkiaTextAlign.Left,n.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,i,s){this._canvas.beginRotate(e*this._scale,i*this._scale,s)}endRotate(){this._canvas.endRotate()}}return n.musicTextStyle=null,n})();class EM extends bs{constructor(t,e,i=!1){super(t.beat,e.beat,i),this.startNote=t,this.endNote=e}getTieHeight(t,e,i,s){return this.startNote===this.endNote?15:super.getTieHeight(t,e,i,s)}getBeamDirection(t,e){return B.Down}static getBeamDirectionForNote(t){return B.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,Z.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,wt.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,wt.Left)}}class Wq extends Zs{constructor(){super(...arguments),this._tiedNoteTie=null}createTies(t){if(t.isVisible){if(!this._tiedNoteTie&&t.isTieOrigin&&t.tieDestination.isVisible){const e=new EM(t,t.tieDestination,!1);this._tiedNoteTie=e,this.addTie(e)}if(!this._tiedNoteTie&&t.isTieDestination){const e=new EM(t.tieOrigin,t,!0);this._tiedNoteTie=e,this.addTie(e)}}}}class Uq extends Zh{updateBeamingHelper(t){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,t+this.x+this.width/2,t+this.x+this.width/2)}paint(t,e,i){super.internalPaint(t,e,i,ht.SlashRests)}}class Gq extends Xa{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.restGlyph=null}get effectElement(){return ht.SlashEffects}getNoteX(t,e){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let s=i.x;switch(e){case wt.Left:break;case wt.Center:s+=i.width/2;break;case wt.Right:s+=i.width}return s}return 0}buildBoundingsLookup(t,e,i){if(this.noteHeads&&this.container.beat.notes.length>0){const s=new Bc;s.note=this.container.beat.notes[0],s.noteHeadBounds=new kn,s.noteHeadBounds.x=e+this.x+this.noteHeads.x,s.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,s.noteHeadBounds.w=this.width,s.noteHeadBounds.h=this.height,t.addNote(s)}}getNoteY(t,e){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let s=this.y+i.y;switch(e){case Z.Top:case Z.TopWithStem:s-=i.height/2+2;break;case Z.Center:break;case Z.Bottom:case Z.BottomWithStem:s+=i.height/2}return s}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.deadSlapped?this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.container.beat,this.container.x+this.x+this.deadSlapped.x+this.width,this.container.x+this.x+this.deadSlapped.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){const t=this.renderer,e=t.getNoteLine(),i=t.getLineY(e);if(this.container.beat.deadSlapped){const s=new Kg;s.renderer=this.renderer,s.doLayout(),this.deadSlapped=s,this.addEffect(s)}else if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const s=new Uq(0,i,this.container.beat.duration);this.restGlyph=s,s.beat=this.container.beat,s.beamingHelper=this.beamingHelper,this.addNormal(s),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const r=new ed(0,i,this.container.beat.duration,this.container.beat.graceType!==re.None,this.container.beat);this.noteHeads=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r)}if(this.container.beat.dots>0){this.addNormal(new Hn(0,0,5));for(let s=0;s<this.container.beat.dots;s++)this.addEffect(new Kh(0,t.getLineY(t.getNoteLine())-t.getLineHeight(.5),1.5))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}let BM=(()=>{class n extends Ir{constructor(e,i){super(e,i),this.simpleWhammyOverflow=0,this._isOnlySlash=!i.staff.showTablature&&!i.staff.showStandardNotation,this.helpers.preferredBeamDirection=B.Up}get repeatsBarSubElement(){return Le.SlashRepeats}get barNumberBarSubElement(){return Le.SlashBarNumber}get barLineBarSubElement(){return Le.SlashBarLines}get staffLineBarSubElement(){return Le.SlashStaffLine}get lineSpacing(){return Ct.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,i,s){super.paint(e,i,s),this.paintBeams(e,i,s,ht.SlashFlags,ht.SlashBeams),this.paintTuplets(e,i,s,ht.SlashTuplet)}doLayout(){super.doLayout();let e=!1;for(const i of this.bar.voices)if(this.hasVoiceContainer(i)&&this.getVoiceContainer(i).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e,i){const s=Xe.Heights.get(d.NoteheadSlashWhiteHalf);return this.getLineY(0)-s/2}getFlagBottomY(e,i){const s=Xe.Heights.get(d.NoteheadSlashWhiteHalf);return this.getLineY(0)-s/2}getBeamDirection(e){return B.Up}getNoteY(e,i){let s=super.getNoteY(e,i);return Number.isNaN(s)&&(s=this.getLineY(0)),s}calculateBeamYWithDirection(e,i,s){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,i){const s=Xe.Heights.get(d.NoteheadSlashWhiteHalf);return this.getLineY(0)-s/2}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Hn(0,0,5));const e=this.bar.masterBar,i=new p_(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(null==e.previousMasterBar||e.isFreeTime!==e.previousMasterBar.isFreeTime));i.barSubElement=Le.SlashTimeSignature,this.addPreBeatGlyph(i)}createVoiceGlyphs(e){for(const i of e.beats){const s=new Wq(i,this.getVoiceContainer(e));s.preNotes=new Ya,s.onNotes=0===e.index?new Gq:new Xa,this.addBeatGlyph(s)}}paintBeamingStem(e,i,s,r,a,o){const l=Ce.beat(o,ht.SlashStem,e);try{o.lineWidth=Ct.StemWidth,o.beginPath(),o.moveTo(s,r),o.lineTo(s,a),o.stroke(),o.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return n.StaffId="slash",n})();class zq extends Xh{get staffId(){return BM.StaffId}getStaffPaddingTop(t){return t.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(t){return t.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(t,e){return new BM(t,e)}canCreate(t,e){return super.canCreate(t,e)&&e.showSlash}}class T_ extends bs{constructor(t,e,i=!1){super(t?t.beat:null,e?e.beat:null,i),this.startNote=t,this.endNote=e}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(t,e){return B.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,Z.Top)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,wt.Center)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,this.startNote===this.endNote?wt.Left:wt.Center)}}class PM extends aa{constructor(t,e,i,s=!1){super(t,e,s),this._direction=B.Up,this._forSlide=i}getTieHeight(t,e,i,s){return Math.log(i-t+1)*this.renderer.settings.notation.slurHeight}tryExpand(t,e,i,s){if(this._forSlide!==i||this.forEnd!==s||this.startNote.beat.id!==t.beat.id||this.endNote.beat.id!==e.beat.id)return!1;switch(this._direction){case B.Up:t.realValue>this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue>this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat);break;case B.Down:t.realValue<this.startNote.realValue&&(this.startNote=t,this.startBeat=t.beat),e.realValue<this.endNote.realValue&&(this.endNote=e,this.endBeat=e.beat)}return!0}paint(t,e,i){const s=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),r=this.getBeamDirection(this.startBeat,s),a=`numbered.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${r}`,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(t,e,i))}}class $q extends Zs{constructor(){super(...arguments),this._effectSlurs=[]}createTies(t){if(t.isVisible){if(t.isTieOrigin&&t.tieDestination.isVisible){const e=new T_(t,t.tieDestination,!1);this.addTie(e)}if(t.isTieDestination){const e=new T_(t.tieOrigin,t,!0);this.addTie(e)}if(t.isLeftHandTapped&&!t.isHammerPullDestination){const e=new T_(t,t,!1);this.addTie(e)}if(t.isEffectSlurOrigin&&t.effectSlurDestination){let e=!1;for(const i of this._effectSlurs)if(i.tryExpand(t,t.effectSlurDestination,!1,!1)){e=!0;break}if(!e){const i=new PM(t,t.effectSlurDestination,!1,!1);this._effectSlurs.push(i),this.addTie(i)}}if(t.isEffectSlurDestination&&t.effectSlurOrigin){let e=!1;for(const i of this._effectSlurs)if(i.tryExpand(t.effectSlurOrigin,t,!1,!0)){e=!0;break}if(!e){const i=new PM(t.effectSlurOrigin,t,!1,!0);this._effectSlurs.push(i),this.addTie(i)}}}}}let jq=(()=>{class n extends Pt{constructor(e,i,s,r,a){super(e,i),this._isGrace=r,this._number=s,this._beat=a}paint(e,i,s){const r=this._beat.isRest?Ce.beat(s,ht.NumberedRests,this._beat):this._beat.notes.length>0?Ce.note(s,si.NumberedNumber,this._beat.notes[0]):void 0;try{const a=this.renderer.resources;s.font=this._isGrace?a.numberedNotationGraceFont:a.numberedNotationFont,s.textBaseline=ge.Middle,s.textAlign=K.Left,s.fillText(this._number.toString(),e+this.x,i+this.y)}finally{r?.[Symbol.dispose]?.()}}doLayout(){const e=this._isGrace?gt.GraceScale:1;this.width=n.NoteHeadWidth*e,this.height=n.NoteHeadHeight*e}}return n.NoteHeadHeight=17,n.NoteHeadWidth=12,n})(),qq=(()=>{class n extends Pt{constructor(e,i,s){super(e,i),this._beat=s}doLayout(){this.width=14+n.Padding,this.height=Yn.BarSize}paint(e,i,s){const r=Ce.beat(s,ht.NumberedDuration,this._beat);try{s.fillRect(e+this.x,i+this.y,this.width-n.Padding,this.height)}finally{r?.[Symbol.dispose]?.()}}}return n.Padding=3,n})();class Yq extends Ya{constructor(){super(...arguments),this.isNaturalizeAccidental=!1,this.accidental=le.None}get effectElement(){return ht.NumberedEffects}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){const t=new f_;if(t.renderer=this.renderer,this.container.beat.notes.length>0){const e=this.container.beat.notes[0],i=e?e.accidentalMode:ke.Default,s=Js.getNoteValue(e);let r=Js.computeAccidental(this.renderer.bar.keySignature,i,s,e.hasQuarterToneOffset);if(r===le.Natural&&(r=this.renderer.bar.keySignature+7<7?le.Sharp:le.Flat,this.isNaturalizeAccidental=!0),r!==le.None){this.accidental=r;const a=this.renderer,o=Ce.noteColor(a.resources,si.NumberedAccidentals,e),l=new Pr(0,a.getLineY(0),r,e.beat.graceType!==re.None?gt.GraceScale*gt.GraceScale:gt.GraceScale);l.colorOverride=o,l.renderer=this.renderer,t.addGlyph(l),this.addNormal(t),this.addNormal(new Hn(0,0,4))}}}super.doLayout()}}let IM=(()=>{class n extends Xa{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.octaveDots=0}get effectElement(){return ht.NumberedEffects}getNoteX(e,i){let s=null;if(this.noteHeads?s=this.noteHeads:this.deadSlapped&&(s=this.deadSlapped),s){let r=s.x;switch(i){case wt.Left:break;case wt.Center:r+=s.width/2;break;case wt.Right:r+=s.width}return r}return 0}buildBoundingsLookup(e,i,s){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new Bc;r.note=this.container.beat.notes[0],r.noteHeadBounds=new kn,r.noteHeadBounds.x=i+this.x+this.noteHeads.x,r.noteHeadBounds.y=s+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}getNoteY(e,i){let s=null;if(this.noteHeads?s=this.noteHeads:this.deadSlapped&&(s=this.deadSlapped),s){let r=this.y+s.y;switch(i){case Z.Top:case Z.TopWithStem:r-=s.height/2+2;break;case Z.Center:break;case Z.Bottom:case Z.BottomWithStem:r+=s.height/2}return r}return 0}updateBeamingHelper(){if(this.beamingHelper){let e=null;this.noteHeads?e=this.noteHeads:this.deadSlapped&&(e=this.deadSlapped),e&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+e.x,this.container.x+this.x+e.x+e.width)}}doLayout(){const e=this.renderer;e.shortestDuration<this.container.beat.duration&&(e.shortestDuration=this.container.beat.duration);const i=e.getLineY(e.getNoteLine());if(!this.container.beat.isEmpty){let s="0";if(this.container.beat.notes.length>0){const l=this.renderer.bar.keySignature,c=l+7,f=this.container.beat.notes[0];if(f.isDead)s="X";else{const p=f.displayValue-(this.renderer.bar.keySignatureType===li.Minor?n.MinorKeySignatureOneValues:n.MajorKeySignatureOneValues)[c],g=p<0?(p%12+12)%12:p%12;let m=p<0?(Math.abs(p)+12)/12|0:p/12|0;p<0&&(m*=-1),this.octaveDots=m,e.registerOctave(m);let b=(H.keySignatureIsSharp(l)||H.keySignatureIsNatural(l)?Js.FlatNoteSteps:Js.SharpNoteSteps)[g]+1;Js.AccidentalNotes[g]&&!this.container.preNotes.isNaturalizeAccidental&&(c<7?b++:b--),s=b.toString()}}if(this.container.beat.deadSlapped){const o=new Kg;o.renderer=this.renderer,o.doLayout(),this.deadSlapped=o,this.addEffect(o)}else{const l=new jq(0,i,s,this.container.beat.graceType!==re.None,this.container.beat);this.noteHeads=l,this.addNormal(l)}if(this.container.beat.dots>0&&this.container.beat.duration>=w.Quarter){this.addNormal(new Hn(0,0,5));for(let o=0;o<this.container.beat.dots;o++){const l=new Kh(0,e.getLineY(0),1.5);l.renderer=this.renderer,this.addEffect(l)}}let r=0;switch(this.container.beat.duration){case w.QuadrupleWhole:r=16;break;case w.DoubleWhole:r=8;break;case w.Whole:r=4;break;case w.Half:r=2}let a=r;for(let o=0;o<this.container.beat.dots;o++)a=a/2|0,r+=a;for(let o=0;o<r-1;o++){const l=new qq(0,e.getLineY(0),this.container.beat);l.renderer=this.renderer,this.addNormal(l)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}return n.MajorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61],n.MinorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73],n})();class Xq extends Pt{constructor(t,e,i,s){super(t,e),this._text="",this._accidental=le.None,this._accidentalOffset=0,this._keySignature=i,this._keySignatureType=s}doLayout(){super.doLayout();const t="1 = ";let e="",i=le.None;switch(this._keySignatureType){case li.Major:switch(this._keySignature){case De.Cb:e="  C",i=le.Flat;break;case De.Gb:e="  G",i=le.Flat;break;case De.Db:e="  D",i=le.Flat;break;case De.Ab:e="  A",i=le.Flat;break;case De.Eb:e="  E",i=le.Flat;break;case De.Bb:e="  B",i=le.Flat;break;case De.F:e="F";break;case De.C:e="C",i=le.None;break;case De.G:e="G",i=le.None;break;case De.D:e="D",i=le.None;break;case De.A:e="A",i=le.None;break;case De.E:e="E",i=le.None;break;case De.B:e="B",i=le.None;break;case De.FSharp:e="  F",i=le.Sharp;break;case De.CSharp:e="  C",i=le.Sharp}break;case li.Minor:switch(this._keySignature){case De.Cb:e="  a",i=le.Flat;break;case De.Gb:e="  e",i=le.Flat;break;case De.Db:e="  b",i=le.Flat;break;case De.Ab:e="f",i=le.None;break;case De.Eb:e="c",i=le.None;break;case De.Bb:e="g",i=le.None;break;case De.F:e="d";break;case De.C:e="a",i=le.None;break;case De.G:e="e",i=le.None;break;case De.D:e="b",i=le.None;break;case De.A:e="  f",i=le.Sharp;break;case De.E:e="  c",i=le.Sharp;break;case De.B:e="  g",i=le.Sharp;break;case De.FSharp:e="  d",i=le.Sharp;break;case De.CSharp:e="  a",i=le.Sharp}}this._text=t+e,this._accidental=i;const s=this.renderer.scoreRenderer.canvas;s.font=this.renderer.resources.numberedNotationFont,this._accidentalOffset=s.measureText(t).width,this.width=s.measureText(t+e).width}paint(t,e,i){const s=Ce.bar(i,Le.NumberedKeySignature,this.renderer.bar);try{i.font=this.renderer.resources.numberedNotationFont,i.textBaseline=ge.Middle,i.fillText(this._text,t+this.x,e+this.y),this._accidental!==le.None&&i.fillMusicFontSymbol(t+this.x+this._accidentalOffset,e+this.y,.7,Pr.getMusicSymbol(this._accidental),!1)}finally{s?.[Symbol.dispose]?.()}}}class Yn extends Ir{registerOctave(t){null===this.lowestOctave?(this.lowestOctave=t,this.highestOctave=t):(t<this.lowestOctave&&(this.lowestOctave=t),t>this.highestOctave&&(this.highestOctave=t))}get repeatsBarSubElement(){return Le.NumberedRepeats}get barNumberBarSubElement(){return Le.NumberedBarNumber}get barLineBarSubElement(){return Le.NumberedBarLines}get staffLineBarSubElement(){return Le.NumberedStaffLine}constructor(t,e){super(t,e),this.simpleWhammyOverflow=0,this.shortestDuration=w.QuadrupleWhole,this.lowestOctave=null,this.highestOctave=null,this._isOnlyNumbered=!e.staff.showSlash&&!e.staff.showTablature&&!e.staff.showStandardNotation}get lineSpacing(){return Ct.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(t,e,i){super.paint(t,e,i),this.paintBeams(t,e,i,ht.NumberedDuration,ht.NumberedDuration),this.paintTuplets(t,e,i,ht.NumberedTuplet,!0)}doLayout(){super.doLayout();let t=!1;for(const e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){t=!0;break}if(t&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){const e=H.getIndex(this.shortestDuration)-2;if(e>0){const a=(e-1)*Yn.BarSpacing+Yn.BarSize;let o=0;const l=this.lowestOctave;null!==l&&(o=Math.abs(l)*Yn.DotSpacing+Yn.DotSize),this.registerOverflowBottom(a+o)}const i=this.highestOctave;if(null!==i){const s=Math.abs(i)*Yn.DotSpacing+Yn.DotSize;this.registerOverflowTop(s)}}}paintFlag(t,e,i,s,r){this.paintBar(t,e,i,s,r)}paintBar(t,e,i,s,r){if(0===s.beats.length)return;const a=this.resources;for(let o=0,l=s.beats.length;o<l;o++){const c=s.beats[o],u=Ce.beat(i,r,c);try{const h=Yn.BarSpacing,f=Yn.BarSize,p=H.getIndex(c.duration)-2,g=e+this.y,m=this.getBeatX(c,xe.PreNotes)-this.beatGlyphsStart,y=this.calculateBeamY(s,m);for(let D=0;D<p;D++){let C=0,oe=0,at=0;const Fe=g+D*h;o===s.beats.length-1?(C=m,oe=this.getBeatX(c,xe.PostNotes)-this.beatGlyphsStart):(C=m,oe=this.getBeatX(s.beats[o+1],xe.PreNotes)-this.beatGlyphsStart),at=Fe+y|0,Ir.paintSingleBar(i,t+this.x+C,at,t+this.x+oe,at,f)}const b=this.getBeatContainer(c).onNotes;let _=b instanceof IM?b.octaveDots:0,v=0,k=0;_>0?(v=g+this.getLineY(0)-a.numberedNotationFont.size/1.5,k=-1*Yn.DotSpacing):_<0&&(v=g+y+p*h,k=Yn.DotSpacing);const F=this.getBeatX(c,xe.OnNotes)+4-this.beatGlyphsStart;_=Math.abs(_);for(let D=0;D<_;D++)i.fillCircle(t+this.x+F,v,Yn.DotSize),v+=k}finally{u?.[Symbol.dispose]?.()}}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size}getFlagTopY(t,e){const i=Xe.Heights.get(d.NoteheadBlack);return this.getLineY(0)-i/2}getFlagBottomY(t,e){const i=Xe.Heights.get(d.NoteheadBlack);return this.getLineY(0)-i/2}getBeamDirection(t){return B.Down}getTupletBeamDirection(t){return B.Up}getNoteY(t,e){let i=super.getNoteY(t,e);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(t,e,i){const s=this.resources.numberedNotationFont;return this.getLineY(0)+s.size}getBarLineStart(t,e){const i=Xe.Heights.get(d.NoteheadBlack);return this.getLineY(0)-i/2}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine,(0===this.index||this.bar.masterBar.isRepeatStart&&this._isOnlyNumbered)&&this.addPreBeatGlyph(new m_(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new vM(0,this.getLineHeight(-.25),this.bar.index+1))}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){this.addPreBeatGlyph(new Xq(0,this.getLineY(0),this.bar.keySignature,this.bar.keySignatureType))}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Hn(0,0,5));const t=this.bar.masterBar,e=new p_(0,this.getLineY(0),t.timeSignatureNumerator,t.timeSignatureDenominator,t.timeSignatureCommon,t.isFreeTime&&(null==t.previousMasterBar||t.isFreeTime!==t.previousMasterBar.isFreeTime));e.barSubElement=Le.NumberedTimeSignature,this.addPreBeatGlyph(e)}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(t){for(const e of t.beats){const i=new $q(e,this.getVoiceContainer(t));i.preNotes=0===t.index?new Yq:new Ya,i.onNotes=0===t.index?new IM:new Xa,this.addBeatGlyph(i)}}paintBeamingStem(t,e,i,s,r,a){}}Yn.StaffId="numbered",Yn.BarSpacing=Ct.BeamSpacing+Ct.BeamThickness,Yn.BarSize=2,Yn.DotSpacing=5,Yn.DotSize=2;class Jq extends Xh{get staffId(){return Yn.StaffId}getStaffPaddingTop(t){return t.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(t){return t.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(t,e){return new Yn(t,e)}canCreate(t,e){return super.canCreate(t,e)&&e.showNumbered}}class Qq extends Mt{get notationElement(){return Te.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SinglePreBeat}shouldCreateGlyph(t,e){const i=e.voice.bar.masterBar;return 0===e.voice.bar.staff.index&&0===e.voice.index&&0===e.index&&i.isFreeTime&&(0===i.index||i.isFreeTime!==i.previousMasterBar.isFreeTime)}createNewGlyph(t,e){return new zi(0,0,"Free time",t.resources.effectFont,K.Left)}canExpand(t,e){return!0}}let Kq=(()=>{class n extends Gi{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=Xe.Heights.get(d.KeyboardPedalPed)}paint(e,i,s){const a=i+this.y,o=this.height,l=this.renderer.bar.sustainPedals,c=Xe.Widths.get(d.KeyboardPedalPed),u=Xe.Widths.get(d.KeyboardPedalUp);let h=0;for(;h<l.length;){let f=l[h];for(;null!=f;){const p=e+this.renderer.getRatioPositionX(f.ratioPosition);let g=0;if(f.pedalType===jt.Down?(s.fillMusicFontSymbol(p,a+o,1,d.KeyboardPedalPed,!0),g=c/2+n.TextLinePadding):f.pedalType===jt.Up&&(s.fillMusicFontSymbol(p,a+o,1,d.KeyboardPedalUp,!0),g=u/2+n.StarLinePadding),f.nextPedalMarker)if(f.nextPedalMarker.bar===f.bar){let m=e+this.renderer.getRatioPositionX(f.nextPedalMarker.ratioPosition);switch(f.nextPedalMarker.pedalType){case jt.Down:m-=c/2;break;case jt.Hold:break;case jt.Up:m-=u/2}const y=p+g;m>y&&s.fillRect(y,a+o-1,m-y,1)}else{const y=p+g;s.fillRect(y,a+o-1,e+this.x+this.width-y,1)}if(0===h&&f.previousPedalMarker){const m=e+this.x;s.fillRect(m,a+o-1,p-g-m,1)}h++,null!=f.nextPedalMarker&&f.nextPedalMarker.bar!==f.bar?(f=null,h=l.length):f=f.nextPedalMarker}}}}return n.TextLinePadding=3,n.StarLinePadding=3,n})();class Zq extends Mt{get notationElement(){return Te.EffectSustainPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Pe.FullBar}shouldCreateGlyph(t,e){return 0===e.voice.index&&0===e.index&&e.voice.bar.sustainPedals.length>0}createNewGlyph(t,e){return new Kq}canExpand(t,e){return!0}}class tm extends Mt{constructor(t,e){super(),this._type=t,this._shouldCreate=e}get notationElement(){return Te.EffectGolpe}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){const i=this._shouldCreate;return e.golpe===this._type&&(!i||i(t,e))}createNewGlyph(t,e){return new bM(0,0,!0)}canExpand(t,e){return!1}}class k_ extends sn{constructor(t){super(0,0,1,k_.getSymbol(t)),this.center=!0}static getSymbol(t){switch(t){case Li.Open:return d.GuitarOpenPedal;case Li.Closed:return d.GuitarClosePedal}return d.None}paint(t,e,i){super.paint(t,e+this.height,i)}}class eY extends Mt{get notationElement(){return Te.EffectWahPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.wahPedal!==Li.None}createNewGlyph(t,e){return new k_(e.wahPedal)}canExpand(t,e){return!1}}class id extends Mt{get notationElement(){return Te.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(t,e){return e.isBarre}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){let i="";switch(e.barreShape){case Ri.None:case Ri.Full:break;case Ri.Half:i+="1/2"}return i+=`B ${id.toRoman(e.barreFret)}`,new Qo(i,!1)}static toRoman(t){let e="";if(t>0)for(const[i,s]of id.RomanLetters){const r=Math.floor(t/s);t-=r*s,e+=i.repeat(r)}return e}canExpand(t,e){return t.barreFret===e.barreFret&&t.barreShape===e.barreShape}}id.RomanLetters=new Map([["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]]);class C_ extends sn{constructor(t){super(0,0,1,C_.getSymbol(t)),this.center=!0}static getSymbol(t){switch(t){case Vt.InvertedTurn:return d.OrnamentTurnInverted;case Vt.Turn:return d.OrnamentTurn;case Vt.UpperMordent:return d.OrnamentShortTrill;case Vt.LowerMordent:return d.OrnamentMordent}return d.None}paint(t,e,i){super.paint(t,e+this.height-4,i)}}class tY extends Mt{get notationElement(){return Te.EffectNoteOrnament}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.notes.some(i=>i.ornament!==Vt.None)}createNewGlyph(t,e){return new C_(e.notes.find(i=>i.ornament!==Vt.None).ornament)}canExpand(t,e){return!1}}class nY extends Mt{get notationElement(){return Te.EffectRasgueado}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(t,e){return e.hasRasgueado}get sizingMode(){return Pe.GroupedOnBeat}createNewGlyph(t,e){return new Qo("rasg.")}canExpand(t,e){return!0}}class nm extends Pt{constructor(t){super(0,0),this._symbols=t}doLayout(){this.height=27}paint(t,e,i){i.fillMusicFontSymbols(t+this.x,e+this.y+this.height,.8,this._symbols,!0)}}class $i extends Pt{constructor(t){super(0,0),this._text=t}doLayout(){this.height=1.5*this.renderer.resources.directionsFont.size}paint(t,e,i){const s=i.font,r=i.textBaseline,a=i.textAlign;i.font=this.renderer.resources.directionsFont,i.textBaseline=ge.Middle,i.textAlign=K.Right,i.fillText(this._text,t+this.x,e+this.y+this.height/2),i.font=s,i.textBaseline=r,i.textAlign=a}}class iY extends Gi{constructor(t,e,i){super(t,e),this._barBeginGlyphs=[],this._barEndGlyphs=[],this._directions=i}doLayout(){const t=this._directions;t.has(A.TargetSegnoSegno)&&this._barBeginGlyphs.push(new nm([d.Segno,d.Segno])),t.has(A.TargetSegno)&&this._barBeginGlyphs.push(new nm([d.Segno])),t.has(A.TargetDoubleCoda)&&this._barBeginGlyphs.push(new nm([d.Coda,d.Coda])),t.has(A.TargetCoda)&&this._barBeginGlyphs.push(new nm([d.Coda])),t.has(A.TargetFine)&&this._barEndGlyphs.push(new $i("Fine")),t.has(A.JumpDaDoubleCoda)&&this._barEndGlyphs.push(new $i("To Double Coda")),t.has(A.JumpDaCoda)&&this._barEndGlyphs.push(new $i("To Coda")),t.has(A.JumpDalSegnoSegno)&&this._barEndGlyphs.push(new $i("D.S.S.")),t.has(A.JumpDalSegnoSegnoAlCoda)&&this._barEndGlyphs.push(new $i("D.S.S. al Coda")),t.has(A.JumpDalSegnoSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new $i("D.S.S. al Double Coda")),t.has(A.JumpDalSegnoSegnoAlFine)&&this._barEndGlyphs.push(new $i("D.S.S. al Fine")),t.has(A.JumpDalSegno)&&this._barEndGlyphs.push(new $i("D.S.")),t.has(A.JumpDalSegnoAlCoda)&&this._barEndGlyphs.push(new $i("D.S. al Coda")),t.has(A.JumpDalSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new $i("D.S. al Double Coda")),t.has(A.JumpDalSegnoAlFine)&&this._barEndGlyphs.push(new $i("D.S. al Fine")),t.has(A.JumpDaCapo)&&this._barEndGlyphs.push(new $i("D.C.")),t.has(A.JumpDaCapoAlCoda)&&this._barEndGlyphs.push(new $i("D.C. al Coda")),t.has(A.JumpDaCapoAlDoubleCoda)&&this._barEndGlyphs.push(new $i("D.C. al Double Coda")),t.has(A.JumpDaCapoAlFine)&&this._barEndGlyphs.push(new $i("D.C. al Fine"));const e=this.doSideLayout(this._barBeginGlyphs),i=this.doSideLayout(this._barEndGlyphs);this.height=Math.max(e,i)}doSideLayout(t){let e=0;for(const s of t)s.y=e,s.renderer=this.renderer,s.doLayout(),e+=s.height+3;return e}paint(t,e,i){for(const s of this._barBeginGlyphs)s.paint(t+this.x,e+this.y,i);for(const s of this._barEndGlyphs)s.paint(t+this.x+this.width,e+this.y,i)}}class sY extends Mt{get notationElement(){return Te.EffectDirections}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Pe.FullBar}shouldCreateGlyph(t,e){return 0===e.voice.index&&0===e.index&&null!==e.voice.bar.masterBar.directions&&e.voice.bar.masterBar.directions.size>0}createNewGlyph(t,e){return new iY(0,0,e.voice.bar.masterBar.directions)}canExpand(t,e){return!0}}let rY=(()=>{class n extends Gi{constructor(e){super(0,0),this._text="",this._textWidth=0,this._textHeight=0,this._timer=e}doLayout(){const e=this._timer/6e4|0;this._text=`${e}:${((this._timer-6e4*e)/1e3|0).toString().padStart(2,"0")}`;const s=this.renderer.scoreRenderer.canvas;s.font=this.renderer.resources.timerFont;const r=s.measureText(this._text);this._textHeight=s.font.size+2*n.PaddingY,this._textWidth=r.width+2*n.PaddingX,this.height=this._textHeight+2*n.MarginY}paint(e,i,s){s.strokeRect(e+this.x-(this._textWidth/2|0),i+this.y+n.MarginY,this._textWidth,this._textHeight);const a=s.font,o=s.textBaseline,l=s.textAlign;s.font=this.renderer.resources.timerFont,s.textBaseline=ge.Middle,s.textAlign=K.Center,s.fillText(this._text,e+this.x,i+this.y+this.height/2),s.font=a,s.textBaseline=o,s.textAlign=l}}return n.PaddingX=2,n.PaddingY=2,n.MarginY=2,n})();class aY extends Mt{get notationElement(){return Te.EffectBeatTimer}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Pe.SingleOnBeat}shouldCreateGlyph(t,e){return e.showTimer}createNewGlyph(t,e){return new rY(e.timer??0)}canExpand(t,e){return!0}}let oY=(()=>{class n{static print(e){e(`alphaTab ${n.version}`),e(`commit: ${n.commit}`),e(`build date: ${n.date}`)}}return n.version="1.5.0-alpha.1396",n.date="2025-05-04T14:15:08.376Z",n.commit="692a6f03aec7ff1a9958d2196245e287315d3b86",n})();class MM{constructor(t,e){this.vertical=t,this.createLayout=e}}class D_{constructor(t,e){this.supportsWorkers=t,this.createCanvas=e}}class N{static createStyleElement(t,e){let i=t.getElementById("alphaTabStyle");if(!i){if(!e)return void x.error("AlphaTab","Font directory could not be detected, cannot create style element");i=t.createElement("style"),i.id="alphaTabStyle",i.innerHTML=`\n            @font-face {\n                font-display: block;\n                font-family: 'alphaTab';\n                 src: url('${e}Bravura.eot');\n                 src: url('${e}Bravura.eot?#iefix') format('embedded-opentype')\n                      , url('${e}Bravura.woff') format('woff')\n                      , url('${e}Bravura.otf') format('opentype')\n                      , url('${e}Bravura.svg#Bravura') format('svg');\n                 font-weight: normal;\n                 font-style: normal;\n            }\n            .at-surface * {\n                cursor: default;\n                vertical-align: top;\n                overflow: visible;\n            }\n            .at-surface-svg text {\n                dominant-baseline: central;\n                white-space:pre;\n            }\n            .at {\n                 font-family: 'alphaTab';\n                 speak: none;\n                 font-style: normal;\n                 font-weight: normal;\n                 font-variant: normal;\n                 text-transform: none;\n                 line-height: 1;\n                 line-height: 1;\n                 -webkit-font-smoothing: antialiased;\n                 -moz-osx-font-smoothing: grayscale;\n                 font-size: ${N.MusicFontSize}px;\n                 overflow: visible !important;\n            }`,t.getElementsByTagName("head").item(0).appendChild(i),N.bravuraFontChecker.checkForFontAvailability()}}static get globalThis(){if(void 0===N._globalThis){try{N._globalThis=globalThis}catch{}typeof N._globalThis>"u"&&(N._globalThis=self),typeof N._globalThis>"u"&&(N._globalThis=global),typeof N._globalThis>"u"&&(N._globalThis=window),typeof N._globalThis>"u"&&(N._globalThis=Function("return this")())}return N._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in N.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in N.globalThis}static throttle(t,e){let i=0;return()=>{N.globalThis.clearTimeout(i),i=N.globalThis.setTimeout(t,e)}}static detectScriptFile(){if(!N.isRunningInWorker&&N.globalThis.ALPHATAB_ROOT){let t=N.globalThis.ALPHATAB_ROOT;return t=N.ensureFullUrl(t),t=N.appendScriptName(t),t}try{const t="file:///F:/__Projects__/050_guitarpro/node_modules/@coderline/alphatab/dist/alphaTab.core.mjs";if(t&&-1===t.indexOf("file://"))return t}catch{}return"document"in N.globalThis&&document.currentScript?document.currentScript.src:null}static ensureFullUrl(t){if(!t)return"";if(!t.startsWith("http")&&!t.startsWith("https")&&!t.startsWith("file")){let e="";const i=N.globalThis.location;if(e+=i.protocol?.toString(),e+="//",i.hostname&&(e+=i.hostname?.toString()),i.port&&(e+=":",e+=i.port?.toString()),!t.startsWith("/")){const s=i.pathname.split("/").slice(0,-1).join("/");s.length>0&&(s.startsWith("/")||(e+="/"),e+=s?.toString())}return t.startsWith("/")||(e+="/"),e+=t?.toString(),e}return t}static appendScriptName(t){return t&&!t.endsWith(".js")&&(t.endsWith("/")||(t+="/"),t+="alphaTab.js"),t}static detectFontDirectory(){if(!N.isRunningInWorker&&N.globalThis.ALPHATAB_FONT)return N.ensureFullUrl(N.globalThis.ALPHATAB_FONT);const t=N.scriptFile;if(t){const e=t.lastIndexOf("/");if(e>=0)return`${t.substr(0,e)}/font/`}return null}static registerJQueryPlugin(){if(!N.isRunningInWorker&&N.globalThis&&"jQuery"in N.globalThis){const t=N.globalThis.jQuery,e=new KI;t.fn.alphaTab=function(i){const s=Array.prototype.slice.call(arguments,1);return 1===this.length?e.exec(this[0],i,s):this.each((r,a)=>{e.exec(a,i,s)})},t.alphaTab={restore:KI.restore},t.fn.alphaTab.fn=e}}static getRenderEngineFactory(t){return t&&N.renderEngines.has(t)?N.renderEngines.get(t):N.renderEngines.get("default")}static getLayoutEngineFactory(t){return t&&N.layoutEngines.has(t)?N.layoutEngines.get(t):N.layoutEngines.get(Wa.Page)}static buildImporters(){return[new G$,new e9,new J$,new rt,new Fq,new vI]}static createDefaultRenderEngines(){const t=new Map;return t.set("svg",new D_(!0,()=>new ZI)),t.set("default",t.get("svg")),t.set("skia",new D_(!1,()=>new v_)),N.createPlatformSpecificRenderEngines(t),t}static enableAlphaSkia(t,e){v_.enable(t,e)}static registerAlphaSkiaCustomFont(t){return v_.registerFont(t)}static createPlatformSpecificRenderEngines(t){t.set("html5",new D_(!1,()=>new V9))}static createDefaultRenderers(){return[new Xo(N.StaffIdBeforeSlashAlways,[new Uj,new qj,new Fj,new sY,new Tj,new Qq,new Gj,new aY,new Cj]),new zq,new Xo(N.StaffIdBeforeScoreAlways,[new Bj,new id,new tY,new nY,new eY]),new Xo(N.StaffIdBeforeScoreHideable,[new Yj,new oM,new iM(!0),new lM,new rM,new cM,new aM(!1),new kM,new tm(Ci.Finger)],(t,e)=>e.showStandardNotation),new yq,new Xo(N.StaffIdBeforeNumberedAlways,[new Nj,new iM(!1),new xj,new tm(Ci.Thumb,(t,e)=>e.voice.bar.staff.showStandardNotation),new Zq]),new Jq,new Xo(N.StaffIdBeforeTabAlways,[new Aj]),new Xo(N.StaffIdBeforeTabHideable,[new oM,new lM,new rM,new cM,new aM(!0),new Hj,new Ej,new Ja(ae.Natural),new Ja(ae.Artificial),new Ja(ae.Pinch),new Ja(ae.Tap),new Ja(ae.Semi),new Ja(ae.Feedback),new Ij,new kj,new Pj,new Rj,new Vj,new Oj,new kM,new tm(Ci.Finger,(t,e)=>!e.voice.bar.staff.showStandardNotation)],(t,e)=>e.showTablature),new w_,new Xo(N.StaffIdBeforeEndAlways,[new tm(Ci.Thumb,(t,e)=>!e.voice.bar.staff.showStandardNotation)])]}static createDefaultStaveProfiles(){const t=new Map,e=N.createDefaultRenderers();t.set(_r.Default,e),t.set(_r.ScoreTab,e);const i=new Set([N.StaffIdBeforeSlashAlways,N.StaffIdBeforeScoreAlways,N.StaffIdBeforeNumberedAlways,N.StaffIdBeforeTabAlways,y_.StaffId,N.StaffIdBeforeEndAlways]);t.set(_r.Score,e.filter(r=>i.has(r.staffId)));const s=new Set([N.StaffIdBeforeSlashAlways,N.StaffIdBeforeScoreAlways,N.StaffIdBeforeNumberedAlways,N.StaffIdBeforeTabAlways,b_.StaffId,N.StaffIdBeforeEndAlways]);return t.set(_r.Tab,N.createDefaultRenderers().filter(r=>{if(r instanceof w_){const a=r;a.showTimeSignature=!0,a.showRests=!0,a.showTiedNotes=!0}return s.has(r.staffId)})),t.set(_r.TabMixed,N.createDefaultRenderers().filter(r=>{if(r instanceof w_){const a=r;a.showTimeSignature=!1,a.showRests=!1,a.showTiedNotes=!1}return s.has(r.staffId)})),t}static createDefaultLayoutEngines(){const t=new Map;return t.set(Wa.Page,new MM(!0,e=>new Jj(e))),t.set(Wa.Horizontal,new MM(!1,e=>new Xj(e))),t}static initializeMain(t,e){N.isRunningInWorker||N.isRunningInAudioWorklet||((N.webPlatform===Ui.Browser||N.webPlatform===Ui.BrowserModule)&&(N.registerJQueryPlugin(),N.HighDpiFactor=window.devicePixelRatio,"ResizeObserver"in N.globalThis||(N.globalThis.ResizeObserver=Lq),"IntersectionObserver"in N.globalThis||(N.globalThis.IntersectionObserver=Rq),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...i){this.innerHTML="",this.append(...i)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(i,s){return this.replace(new RegExp(i,"g"),s)})),N.createWebWorker=t,N.createAudioWorklet=e)}static get alphaTabWorker(){return N.globalThis.Worker}static get alphaTabUrl(){return N.globalThis.URL}static initializeWorker(){if(!N.isRunningInWorker)throw new nt(it.General,"Not running in worker, cannot run worker initialization");i_.init(),JS.init(),N.createWebWorker=t=>{throw new nt(it.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!N.isRunningInAudioWorklet)throw new nt(it.General,"Not running in audio worklet, cannot run worklet initialization");X9.init()}static detectWebPack(){try{return!0}catch{}return!1}static detectVite(){try{if("string"==typeof __BASE__)return!0}catch{}return!1}static detectWebPlatform(){try{if("[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0))return Ui.NodeJs}catch{}try{const t="file:///F:/__Projects__/050_guitarpro/node_modules/@coderline/alphatab/dist/alphaTab.core.mjs";if(t&&"string"==typeof t&&!t.startsWith("file://"))return Ui.BrowserModule}catch{}return Ui.Browser}static printEnvironmentInfo(t=!0){const e=t?i=>{x.log.debug("VersionInfo",i)}:i=>{x.debug("VersionInfo",i)};oY.print(e),e(`High DPI: ${N.HighDpiFactor}`),N.printPlatformInfo(e)}static printPlatformInfo(t){t(`Browser: ${navigator.userAgent}`),t(`Platform: ${Ui[N.webPlatform]}`),t(`WebPack: ${N.isWebPackBundled}`),t(`Vite: ${N.isViteBundled}`),N.webPlatform!==Ui.NodeJs&&(t(`Window Size: ${window.outerWidth}x${window.outerHeight}`),t(`Screen Size: ${window.screen.width}x${window.screen.height}`))}}N.StaffIdBeforeSlashAlways="before-slash-always",N.StaffIdBeforeScoreAlways="before-score-always",N.StaffIdBeforeScoreHideable="before-score-hideable",N.StaffIdBeforeNumberedAlways="before-numbered-always",N.StaffIdBeforeTabAlways="before-tab-always",N.StaffIdBeforeTabHideable="before-tab-hideable",N.StaffIdBeforeEndAlways="before-end-always",N.MusicFontSize=34,N.HighDpiFactor=1,N._globalThis=void 0,N.webPlatform=N.detectWebPlatform(),N.isWebPackBundled=N.detectWebPack(),N.isViteBundled=N.detectVite(),N.scriptFile=N.detectScriptFile(),N.fontDirectory=N.detectFontDirectory(),N.bravuraFontChecker=new YI(["alphaTab"]),N.renderEngines=N.createDefaultRenderEngines(),N.layoutEngines=N.createDefaultLayoutEngines(),N.staveProfiles=N.createDefaultStaveProfiles();class AM{constructor(){this.scriptFile=null,this.fontDirectory=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=kr.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=N.scriptFile,this.fontDirectory=N.fontDirectory}}Symbol,Symbol;var M=function(n){return n[n.SteelGuitar=1]="SteelGuitar",n[n.AcousticGuitar=2]="AcousticGuitar",n[n.TwelveStringGuitar=3]="TwelveStringGuitar",n[n.ElectricGuitar=4]="ElectricGuitar",n[n.Bass=5]="Bass",n[n.ClassicalGuitar=23]="ClassicalGuitar",n[n.UprightBass=6]="UprightBass",n[n.Ukulele=7]="Ukulele",n[n.Banjo=8]="Banjo",n[n.Mandolin=9]="Mandolin",n[n.Piano=10]="Piano",n[n.Synth=12]="Synth",n[n.Strings=11]="Strings",n[n.Brass=13]="Brass",n[n.Reed=14]="Reed",n[n.Woodwind=15]="Woodwind",n[n.Vocal=16]="Vocal",n[n.PitchedIdiophone=17]="PitchedIdiophone",n[n.Fx=21]="Fx",n[n.PercussionKit=18]="PercussionKit",n[n.Idiophone=19]="Idiophone",n[n.Membraphone=20]="Membraphone",n}(M||{});class R{constructor(t,e,i=null){if(this.icon=M.Piano,this.icon=t,this.instrumentSetName=e,i)this.instrumentSetType=i;else{const s=e.split(" ");s[0]=s[0].substr(0,1).toLowerCase()+s[0].substr(1),this.instrumentSetType=s.join("")}}}class ws{constructor(){this._rhythmIdLookup=new Map}writeXml(t){const e=new Ph;return this._rhythmIdLookup=new Map,this.writeDom(e,t),e.toFormattedString("",!0)}writeDom(t,e){const i=t.addElement("GPIF");i.addElement("GPVersion").innerText="7";const s=i.addElement("GPRevision");s.innerText="7",s.attributes.set("required","12021"),s.attributes.set("recommended","12023"),s.innerText="12025",i.addElement("Encoding").addElement("EncodingDescription").innerText="GP7",this.writeScoreNode(i,e),this.writeMasterTrackNode(i,e),this.writeAudioTracksNode(i,e),this.writeTracksNode(i,e),this.writeMasterBarsNode(i,e);const r=i.addElement("Bars"),a=i.addElement("Voices"),o=i.addElement("Beats"),l=i.addElement("Notes"),c=i.addElement("Rhythms");for(const u of e.tracks)for(const h of u.staves)for(const f of h.bars){this.writeBarNode(r,f);for(const p of f.voices){this.writeVoiceNode(a,p);for(const g of p.beats){this.writeBeatNode(o,g,c);for(const m of g.notes)this.writeNoteNode(l,m)}}}}writeNoteNode(t,e){const i=t.addElement("Note");i.attributes.set("id",e.id.toString()),this.writeNoteProperties(i,e),e.isGhost&&(i.addElement("AntiAccent").innerText="normal"),e.isLetRing&&i.addElement("LetRing"),e.isTrill&&(i.addElement("Trill").innerText=e.trillValue.toString());let s=0;switch(e.isStaccato&&(s|=1),e.accentuated){case Ot.Normal:s|=8;break;case Ot.Heavy:s|=4;break;case Ot.Tenuto:s|=16}if(s>0&&(i.addElement("Accent").innerText=s.toString()),e.isTieOrigin||e.isTieDestination){const r=i.addElement("Tie");r.attributes.set("origin",e.isTieOrigin?"true":"false"),r.attributes.set("destination",e.isTieDestination?"true":"false")}switch(e.vibrato){case Ie.Slight:i.addElement("Vibrato").innerText="Slight";break;case Ie.Wide:i.addElement("Vibrato").innerText="Wide"}if(e.isFingering){switch(e.leftHandFinger){case se.Thumb:i.addElement("LeftFingering").innerText="P";break;case se.IndexFinger:i.addElement("LeftFingering").innerText="I";break;case se.MiddleFinger:i.addElement("LeftFingering").innerText="M";break;case se.AnnularFinger:i.addElement("LeftFingering").innerText="A";break;case se.LittleFinger:i.addElement("LeftFingering").innerText="C"}switch(e.rightHandFinger){case se.Thumb:i.addElement("RightFingering").innerText="P";break;case se.IndexFinger:i.addElement("RightFingering").innerText="I";break;case se.MiddleFinger:i.addElement("RightFingering").innerText="M";break;case se.AnnularFinger:i.addElement("RightFingering").innerText="A";break;case se.LittleFinger:i.addElement("RightFingering").innerText="C"}}i.addElement("InstrumentArticulation").innerText=e.percussionArticulation>=0?e.percussionArticulation.toString():"0",e.ornament!==Vt.None&&(i.addElement("Ornament").innerText=Vt[e.ornament])}writeNoteProperties(t,e){const i=t.addElement("Properties");if(this.writeConcertPitch(i,e),this.writeTransposedPitch(i,e),e.isStringed&&(this.writeSimplePropertyNode(i,"String","String",(e.string-1).toString()),this.writeSimplePropertyNode(i,"Fret","Fret",e.fret.toString()),this.writeSimplePropertyNode(i,"Midi","Number",e.realValue.toString()),e.showStringNumber&&this.writeSimplePropertyNode(i,"ShowStringNumber","Enable",null)),e.isPiano&&(this.writeSimplePropertyNode(i,"Octave","Number",e.octave.toString()),this.writeSimplePropertyNode(i,"Tone","Step",e.tone.toString()),this.writeSimplePropertyNode(i,"Midi","Number",e.realValue.toString())),e.beat.tap&&this.writeSimplePropertyNode(i,"Tapped","Enable",null),e.harmonicType!==ae.None){switch(e.harmonicType){case ae.Natural:this.writeSimplePropertyNode(i,"HarmonicType","HType","Natural");break;case ae.Artificial:this.writeSimplePropertyNode(i,"HarmonicType","HType","Artificial");break;case ae.Pinch:this.writeSimplePropertyNode(i,"HarmonicType","HType","Pinch");break;case ae.Tap:this.writeSimplePropertyNode(i,"HarmonicType","HType","Tap");break;case ae.Semi:this.writeSimplePropertyNode(i,"HarmonicType","HType","Semi");break;case ae.Feedback:this.writeSimplePropertyNode(i,"HarmonicType","HType","Feedback")}0!==e.harmonicValue&&this.writeSimplePropertyNode(i,"HarmonicFret","HFret",e.harmonicValue.toString())}e.isDead&&this.writeSimplePropertyNode(i,"Muted","Enable",null),e.isPalmMute&&this.writeSimplePropertyNode(i,"PalmMuted","Enable",null),e.hasBend&&this.writeBend(i,e),e.isHammerPullOrigin&&this.writeSimplePropertyNode(i,"HopoOrigin","Enable",null),e.isHammerPullDestination&&this.writeSimplePropertyNode(i,"HopoDestination","Enable",null),e.isLeftHandTapped&&this.writeSimplePropertyNode(i,"LeftHandTapped","Enable",null);let s=0;switch(e.slideInType){case pn.IntoFromAbove:s|=32;break;case pn.IntoFromBelow:s|=16}switch(e.slideOutType){case Se.Shift:s|=1;break;case Se.Legato:s|=2;break;case Se.OutDown:s|=4;break;case Se.OutUp:s|=8;break;case Se.PickSlideDown:s|=64;break;case Se.PickSlideUp:s|=128}s>0&&this.writeSimplePropertyNode(i,"Slide","Flags",s.toString())}writeTransposedPitch(t,e){e.isPercussion?this.writePitch(t,"ConcertPitch","C","-1",""):this.writePitchForValue(t,"TransposedPitch",e.displayValueWithoutBend,e.accidentalMode)}writeConcertPitch(t,e){e.isPercussion?this.writePitch(t,"ConcertPitch","C","-1",""):this.writePitchForValue(t,"ConcertPitch",e.realValueWithoutHarmonic,e.accidentalMode)}writePitchForValue(t,e,i,s){let r=0,a=0,o="",l="";const c=()=>{r=i%12,a=i/12|0,o=I.defaultSteps[r],l=I.defaultAccidentals[r]};switch(c(),s){case ke.Default:break;case ke.ForceNone:case ke.ForceNatural:l="";break;case ke.ForceSharp:l="#";break;case ke.ForceDoubleSharp:"#"===l&&(i-=2,c()),l="x";break;case ke.ForceFlat:"#"===l&&(i+=1,c()),l="b";break;case ke.ForceDoubleFlat:"#"===l&&(i+=2,c()),l="bb"}this.writePitch(t,e,o,a.toString(),l)}writePitch(t,e,i,s,r){const a=t.addElement("Property");a.attributes.set("name",e);const o=a.addElement("Pitch");o.addElement("Step").innerText=i,o.addElement("Accidental").innerText=r,o.addElement("Octave").innerText=s}writeBend(t,e){e.hasBend&&e.bendPoints.length<=4&&this.writeStandardBend(t,e.bendPoints)}writeStandardBend(t,e){this.writeSimplePropertyNode(t,"Bended","Enable",null);const i=e[0],s=e[e.length-1];let r,a;switch(e.length){case 4:r=e[1],a=e[2];break;case 3:r=e[1],a=e[1];break;default:r=new V((i.offset+s.offset)/2,(i.value+s.value)/2),a=r}this.writeSimplePropertyNode(t,"BendDestinationOffset","Float",this.toBendOffset(s.offset).toString()),this.writeSimplePropertyNode(t,"BendDestinationValue","Float",this.toBendValue(s.value).toString()),this.writeSimplePropertyNode(t,"BendMiddleOffset1","Float",this.toBendOffset(r.offset).toString()),this.writeSimplePropertyNode(t,"BendMiddleOffset2","Float",this.toBendOffset(a.offset).toString()),this.writeSimplePropertyNode(t,"BendMiddleValue","Float",this.toBendValue(r.value).toString()),this.writeSimplePropertyNode(t,"BendOriginOffset","Float",this.toBendOffset(i.offset).toString()),this.writeSimplePropertyNode(t,"BendOriginValue","Float",this.toBendValue(i.value).toString())}toBendValue(t){return 25*t}toBendOffset(t){return t/V.MaxPosition*100}writeBeatNode(t,e,i){const s=t.addElement("Beat");if(s.attributes.set("id",e.id.toString()),s.addElement("Dynamic").innerText=ie[e.dynamics],e.fade!==un.None&&(s.addElement("Fadding").innerText=un[e.fade]),e.isTremolo)switch(e.tremoloSpeed){case w.Eighth:s.addElement("Tremolo").innerText="1/2";break;case w.Sixteenth:s.addElement("Tremolo").innerText="1/4";break;case w.ThirtySecond:s.addElement("Tremolo").innerText="1/8"}switch(e.hasChord&&s.addElement("Chord").setCData(e.chordId),e.crescendo!==ii.None&&(s.addElement("Hairpin").innerText=ii[e.crescendo]),e.brushType){case Y.ArpeggioUp:s.addElement("Arpeggio").innerText="Up";break;case Y.ArpeggioDown:s.addElement("Arpeggio").innerText="Down"}switch(e.text&&s.addElement("FreeText").setCData(e.text),e.graceType){case re.OnBeat:case re.BeforeBeat:s.addElement("GraceNotes").innerText=re[e.graceType]}if(e.ottava!==we.Regular&&(s.addElement("Ottavia").innerText=we[e.ottava].substr(1)),e.hasWhammyBar&&this.writeWhammyNode(s,e),e.isLegatoOrigin||e.isLegatoDestination){const r=s.addElement("Legato");r.attributes.set("origin",e.isLegatoOrigin?"true":"false"),r.attributes.set("destination",e.isLegatoDestination?"true":"false")}if(this.writeRhythm(s,e,i),null!==e.preferredBeamDirection)switch(e.preferredBeamDirection){case B.Up:s.addElement("TransposedPitchStemOrientation").innerText="Upward",s.addElement("UserTransposedPitchStemOrientation").innerText="Upward";break;case B.Down:s.addElement("TransposedPitchStemOrientation").innerText="Downward",s.addElement("UserTransposedPitchStemOrientation").innerText="Downward"}s.addElement("ConcertPitchStemOrientation").innerText="Undefined",e.slashed&&s.addElement("Slashed"),e.deadSlapped&&s.addElement("DeadSlapped"),e.notes.length>0&&(s.addElement("Notes").innerText=e.notes.map(r=>r.id).join(" ")),e.golpe!==Ci.None&&(s.addElement("Golpe").innerText=Ci[e.golpe]),e.wahPedal!==Li.None&&(s.addElement("Wah").innerText=Li[e.wahPedal]),e.showTimer&&(s.addElement("Timer").innerText=(e.timer??0).toString()),this.writeBeatProperties(s,e),this.writeBeatXProperties(s,e),e.lyrics&&e.lyrics.length>0&&this.writeBeatLyrics(s,e.lyrics)}writeBeatLyrics(t,e){const i=t.addElement("Lyrics");for(const s of e)i.addElement("Line").setCData(s)}writeBeatXProperties(t,e){const i=t.addElement("XProperties");switch(e.brushDuration>0&&this.writeSimpleXPropertyNode(i,"687935489","Int",e.brushDuration.toString()),e.beamingMode){case St.ForceSplitToNext:this.writeSimpleXPropertyNode(i,"1124204546","Int","2");break;case St.ForceMergeWithNext:this.writeSimpleXPropertyNode(i,"1124204546","Int","1");break;case St.ForceSplitOnSecondaryToNext:this.writeSimpleXPropertyNode(i,"1124204552","Int","1")}}writeBeatProperties(t,e){const i=t.addElement("Properties");switch(e.brushType){case Y.BrushUp:this.writeSimplePropertyNode(i,"Brush","Direction","Up");break;case Y.BrushDown:this.writeSimplePropertyNode(i,"Brush","Direction","Down")}switch(e.pickStroke){case vn.Up:this.writeSimplePropertyNode(i,"PickStroke","Direction","Up");break;case vn.Down:this.writeSimplePropertyNode(i,"PickStroke","Direction","Down")}switch(e.slap&&this.writeSimplePropertyNode(i,"Slapped","Enable",null),e.pop&&this.writeSimplePropertyNode(i,"Popped","Enable",null),e.vibrato){case Ie.Wide:this.writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Wide");break;case Ie.Slight:this.writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Slight")}if(e.isBarre)switch(this.writeSimplePropertyNode(i,"BarreFret","Fret",e.barreFret.toString()),e.barreShape){case Ri.Full:this.writeSimplePropertyNode(i,"BarreString","String","0");break;case Ri.Half:this.writeSimplePropertyNode(i,"BarreString","String","1")}if(e.rasgueado!==X.None){let s="";switch(e.rasgueado){case X.Ii:s="ii_1";break;case X.Mi:s="mi_1";break;case X.MiiTriplet:s="mii_1";break;case X.MiiAnapaest:s="mii_2";break;case X.PmpTriplet:s="pmp_1";break;case X.PmpAnapaest:s="pmp_2";break;case X.PeiTriplet:s="pei_1";break;case X.PeiAnapaest:s="pei_2";break;case X.PaiTriplet:s="pai_1";break;case X.PaiAnapaest:s="pai_2";break;case X.AmiTriplet:s="ami_1";break;case X.AmiAnapaest:s="ami_2";break;case X.Ppp:s="ppp_1";break;case X.Amii:s="amii_1";break;case X.Amip:s="amip_1";break;case X.Eami:s="eami_1";break;case X.Eamii:s="eamii_1";break;case X.Peami:s="peami_1"}this.writeSimplePropertyNode(i,"Rasgueado","Rasgueado",s)}}writeRhythm(t,e,i){const s=`${e.duration}_${e.dots}_${e.tupletNumerator}_${e.tupletDenominator}';`;let r;if(this._rhythmIdLookup.has(s))r=this._rhythmIdLookup.get(s);else{r=this._rhythmIdLookup.size.toString(),this._rhythmIdLookup.set(s,r);const a=i.addElement("Rhythm");if(a.attributes.set("id",r),e.hasTuplet){const l=a.addElement("PrimaryTuplet");l.attributes.set("num",e.tupletNumerator.toString()),l.attributes.set("den",e.tupletDenominator.toString())}e.dots>0&&a.addElement("AugmentationDot").attributes.set("count",e.dots.toString());let o="Quarter";switch(e.duration){case w.QuadrupleWhole:o="Long";break;case w.DoubleWhole:o="DoubleWhole";break;case w.Whole:o="Whole";break;case w.Half:o="Half";break;case w.Quarter:o="Quarter";break;case w.Eighth:o="Eighth";break;case w.Sixteenth:o="16th";break;case w.ThirtySecond:o="32nd";break;case w.SixtyFourth:o="64th";break;case w.OneHundredTwentyEighth:o="128th";break;case w.TwoHundredFiftySixth:o="256th"}a.addElement("NoteValue").innerText=o}t.addElement("Rhythm").attributes.set("ref",r)}writeWhammyNode(t,e){e.hasWhammyBar&&e.whammyBarPoints.length<=4&&this.writeStandardWhammy(t,e.whammyBarPoints)}writeStandardWhammy(t,e){const i=t.addElement("Whammy"),s=e[0],r=e[e.length-1];let a,o;switch(e.length){case 4:a=e[1],o=e[2];break;case 3:a=e[1],o=e[1];break;default:a=new V((s.offset+r.offset)/2,(s.value+r.value)/2),o=a}i.attributes.set("destinationOffset",this.toBendOffset(r.offset).toString()),i.attributes.set("destinationValue",this.toBendValue(r.value).toString()),i.attributes.set("middleOffset1",this.toBendOffset(a.offset).toString()),i.attributes.set("middleOffset2",this.toBendOffset(o.offset).toString()),i.attributes.set("middleValue",this.toBendValue(a.value).toString()),i.attributes.set("originOffset",this.toBendOffset(s.offset).toString()),i.attributes.set("originValue",this.toBendValue(s.value).toString())}writeScoreNode(t,e){const i=t.addElement("Score");i.addElement("Title").setCData(e.title),i.addElement("SubTitle").setCData(e.subTitle),i.addElement("Artist").setCData(e.artist),i.addElement("Album").setCData(e.album),i.addElement("Words").setCData(e.words),i.addElement("Music").setCData(e.music),i.addElement("WordsAndMusic").setCData(e.words===e.music?e.words:""),i.addElement("Copyright").setCData(e.copyright),i.addElement("Tabber").setCData(e.tab),i.addElement("Instructions").setCData(e.instructions),i.addElement("Notices").setCData(e.notices),i.addElement("FirstPageHeader").setCData(""),i.addElement("FirstPageFooter").setCData(""),i.addElement("PageHeader").setCData(""),i.addElement("PageFooter").setCData(""),i.addElement("ScoreSystemsDefaultLayout").setCData(e.defaultSystemsLayout.toString()),i.addElement("ScoreSystemsLayout").setCData(e.systemsLayout.join(" ")),i.addElement("ScoreZoomPolicy").innerText="Value",i.addElement("ScoreZoom").innerText="1",i.addElement("MultiVoice").innerText="1>"}writeMasterTrackNode(t,e){const i=t.addElement("MasterTrack");i.addElement("Tracks").innerText=e.tracks.map(r=>r.index).join(" ");const s=i.addElement("Automations");if(e.masterBars.length>0&&e.masterBars[0].isAnacrusis&&i.addElement("Anacrusis"),0===e.masterBars[0].tempoAutomations.length){const r=s.addElement("Automation");r.addElement("Type").innerText="Tempo",r.addElement("Linear").innerText="false",r.addElement("Bar").innerText="0",r.addElement("Position").innerText="0",r.addElement("Visible").innerText="true",r.addElement("Value").innerText=`${e.tempo} 2`,e.tempoLabel&&(r.addElement("Text").innerText=e.tempoLabel)}for(const r of e.masterBars)for(const a of r.tempoAutomations){const o=s.addElement("Automation");o.addElement("Type").innerText="Tempo",o.addElement("Linear").innerText=a.isLinear?"true":"false",o.addElement("Bar").innerText=r.index.toString(),o.addElement("Position").innerText=a.ratioPosition.toString(),o.addElement("Visible").innerText="true",o.addElement("Value").innerText=`${a.value} 2`,a.text&&(o.addElement("Text").innerText=a.text)}}writeAudioTracksNode(t,e){t.addElement("AudioTracks")}writeTracksNode(t,e){const i=t.addElement("Tracks");for(const s of e.tracks)this.writeTrackNode(i,s)}writeTrackNode(t,e){const i=t.addElement("Track");i.attributes.set("id",e.index.toString()),i.addElement("Name").setCData(e.name),i.addElement("ShortName").setCData(e.shortName),i.addElement("Color").innerText=`${e.color.r} ${e.color.g} ${e.color.b}`,i.addElement("SystemsDefautLayout").innerText=e.defaultSystemsLayout.toString(),i.addElement("SystemsLayout").innerText=e.systemsLayout.join(" "),i.addElement("AutoBrush"),i.addElement("PalmMute").innerText="0",i.addElement("PlayingStyle").innerText=qs.isGuitar(e.playbackInfo.program)?"StringedPick":"Default",i.addElement("UseOneChannelPerString"),i.addElement("IconId").innerText=ws.getIconId(e.playbackInfo).toString(),this.writeInstrumentSetNode(i,e),this.writeTransposeNode(i,e),this.writeRseNode(i,e),i.addElement("ForcedSound").innerText="-1",this.writeMidiConnectionNode(i,e),i.addElement("PlaybackState").innerText=e.playbackInfo.isSolo?"Solo":e.playbackInfo.isMute?"Mute":"Default",i.addElement("AudioEngineState").innerText="MIDI",this.writeLyricsNode(i,e),this.writeStavesNode(i,e),this.writeSoundsAndAutomations(i,e)}static getIconId(t){return 9===t.primaryChannel?ws.DrumKitProgramInfo.icon:ws.MidiProgramInfoLookup.has(t.program)?ws.MidiProgramInfoLookup.get(t.program).icon:M.SteelGuitar}writeSoundAndAutomation(t,e,i,s,r,a,o,l=0){const c=t.addElement("Sound");c.addElement("Name").setCData(i),c.addElement("Label").setCData(i),c.addElement("Path").setCData(s),c.addElement("Role").setCData(r);const u=c.addElement("MIDI");u.addElement("LSB").innerText="0",u.addElement("MSB").innerText="0",u.addElement("Program").innerText=o.toString();const h=e.addElement("Automation");h.addElement("Type").innerText="Sound",h.addElement("Linear").innerText="false",h.addElement("Bar").innerText=a.toString(),h.addElement("Position").innerText=l.toString(),h.addElement("Visible").innerText="true",h.addElement("Value").setCData(`${s};${i};${r}`)}writeSoundsAndAutomations(t,e){const i=t.addElement("Sounds"),s=t.addElement("Automations");if(e.staves.length>0&&e.staves[0].bars.length>0){const r=`Track_${e.index}_Initial`,a=`Midi/${e.playbackInfo.program}`,o="Factory";let l=!1;for(const c of e.staves)for(const u of c.bars)for(const h of u.voices)for(const f of h.beats){const p=f.getAutomation(Bt.Instrument),g=0===u.index&&0===f.index;if(p){const m=g?r:`ProgramChange_${f.id}`,y=g?a:`Midi/${p.value}`,b=g?o:"User";!g&&!l&&(this.writeSoundAndAutomation(i,s,r,a,o,e.staves[0].bars[0].index,e.playbackInfo.program),l=!0),this.writeSoundAndAutomation(i,s,m,y,b,u.index,p.value,p.ratioPosition),g&&(l=!0)}}}for(const r of e.staves)for(const a of r.bars)for(const o of a.sustainPedals)if(o.pedalType!==jt.Hold){const l=s.addElement("Automation");switch(l.addElement("Type").innerText="SustainPedal",l.addElement("Linear").innerText="false",l.addElement("Bar").innerText=a.index.toString(),l.addElement("Position").innerText=o.ratioPosition.toString(),l.addElement("Visible").innerText="true",o.pedalType){case jt.Down:l.addElement("Value").innerText="0 1";break;case jt.Up:l.addElement("Value").innerText="0 3"}}}writeMidiConnectionNode(t,e){const i=t.addElement("MidiConnection");i.addElement("Port").innerText=e.playbackInfo.port.toString(),i.addElement("PrimaryChannel").innerText=e.playbackInfo.primaryChannel.toString(),i.addElement("SecondaryChannel").innerText=e.playbackInfo.secondaryChannel.toString(),i.addElement("ForeOneChannelPerString").innerText="false"}writeRseNode(t,e){const s=t.addElement("RSE").addElement("ChannelStrip");s.attributes.set("version","E56"),s.addElement("Parameters").innerText=`0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 ${e.playbackInfo.balance/16} ${e.playbackInfo.volume/16} 0.5 0.5 0.5`}writeStavesNode(t,e){const i=t.addElement("Staves");for(const s of e.staves)this.writeStaffNode(i,s)}writeStaffNode(t,e){const s=t.addElement("Staff").addElement("Properties");if(this.writeSimplePropertyNode(s,"CapoFret","Fret",e.capo.toString()),this.writeSimplePropertyNode(s,"FretCount","Fret","24"),e.tuning.length>0){const r=s.addElement("Property");switch(r.attributes.set("name","Tuning"),r.addElement("Pitches").innerText=e.tuning.slice().reverse().join(" "),r.addElement("Label").setCData(e.tuningName),r.addElement("LabelVisible").innerText=e.tuningName?"true":"false",r.addElement("Flat"),e.tuning.length){case 3:r.addElement("Instrument").innerText="Shamisen";break;case 4:r.addElement("Instrument").innerText=105===e.track.playbackInfo.program?"Banjo":42===e.track.playbackInfo.program?"Cello":43===e.track.playbackInfo.program?"Contrabass":40===e.track.playbackInfo.program?"Violin":41===e.track.playbackInfo.program?"Viola":"Bass";break;case 5:r.addElement("Instrument").innerText=105===e.track.playbackInfo.program?"Banjo":"Bass";break;case 6:r.addElement("Instrument").innerText=105===e.track.playbackInfo.program?"Banjo":e.track.playbackInfo.program<=39?"Bass":"Guitar";break;case 7:r.addElement("Instrument").innerText=e.track.playbackInfo.program<=39?"Bass":"Guitar";break;default:r.addElement("Instrument").innerText="Guitar"}}this.writeSimplePropertyNode(s,"PartialCapoFret","Fret","0"),this.writeSimplePropertyNode(s,"PartialCapoStringFlags","Bitset",e.tuning.map(r=>"0").join("")),this.writeSimplePropertyNode(s,"TuningFlat","Enable",null),this.writeDiagramCollection(s,e,"DiagramCollection"),this.writeDiagramCollection(s,e,"DiagramWorkingSet")}writeDiagramCollection(t,e,i){const s=t.addElement("Property");s.attributes.set("name",i);const r=s.addElement("Items"),a=e.chords;if(a)for(const[o,l]of a){const c=r.addElement("Item");c.attributes.set("id",o),c.attributes.set("name",l.name);const u=c.addElement("Diagram");u.attributes.set("stringCount",l.strings.length.toString()),u.attributes.set("fretCount","5"),u.attributes.set("baseFret",(l.firstFret-1).toString()),u.attributes.set("barStates",l.strings.map(D=>"1").join(" "));const h=[],f=new Map;for(let D=0;D<l.strings.length;D++){const C=l.strings[D];if(-1!==C){const oe=u.addElement("Fret"),at=l.strings.length-1-D;oe.attributes.set("string",at.toString()),oe.attributes.set("fret",(C-l.firstFret+1).toString()),f.has(C)||(f.set(C,[]),h.push(C)),f.get(C).push(at)}}h.sort();const p=u.addElement("Fingering");if(l.barreFrets.length>0){const D=[se.LittleFinger,se.AnnularFinger,se.MiddleFinger,se.IndexFinger];for(const C of h){const oe=f.get(C);if(oe.length>1&&l.barreFrets.indexOf(C)>=0){const at=D.length>0?D.pop():se.IndexFinger;for(const Fe of oe){const ne=p.addElement("Position");switch(at){case se.LittleFinger:ne.attributes.set("finger","Pinky");break;case se.AnnularFinger:ne.attributes.set("finger","Ring");break;case se.MiddleFinger:ne.attributes.set("finger","Middle");break;case se.IndexFinger:ne.attributes.set("finger","Index")}ne.attributes.set("fret",(C-l.firstFret+1).toString()),ne.attributes.set("string",Fe.toString())}}}}const g=u.addElement("Property");g.attributes.set("name","ShowName"),g.attributes.set("type","bool"),g.attributes.set("value",l.showName?"true":"false");const m=u.addElement("Property");m.attributes.set("name","ShowDiagram"),m.attributes.set("type","bool"),m.attributes.set("value",l.showDiagram?"true":"false");const y=u.addElement("Property");y.attributes.set("name","ShowFingering"),y.attributes.set("type","bool"),y.attributes.set("value",l.showFingering?"true":"false");const b=u.addElement("Chord"),_=b.addElement("KeyNote");_.attributes.set("step","C"),_.attributes.set("accidental","Natural");const v=b.addElement("BassNote");v.attributes.set("step","C"),v.attributes.set("accidental","Natural");const k=b.addElement("Degree");k.attributes.set("interval","Third"),k.attributes.set("alteration","Major"),k.attributes.set("omitted","false");const F=b.addElement("Degree");F.attributes.set("interval","Fifth"),F.attributes.set("alteration","Perfect"),F.attributes.set("omitted","false")}}writeSimplePropertyNode(t,e,i,s){const r=t.addElement("Property");r.attributes.set("name",e);const a=r.addElement(i);return null!==s&&(a.innerText=s),r}writeSimpleXPropertyNode(t,e,i,s){const r=t.addElement("XProperty");r.attributes.set("id",e);const a=r.addElement(i);return null!==s&&(a.innerText=s),r}writeLyricsNode(t,e){const i=t.addElement("Lyrics");i.attributes.set("dispatched","true");const s=[];for(const r of e.staves[0].bars)for(const a of r.voices)if(!a.isEmpty)for(const o of a.beats)if(o.lyrics)for(let l=0;l<o.lyrics.length;l++){for(;l>=s.length;){const u=new vc;u.startBar=r.index,u.text="[Empty]",s.push(u)}const c=s[l];c.text="[Empty]"===c.text?o.lyrics[l]:`${c.text} ${o.lyrics[l].split(" ").join("+")}`}for(let r=0;r<s.length;r++){const a=i.addElement("Line");a.addElement("Text").setCData(s[r].text),a.addElement("Offset").innerText=s[r].startBar.toString()}}writeTransposeNode(t,e){const i=t.addElement("Transpose"),s=Math.floor(e.staves[0].displayTranspositionPitch/12),r=e.staves[0].displayTranspositionPitch-12*s;i.addElement("Chromatic").innerText=r.toString(),i.addElement("Octave").innerText=s.toString()}writeInstrumentSetNode(t,e){const i=t.addElement("InstrumentSet"),s=e.staves[0];if(i.addElement("LineCount").innerText=s.standardNotationLineCount.toString(),e.percussionArticulations.length>0||s.isPercussion){const r=e.percussionArticulations.length>0?e.percussionArticulations:Array.from(nn.instrumentArticulations.values());i.addElement("Name").innerText=ws.DrumKitProgramInfo.instrumentSetName,i.addElement("Type").innerText=ws.DrumKitProgramInfo.instrumentSetType;let a="",o=new Bs;const l=new Map,c=i.addElement("Elements");for(const u of r){{const f=c.addElement("Element");let p=u.elementType;if(l.has(p)){const g=l.get(p);p+=` ${g}`,l.set(p,g+1)}else l.set(p,1);a=p,f.addElement("Name").innerText=p,f.addElement("Type").innerText=u.elementType,o=f.addElement("Articulations")}const h=o.addElement("Articulation");switch(h.addElement("Name").innerText=`${a} ${o.childNodes.length}`,h.addElement("StaffLine").innerText=u.staffLine.toString(),h.addElement("Noteheads").innerText=[this.mapMusicSymbol(u.noteHeadDefault),this.mapMusicSymbol(u.noteHeadHalf),this.mapMusicSymbol(u.noteHeadWhole)].join(" "),u.techniqueSymbolPlacement){case ge.Top:h.addElement("TechniquePlacement").innerText="below";break;case ge.Middle:h.addElement("TechniquePlacement").innerText="inside";break;case ge.Bottom:h.addElement("TechniquePlacement").innerText="above"}h.addElement("TechniqueSymbol").innerText=this.mapMusicSymbol(u.techniqueSymbol),h.addElement("InputMidiNumbers").innerText="",h.addElement("OutputMidiNumber").innerText=u.outputMidiNumber.toString()}}else{const r=ws.MidiProgramInfoLookup.has(e.playbackInfo.program)?ws.MidiProgramInfoLookup.get(e.playbackInfo.program):ws.MidiProgramInfoLookup.get(0);i.addElement("Name").innerText=r.instrumentSetName,i.addElement("Type").innerText=r.instrumentSetType;const o=i.addElement("Elements").addElement("Element");o.addElement("Pitched").innerText="Pitched",o.addElement("Type").innerText="pitched",o.addElement("SoundbankName").innerText="";const c=o.addElement("Articulations").addElement("Articulation");c.addElement("Name").innerText="",c.addElement("StaffLine").innerText="0",c.addElement("Noteheads").innerText="noteheadBlack noteheadHalf noteheadWhole",c.addElement("TechniquePlacement").innerText="outside",c.addElement("TechniqueSymbol").innerText="",c.addElement("InputMidiNumbers").innerText="",c.addElement("OutputRSESound").innerText="",c.addElement("OutputMidiNumber").innerText="0"}}mapMusicSymbol(t){if(t===d.None)return"";const e=d[t];return e.substring(0,1).toLowerCase()+e.substring(1)}writeMasterBarsNode(t,e){const i=t.addElement("MasterBars");for(const s of e.masterBars)this.writeMasterBarNode(i,s)}writeMasterBarNode(t,e){const i=t.addElement("MasterBar"),s=i.addElement("Key");s.addElement("AccidentalCount").innerText=e.keySignature.toString(),s.addElement("Mode").innerText=li[e.keySignatureType],s.addElement("Sharps").innerText="Sharps",i.addElement("Time").innerText=`${e.timeSignatureNumerator}/${e.timeSignatureDenominator}`,e.isFreeTime&&i.addElement("FreeTime");const r=[];for(const a of e.score.tracks)for(const o of a.staves)r.push(o.bars[e.index].id.toString());if(i.addElement("Bars").innerText=r.join(" "),e.isDoubleBar&&i.addElement("DoubleBar"),e.isSectionStart){const a=i.addElement("Section");a.addElement("Letter").setCData(e.section.marker),a.addElement("Text").setCData(e.section.text)}if(e.isRepeatStart||e.isRepeatEnd){const a=i.addElement("Repeat");a.attributes.set("start",e.isRepeatStart?"true":"false"),a.attributes.set("end",e.isRepeatEnd?"true":"false"),e.isRepeatEnd&&a.attributes.set("count",e.repeatCount.toString())}if(e.alternateEndings>0){let a=e.alternateEndings;const o=[];let l=0;for(;a>0;)1==(a>>l&1)&&(o.push(l+1),a&=~(1<<l)),l++;i.addElement("AlternateEndings").innerText=o.join(" ")}if(e.tripletFeel!==_e.NoTripletFeel&&(i.addElement("TripletFeel").innerText=_e[e.tripletFeel]),e.directions&&e.directions.size>0){const a=i.addElement("Directions");for(const o of e.directions)switch(o){case A.TargetFine:a.addElement("Target").innerText="Fine";break;case A.TargetSegno:a.addElement("Target").innerText="Segno";break;case A.TargetSegnoSegno:a.addElement("Target").innerText="SegnoSegno";break;case A.TargetCoda:a.addElement("Target").innerText="Coda";break;case A.TargetDoubleCoda:a.addElement("Target").innerText="DoubleCoda";break;case A.JumpDaCapo:a.addElement("Jump").innerText="DaCapo";break;case A.JumpDaCapoAlCoda:a.addElement("Jump").innerText="DaCapoAlCoda";break;case A.JumpDaCapoAlDoubleCoda:a.addElement("Jump").innerText="DaCapoAlDoubleCoda";break;case A.JumpDaCapoAlFine:a.addElement("Jump").innerText="DaCapoAlFine";break;case A.JumpDalSegno:a.addElement("Jump").innerText="DaSegno";break;case A.JumpDalSegnoAlCoda:a.addElement("Jump").innerText="DaSegnoAlCoda";break;case A.JumpDalSegnoAlDoubleCoda:a.addElement("Jump").innerText="DaSegnoAlDoubleCoda";break;case A.JumpDalSegnoAlFine:a.addElement("Jump").innerText="DaSegnoAlFine";break;case A.JumpDalSegnoSegno:a.addElement("Jump").innerText="DaSegnoSegno";break;case A.JumpDalSegnoSegnoAlCoda:a.addElement("Jump").innerText="DaSegnoSegnoAlCoda";break;case A.JumpDalSegnoSegnoAlDoubleCoda:a.addElement("Jump").innerText="DaSegnoSegnoAlDoubleCoda";break;case A.JumpDalSegnoSegnoAlFine:a.addElement("Jump").innerText="DaSegnoSegnoAlFine";break;case A.JumpDaCoda:a.addElement("Jump").innerText="DaCoda";break;case A.JumpDaDoubleCoda:a.addElement("Jump").innerText="DaDoubleCoda"}}this.writeFermatas(i,e)}writeFermatas(t,e){const i=e.fermata?.size??0;if(0!==i&&i>0){const s=t.addElement("Fermatas");for(const[r,a]of e.fermata)this.writeFermata(s,r,a)}}writeFermata(t,e,i){let s=-1,r=1;if(e>0)for(;r<10&&(s=e/P.QuarterTime*r,s!==Math.floor(s));)s=-1,r++;else s=0,r=1;if(-1===s)return;const a=t.addElement("Fermata");a.addElement("Type").innerText=jn[i.type],a.addElement("Length").innerText=i.length.toString(),a.addElement("Offset").innerText=`${s}/${r}`}writeBarNode(t,e){const i=t.addElement("Bar");i.attributes.set("id",e.id.toString()),i.addElement("Voices").innerText=e.voices.map(s=>s.isEmpty?"-1":s.id.toString()).join(" "),i.addElement("Clef").innerText=Be[e.clef],e.clefOttava!==we.Regular&&(i.addElement("Ottavia").innerText=we[e.clefOttava].substr(1)),e.simileMark!==$t.None&&(i.addElement("SimileMark").innerText=$t[e.simileMark])}writeVoiceNode(t,e){if(e.isEmpty)return;const i=t.addElement("Voice");i.attributes.set("id",e.id.toString()),i.addElement("Beats").innerText=e.beats.map(s=>s.id).join(" ")}}ws.MidiProgramInfoLookup=new Map([[0,new R(M.Piano,"Acoustic Piano")],[1,new R(M.Piano,"Acoustic Piano")],[2,new R(M.Piano,"Electric Piano")],[3,new R(M.Piano,"Acoustic Piano")],[4,new R(M.Piano,"Electric Piano")],[5,new R(M.Piano,"Electric Piano")],[6,new R(M.Piano,"Harpsichord")],[7,new R(M.Piano,"Harpsichord")],[8,new R(M.PitchedIdiophone,"Celesta")],[9,new R(M.PitchedIdiophone,"Vibraphone")],[10,new R(M.PitchedIdiophone,"Vibraphone")],[11,new R(M.PitchedIdiophone,"Vibraphone")],[12,new R(M.PitchedIdiophone,"Xylophone")],[13,new R(M.PitchedIdiophone,"Xylophone")],[14,new R(M.PitchedIdiophone,"Vibraphone")],[15,new R(M.Banjo,"Banjo")],[16,new R(M.Piano,"Electric Organ")],[17,new R(M.Piano,"Electric Organ")],[18,new R(M.Piano,"Electric Organ")],[19,new R(M.Piano,"Electric Organ")],[20,new R(M.Piano,"Electric Organ")],[21,new R(M.Piano,"Electric Organ")],[22,new R(M.Woodwind,"Recorder")],[23,new R(M.Piano,"Electric Organ")],[24,new R(M.ClassicalGuitar,"Nylon Guitar")],[25,new R(M.SteelGuitar,"Steel Guitar")],[26,new R(M.SteelGuitar,"Electric Guitar")],[27,new R(M.ElectricGuitar,"Electric Guitar")],[28,new R(M.ElectricGuitar,"Electric Guitar")],[29,new R(M.ElectricGuitar,"Electric Guitar")],[30,new R(M.SteelGuitar,"Electric Guitar")],[31,new R(M.SteelGuitar,"Electric Guitar")],[32,new R(M.Bass,"Acoustic Bass")],[33,new R(M.Bass,"Electric Bass")],[34,new R(M.Bass,"Electric Bass")],[35,new R(M.Bass,"Acoustic Bass")],[36,new R(M.Bass,"Electric Bass")],[37,new R(M.Bass,"Electric Bass")],[38,new R(M.Synth,"Synth Bass")],[39,new R(M.Synth,"Synth Bass")],[40,new R(M.Strings,"Violin")],[41,new R(M.Strings,"Viola")],[42,new R(M.Strings,"Cello")],[43,new R(M.Strings,"Contrabass")],[44,new R(M.Strings,"Violin")],[45,new R(M.Strings,"Violin")],[46,new R(M.Piano,"Harp")],[47,new R(M.Membraphone,"Timpani")],[48,new R(M.Strings,"Violin")],[49,new R(M.Strings,"Violin")],[50,new R(M.Strings,"Violin")],[51,new R(M.Strings,"Violin")],[52,new R(M.Vocal,"Voice")],[53,new R(M.Vocal,"Voice")],[54,new R(M.Vocal,"Voice")],[55,new R(M.Synth,"Pad Synthesizer")],[56,new R(M.Brass,"Trumpet")],[57,new R(M.Brass,"Trombone")],[58,new R(M.Brass,"Tuba")],[59,new R(M.Brass,"Trumpet")],[60,new R(M.Brass,"French Horn")],[61,new R(M.Brass,"Trumpet")],[62,new R(M.Brass,"Trumpet")],[63,new R(M.Brass,"Trumpet")],[64,new R(M.Reed,"Saxophone")],[65,new R(M.Reed,"Saxophone")],[66,new R(M.Reed,"Saxophone")],[67,new R(M.Reed,"Saxophone")],[68,new R(M.Reed,"Oboe")],[69,new R(M.Reed,"English Horn")],[70,new R(M.Reed,"Bassoon")],[71,new R(M.Reed,"Clarinet")],[72,new R(M.Reed,"Piccolo")],[73,new R(M.Woodwind,"Flute")],[74,new R(M.Woodwind,"Recorder")],[75,new R(M.Woodwind,"Flute")],[76,new R(M.Woodwind,"Recorder")],[77,new R(M.Woodwind,"Flute")],[78,new R(M.Woodwind,"Recorder")],[79,new R(M.Woodwind,"Flute")],[80,new R(M.Synth,"Lead Synthesizer")],[81,new R(M.Synth,"Lead Synthesizer")],[82,new R(M.Synth,"Lead Synthesizer")],[83,new R(M.Synth,"Lead Synthesizer")],[84,new R(M.Synth,"Lead Synthesizer")],[85,new R(M.Synth,"Lead Synthesizer")],[86,new R(M.Synth,"Lead Synthesizer")],[87,new R(M.Synth,"Lead Synthesizer")],[88,new R(M.Synth,"Pad Synthesizer")],[89,new R(M.Synth,"Pad Synthesizer")],[90,new R(M.Synth,"Pad Synthesizer")],[91,new R(M.Synth,"Pad Synthesizer")],[92,new R(M.Synth,"Pad Synthesizer")],[93,new R(M.Synth,"Pad Synthesizer")],[94,new R(M.Synth,"Pad Synthesizer")],[95,new R(M.Synth,"Pad Synthesizer")],[96,new R(M.Fx,"Pad Synthesizer")],[97,new R(M.Fx,"Pad Synthesizer")],[98,new R(M.Fx,"Pad Synthesizer")],[99,new R(M.Fx,"Pad Synthesizer")],[100,new R(M.Fx,"Lead Synthesizer")],[101,new R(M.Fx,"Lead Synthesizer")],[102,new R(M.Fx,"Lead Synthesizer")],[103,new R(M.Fx,"Trumpet")],[104,new R(M.ElectricGuitar,"Banjo")],[105,new R(M.Banjo,"Banjo")],[106,new R(M.Ukulele,"Ukulele")],[107,new R(M.Banjo,"Banjo")],[108,new R(M.PitchedIdiophone,"Xylophone")],[109,new R(M.Reed,"Bassoon")],[110,new R(M.Strings,"Violin")],[111,new R(M.Woodwind,"Flute")],[112,new R(M.PitchedIdiophone,"Xylophone")],[113,new R(M.Idiophone,"Celesta")],[114,new R(M.PitchedIdiophone,"Vibraphone")],[115,new R(M.Idiophone,"Xylophone")],[116,new R(M.Membraphone,"Xylophone")],[117,new R(M.Membraphone,"Xylophone")],[118,new R(M.Membraphone,"Xylophone")],[119,new R(M.Idiophone,"Celesta")],[120,new R(M.Fx,"Steel Guitar")],[121,new R(M.Fx,"Recorder")],[122,new R(M.Fx,"Recorder")],[123,new R(M.Fx,"Recorder")],[124,new R(M.Fx,"Recorder")],[125,new R(M.Fx,"Recorder")],[126,new R(M.Fx,"Recorder")],[127,new R(M.Fx,"Timpani")]]),ws.DrumKitProgramInfo=new R(M.PercussionKit,"Drums","drumKit");class la{static buildCrc32Lookup(){const e=new Uint32Array(256);for(let i=0;i<e.length;i++){let s=i;for(let r=0;r<8;r++)s=1==(1&s)?s>>>1^3988292384:s>>>1;e[i]=s}return e}get value(){return~this._checkValue}constructor(){this._checkValue=la.CrcInit,this.reset()}update(t,e,i){for(let s=0;s<i;s++)this._checkValue=la.Crc32Lookup[255&(this._checkValue^t[e+s])]^this._checkValue>>>8}reset(){this._checkValue=la.CrcInit}}la.Crc32Lookup=la.buildCrc32Lookup(),la.CrcInit=4294967295;class de{}de.MAX_WBITS=15,de.WSIZE=1<<de.MAX_WBITS,de.WMASK=de.WSIZE-1,de.MIN_MATCH=3,de.MAX_MATCH=258,de.DEFAULT_MEM_LEVEL=8,de.PENDING_BUF_SIZE=1<<de.DEFAULT_MEM_LEVEL+8,de.HASH_BITS=de.DEFAULT_MEM_LEVEL+7,de.HASH_SIZE=1<<de.HASH_BITS,de.HASH_SHIFT=(de.HASH_BITS+de.MIN_MATCH-1)/de.MIN_MATCH,de.HASH_MASK=de.HASH_SIZE-1,de.MIN_LOOKAHEAD=de.MAX_MATCH+de.MIN_MATCH+1,de.MAX_DIST=de.WSIZE-de.MIN_LOOKAHEAD;let N_=(()=>{class n{constructor(e,i,s,r){this.length=null,this.numCodes=0,this.codes=null,this.huffman=e,this.minNumCodes=s,this.maxLength=r,this.freqs=new Int16Array(i),this.bitLengthCounts=new Int32Array(r)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this.codes=null,this.length=null}buildTree(){const e=this.freqs.length,i=new Int32Array(e);let s=0,r=0;for(let u=0;u<e;u++){const h=this.freqs[u];if(0!==h){let f=s++;for(;f>0;){const p=Math.floor((f-1)/2);if(!(this.freqs[i[p]]>h))break;i[f]=i[p],f=p}i[f]=u,r=u}}for(;s<2;){const u=r<2?++r:0;i[s++]=u}this.numCodes=Math.max(r+1,this.minNumCodes);const a=s,o=new Int32Array(4*s-2),l=new Int32Array(2*s-1);let c=a;for(let u=0;u<s;u++){const h=i[u];o[2*u]=h,o[2*u+1]=-1,l[u]=this.freqs[h]<<8,i[u]=u}do{const u=i[0];let h=i[--s],f=0,p=1;for(;p<s;)p+1<s&&l[i[p]]>l[i[p+1]]&&p++,i[f]=i[p],f=p,p=2*p+1;let g=l[h];for(;p=f,f>0&&(f=Math.floor((p-1)/2),l[i[f]]>g);)i[p]=i[f];i[p]=h;const m=i[0];h=c++,o[2*h]=u,o[2*h+1]=m;const y=Math.min(255&l[u],255&l[m]);for(g=l[u]+l[m]-y+1,l[h]=g,f=0,p=1;p<s;)p+1<s&&l[i[p]]>l[i[p+1]]&&p++,i[f]=i[p],f=p,p=2*f+1;for(;p=f,p>0&&(f=Math.floor((p-1)/2),l[i[f]]>g);)i[p]=i[f];i[p]=h}while(s>1);this.buildLength(o)}buildLength(e){this.length=new Uint8Array(this.freqs.length);const i=Math.floor(e.length/2),s=Math.floor((i+1)/2);let r=0;for(let c=0;c<this.maxLength;c++)this.bitLengthCounts[c]=0;const a=new Int32Array(i);a[i-1]=0;for(let c=i-1;c>=0;c--)if(-1!==e[2*c+1]){let u=a[c]+1;u>this.maxLength&&(u=this.maxLength,r++),a[e[2*c]]=u,a[e[2*c+1]]=u}else this.bitLengthCounts[a[c]-1]++,this.length[e[2*c]]=a[c];if(0===r)return;let o=this.maxLength-1;do{for(;0===this.bitLengthCounts[--o];);do{this.bitLengthCounts[o]--,this.bitLengthCounts[++o]++,r-=1<<this.maxLength-1-o}while(r>0&&o<this.maxLength-1)}while(r>0);this.bitLengthCounts[this.maxLength-1]+=r,this.bitLengthCounts[this.maxLength-2]-=r;let l=2*s;for(let c=this.maxLength;0!==c;c--){let u=this.bitLengthCounts[c-1];for(;u>0;){const h=2*e[l++];-1===e[h+1]&&(this.length[e[h]]=c,u--)}}}getEncodedLength(){let e=0;for(let i=0;i<this.freqs.length;i++)e+=this.freqs[i]*this.length[i];return e}calcBLFreq(e){let i,s,r,a=-1,o=0;for(;o<this.numCodes;){r=1;const l=this.length[o];for(0===l?(i=138,s=3):(i=6,s=3,a!==l&&(e.freqs[l]++,r=0)),a=l,o++;o<this.numCodes&&a===this.length[o]&&(o++,!(++r>=i)););r<s?e.freqs[a]+=r:0!==a?e.freqs[n.Repeat3To6]++:r<=10?e.freqs[n.Repeat3To10]++:e.freqs[n.Repeat11To138]++}}setStaticCodes(e,i){this.codes=e,this.length=i}buildCodes(){const e=new Int32Array(this.maxLength);let i=0;this.codes=new Int16Array(this.freqs.length);for(let s=0;s<this.maxLength;s++)e[s]=i,i+=this.bitLengthCounts[s]<<15-s;for(let s=0;s<this.numCodes;s++){const r=this.length[s];r>0&&(this.codes[s]=me.bitReverse(e[r-1]),e[r-1]+=1<<16-r)}}writeTree(e){let i,s,r,a=-1,o=0;for(;o<this.numCodes;){r=1;const l=this.length[o];for(0===l?(i=138,s=3):(i=6,s=3,a!==l&&(e.writeSymbol(l),r=0)),a=l,o++;o<this.numCodes&&a===this.length[o]&&(o++,!(++r>=i)););if(r<s)for(;r-- >0;)e.writeSymbol(a);else 0!==a?(e.writeSymbol(n.Repeat3To6),this.huffman.pending.writeBits(r-3,2)):r<=10?(e.writeSymbol(n.Repeat3To10),this.huffman.pending.writeBits(r-3,3)):(e.writeSymbol(n.Repeat11To138),this.huffman.pending.writeBits(r-11,7))}}writeSymbol(e){this.huffman.pending.writeBits(65535&this.codes[e],this.length[e])}}return n.Repeat3To6=16,n.Repeat3To10=17,n.Repeat11To138=18,n})();class me{static staticInit(){let t=0;for(;t<144;)me.staticLCodes[t]=me.bitReverse(48+t<<8),me.staticLLength[t++]=8;for(;t<256;)me.staticLCodes[t]=me.bitReverse(256+t<<7),me.staticLLength[t++]=9;for(;t<280;)me.staticLCodes[t]=me.bitReverse(-256+t<<9),me.staticLLength[t++]=7;for(;t<me.LITERAL_NUM;)me.staticLCodes[t]=me.bitReverse(-88+t<<8),me.staticLLength[t++]=8;for(t=0;t<me.DIST_NUM;t++)me.staticDCodes[t]=me.bitReverse(t<<11),me.staticDLength[t]=5}static bitReverse(t){return me.bit4Reverse[15&t]<<12|me.bit4Reverse[t>>4&15]<<8|me.bit4Reverse[t>>8&15]<<4|me.bit4Reverse[t>>12]}constructor(t){this.last_lit=0,this.extra_bits=0,this.pending=t,this.literalTree=new N_(this,me.LITERAL_NUM,257,15),this.distTree=new N_(this,me.DIST_NUM,1,15),this.blTree=new N_(this,me.BITLEN_NUM,4,7),this.d_buf=new Int16Array(me.BUFSIZE),this.l_buf=new Uint8Array(me.BUFSIZE)}isFull(){return this.last_lit>=me.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(t,e,i,s){this.pending.writeBits((me.STORED_BLOCK<<1)+(s?1:0),3),this.pending.alignToByte(),this.pending.writeShort(i),this.pending.writeShort(~i),this.pending.writeBlock(t,e,i),this.reset()}flushBlock(t,e,i,s){this.literalTree.freqs[me.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let r=4;for(let l=18;l>r;l--)this.blTree.length[me.BL_ORDER[l]]>0&&(r=l+1);let a=14+3*r+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,o=this.extra_bits;for(let l=0;l<me.LITERAL_NUM;l++)o+=this.literalTree.freqs[l]*me.staticLLength[l];for(let l=0;l<me.DIST_NUM;l++)o+=this.distTree.freqs[l]*me.staticDLength[l];a>=o&&(a=o),e>=0&&i+4<a>>3?this.flushStoredBlock(t,e,i,s):a===o?(this.pending.writeBits((me.STATIC_TREES<<1)+(s?1:0),3),this.literalTree.setStaticCodes(me.staticLCodes,me.staticLLength),this.distTree.setStaticCodes(me.staticDCodes,me.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((me.DYN_TREES<<1)+(s?1:0),3),this.sendAllTrees(r),this.compressBlock(),this.reset())}sendAllTrees(t){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(t-4,4);for(let e=0;e<t;e++)this.pending.writeBits(this.blTree.length[me.BL_ORDER[e]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let t=0;t<this.last_lit;t++){const e=255&this.l_buf[t];let i=this.d_buf[t];if(0!=i--){const s=me.Lcode(e);this.literalTree.writeSymbol(s);let r=Math.floor((s-261)/4);r>0&&r<=5&&this.pending.writeBits(e&(1<<r)-1,r);const a=me.Dcode(i);this.distTree.writeSymbol(a),r=Math.floor(a/2)-1,r>0&&this.pending.writeBits(i&(1<<r)-1,r)}else this.literalTree.writeSymbol(e)}this.literalTree.writeSymbol(me.EOF_SYMBOL)}tallyDist(t,e){this.d_buf[this.last_lit]=t,this.l_buf[this.last_lit++]=e-3;const i=me.Lcode(e-3);this.literalTree.freqs[i]++,i>=265&&i<285&&(this.extra_bits+=Math.floor((i-261)/4));const s=me.Dcode(t-1);return this.distTree.freqs[s]++,s>=4&&(this.extra_bits+=Math.floor(s/2)-1),this.isFull()}tallyLit(t){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=t,this.literalTree.freqs[t]++,this.isFull()}static Lcode(t){if(255===t)return 285;let e=257;for(;t>=8;)e+=4,t>>=1;return e+t}static Dcode(t){let e=0;for(;t>=4;)e+=2,t>>=1;return e+t}}me.BUFSIZE=1<<de.DEFAULT_MEM_LEVEL+6,me.LITERAL_NUM=286,me.STORED_BLOCK=0,me.STATIC_TREES=1,me.DYN_TREES=2,me.DIST_NUM=30,me.staticLCodes=new Int16Array(me.LITERAL_NUM),me.staticLLength=new Uint8Array(me.LITERAL_NUM),me.staticDCodes=new Int16Array(me.DIST_NUM),me.staticDLength=new Uint8Array(me.DIST_NUM),me.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],me.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]),me.BITLEN_NUM=19,me.EOF_SYMBOL=256,me.staticInit();Symbol;Symbol,Symbol,Symbol,Symbol,Symbol,Symbol,N.isRunningInWorker?N.initializeWorker():N.isRunningInAudioWorklet?N.initializeAudioWorklet():N.initializeMain(n=>{if(N.webPlatform===Ui.NodeJs)throw new nt(it.General,"Workers not yet supported in Node.js");if(N.webPlatform===Ui.BrowserModule||N.isWebPackBundled||N.isViteBundled){x.debug("AlphaTab","Creating webworker");try{return new N.alphaTabWorker(new N.alphaTabUrl(ha.p+ha.u(764),ha.b),{type:void 0})}catch(e){x.debug("AlphaTab","ESM webworker construction with direct URL failed",e)}let t="";try{t=new N.alphaTabUrl("./alphaTab.worker.mjs","file:///F:/__Projects__/050_guitarpro/node_modules/@coderline/alphatab/dist/alphaTab.mjs");const e=`import ${JSON.stringify(t)}`,i=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(e){x.debug("AlphaTab","ESM webworker construction with blob import failed",t,e)}try{if(!n.core.scriptFile)throw new Error("Could not detect alphaTab script file");t=n.core.scriptFile;const e=`import ${JSON.stringify(n.core.scriptFile)}`,i=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(e){x.debug("AlphaTab","ESM webworker construction with blob import failed",n.core.scriptFile,e)}}if(!n.core.scriptFile)throw new nt(it.General,"Could not detect alphaTab script file, cannot initialize renderer");try{x.debug("AlphaTab","Creating Blob worker");const t=`importScripts('${n.core.scriptFile}')`,e=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))}catch{return x.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(n.core.scriptFile)}},(n,t)=>{if(N.webPlatform===Ui.NodeJs)throw new nt(it.General,"Audio Worklets not yet supported in Node.js");return N.webPlatform===Ui.BrowserModule||N.isWebPackBundled||N.isViteBundled?(x.debug("AlphaTab","Creating Module worklet"),async function(i){await i.addModule(URL.createObjectURL(new Blob([`\n\t                globalThis.self = globalThis.self || globalThis;\n\t                globalThis.location = ${JSON.stringify(ha.b)};\n\t                globalThis.importScripts = (url) => { throw new Error("importScripts not available, dynamic loading of chunks not supported in this context", url) };\n\t            `],{type:"application/javascript; charset=utf-8"})));for(const s of ha.wsc(624))await i.addModule(new URL(ha.p+s,ha.b))}(n.audioWorklet)):(x.debug("AlphaTab","Creating Script worklet"),n.audioWorklet.addModule(t.core.scriptFile))});const eo={core:{fontDirectory:"/font/",useWorkers:!0,includeNoteBounds:!0},display:{scale:1,stretchForce:.8},player:{enablePlayer:!0,soundFont:"/soundfont/sonivox.sf2"}},ca={STANDARD_TUNING:[64,59,55,50,45,40],DROP_D_TUNING:[64,59,55,50,45,38],HALF_STEP_DOWN:[63,58,54,49,44,39],WHOLE_STEP_DOWN:[62,57,53,48,43,38],NOTE_NAMES:{english:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],german:["C","C#","D","D#","E","F","F#","G","G#","A","B","H"],solfege:["Do","Do#","Re","Re#","Mi","Fa","Fa#","Sol","Sol#","La","La#","Si"],englishFlat:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],germanFlat:["C","Db","D","Eb","E","F","Gb","G","Ab","A","B","H"],solfegeFlat:["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"]},MIN_FRET:0,MAX_FRET:24,MIN_STRING:0,MAX_STRING:5,MIN_SPEED:.25,MAX_SPEED:2,DEFAULT_SPEED:1,MIN_ZOOM:.5,MAX_ZOOM:2,DEFAULT_ZOOM:1},Ac={display:{noteDisplayMechanism:"replace",noteNamesTarget:"tab-numbers",theme:"light",zoom:1},playback:{speed:100,metronomeEnabled:!1,countInEnabled:!1},notation:{notationMode:"tab-only",noteNameFormat:"english"}};let sm=(()=>{class n{constructor(){this.STORAGE_KEY="guitarpro_settings";const e=this.loadSettings();this.settingsSubject=new ss(e)}getSettings(){return this.settingsSubject.asObservable()}getCurrentSettings(){return this.settingsSubject.value}updateSettings(e){const i=this.settingsSubject.value,s={display:{...i.display,...e.display},playback:{...i.playback,...e.playback},notation:{...i.notation,...e.notation}};this.settingsSubject.next(s),this.saveSettings(s)}cycleNoteNamesTarget(){const e=this.settingsSubject.value,i=["none","tab-numbers","tab-numbers-octave","scale-degrees","scale-degrees-roman"],r=(i.indexOf(e.display.noteNamesTarget)+1)%i.length;this.updateSettings({display:{...e.display,noteNamesTarget:i[r]}})}resetToDefaults(){this.settingsSubject.next(Ac),this.saveSettings(Ac)}loadSettings(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(e){const i=JSON.parse(e);return{display:{...Ac.display,...i.display},playback:{...Ac.playback,...i.playback},notation:{...Ac.notation,...i.notation}}}}catch(e){console.error("Error loading settings:",e)}return Ac}saveSettings(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(i){console.error("Error saving settings:",i)}}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),bY=(()=>{class n{midiToNoteName(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}midiToOctave(e){return Math.floor(e/12)-1}midiToNoteNameWithOctave(e,i=!0){const s=this.midiToNoteName(e);return i?`${s}${this.midiToOctave(e)}`:s}calculateNoteName(e,i,s,r="english"){return ca.NOTE_NAMES[r][(s[i]+e)%12]}fretToNoteName(e,i,s,r="english"){let a=ca.STANDARD_TUNING;try{if(s&&s.tracks&&s.tracks.length>0){const h=s.tracks[0];if(h.staves&&h.staves.length>0){const f=h.staves[0];f.tuning&&f.tuning.length>0&&(a=f.tuning.map(p=>p))}}}catch{}return ca.NOTE_NAMES[r][((a[i]||ca.STANDARD_TUNING[i])+e)%12]}getTuningFromScore(e){let i=ca.STANDARD_TUNING;try{if(e&&e.tracks&&e.tracks.length>0){const s=e.tracks[0];if(s.staves&&s.staves.length>0){const r=s.staves[0];r.tuning&&r.tuning.length>0&&(i=r.tuning.map(a=>a))}}}catch{console.log("Using standard tuning")}return i}guessStringFromPosition(e,i,s){const r=i.querySelectorAll("path[d]"),a=[];r.forEach(f=>{const p=f.getAttribute("d");if(!p)return;const g=p.match(/M\s*([\d.]+)\s+([\d.]+)/g);g&&g.forEach(m=>{const y=m.replace("M","").trim().split(/\s+/),b=parseFloat(y[1]);b>0&&!a.some(_=>Math.abs(_-b)<2)&&a.push(b)})}),i.querySelectorAll("line").forEach(f=>{const m=(parseFloat(f.getAttribute("y1")||"0")+parseFloat(f.getAttribute("y2")||"0"))/2;m>0&&!a.some(y=>Math.abs(y-m)<2)&&a.push(m)}),a.sort((f,p)=>f-p);const c=a.filter((f,p)=>0===p||Math.abs(f-a[p-1])>5).slice(0,s);let u=0,h=1/0;return c.forEach((f,p)=>{const g=Math.abs(e-f);g<h&&g<15&&(h=g,u=p)}),h<1/0?u:null}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const wY=[6.35,2.23,3.48,2.33,4.38,4.09,2.52,5.19,2.39,3.66,2.29,2.88],SY=[6.33,2.68,3.52,5.38,2.6,3.53,2.54,4.75,3.98,2.69,3.34,3.17],rm=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_Y=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],vY={"C major":"\u0414\u043e \u043c\u0430\u0436\u043e\u0440","C# major":"\u0414\u043e-\u0434\u0438\u0435\u0437 \u043c\u0430\u0436\u043e\u0440","D major":"\u0420\u0435 \u043c\u0430\u0436\u043e\u0440","D# major":"\u0420\u0435-\u0434\u0438\u0435\u0437 \u043c\u0430\u0436\u043e\u0440","E major":"\u041c\u0438 \u043c\u0430\u0436\u043e\u0440","F major":"\u0424\u0430 \u043c\u0430\u0436\u043e\u0440","F# major":"\u0424\u0430-\u0434\u0438\u0435\u0437 \u043c\u0430\u0436\u043e\u0440","G major":"\u0421\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","G# major":"\u0421\u043e\u043b\u044c-\u0434\u0438\u0435\u0437 \u043c\u0430\u0436\u043e\u0440","A major":"\u041b\u044f \u043c\u0430\u0436\u043e\u0440","A# major":"\u041b\u044f-\u0434\u0438\u0435\u0437 \u043c\u0430\u0436\u043e\u0440","B major":"\u0421\u0438 \u043c\u0430\u0436\u043e\u0440","C minor":"\u0414\u043e \u043c\u0438\u043d\u043e\u0440","C# minor":"\u0414\u043e-\u0434\u0438\u0435\u0437 \u043c\u0438\u043d\u043e\u0440","D minor":"\u0420\u0435 \u043c\u0438\u043d\u043e\u0440","D# minor":"\u0420\u0435-\u0434\u0438\u0435\u0437 \u043c\u0438\u043d\u043e\u0440","E minor":"\u041c\u0438 \u043c\u0438\u043d\u043e\u0440","F minor":"\u0424\u0430 \u043c\u0438\u043d\u043e\u0440","F# minor":"\u0424\u0430-\u0434\u0438\u0435\u0437 \u043c\u0438\u043d\u043e\u0440","G minor":"\u0421\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440","G# minor":"\u0421\u043e\u043b\u044c-\u0434\u0438\u0435\u0437 \u043c\u0438\u043d\u043e\u0440","A minor":"\u041b\u044f \u043c\u0438\u043d\u043e\u0440","A# minor":"\u041b\u044f-\u0434\u0438\u0435\u0437 \u043c\u0438\u043d\u043e\u0440","B minor":"\u0421\u0438 \u043c\u0438\u043d\u043e\u0440","Db major":"\u0420\u0435-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","Eb major":"\u041c\u0438-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","Gb major":"\u0421\u043e\u043b\u044c-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","Ab major":"\u041b\u044f-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","Bb major":"\u0421\u0438-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0430\u0436\u043e\u0440","Db minor":"\u0420\u0435-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440","Eb minor":"\u041c\u0438-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440","Gb minor":"\u0421\u043e\u043b\u044c-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440","Ab minor":"\u041b\u044f-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440","Bb minor":"\u0421\u0438-\u0431\u0435\u043c\u043e\u043b\u044c \u043c\u0438\u043d\u043e\u0440"};let VM=(()=>{class n{detectKey(e){console.log("[KeyDetection] Analyzing score for key detection...");const i=new Array(12).fill(0);let s=0;if(e.tracks.forEach(f=>{f.staves.forEach(p=>{p.bars.forEach(g=>{g.voices.forEach(m=>{m.beats.forEach(y=>{y.notes.forEach(b=>{i[b.realValue%12]++,s++})})})})})}),console.log("[KeyDetection] Total notes analyzed:",s),console.log("[KeyDetection] Note distribution:",i),0===s)return{key:"C",mode:"major",keyName:"C major",keyNameRu:"\u0414\u043e \u043c\u0430\u0436\u043e\u0440",confidence:0};const r=i.map(f=>f/s);let a="C",o="major",l=-1/0;for(let f=0;f<12;f++){const p=this.calculateCorrelation(r,wY,f);p>l&&(l=p,a=rm[f],o="major");const g=this.calculateCorrelation(r,SY,f);g>l&&(l=g,a=rm[f],o="minor")}const c=Math.max(0,Math.min(1,(l+1)/2)),u=`${a} ${o}`,h=vY[u]||u;return console.log("[KeyDetection] Detected key:",u,"confidence:",c.toFixed(2)),{key:a,mode:o,keyName:u,keyNameRu:h,confidence:c}}calculateCorrelation(e,i,s){const r=[];for(let h=0;h<12;h++)r[h]=i[(h-s+12)%12];const a=e.reduce((h,f)=>h+f,0)/12,o=r.reduce((h,f)=>h+f,0)/12;let l=0,c=0,u=0;for(let h=0;h<12;h++){const f=e[h]-a,p=r[h]-o;l+=f*p,c+=f*f,u+=p*p}return 0===c||0===u?0:l/Math.sqrt(c*u)}getTuningInfo(e){let i=[64,59,55,50,45,40];try{if(e&&e.tracks&&e.tracks.length>0){const a=e.tracks[0];if(a.staves&&a.staves.length>0){const o=a.staves[0];o.tuning&&o.tuning.length>0&&(i=o.tuning.map(l=>l))}}}catch{console.warn("[KeyDetection] Could not read tuning from score, using standard")}const s=i.map(a=>rm[a%12]);return{tuningName:this.identifyTuning(i),notes:s,midiValues:i}}identifyTuning(e){const i={"Standard (E)":[64,59,55,50,45,40],"Drop D":[64,59,55,50,45,38],"Drop C":[62,57,53,48,43,36],"Drop B":[61,56,52,47,42,35],"Open D":[62,59,54,50,45,38],"Open G":[62,59,55,50,43,38],DADGAD:[62,57,55,50,45,38],"Half Step Down":[63,58,54,49,44,39],"Whole Step Down":[62,57,53,48,43,38]};for(const[s,r]of Object.entries(i))if(e.length===r.length&&e.every((o,l)=>o===r[r.length-1-l]))return s;return"Custom"}formatTuning(e){return[...e.notes].reverse().join(" - ")}getScaleDegrees(){return[{degree:1,short:"T",englishFull:"Tonic",russianFull:"\u0422\u043e\u043d\u0438\u043a\u0430",interval:"T",intervalEnglish:"Tone"},{degree:2,short:"S",englishFull:"Supertonic",russianFull:"\u0421\u0443\u043f\u0435\u0440\u0442\u043e\u043d\u0438\u043a\u0430",interval:"T",intervalEnglish:"Tone"},{degree:3,short:"M",englishFull:"Mediant",russianFull:"\u041c\u0435\u0434\u0438\u0430\u043d\u0442\u0430",interval:"S",intervalEnglish:"Semitone"},{degree:4,short:"SD",englishFull:"Subdominant",russianFull:"\u0421\u0443\u0431\u0434\u043e\u043c\u0438\u043d\u0430\u043d\u0442\u0430",interval:"T",intervalEnglish:"Tone"},{degree:5,short:"D",englishFull:"Dominant",russianFull:"\u0414\u043e\u043c\u0438\u043d\u0430\u043d\u0442\u0430",interval:"T",intervalEnglish:"Tone"},{degree:6,short:"SM",englishFull:"Submediant",russianFull:"\u0421\u0443\u0431\u043c\u0435\u0434\u0438\u0430\u043d\u0442\u0430",interval:"T",intervalEnglish:"Tone"},{degree:7,short:"L",englishFull:"Leading tone",russianFull:"\u0412\u0432\u043e\u0434\u043d\u044b\u0439 \u0442\u043e\u043d",interval:"S",intervalEnglish:"Semitone"}]}getScaleNotes(e){const i=this.getNoteIndex(e.key),s="major"===e.mode?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10],a=["F","Bb","Eb","Ab","Db","Gb"].includes(e.key)?_Y:rm;return s.map(o=>a[(i+o)%12])}getScaleDegreeForNote(e,i){const s=this.getNoteIndex(i.key),r="major"===i.mode?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10];let o=(e%12-s+12)%12;const l=r.indexOf(o);if(-1===l){for(let u=0;u<r.length;u++)if(Math.abs(r[u]-o)<=1)return this.getScaleDegrees()[u].short;return"?"}return this.getScaleDegrees()[l].short}getNoteIndex(e){return{C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[e]||0}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),TY=(()=>{class n{constructor(e,i,s){this.notationHelper=e,this.settingsService=i,this.keyDetectionService=s,this.renderHandler=null,this.partialRenderHandler=null,this.isCreatingOverlay=!1,this.overlayDebounceTimer=null,this.cachedKeyInfo=null,this.lastOverlayHash=null}enableNoteNames(e){if(!e)return;const i=this.settingsService.getCurrentSettings(),s=i.display.noteNamesTarget,r=i.display.noteDisplayMechanism,a=this.getHTMLContainer(e);if(a&&a.classList&&(a.classList.add("show-note-names"),a.classList.add(`note-target-${s}`),a.classList.add(`note-mechanism-${r}`),"tab-numbers-octave"===s?a.classList.add("show-octave-numbers"):a.classList.remove("show-octave-numbers")),"tab-numbers"===s||"tab-numbers-octave"===s||"scale-degrees"===s||"scale-degrees-roman"===s){const o=e;this.renderHandler&&e.renderFinished.off(this.renderHandler),this.partialRenderHandler&&o.renderer?.partialRenderFinished&&o.renderer.partialRenderFinished.off(this.partialRenderHandler),this.renderHandler=()=>{this.overlayDebounceTimer&&clearTimeout(this.overlayDebounceTimer),this.overlayDebounceTimer=setTimeout(()=>{this.createNoteNamesOverlay(e)},150)},this.partialRenderHandler=()=>{this.overlayDebounceTimer&&clearTimeout(this.overlayDebounceTimer),this.overlayDebounceTimer=setTimeout(()=>{this.createNoteNamesOverlay(e)},150)},e.renderFinished.on(this.renderHandler),o.renderer?.partialRenderFinished&&o.renderer.partialRenderFinished.on(this.partialRenderHandler),setTimeout(()=>this.createNoteNamesOverlay(e),100)}}disableNoteNames(e){if(!e)return;const i=e;this.overlayDebounceTimer&&(clearTimeout(this.overlayDebounceTimer),this.overlayDebounceTimer=null),this.isCreatingOverlay=!1,this.cachedKeyInfo=null,this.lastOverlayHash=null,this.renderHandler&&(e.renderFinished.off(this.renderHandler),this.renderHandler=null),this.partialRenderHandler&&(i.renderer?.partialRenderFinished&&i.renderer.partialRenderFinished.off(this.partialRenderHandler),this.partialRenderHandler=null);const s=this.getHTMLContainer(e);s&&s.classList&&(s.classList.remove("show-note-names"),s.classList.remove("note-target-tab-numbers"),s.classList.remove("note-mechanism-overlay"),s.classList.remove("note-mechanism-replace"),s.classList.remove("show-octave-numbers")),this.removeNoteNamesOverlay();const r=document.getElementById("note-names-css-rules");r&&r.remove()}createNoteNamesOverlay(e){if(this.isCreatingOverlay||!e||!e.score)return;const s=this.settingsService.getCurrentSettings().display.noteNamesTarget;if("tab-numbers"===s||"tab-numbers-octave"===s||"scale-degrees"===s||"scale-degrees-roman"===s)try{this.isCreatingOverlay=!0;const r=this.getHTMLContainer(e);if(!r)return void(this.isCreatingOverlay=!1);this.removeNoteNamesOverlay();const o=e.renderer?.boundsLookup;if(!o||!o.isFinished)return void(this.isCreatingOverlay=!1);let l=0;o.staffSystems?.forEach(b=>{const _=b.staves||b.bars||[];_&&_.length>0&&_.forEach(v=>{v.bars?.forEach(k=>{k.visualBounds&&k.visualBounds.y+k.visualBounds.h>l&&(l=k.visualBounds.y+k.visualBounds.h)})})});const c=document.createElement("div");c.id="note-names-overlay-container",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height=l>0?`${l+100}px`:"100%",c.style.pointerEvents="none",c.style.overflow="visible",r.appendChild(c);const u=this.settingsService.getCurrentSettings(),h="scale-degrees"===u.display.noteNamesTarget,f="scale-degrees-roman"===u.display.noteNamesTarget,p="tab-numbers-octave"===u.display.noteNamesTarget;let g=null;(h||f)&&e.score&&(this.cachedKeyInfo&&this.cachedKeyInfo.score===e.score?g=this.cachedKeyInfo.keyInfo:(g=this.keyDetectionService.detectKey(e.score),this.cachedKeyInfo={score:e.score,keyInfo:g}));let m=0;const y=document.createDocumentFragment();o.staffSystems?.forEach(b=>{const _=b.staves||b.bars||[];_&&_.length>0&&_.forEach(v=>{v.bars?.forEach(k=>{k.beats?.forEach(F=>{const D=F.beat;if(!D||!D.notes)return;const C=F;D.notes?.forEach(oe=>{try{let at,Fe;if(C.notes&&C.notes.length>0){const ne=C.notes.find(ot=>ot.note===oe);ne&&ne.noteHeadBounds&&(at=ne.noteHeadBounds.x+ne.noteHeadBounds.w/2,Fe=ne.noteHeadBounds.y+ne.noteHeadBounds.h/2)}if(void 0!==at&&void 0!==Fe){let ne;if(h&&g){ne=`${this.keyDetectionService.getScaleDegreeForNote(oe.realValue,g)}${Math.floor(oe.realValue/12)-1}`}else if(f&&g){const Nn=this.keyDetectionService.getScaleDegreeForNote(oe.realValue,g);ne=`${this.convertToRomanNumeral(Nn)}${Math.floor(oe.realValue/12)-1}`}else ne=this.notationHelper.midiToNoteNameWithOctave(oe.realValue,p);const ot=document.createElement("span");ot.className="note-name-label",ot.textContent=ne,ot.style.cssText=`position:absolute;left:${at}px;top:${Fe}px;transform:translate(-50%,-50%);white-space:nowrap;pointer-events:none;z-index:10`,y.appendChild(ot),m++}}catch{}})})})})}),c.appendChild(y),this.isCreatingOverlay=!1}catch(r){console.error("[NoteNames] Error creating overlay:",r),this.isCreatingOverlay=!1}else this.removeNoteNamesOverlay()}removeNoteNamesOverlay(){const e=document.getElementById("note-names-overlay-container");e&&e.remove()}getHTMLContainer(e){const i=e,s=i.container?.element||i.container;return s instanceof HTMLElement?s:s&&"object"==typeof s?s.element||s._element:null}convertToRomanNumeral(e){return{T:"I",S:"II",M:"III",SD:"IV",D:"V",SM:"VI",L:"VII"}[e]||e}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(bY),Oe(sm),Oe(VM))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),HM=(()=>{class n{constructor(e,i){this.settingsService=e,this.noteNamesService=i,this.api=null,this.isReady=new ui,this.scoreLoaded=new ui,this.isApplyingSettings=!1,this.renderFinishedHandler=null,this.scoreLoadedHandler=null,this.visibleTracks=new Set,this.ready$=this.isReady.asObservable(),this.scoreLoaded$=this.scoreLoaded.asObservable(),this.settingsService.getSettings().subscribe(s=>{this.api&&!this.isApplyingSettings&&this.applySettings()})}initialize(e,i){const s=this.settingsService.getCurrentSettings();let a=this.getStaveProfile(s.notation.notationMode);console.log("[AlphaTab] Initializing with staveProfile:",s.notation.notationMode,a);const o={...eo,core:{...eo.core,file:i||"https://www.alphatab.net/files/canon.gp"},display:{...eo.display,scale:s.display.zoom,staveProfile:a},notation:{notationMode:_n.GuitarPro},fontDirectory:"./font/"};return this.api=new Gg(e,o),this.setupRenderHandlers(),this.isReady.next(!0),this.api}setupRenderHandlers(){if(!this.api)return;let e=!0;this.renderFinishedHandler=()=>{e&&(e=!1,this.applySettings())},this.api.renderFinished.on(this.renderFinishedHandler),this.scoreLoadedHandler=()=>{console.log("[AlphaTab] Score loaded, emitting event"),this.scoreLoaded.next(!0)},this.api.scoreLoaded.on(this.scoreLoadedHandler)}getApi(){return this.api}applySettings(){if(!this.api||this.isApplyingSettings)return;this.isApplyingSettings=!0;const e=this.settingsService.getCurrentSettings();console.log("[AlphaTab] Applying settings:",e),this.applyPlaybackSpeed(e.playback.speed),this.applyNotationMode(e.notation.notationMode),this.applyZoom(e.display.zoom),this.applyNoteNames(e.display.noteNamesTarget),setTimeout(()=>{this.isApplyingSettings=!1},100)}applyPlaybackSpeed(e){this.api&&this.api.player&&(this.api.player.playbackSpeed=e/100,console.log("[AlphaTab] Playback speed set to:",e))}applyNotationMode(e){if(!this.api)return;console.log("[AlphaTab] Applying notation mode:",e);const i=this.getStaveProfile(e);this.api.settings.display.staveProfile=i,console.log("[AlphaTab] Reloading track to apply staveProfile...");const s=this.api;s._score?this.api.renderScore(s._score):this.api.render()}getStaveProfile(e){const i=_r;switch(e){case"staff-only":return i.Score;case"tab-only":return i.Tab;default:return i.ScoreTab}}applyZoom(e){if(!this.api)return;const i=this.api.settings.display.scale;Math.abs(i-e)>.01&&(console.log("[AlphaTab] Changing scale from",i,"to",e),this.api.settings.display.scale=e,this.api.render())}applyNoteNames(e){this.api&&(console.log("[AlphaTab] Note names target:",e),this.noteNamesService.disableNoteNames(this.api),"none"!==e&&this.noteNamesService.enableNoteNames(this.api))}destroy(){this.api&&(this.renderFinishedHandler&&this.api.renderFinished.off(this.renderFinishedHandler),this.scoreLoadedHandler&&this.api.scoreLoaded.off(this.scoreLoadedHandler),this.api.destroy(),this.api=null)}playPause(){this.api?.playPause()}stop(){this.api?.stop()}loadFile(e){if(!this.api)return;const i=new FileReader;i.onload=s=>{const r=s.target?.result;this.api?.load(new Uint8Array(r))},i.readAsArrayBuffer(e)}loadFromUrl(e){this.api&&this.api.load(e)}getTracks(){return this.api&&this.api.score?this.api.score.tracks.map((e,i)=>({index:i,name:e.name||`Track ${i+1}`,instrument:this.getInstrumentName(e),isSolo:e.playbackInfo?.isSolo||!1,isMuted:e.playbackInfo?.isMute||!1,isVisible:0===this.visibleTracks.size||this.visibleTracks.has(i)})):[]}getInstrumentName(e){return e.shortName?e.shortName:{0:"Piano",25:"Acoustic Guitar",26:"Electric Guitar (jazz)",27:"Electric Guitar (clean)",28:"Electric Guitar (muted)",29:"Overdriven Guitar",30:"Distortion Guitar",31:"Guitar Harmonics",32:"Acoustic Bass",33:"Electric Bass (finger)",34:"Electric Bass (pick)"}[e.playbackInfo?.program||0]||"Guitar"}toggleTrackVisibility(e){if(this.api&&this.api.score)if(this.visibleTracks.has(e)?this.visibleTracks.delete(e):this.visibleTracks.add(e),0===this.visibleTracks.size)console.log("[AlphaTab] No tracks selected, rendering all tracks"),this.api.renderScore(this.api.score);else{const i=Array.from(this.visibleTracks);console.log("[AlphaTab] Rendering tracks:",i),this.api.renderTracks(i.map(s=>this.api.score.tracks[s]))}}setTrackVisibility(e,i){if(this.api&&this.api.score)if(i?this.visibleTracks.add(e):this.visibleTracks.delete(e),0===this.visibleTracks.size)this.api.renderScore(this.api.score);else{const s=Array.from(this.visibleTracks);this.api.renderTracks(s.map(r=>this.api.score.tracks[r]))}}toggleTrackMute(e){if(!this.api||!this.api.score)return;const i=this.api.score.tracks[e];i&&i.playbackInfo&&(i.playbackInfo.isMute=!i.playbackInfo.isMute,console.log(`[AlphaTab] Track ${e} mute:`,i.playbackInfo.isMute))}toggleTrackSolo(e){if(!this.api||!this.api.score)return;const i=this.api.score.tracks[e];i&&i.playbackInfo&&(i.playbackInfo.isSolo=!i.playbackInfo.isSolo,console.log(`[AlphaTab] Track ${e} solo:`,i.playbackInfo.isSolo))}static#e=this.\u0275fac=function(i){return new(i||n)(Oe(sm),Oe(TY))};static#t=this.\u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function kY(n,t){1&n&&(uo(),G(0,"svg",16),Ln(1,"polygon",17),$())}function CY(n,t){1&n&&(uo(),G(0,"svg",16),Ln(1,"rect",18)(2,"rect",19),$())}let DY=(()=>{class n{constructor(e){this.alphaTabService=e,this.isPlaying=!1}playPause(){this.alphaTabService.playPause(),this.isPlaying=!this.isPlaying}stop(){this.alphaTabService.stop(),this.isPlaying=!1}openSettings(){this.onOpenSettings&&this.onOpenSettings()}loadFile(e){const i=e.target;i.files&&i.files[0]&&this.alphaTabService.loadFile(i.files[0])}static#e=this.\u0275fac=function(i){return new(i||n)(j(HM))};static#t=this.\u0275cmp=Wc({type:n,selectors:[["app-player-controls"]],inputs:{onOpenSettings:"onOpenSettings"},standalone:!0,features:[Vu],decls:29,vars:22,consts:[[1,"player-controls"],[1,"controls-group"],[1,"file-btn",3,"title"],["type","file","accept",".gp,.gp3,.gp4,.gp5,.gpx,.gp6,.gp7","hidden","",3,"change"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","7 10 12 15 17 10"],["x1","12","y1","15","x2","12","y2","3"],[1,"control-btn","play-btn",3,"title","click"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor",4,"ngIf"],[1,"control-btn",3,"title","click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["x","6","y","6","width","12","height","12"],[1,"settings-btn",3,"title","click"],["cx","12","cy","12","r","3"],["d","M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m-2.83 2.83l-4.24 4.24m13.66 0l-4.24-4.24m-2.83-2.83L1.34 5.66"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor"],["points","5 3 19 12 5 21 5 3"],["x","6","y","4","width","4","height","16"],["x","14","y","4","width","4","height","16"]],template:function(i,s){1&i&&(G(0,"div",0)(1,"div",1)(2,"label",2),Me(3,"translate"),G(4,"input",3),tt("change",function(a){return s.loadFile(a)}),$(),uo(),G(5,"svg",4),Ln(6,"path",5)(7,"polyline",6)(8,"line",7),$(),Jc(),G(9,"span"),ue(10),Me(11,"translate"),$()(),G(12,"button",8),tt("click",function(){return s.playPause()}),Me(13,"translate"),Me(14,"translate"),Mn(15,kY,2,0,"svg",9)(16,CY,3,0,"svg",9),$(),G(17,"button",10),tt("click",function(){return s.stop()}),Me(18,"translate"),uo(),G(19,"svg",11),Ln(20,"rect",12),$()()(),Jc(),G(21,"button",13),tt("click",function(){return s.openSettings()}),Me(22,"translate"),uo(),G(23,"svg",4),Ln(24,"circle",14)(25,"path",15),$(),Jc(),G(26,"span"),ue(27),Me(28,"translate"),$()()()),2&i&&(O(2),pt("title",Ae(3,8,"APP.LOAD_FILE")),O(8),Ke(Ae(11,10,"APP.LOAD_FILE")),O(2),pt("title",s.isPlaying?Ae(13,12,"PLAYER.STOP"):Ae(14,14,"PLAYER.PLAY")),O(3),pt("ngIf",!s.isPlaying),O(),pt("ngIf",s.isPlaying),O(),pt("title",Ae(18,16,"PLAYER.STOP")),O(4),pt("title",Ae(22,18,"PLAYER.SETTINGS")),O(6),Ke(Ae(28,20,"PLAYER.SETTINGS")))},dependencies:[Yw,gp,Yp,J0],styles:[".player-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 2px 4px #0000000d}.controls-group[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.control-btn[_ngcontent-%COMP%], .file-btn[_ngcontent-%COMP%], .settings-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 16px;background:#fff;border:1px solid #ddd;border-radius:8px;cursor:pointer;transition:all .2s;font-size:14px;font-weight:500;color:#333}.control-btn[_ngcontent-%COMP%]:hover, .file-btn[_ngcontent-%COMP%]:hover, .settings-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5;border-color:#4caf50}.control-btn[_ngcontent-%COMP%]:active, .file-btn[_ngcontent-%COMP%]:active, .settings-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.play-btn[_ngcontent-%COMP%]{background:#4caf50;color:#fff;border-color:#4caf50}.play-btn[_ngcontent-%COMP%]:hover{background:#45a049}.file-btn[_ngcontent-%COMP%]{cursor:pointer}.settings-btn[_ngcontent-%COMP%]{margin-left:auto}.control-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .file-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .settings-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}@media (max-width: 768px){.player-controls[_ngcontent-%COMP%]{padding:12px 16px}.control-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .file-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .settings-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.control-btn[_ngcontent-%COMP%], .file-btn[_ngcontent-%COMP%], .settings-btn[_ngcontent-%COMP%]{padding:10px}.controls-group[_ngcontent-%COMP%]{gap:8px}}"]})}return n})();function NY(n,t){if(1&n){const e=zr();G(0,"div",8)(1,"label",9),ue(2),Me(3,"translate"),$(),G(4,"p",20),ue(5),Me(6,"translate"),$(),G(7,"select",10),ns("ngModelChange",function(s){Ss(e);const r=Gt();return fs(r.settings.display.noteDisplayMechanism,s)||(r.settings.display.noteDisplayMechanism=s),_s(s)}),tt("change",function(){return Ss(e),_s(Gt().updateDisplaySettings())}),G(8,"option",36),ue(9),Me(10,"translate"),$(),G(11,"option",37),ue(12),Me(13,"translate"),$()()()}if(2&n){const e=Gt();O(2),Ke(Ae(3,5,"SETTINGS.DISPLAY_MECHANISM")),O(3),fn(" ",Ae(6,7,"SETTINGS.DISPLAY_MECHANISM_DESC")," "),O(2),ts("ngModel",e.settings.display.noteDisplayMechanism),O(2),Ke(Ae(10,9,"OPTIONS.DISPLAY_MECHANISM.OVERLAY")),O(3),Ke(Ae(13,11,"OPTIONS.DISPLAY_MECHANISM.REPLACE"))}}let xY=(()=>{class n{constructor(e,i){this.settingsService=e,this.translate=i,this.isOpen=!1}ngOnInit(){this.settingsService.getSettings().subscribe(e=>{this.settings=e})}togglePanel(){this.isOpen=!this.isOpen}close(){this.isOpen=!1}updateDisplaySettings(){console.log("Updating display settings:",this.settings.display),this.settingsService.updateSettings({display:this.settings.display})}updatePlaybackSettings(){this.settingsService.updateSettings({playback:this.settings.playback})}updateNotationSettings(){console.log("Updating notation settings:",this.settings.notation),this.settingsService.updateSettings({notation:this.settings.notation}),setTimeout(()=>{window.location.reload()},300)}resetSettings(){confirm("ru"===this.translate.currentLang?"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0432\u0441\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438?":"Are you sure you want to reset all settings?")&&this.settingsService.resetToDefaults()}static#e=this.\u0275fac=function(i){return new(i||n)(j(sm),j(vh))};static#t=this.\u0275cmp=Wc({type:n,selectors:[["app-settings-panel"]],standalone:!0,features:[Vu],decls:124,vars:99,consts:[[1,"settings-panel"],[1,"settings-header"],[1,"close-btn",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"settings-content"],[1,"settings-section"],[1,"setting-item"],[1,"setting-label"],[1,"select",3,"ngModel","ngModelChange","change"],["value","none"],["value","tab-numbers"],["value","tab-numbers-octave"],["value","scale-degrees"],["value","scale-degrees-roman"],["class","setting-item",4,"ngIf"],["type","range","min","0.5","max","2","step","0.1",1,"slider",3,"ngModel","ngModelChange","change"],["value","light"],["value","dark"],[1,"setting-description"],[1,"radio-group"],[1,"radio-label"],["type","radio","name","notationMode","value","staff-only",3,"ngModel","ngModelChange","change"],[1,"radio-button"],[1,"radio-text"],["type","radio","name","notationMode","value","tab-only",3,"ngModel","ngModelChange","change"],["type","radio","name","notationMode","value","both",3,"ngModel","ngModelChange","change"],["value","english"],["value","german"],["value","solfege"],["type","range","min","25","max","200","step","5",1,"slider",3,"ngModel","ngModelChange","change"],[1,"toggle-label"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"toggle-text"],[1,"reset-btn",3,"click"],["value","overlay"],["value","replace"]],template:function(i,s){1&i&&(G(0,"div",0)(1,"div",1)(2,"h2"),ue(3),Me(4,"translate"),$(),G(5,"button",2),tt("click",function(){return s.close()}),Me(6,"translate"),uo(),G(7,"svg",3),Ln(8,"line",4)(9,"line",5),$()()(),Jc(),G(10,"div",6)(11,"section",7)(12,"h3"),ue(13),Me(14,"translate"),$(),G(15,"div",8)(16,"label",9),ue(17),Me(18,"translate"),$(),G(19,"select",10),ns("ngModelChange",function(a){return fs(s.settings.display.noteNamesTarget,a)||(s.settings.display.noteNamesTarget=a),a}),tt("change",function(){return s.updateDisplaySettings()}),G(20,"option",11),ue(21),Me(22,"translate"),$(),G(23,"option",12),ue(24),Me(25,"translate"),$(),G(26,"option",13),ue(27),Me(28,"translate"),$(),G(29,"option",14),ue(30),Me(31,"translate"),$(),G(32,"option",15),ue(33),Me(34,"translate"),$()()(),Mn(35,NY,14,13,"div",16),G(36,"div",8)(37,"label",9),ue(38),Me(39,"translate"),$(),G(40,"input",17),ns("ngModelChange",function(a){return fs(s.settings.display.zoom,a)||(s.settings.display.zoom=a),a}),tt("change",function(){return s.updateDisplaySettings()}),$()(),G(41,"div",8)(42,"label",9),ue(43),Me(44,"translate"),$(),G(45,"select",10),ns("ngModelChange",function(a){return fs(s.settings.display.theme,a)||(s.settings.display.theme=a),a}),tt("change",function(){return s.updateDisplaySettings()}),G(46,"option",18),ue(47),Me(48,"translate"),$(),G(49,"option",19),ue(50),Me(51,"translate"),$()()()(),G(52,"section",7)(53,"h3"),ue(54),Me(55,"translate"),$(),G(56,"div",8)(57,"label",9),ue(58),Me(59,"translate"),$(),G(60,"p",20),ue(61),Me(62,"translate"),$(),G(63,"div",21)(64,"label",22)(65,"input",23),ns("ngModelChange",function(a){return fs(s.settings.notation.notationMode,a)||(s.settings.notation.notationMode=a),a}),tt("change",function(){return s.updateNotationSettings()}),$(),Ln(66,"span",24),G(67,"span",25)(68,"strong"),ue(69),Me(70,"translate"),$()()(),G(71,"label",22)(72,"input",26),ns("ngModelChange",function(a){return fs(s.settings.notation.notationMode,a)||(s.settings.notation.notationMode=a),a}),tt("change",function(){return s.updateNotationSettings()}),$(),Ln(73,"span",24),G(74,"span",25)(75,"strong"),ue(76),Me(77,"translate"),$()()(),G(78,"label",22)(79,"input",27),ns("ngModelChange",function(a){return fs(s.settings.notation.notationMode,a)||(s.settings.notation.notationMode=a),a}),tt("change",function(){return s.updateNotationSettings()}),$(),Ln(80,"span",24),G(81,"span",25)(82,"strong"),ue(83),Me(84,"translate"),$()()()()(),G(85,"div",8)(86,"label",9),ue(87),Me(88,"translate"),$(),G(89,"select",10),ns("ngModelChange",function(a){return fs(s.settings.notation.noteNameFormat,a)||(s.settings.notation.noteNameFormat=a),a}),tt("change",function(){return s.updateNotationSettings()}),G(90,"option",28),ue(91),Me(92,"translate"),$(),G(93,"option",29),ue(94),Me(95,"translate"),$(),G(96,"option",30),ue(97),Me(98,"translate"),$()()()(),G(99,"section",7)(100,"h3"),ue(101),Me(102,"translate"),$(),G(103,"div",8)(104,"label",9),ue(105),Me(106,"translate"),$(),G(107,"input",31),ns("ngModelChange",function(a){return fs(s.settings.playback.speed,a)||(s.settings.playback.speed=a),a}),tt("change",function(){return s.updatePlaybackSettings()}),$()(),G(108,"div",8)(109,"label",32)(110,"input",33),ns("ngModelChange",function(a){return fs(s.settings.playback.metronomeEnabled,a)||(s.settings.playback.metronomeEnabled=a),a}),tt("change",function(){return s.updatePlaybackSettings()}),$(),G(111,"span",34),ue(112),Me(113,"translate"),$()()(),G(114,"div",8)(115,"label",32)(116,"input",33),ns("ngModelChange",function(a){return fs(s.settings.playback.countInEnabled,a)||(s.settings.playback.countInEnabled=a),a}),tt("change",function(){return s.updatePlaybackSettings()}),$(),G(117,"span",34),ue(118),Me(119,"translate"),$()()()(),G(120,"section",7)(121,"button",35),tt("click",function(){return s.resetSettings()}),ue(122),Me(123,"translate"),$()()()()),2&i&&(oi("open",s.isOpen),O(3),Ke(Ae(4,43,"SETTINGS.TITLE")),O(2),Hs("aria-label",Ae(6,45,"SETTINGS.CLOSE")),O(8),Ke(Ae(14,47,"SETTINGS.DISPLAY")),O(4),Ke(Ae(18,49,"SETTINGS.NOTE_REPLACEMENT")),O(2),ts("ngModel",s.settings.display.noteNamesTarget),O(2),Ke(Ae(22,51,"OPTIONS.NOTE_REPLACEMENT.NONE")),O(3),Ke(Ae(25,53,"OPTIONS.NOTE_REPLACEMENT.TAB_NUMBERS")),O(3),Ke(Ae(28,55,"OPTIONS.NOTE_REPLACEMENT.TAB_NUMBERS_OCTAVE")),O(3),Ke(Ae(31,57,"OPTIONS.NOTE_REPLACEMENT.SCALE_DEGREES")),O(3),Ke(Ae(34,59,"OPTIONS.NOTE_REPLACEMENT.SCALE_DEGREES_ROMAN")),O(2),pt("ngIf","none"!==s.settings.display.noteNamesTarget),O(3),tc("",Ae(39,61,"SETTINGS.ZOOM"),": ",100*s.settings.display.zoom,"%"),O(2),ts("ngModel",s.settings.display.zoom),O(3),Ke(Ae(44,63,"SETTINGS.THEME")),O(2),ts("ngModel",s.settings.display.theme),O(2),Ke(Ae(48,65,"OPTIONS.THEME.LIGHT")),O(3),Ke(Ae(51,67,"OPTIONS.THEME.DARK")),O(4),Ke(Ae(55,69,"SETTINGS.NOTATION")),O(4),Ke(Ae(59,71,"SETTINGS.DISPLAY_MODE")),O(3),fn(" ",Ae(62,73,"SETTINGS.DISPLAY_MODE_DESC")," "),O(4),ts("ngModel",s.settings.notation.notationMode),O(4),Ke(Ae(70,75,"OPTIONS.NOTATION_MODE.STAFF_ONLY")),O(3),ts("ngModel",s.settings.notation.notationMode),O(4),Ke(Ae(77,77,"OPTIONS.NOTATION_MODE.TAB_ONLY")),O(3),ts("ngModel",s.settings.notation.notationMode),O(4),Ke(Ae(84,79,"OPTIONS.NOTATION_MODE.BOTH")),O(4),Ke(Ae(88,81,"SETTINGS.NOTE_NAME_FORMAT")),O(2),ts("ngModel",s.settings.notation.noteNameFormat),O(2),Ke(Ae(92,83,"OPTIONS.NOTE_FORMAT.ENGLISH")),O(3),Ke(Ae(95,85,"OPTIONS.NOTE_FORMAT.GERMAN")),O(3),Ke(Ae(98,87,"OPTIONS.NOTE_FORMAT.SOLFEGE")),O(4),Ke(Ae(102,89,"SETTINGS.PLAYBACK")),O(4),tc("",Ae(106,91,"SETTINGS.SPEED"),": ",s.settings.playback.speed,"%"),O(2),ts("ngModel",s.settings.playback.speed),O(3),ts("ngModel",s.settings.playback.metronomeEnabled),O(2),Ke(Ae(113,93,"SETTINGS.METRONOME")),O(4),ts("ngModel",s.settings.playback.countInEnabled),O(2),Ke(Ae(119,95,"SETTINGS.COUNT_IN")),O(4),fn(" ",Ae(123,97,"SETTINGS.RESET")," "))},dependencies:[Yw,gp,fI,tI,iI,Jp,fS,Xp,lg,dS,eS,og,Yp,J0],styles:['.settings-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:-400px;width:400px;height:100vh;background:#fff;box-shadow:-2px 0 8px #00000026;transition:right .3s ease;z-index:1001;overflow-y:auto}.settings-panel.open[_ngcontent-%COMP%]{right:0}.settings-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #e0e0e0;position:sticky;top:0;background:#fff;z-index:1}.settings-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:600;color:#333}.close-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;color:#666;transition:color .2s}.close-btn[_ngcontent-%COMP%]:hover{color:#333}.settings-content[_ngcontent-%COMP%]{padding:20px}.settings-section[_ngcontent-%COMP%]{margin-bottom:32px}.settings-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#444;margin:0 0 16px;padding-bottom:8px;border-bottom:2px solid #f0f0f0}.setting-item[_ngcontent-%COMP%]{margin-bottom:24px}.setting-label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;color:#555;margin-bottom:8px}.setting-description[_ngcontent-%COMP%]{font-size:12px;color:#888;margin:4px 0 8px;line-height:1.4}.radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.radio-label[_ngcontent-%COMP%]{display:flex;align-items:flex-start;cursor:pointer;-webkit-user-select:none;user-select:none;padding:12px;border:2px solid #e0e0e0;border-radius:8px;transition:all .2s}.radio-label[_ngcontent-%COMP%]:hover{border-color:#667eea;background-color:#f8f9ff}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}.radio-button[_ngcontent-%COMP%]{position:relative;width:20px;height:20px;border:2px solid #ddd;border-radius:50%;margin-right:12px;flex-shrink:0;transition:all .2s}.radio-button[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);width:10px;height:10px;border-radius:50%;background-color:#667eea;transition:transform .2s}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]:checked ~ .radio-button[_ngcontent-%COMP%]{border-color:#667eea}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]:checked ~ .radio-button[_ngcontent-%COMP%]:after{transform:translate(-50%,-50%) scale(1)}.radio-text[_ngcontent-%COMP%]{font-size:14px;color:#555;line-height:1.5}.radio-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333;display:block;margin-bottom:2px}.checkbox[_ngcontent-%COMP%]{margin-right:8px;cursor:pointer;width:18px;height:18px;accent-color:#667eea}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:#555;cursor:pointer}.toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}.toggle-slider[_ngcontent-%COMP%]{position:relative;display:inline-block;width:48px;height:24px;background-color:#ccc;border-radius:24px;transition:background-color .3s;margin-right:12px;flex-shrink:0}.toggle-slider[_ngcontent-%COMP%]:before{content:"";position:absolute;width:20px;height:20px;border-radius:50%;background-color:#fff;top:2px;left:2px;transition:transform .3s}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]{background-color:#4caf50}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .toggle-slider[_ngcontent-%COMP%]:before{transform:translate(24px)}.slider[_ngcontent-%COMP%]{width:100%;height:6px;border-radius:3px;background:#e0e0e0;outline:none;-webkit-appearance:none}.slider[_ngcontent-%COMP%]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:#4caf50;cursor:pointer;-webkit-transition:background .2s;transition:background .2s}.slider[_ngcontent-%COMP%]::-webkit-slider-thumb:hover{background:#45a049}.slider[_ngcontent-%COMP%]::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:#4caf50;cursor:pointer;border:none;-moz-transition:background .2s;transition:background .2s}.slider[_ngcontent-%COMP%]::-moz-range-thumb:hover{background:#45a049}.select[_ngcontent-%COMP%]{width:100%;padding:10px 12px;font-size:14px;border:1px solid #ddd;border-radius:6px;background:#fff;color:#333;cursor:pointer;transition:border-color .2s}.select[_ngcontent-%COMP%]:hover{border-color:#4caf50}.select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50;box-shadow:0 0 0 3px #4caf501a}.settings-footer[_ngcontent-%COMP%]{padding-top:20px;border-top:1px solid #e0e0e0;margin-top:32px}.reset-btn[_ngcontent-%COMP%]{width:100%;padding:12px;background:#f44336;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .2s}.reset-btn[_ngcontent-%COMP%]:hover{background:#d32f2f}.settings-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s;z-index:1000}.settings-overlay.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}@media (max-width: 768px){.settings-panel[_ngcontent-%COMP%]{width:100%;right:-100%}}']})}return n})();const EY=["alphaTab"],BY=["settingsPanel"];function PY(n,t){if(1&n&&(G(0,"div",20),ue(1),$()),2&n){const e=Gt();O(),Ke(e.songTitle)}}function IY(n,t){if(1&n&&(G(0,"div",23)(1,"span",25),ue(2),Me(3,"translate"),$(),G(4,"span",26),ue(5),G(6,"span",27),ue(7),$()()()),2&n){const e=Gt(2);O(2),Ke(Ae(3,4,"HEADER.KEY")),O(3),fn(" ","ru"===e.getCurrentLanguage()?e.keyInfo.keyNameRu:e.keyInfo.keyName," "),O(),pt("title","\u0423\u0432\u0435\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u044c: "+(100*e.keyInfo.confidence).toFixed(0)+"%"),O(),fn(" (",(100*e.keyInfo.confidence).toFixed(0),"%) ")}}function MY(n,t){if(1&n&&(G(0,"div",23)(1,"span",25),ue(2),Me(3,"translate"),$(),G(4,"span",28),ue(5),G(6,"span",29),ue(7),$()()()),2&n){const e=Gt(2);O(2),fn("",Ae(3,3,"HEADER.TUNING"),":"),O(3),fn(" ",e.tuningInfo.tuningName," "),O(2),fn("[",e.getFormattedTuning(),"]")}}function AY(n,t){if(1&n){const e=zr();G(0,"div",23)(1,"button",30),tt("click",function(){return Ss(e),_s(Gt(2).toggleTracksPanel())}),Me(2,"translate"),ue(3),Me(4,"translate"),$()()}if(2&n){const e=Gt(2);O(),oi("active",e.showTracksPanel),pt("title",Ae(2,5,"HEADER.TRACKS")),O(2),tc(" \u{1f3b8} ",Ae(4,7,"HEADER.TRACKS")," (",e.tracks.length,") ")}}function FY(n,t){if(1&n){const e=zr();G(0,"div",21),Mn(1,IY,8,6,"div",22)(2,MY,8,5,"div",22)(3,AY,5,9,"div",22),G(4,"div",23)(5,"button",24),tt("click",function(){return Ss(e),_s(Gt().toggleFretboardOctaves())}),ue(6),$()()()}if(2&n){const e=Gt();O(),pt("ngIf",e.keyInfo),O(),pt("ngIf",e.tuningInfo),O(),pt("ngIf",e.tracks.length>1),O(2),oi("active",e.showFretboardOctaves),pt("title","ru"===e.getCurrentLanguage()?"\u041e\u043a\u0442\u0430\u0432\u044b \u043d\u0430 \u0433\u0440\u0438\u0444\u0435":"Fretboard Octaves"),O(),fn(" \u{1f3b5} ","ru"===e.getCurrentLanguage()?"\u041e\u043a\u0442\u0430\u0432\u044b":"Octaves"," ")}}function LY(n,t){if(1&n){const e=zr();G(0,"div",31),tt("click",function(){Ss(e);const s=Gt();return _s(s.showTracksPanel?s.toggleTracksPanel():s.toggleFretboardOctaves())}),$()}}function RY(n,t){if(1&n){const e=zr();G(0,"div",38)(1,"div",39)(2,"input",40),tt("change",function(){const r=Ss(e).$implicit;return _s(Gt(2).toggleTrackVisibility(r.index))}),$(),G(3,"label",41)(4,"span",42),ue(5),$(),ue(6),G(7,"span",43),ue(8),$()()(),G(9,"div",44)(10,"button",45),tt("click",function(){const r=Ss(e).$implicit;return _s(Gt(2).toggleTrackMute(r.index))}),ue(11," \u{1f507} "),$(),G(12,"button",46),tt("click",function(){const r=Ss(e).$implicit;return _s(Gt(2).toggleTrackSolo(r.index))}),ue(13," \u{1f50a} "),$()()()}if(2&n){const e=t.$implicit;oi("track-visible",e.isVisible)("track-muted",e.isMuted)("track-solo",e.isSolo),O(2),pt("checked",e.isVisible)("id","track-"+e.index),O(),pt("for","track-"+e.index),O(2),fn("",e.index+1,"."),O(),fn(" ",e.name," "),O(2),fn("(",e.instrument,")"),O(2),oi("active",e.isMuted),Wf("title",e.isMuted?"Unmute":"Mute"),O(2),oi("active",e.isSolo),Wf("title",e.isSolo?"Unsolo":"Solo")}}function OY(n,t){if(1&n){const e=zr();G(0,"div",32)(1,"div",33)(2,"span",34),ue(3),Me(4,"translate"),$(),G(5,"button",35),tt("click",function(){return Ss(e),_s(Gt().toggleTracksPanel())}),ue(6,"\u2715"),$()(),G(7,"div",36),Mn(8,RY,14,18,"div",37),$()()}if(2&n){const e=Gt();O(3),Ke(Ae(4,2,"HEADER.TRACKS")),O(5),pt("ngForOf",e.tracks)}}function VY(n,t){if(1&n&&(G(0,"div",60),Ln(1,"span",61),G(2,"span",62),ue(3),$()()),2&n){const e=t.$implicit,i=Gt(2);O(),Ff("background-color",i.getOctaveColor(e)),O(2),tc(" ","ru"===i.getCurrentLanguage()?"\u041e\u043a\u0442\u0430\u0432\u0430":"Octave"," ",e," ")}}function HY(n,t){if(1&n&&(G(0,"div",63),ue(1),$()),2&n){const e=t.$implicit;O(),fn(" ",e," ")}}const WM=()=>[40,45,50,55,59,64],WY=()=>[3,5,7,9,12,15,17,19,21,24];function UY(n,t){if(1&n&&(G(0,"div",66)(1,"span",67),ue(2),$()()),2&n){const e=t.$implicit,i=Gt().$implicit,s=Gt(2);Ff("background-color",s.getOctaveColor(s.getOctaveForMidi(Na(5,WM)[i-1]+e))),oi("fret-marker",Na(6,WY).includes(e)),O(2),fn(" ",s.getOctaveForMidi(Na(7,WM)[i-1]+e)," ")}}const UM=()=>[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];function GY(n,t){if(1&n&&(G(0,"div",64)(1,"div",56),ue(2),$(),Mn(3,UY,3,8,"div",65),$()),2&n){const e=t.$implicit;O(2),Ke(e),O(),pt("ngForOf",Na(2,UM))}}const zY=()=>[2,3,4,5,6,7],$Y=()=>[1,2,3,4,5,6];function jY(n,t){if(1&n){const e=zr();G(0,"div",47)(1,"div",48)(2,"span",49),ue(3),$(),G(4,"button",50),tt("click",function(){return Ss(e),_s(Gt().toggleFretboardOctaves())}),ue(5,"\u2715"),$()(),G(6,"div",51),Mn(7,VY,4,4,"div",52),$(),G(8,"div",53)(9,"div",54)(10,"div",55)(11,"div",56),ue(12),$(),Mn(13,HY,2,1,"div",57),$(),Mn(14,GY,4,3,"div",58),$()(),G(15,"div",59)(16,"p"),ue(17),$(),G(18,"p"),ue(19),$()()()}if(2&n){const e=Gt();O(3),fn(" ","ru"===e.getCurrentLanguage()?"\u041e\u043a\u0442\u0430\u0432\u044b \u043d\u0430 \u0433\u0438\u0442\u0430\u0440\u043d\u043e\u043c \u0433\u0440\u0438\u0444\u0435":"Guitar Fretboard Octaves"," "),O(4),pt("ngForOf",Na(7,zY)),O(5),Ke("ru"===e.getCurrentLanguage()?"\u0421\u0442\u0440\u0443\u043d\u0430":"String"),O(),pt("ngForOf",Na(8,UM)),O(),pt("ngForOf",Na(9,$Y)),O(3),Ke("ru"===e.getCurrentLanguage()?"\u0421\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0441\u0442\u0440\u043e\u0439: E-A-D-G-B-E (6-\u044f \u0441\u0442\u0440\u0443\u043d\u0430 \u2192 1-\u044f \u0441\u0442\u0440\u0443\u043d\u0430)":"Standard tuning: E-A-D-G-B-E (6th string \u2192 1st string)"),O(2),Ke("ru"===e.getCurrentLanguage()?"\u041a\u0430\u0436\u0434\u0430\u044f \u044f\u0447\u0435\u0439\u043a\u0430 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u043e\u043c\u0435\u0440 \u043e\u043a\u0442\u0430\u0432\u044b \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u043e\u0437\u0438\u0446\u0438\u0438 \u043d\u0430 \u0433\u0440\u0438\u0444\u0435":"Each cell shows the octave number for that position on the fretboard")}}function qY(n,t){if(1&n&&(Ca(0),G(1,"div",81),ue(2),$(),Ln(3,"div",82),Da()),2&n){const e=t.$implicit;O(2),Ke(e.short)}}function YY(n,t){if(1&n&&(Ca(0),G(1,"div",84),ue(2),$(),Ln(3,"div",82),Da()),2&n){const e=t.$implicit;O(2),Ke(e.englishFull)}}function XY(n,t){if(1&n&&(G(0,"div",83),Mn(1,YY,4,1,"ng-container",76),$()),2&n){const e=Gt(2);O(),pt("ngForOf",e.scaleDegrees)}}function JY(n,t){if(1&n&&(Ca(0),G(1,"div",86),ue(2),$(),Ln(3,"div",82),Da()),2&n){const e=t.$implicit;O(2),Ke(e.russianFull)}}function QY(n,t){if(1&n&&(G(0,"div",85),Mn(1,JY,4,1,"ng-container",76),$()),2&n){const e=Gt(2);O(),pt("ngForOf",e.scaleDegrees)}}function KY(n,t){if(1&n&&(Ca(0),G(1,"div",88),ue(2),$(),Ln(3,"div",82),Da()),2&n){const e=t.$implicit;O(2),Ke(e)}}function ZY(n,t){if(1&n&&(G(0,"div",87),Mn(1,KY,4,1,"ng-container",76),$()),2&n){const e=Gt(2);O(),pt("ngForOf",e.scaleNotes)}}function eX(n,t){if(1&n&&(Ca(0),Ln(1,"div",89),G(2,"div",90)(3,"span",91),ue(4),$()(),Da()),2&n){const e=t.$implicit,i=Gt(2);O(4),Ke("ru"===i.getCurrentLanguage()?"T"===e.interval?"\u0422\u043e\u043d":"\u041f\u043e\u043b\u0443\u0442\u043e\u043d":e.intervalEnglish)}}function tX(n,t){if(1&n){const e=zr();G(0,"div",68)(1,"div",69)(2,"span",70),ue(3),Me(4,"translate"),$(),G(5,"div",71)(6,"label",72)(7,"input",73),ns("ngModelChange",function(s){Ss(e);const r=Gt();return fs(r.showScaleNotes,s)||(r.showScaleNotes=s),_s(s)}),$(),G(8,"span"),ue(9),Me(10,"translate"),$()()()(),G(11,"div",74)(12,"div",75),Mn(13,qY,4,1,"ng-container",76),$(),Mn(14,XY,2,1,"div",77)(15,QY,2,1,"div",78)(16,ZY,2,1,"div",79),G(17,"div",80),Mn(18,eX,5,1,"ng-container",76),$()()()}if(2&n){const e=Gt();O(3),Ke(Ae(4,8,"HEADER.SCALE_DEGREES")),O(4),ts("ngModel",e.showScaleNotes),O(2),Ke(Ae(10,10,"SCALE_DEGREES.NOTES")),O(4),pt("ngForOf",e.scaleDegrees),O(),pt("ngIf","en"===e.getCurrentLanguage()),O(),pt("ngIf","ru"===e.getCurrentLanguage()),O(),pt("ngIf",e.showScaleNotes&&e.scaleNotes.length>0),O(2),pt("ngForOf",e.scaleDegrees)}}(function OW(n,t){return u8({rootComponent:n,...aE(t)})})((()=>{class n{constructor(e,i,s,r){this.alphaTabService=e,this.settingsService=i,this.keyDetectionService=s,this.translate=r,this.title="Guitar Pro Clone",this.keyInfo=null,this.tuningInfo=null,this.songTitle="",this.scaleDegrees=[],this.scaleNotes=[],this.showScaleNotes=!1,this.tracks=[],this.showTracksPanel=!1,this.showFretboardOctaves=!1,this.translate.addLangs(["en","ru"]),this.translate.setDefaultLang("en");const a=localStorage.getItem("app-language")||"en";this.translate.use(a),this.scaleDegrees=this.keyDetectionService.getScaleDegrees()}ngAfterViewInit(){this.alphaTabService.initialize(this.alphaTabElement.nativeElement,"https://www.alphatab.net/files/canon.gp"),this.alphaTabService.scoreLoaded$.subscribe(()=>{setTimeout(()=>{this.updateSongInfo()},500)})}ngOnDestroy(){this.alphaTabService.destroy()}updateSongInfo(){const e=this.alphaTabService.getApi();!e||!e.score||(console.log("[AppComponent] Updating song info..."),this.songTitle=e.score.title||"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f",this.keyInfo=this.keyDetectionService.detectKey(e.score),this.tuningInfo=this.keyDetectionService.getTuningInfo(e.score),this.keyInfo&&(this.scaleNotes=this.keyDetectionService.getScaleNotes(this.keyInfo)),this.tracks=this.alphaTabService.getTracks(),console.log("[AppComponent] Song info updated:",{title:this.songTitle,key:this.keyInfo,tuning:this.tuningInfo,scaleNotes:this.scaleNotes,tracks:this.tracks}))}getFormattedTuning(){return this.tuningInfo?this.keyDetectionService.formatTuning(this.tuningInfo):""}isScaleDegreesMode(){const e=this.settingsService.getCurrentSettings();return"scale-degrees"===e.display.noteNamesTarget||"scale-degrees-roman"===e.display.noteNamesTarget}openSettings(){this.settingsPanel.togglePanel()}getCurrentNoteNamesTarget(){return this.settingsService.getCurrentSettings().display.noteNamesTarget}setNoteNamesTarget(e){const i=this.settingsService.getCurrentSettings();this.settingsService.updateSettings({display:{...i.display,noteNamesTarget:e}})}getCurrentLanguage(){return this.translate.currentLang||"en"}switchLanguage(e){this.translate.use(e),localStorage.setItem("app-language",e)}toggleTracksPanel(){this.showTracksPanel=!this.showTracksPanel}toggleTrackVisibility(e){this.alphaTabService.toggleTrackVisibility(e),this.tracks=this.alphaTabService.getTracks()}toggleTrackMute(e){this.alphaTabService.toggleTrackMute(e),this.tracks=this.alphaTabService.getTracks()}toggleTrackSolo(e){this.alphaTabService.toggleTrackSolo(e),this.tracks=this.alphaTabService.getTracks()}toggleFretboardOctaves(){this.showFretboardOctaves=!this.showFretboardOctaves}getOctaveForMidi(e){return Math.floor(e/12)-1}getFretboardData(){const e=[64,59,55,50,45,40],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=[];for(let r=0;r<e.length;r++)for(let a=0;a<=24;a++){const o=e[r]+a,l=Math.floor(o/12)-1;s.push({string:r+1,fret:a,note:i[o%12],octave:l})}return s}getOctaveColor(e){return{2:"#e53e3e",3:"#dd6b20",4:"#d69e2e",5:"#38a169",6:"#3182ce",7:"#805ad5"}[e]||"#718096"}static#e=this.\u0275fac=function(i){return new(i||n)(j(HM),j(sm),j(VM),j(vh))};static#t=this.\u0275cmp=Wc({type:n,selectors:[["app-root"]],viewQuery:function(i,s){if(1&i&&(cw(EY,5),cw(BY,5)),2&i){let r;Uf(r=Gf())&&(s.alphaTabElement=r.first),Uf(r=Gf())&&(s.settingsPanel=r.first)}},standalone:!0,features:[Vu],decls:41,vars:39,consts:[[1,"app-container"],[1,"app-header"],[1,"header-content"],[1,"header-main"],["class","song-title",4,"ngIf"],[1,"language-switcher"],["title","English",1,"lang-btn",3,"click"],["title","\u0420\u0443\u0441\u0441\u043a\u0438\u0439",1,"lang-btn",3,"click"],[1,"header-tabs"],[1,"tab-btn",3,"click"],["class","music-info",4,"ngIf"],["class","tracks-backdrop",3,"click",4,"ngIf"],["class","tracks-panel",4,"ngIf"],["class","fretboard-octaves-panel",4,"ngIf"],["class","scale-degrees-table",4,"ngIf"],[3,"onOpenSettings"],[1,"tablature-container"],[1,"alphatab-viewport"],["alphaTab",""],["settingsPanel",""],[1,"song-title"],[1,"music-info"],["class","info-item",4,"ngIf"],[1,"info-item"],[1,"octaves-toggle-btn",3,"title","click"],[1,"info-label"],[1,"info-value","key-badge"],[1,"confidence",3,"title"],[1,"info-value","tuning-badge"],[1,"tuning-notes"],[1,"tracks-toggle-btn",3,"title","click"],[1,"tracks-backdrop",3,"click"],[1,"tracks-panel"],[1,"tracks-panel-header"],[1,"tracks-panel-title"],[1,"tracks-panel-close",3,"click"],[1,"tracks-list"],["class","track-item",3,"track-visible","track-muted","track-solo",4,"ngFor","ngForOf"],[1,"track-item"],[1,"track-info"],["type","checkbox",1,"track-visibility-check",3,"checked","id","change"],[1,"track-name",3,"for"],[1,"track-number"],[1,"track-instrument"],[1,"track-controls"],[1,"track-control-btn","mute-btn",3,"title","click"],[1,"track-control-btn","solo-btn",3,"title","click"],[1,"fretboard-octaves-panel"],[1,"fretboard-panel-header"],[1,"fretboard-panel-title"],[1,"fretboard-panel-close",3,"click"],[1,"fretboard-legend"],["class","legend-item",4,"ngFor","ngForOf"],[1,"fretboard-container"],[1,"fretboard-grid"],[1,"fret-header"],[1,"string-label"],["class","fret-number",4,"ngFor","ngForOf"],["class","string-row",4,"ngFor","ngForOf"],[1,"fretboard-info"],[1,"legend-item"],[1,"legend-color"],[1,"legend-text"],[1,"fret-number"],[1,"string-row"],["class","fret-cell",3,"background-color","fret-marker",4,"ngFor","ngForOf"],[1,"fret-cell"],[1,"fret-octave"],[1,"scale-degrees-table"],[1,"table-header"],[1,"table-title"],[1,"table-toggles"],[1,"toggle-label"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"degrees-grid-container"],[1,"degrees-row","row-short"],[4,"ngFor","ngForOf"],["class","degrees-row row-english",4,"ngIf"],["class","degrees-row row-russian",4,"ngIf"],["class","degrees-row row-notes",4,"ngIf"],[1,"degrees-row","row-intervals"],[1,"degree-cell","cell-short"],[1,"interval-spacer"],[1,"degrees-row","row-english"],[1,"degree-cell","cell-english"],[1,"degrees-row","row-russian"],[1,"degree-cell","cell-russian"],[1,"degrees-row","row-notes"],[1,"degree-cell","cell-note"],[1,"interval-placeholder"],[1,"interval-cell"],[1,"interval-label"]],template:function(i,s){1&i&&(G(0,"div",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"h1"),ue(5),Me(6,"translate"),$(),Mn(7,PY,2,1,"div",4),G(8,"div",5)(9,"button",6),tt("click",function(){return s.switchLanguage("en")}),ue(10," EN "),$(),G(11,"button",7),tt("click",function(){return s.switchLanguage("ru")}),ue(12," RU "),$()()(),G(13,"div",8)(14,"button",9),tt("click",function(){return s.setNoteNamesTarget("none")}),ue(15),Me(16,"translate"),$(),G(17,"button",9),tt("click",function(){return s.setNoteNamesTarget("tab-numbers")}),ue(18),Me(19,"translate"),$(),G(20,"button",9),tt("click",function(){return s.setNoteNamesTarget("tab-numbers-octave")}),ue(21),Me(22,"translate"),$(),G(23,"button",9),tt("click",function(){return s.setNoteNamesTarget("scale-degrees")}),ue(24),Me(25,"translate"),$(),G(26,"button",9),tt("click",function(){return s.setNoteNamesTarget("scale-degrees-roman")}),ue(27),Me(28,"translate"),$()(),Mn(29,FY,7,7,"div",10)(30,LY,1,0,"div",11)(31,OY,9,4,"div",12)(32,jY,20,10,"div",13)(33,tX,19,12,"div",14),$()(),Ln(34,"app-player-controls",15),G(35,"div",16),Ln(36,"div",17,18),$(),Ln(38,"app-settings-panel",null,19)(40,"router-outlet"),$()),2&i&&(O(5),Ke(Ae(6,27,"APP.TITLE")),O(2),pt("ngIf",s.songTitle),O(2),oi("active","en"===s.getCurrentLanguage()),O(2),oi("active","ru"===s.getCurrentLanguage()),O(3),oi("active","none"===s.getCurrentNoteNamesTarget()),O(),fn(" ",Ae(16,29,"TABS.DEFAULT")," "),O(2),oi("active","tab-numbers"===s.getCurrentNoteNamesTarget()),O(),fn(" ",Ae(19,31,"TABS.NOTE_NAMES")," "),O(2),oi("active","tab-numbers-octave"===s.getCurrentNoteNamesTarget()),O(),fn(" ",Ae(22,33,"TABS.NOTE_NAMES_OCTAVE")," "),O(2),oi("active","scale-degrees"===s.getCurrentNoteNamesTarget()),O(),fn(" ",Ae(25,35,"TABS.FRETBOARD_DEGREES")," "),O(2),oi("active","scale-degrees-roman"===s.getCurrentNoteNamesTarget()),O(),fn(" ",Ae(28,37,"TABS.ROMAN_NUMERALS")," "),O(2),pt("ngIf",s.keyInfo||s.tuningInfo),O(),pt("ngIf",s.showTracksPanel||s.showFretboardOctaves),O(),pt("ngIf",s.showTracksPanel&&s.tracks.length>0),O(),pt("ngIf",s.showFretboardOctaves),O(),pt("ngIf",s.isScaleDegreesMode()&&s.scaleDegrees.length>0),O(),pt("onOpenSettings",s.openSettings.bind(s)))},dependencies:[E0,Yw,F1,gp,fI,Xp,eS,og,Yp,J0,DY,xY],styles:[".app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#f5f5f5}.app-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:10px 24px;box-shadow:0 2px 8px #0000001a}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}.header-main[_ngcontent-%COMP%]{flex:0 0 auto;min-width:250px;display:flex;align-items:center;gap:12px}.app-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;font-size:28px;font-weight:700;letter-spacing:-.5px}.language-switcher[_ngcontent-%COMP%]{display:flex;gap:2px;background:#ffffff1a;padding:2px;border-radius:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.lang-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#fff9;padding:4px 10px;border-radius:4px;cursor:pointer;font-size:11px;font-weight:700;letter-spacing:.5px;transition:all .2s ease;min-width:32px}.lang-btn[_ngcontent-%COMP%]:hover{background:#ffffff26;color:#ffffffd9}.lang-btn.active[_ngcontent-%COMP%]{background:#ffffff40;color:#fff;box-shadow:0 1px 4px #00000026}.header-tabs[_ngcontent-%COMP%]{display:flex;gap:4px;background:#ffffff1a;padding:4px;border-radius:10px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);flex:0 0 auto}.tab-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ffffffb3;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s ease;white-space:nowrap}.tab-btn[_ngcontent-%COMP%]:hover{background:#ffffff26;color:#ffffffe6}.tab-btn.active[_ngcontent-%COMP%]{background:#ffffff40;color:#fff;box-shadow:0 2px 8px #00000026}.song-title[_ngcontent-%COMP%]{font-size:18px;font-weight:500;opacity:.95;margin-top:4px}.music-info[_ngcontent-%COMP%]{display:flex;gap:24px;flex-wrap:wrap;align-items:center}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;background:#ffffff26;padding:10px 16px;border-radius:8px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);min-width:200px}.info-label[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;letter-spacing:.5px;opacity:.9;font-weight:600}.info-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px}.key-badge[_ngcontent-%COMP%]{color:#fff}.confidence[_ngcontent-%COMP%]{font-size:12px;opacity:.8;font-weight:400}.tuning-badge[_ngcontent-%COMP%]{color:#fff;display:flex;flex-direction:column;gap:4px}.tuning-notes[_ngcontent-%COMP%]{font-size:12px;opacity:.85;font-weight:400;font-family:Courier New,monospace}.scale-degrees-table[_ngcontent-%COMP%]{width:100%;padding:16px;background:#ffffff26;border-radius:12px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 4px 12px #0000001a}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding:4px 0}.table-title[_ngcontent-%COMP%]{font-size:11px;text-transform:uppercase;letter-spacing:.5px;opacity:.95;font-weight:600}.table-toggles[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:10px;font-weight:500;cursor:pointer;opacity:.85;transition:opacity .2s}.toggle-label[_ngcontent-%COMP%]:hover{opacity:1}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{cursor:pointer;width:14px;height:14px}.toggle-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.degrees-grid-container[_ngcontent-%COMP%]{background:#fffffff2;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #00000014;padding:8px}.degrees-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr 40px);align-items:center;border-bottom:1px solid rgba(0,0,0,.08)}.degrees-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.degree-cell[_ngcontent-%COMP%]{text-align:center;padding:12px 8px;font-weight:600}.interval-spacer[_ngcontent-%COMP%]{width:40px}.row-short[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f0f4ff,#e8edff)}.row-short[_ngcontent-%COMP%]   .cell-short[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#667eea;padding:8px}.row-notes[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff9e6,#fff3cc)}.row-notes[_ngcontent-%COMP%]   .cell-note[_ngcontent-%COMP%]{font-size:15px;font-weight:700;color:#d97706;padding:10px 8px}.row-english[_ngcontent-%COMP%]{background:#fff}.row-english[_ngcontent-%COMP%]   .cell-english[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#2d3748;padding:10px 8px}.row-russian[_ngcontent-%COMP%]{background:#fafafa}.row-russian[_ngcontent-%COMP%]   .cell-russian[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#4a5568;padding:10px 8px}.row-intervals[_ngcontent-%COMP%]{background:transparent;padding:8px 0;position:relative}.interval-cell[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;text-align:center}.interval-label[_ngcontent-%COMP%]{font-size:11px;font-weight:600;color:#c53030;white-space:nowrap}@media (max-width: 768px){.degrees-row[_ngcontent-%COMP%]{grid-template-columns:repeat(7,1fr 30px)}.interval-spacer[_ngcontent-%COMP%], .interval-cell[_ngcontent-%COMP%]{width:30px}.degree-cell[_ngcontent-%COMP%]{padding:8px 4px;font-size:11px}.row-short[_ngcontent-%COMP%]   .cell-short[_ngcontent-%COMP%]{font-size:16px;padding:8px 4px}.row-notes[_ngcontent-%COMP%]   .cell-note[_ngcontent-%COMP%]{font-size:13px;padding:8px 4px}.row-english[_ngcontent-%COMP%]   .cell-english[_ngcontent-%COMP%]{font-size:11px;padding:8px 4px}.row-russian[_ngcontent-%COMP%]   .cell-russian[_ngcontent-%COMP%]{font-size:10px;padding:8px 4px}.interval-label[_ngcontent-%COMP%]{font-size:9px}}.degree-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 8px;background:#ffffff1a;border-radius:4px;font-size:11px}.degree-short[_ngcontent-%COMP%]{font-weight:700;font-size:13px;color:#fff;min-width:28px}.degree-sep[_ngcontent-%COMP%]{opacity:.5}.degree-english[_ngcontent-%COMP%]{font-weight:500;opacity:.9}.degree-russian[_ngcontent-%COMP%]{opacity:.85;font-style:italic}.tablature-container[_ngcontent-%COMP%]{flex:1;overflow:auto;background:#fff;position:relative}.alphatab-viewport[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .at-cursor-bar{background:#fff20040}[_nghost-%COMP%]     .at-selection div{background:#667eea33}[_nghost-%COMP%]     .at-cursor-beat{background:#667eeabf;width:3px}[_nghost-%COMP%]     .at-highlight *{fill:#667eea;stroke:#667eea}[_nghost-%COMP%]     .note-target-tab-numbers.note-mechanism-overlay .at-tab-number{opacity:.15!important;font-weight:600;font-size:12px}[_nghost-%COMP%]     .note-target-tab-numbers.note-mechanism-replace .at-tab-number{color:transparent!important;opacity:0!important;visibility:hidden!important}[_nghost-%COMP%]     .note-target-tab-numbers.note-mechanism-replace .note-name-label{font-size:16px!important;font-weight:700!important;color:#667eea!important}[_nghost-%COMP%]     #note-names-overlay{position:absolute;top:0;left:0;pointer-events:none;z-index:10}[_nghost-%COMP%]     .note-name-label{color:#667eea;font-weight:700;background-color:#fffffff2;border-radius:4px;font-size:14px;line-height:1}[_nghost-%COMP%]     .show-octave-numbers .note-name-label{font-size:11px}@media (max-width: 768px){.app-header[_ngcontent-%COMP%]{padding:16px}.app-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:22px}.header-content[_ngcontent-%COMP%]{gap:12px}.header-main[_ngcontent-%COMP%]{min-width:200px}.header-tabs[_ngcontent-%COMP%]{width:100%;justify-content:center;order:3}.tab-btn[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.music-info[_ngcontent-%COMP%]{order:2;width:100%}.scale-degrees-table[_ngcontent-%COMP%]{order:4;width:100%}}.tablature-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px;height:10px}.tablature-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.tablature-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:5px}.tablature-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.tracks-toggle-btn[_ngcontent-%COMP%]{background:#ffffff26;border:none;color:#fff;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s ease;display:flex;align-items:center;gap:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.tracks-toggle-btn[_ngcontent-%COMP%]:hover{background:#ffffff40;transform:translateY(-1px);box-shadow:0 2px 8px #00000026}.tracks-toggle-btn.active[_ngcontent-%COMP%]{background:#ffffff4d;box-shadow:0 2px 8px #0003}.tracks-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:999;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.tracks-panel[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fffffffa;border-radius:16px;padding:20px;box-shadow:0 8px 32px #00000040;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:1000;min-width:400px;max-width:90vw;max-height:80vh;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translate(-50%,-55%)}to{opacity:1;transform:translate(-50%,-50%)}}.tracks-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:12px;border-bottom:2px solid rgba(102,126,234,.2)}.tracks-panel-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#667eea}.tracks-panel-close[_ngcontent-%COMP%]{background:transparent;border:none;color:#667eea;font-size:20px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:all .2s ease;line-height:1}.tracks-panel-close[_ngcontent-%COMP%]:hover{background:#667eea1a;transform:rotate(90deg)}.tracks-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow-y:auto}.track-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#fff;border:2px solid #e0e0e0;border-radius:8px;transition:all .2s ease}.track-item[_ngcontent-%COMP%]:hover{border-color:#667eea;box-shadow:0 2px 8px #667eea26}.track-item.track-visible[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea0d}.track-item.track-muted[_ngcontent-%COMP%]{opacity:.6}.track-item.track-solo[_ngcontent-%COMP%]{border-color:#4caf50;background:#4caf500d}.track-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1}.track-visibility-check[_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#667eea}.track-name[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:14px;font-weight:500;color:#333;-webkit-user-select:none;user-select:none}.track-number[_ngcontent-%COMP%]{color:#667eea;font-weight:700;min-width:24px}.track-instrument[_ngcontent-%COMP%]{color:#888;font-size:12px;font-weight:400}.track-controls[_ngcontent-%COMP%]{display:flex;gap:6px}.track-control-btn[_ngcontent-%COMP%]{background:#667eea1a;border:none;width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:16px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.track-control-btn[_ngcontent-%COMP%]:hover{background:#667eea33;transform:scale(1.1)}.track-control-btn.active[_ngcontent-%COMP%]{background:#667eea;box-shadow:0 2px 6px #667eea66}.track-control-btn.mute-btn.active[_ngcontent-%COMP%]{background:#f44336;box-shadow:0 2px 6px #f4433666}.track-control-btn.solo-btn.active[_ngcontent-%COMP%]{background:#4caf50;box-shadow:0 2px 6px #4caf5066}.tracks-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.tracks-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.tracks-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:3px}.tracks-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}@media (max-width: 768px){.tracks-panel[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;max-width:90%;max-height:80vh}.tracks-list[_ngcontent-%COMP%]{max-height:calc(80vh - 100px)}.track-name[_ngcontent-%COMP%]{font-size:13px}.track-instrument[_ngcontent-%COMP%]{display:none}}.octaves-toggle-btn[_ngcontent-%COMP%]{background:#ffffff26;border:none;color:#fff;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s ease;display:flex;align-items:center;gap:6px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.octaves-toggle-btn[_ngcontent-%COMP%]:hover{background:#ffffff40;transform:translateY(-1px);box-shadow:0 2px 8px #00000026}.octaves-toggle-btn.active[_ngcontent-%COMP%]{background:#ffffff4d;box-shadow:0 2px 8px #0003}.fretboard-octaves-panel[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fffffffa;border-radius:16px;padding:20px;box-shadow:0 8px 32px #00000040;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:1000;max-width:95vw;max-height:85vh;overflow:auto;animation:_ngcontent-%COMP%_slideDown .3s ease-out}.fretboard-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid rgba(102,126,234,.2)}.fretboard-panel-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#667eea}.fretboard-panel-close[_ngcontent-%COMP%]{background:transparent;border:none;color:#667eea;font-size:20px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:all .2s ease;line-height:1}.fretboard-panel-close[_ngcontent-%COMP%]:hover{background:#667eea1a;transform:rotate(90deg)}.fretboard-legend[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:20px;padding:12px;background:#667eea0d;border-radius:8px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.legend-color[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:4px;border:2px solid rgba(0,0,0,.1)}.legend-text[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#2d3748}.fretboard-container[_ngcontent-%COMP%]{overflow-x:auto;margin-bottom:16px;background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 8px #0000000d}.fretboard-grid[_ngcontent-%COMP%]{display:inline-block;min-width:max-content}.fret-header[_ngcontent-%COMP%]{display:flex;gap:2px;margin-bottom:4px}.fret-number[_ngcontent-%COMP%]{width:32px;height:24px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:600;color:#667eea;background:#667eea0d;border-radius:4px 4px 0 0}.string-row[_ngcontent-%COMP%]{display:flex;gap:2px;margin-bottom:2px}.string-label[_ngcontent-%COMP%]{width:48px;height:32px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#667eea;background:#667eea0d;border-radius:4px}.fret-cell[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,.1);border-radius:4px;transition:all .2s ease;cursor:pointer;position:relative}.fret-cell[_ngcontent-%COMP%]:hover{transform:scale(1.15);box-shadow:0 2px 8px #0003;z-index:10;border-color:#0000004d}.fret-cell.fret-marker[_ngcontent-%COMP%]{border:2px solid rgba(0,0,0,.3);box-shadow:inset 0 0 0 2px #ffffff4d}.fret-octave[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3)}.fretboard-info[_ngcontent-%COMP%]{padding:12px;background:#667eea0d;border-radius:8px;font-size:13px;color:#4a5568;line-height:1.6}.fretboard-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.fretboard-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-weight:600;color:#667eea}.fretboard-octaves-panel[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.fretboard-octaves-panel[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.fretboard-octaves-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#667eea;border-radius:4px}.fretboard-octaves-panel[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#5a67d8}.fretboard-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.fretboard-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.fretboard-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e0;border-radius:4px}.fretboard-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a0aec0}@media (max-width: 768px){.fretboard-octaves-panel[_ngcontent-%COMP%]{max-width:98vw;max-height:90vh;padding:12px}.fretboard-panel-title[_ngcontent-%COMP%]{font-size:16px}.fretboard-legend[_ngcontent-%COMP%]{gap:8px}.legend-color[_ngcontent-%COMP%]{width:20px;height:20px}.legend-text[_ngcontent-%COMP%]{font-size:11px}.fret-cell[_ngcontent-%COMP%]{width:28px;height:28px}.fret-number[_ngcontent-%COMP%]{width:28px;font-size:9px}.fret-octave[_ngcontent-%COMP%]{font-size:11px}.string-label[_ngcontent-%COMP%]{width:40px;height:28px;font-size:11px}.fretboard-info[_ngcontent-%COMP%]{font-size:11px}}"]})}return n})(),$z).catch(n=>console.error(n))}},am=>{am(am.s=964)}]);